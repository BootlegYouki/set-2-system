import"../chunks/DsnmJJEf.js";import{w as j,h as la,a as ra,a0 as Da,aT as Ca,f as na,al as Ta,ax as $a,aU as Ma,aV as ja,aW as ia,G as Ra,aX as Pa,ak as Ot,q as Ss,ae as N,_ as ks,T as c,t as b,x as n,y as Ds,l as e,A as s,aS as Ps,aY as ma,ad as ht,ag as ee,aZ as Xs,a_ as et,v as L,z as t,B as a,a$ as pa,C as u,i as hs,ah as ns,ai as rs,b0 as Ns,b1 as Ia,P as Aa}from"../chunks/Dzme5HSP.js";import{p as Re,i as h,b as xs,s as ta,a as aa,c as oa}from"../chunks/BxRcuCIW.js";import{t as Ve,e as is,T as Fa,s as le,a as ke,b as qt,i as Os,r as yt,c as gt,d as Qt,m as sa,f as Gt,g as va,h as Bt,j as Ea,k as Ms,q as za,l as Na,n as Lt}from"../chunks/CadbDdOh.js";import{c as Oa}from"../chunks/B4dZFGov.js";function da(m,l,r=!1,w=!1,R=!1){var q=m,k="";j(()=>{var o=Da;if(k===(k=l()??"")){la&&ra();return}if(o.nodes_start!==null&&(Ca(o.nodes_start,o.nodes_end),o.nodes_start=o.nodes_end=null),k!==""){if(la){na.data;for(var G=ra(),_=G;G!==null&&(G.nodeType!==Ta||G.data!=="");)_=G,G=$a(G);if(G===null)throw Ma(),ja;ia(na,_),q=Ra(G);return}var F=k+"";r?F=`<svg>${F}</svg>`:w&&(F=`<math>${F}</math>`);var i=Pa(F);if((r||w)&&(i=Ot(i)),ia(Ot(i),i.lastChild),r||w)for(;Ot(i);)q.before(Ot(i));else q.before(i)}})}const ca="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48px'%20viewBox='0%20-960%20960%20960'%20width='48px'%20fill='%23789DE5'%3e%3cpath%20d='M222-255q63-40%20124.5-60.5T480-336q72%200%20134%2020.5T739-255q44-54%2062.5-109T820-480q0-145-97.5-242.5T480-820q-145%200-242.5%2097.5T140-480q0%2061%2019%20116t63%20109Zm257.81-195q-57.81%200-97.31-39.69-39.5-39.68-39.5-97.5%200-57.81%2039.69-97.31%2039.68-39.5%2097.5-39.5%2057.81%200%2097.31%2039.69%2039.5%2039.68%2039.5%2097.5%200%2057.81-39.69%2097.31-39.68%2039.5-97.5%2039.5Zm-.21%20370q-83.15%200-156.28-31.5t-127.22-86Q142-252%20111-324.84%2080-397.68%2080-480.5t31.5-155.66Q143-709%20197.5-763t127.34-85.5Q397.68-880%20480.5-880t155.66%2031.5Q709-817%20763-763t85.5%20127Q880-563%20880-480.27q0%2082.74-31.5%20155.5Q817-252%20763-197.5t-127.13%2086Q562.74-80%20479.6-80Z'/%3e%3c/svg%3e",Ga="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48px'%20viewBox='0%20-960%20960%20960'%20width='48px'%20fill='%23789DE5'%3e%3cpath%20d='M480.17-450Q537-450%20577-490.17t40-97Q617-644%20576.83-684t-97-40Q423-724%20383-683.83t-40%2097Q343-530%20383.17-490t97%2040ZM480-81q-148-38-234-162.54Q160-368.08%20160-523v-238l320-120%20320%20120v238q0%20154.92-86%20279.46Q628-119%20480-81Zm0-62q60-20%20108-59.5t83-90.5q-44.67-21.02-92.97-32.01Q529.72-336%20479.86-336t-98.07%2010.99Q333.58-314.02%20289-293q35%2051%2083%2090.5T480-143Z'/%3e%3c/svg%3e",Ba="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48px'%20viewBox='0%20-960%20960%20960'%20width='48px'%20fill='%23789DE5'%3e%3cpath%20d='M860-283v-282L479-360%2040-600l439-240%20441%20240v317h-60ZM479-120%20189-279v-210l290%20159%20290-159v210L479-120Z'/%3e%3c/svg%3e",La="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48px'%20viewBox='0%20-960%20960%20960'%20width='48px'%20fill='%23789DE5'%3e%3cpath%20d='M480-302q-74%200-139.5%2024.5T220-211v71h520v-71q-55-42-120.5-66.5T480-302ZM220-80q-24%200-42-18t-18-42v-680q0-24%2018-42t42-18h520q24%200%2042%2018t18%2042v680q0%2024-18%2042t-42%2018H220Zm262-301q58%200%2098-40t40-98q0-58-40-98t-98-40q-58%200-98%2040t-40%2098q0%2058%2040%2098t98%2040Z'/%3e%3c/svg%3e";var Qa=b('<div class="toast-container svelte-n5a2bz"></div>');function Ua(m,l){Ss(l,!0);let r=N(ks([]));Ve.subscribe(q=>{c(r,q,!0)});function w(q){setTimeout(()=>{Ve.remove(q)},300)}var R=Qa();is(R,21,()=>e(r),q=>q.id,(q,k)=>{Fa(q,{get message(){return e(k).message},get type(){return e(k).type},get duration(){return e(k).duration},onClose:()=>w(e(k).id)})}),s(R),n(m,R),Ds()}function ua(m,l,r){l()&&m.target===m.currentTarget&&r()}var Va=b('<h2 id="modal-title" class="modal-title svelte-z32m4t"> </h2>'),Ha=b('<button class="modal-close-btn svelte-z32m4t" aria-label="Close modal"><span class="material-symbols-outlined svelte-z32m4t">close</span></button>'),Ya=b('<div class="modal-header svelte-z32m4t"><!> <!></div>'),Ka=b('<div role="presentation"><div role="dialog" aria-modal="true" tabindex="-1"><!> <div class="modal-body svelte-z32m4t"><!></div></div></div>');function wt(m,l){Ss(l,!0);let r=Re(l,"title",3,""),w=Re(l,"size",3,"medium"),R=Re(l,"closable",3,!0),q=Re(l,"backdrop",3,!0),k=N(!1),o=N(!1),G=N(void 0);const _=ma();ht(()=>(setTimeout(()=>{c(k,!0)},10),e(G)&&e(G).focus(),document.body.style.overflow="hidden",()=>{document.body.style.overflow=""}));function F(){R()&&(c(o,!0),setTimeout(()=>{c(k,!1),document.body.style.overflow="",l.onClose&&l.onClose(),_("close")},300))}function i(C){C.key==="Escape"&&R()&&F()}function S(C){switch(C){case"small":return"modal-small";case"large":return"modal-large";case"xlarge":return"modal-xlarge";case"full":return"modal-full";default:return"modal-medium"}}var I=ee();Xs("keydown",et,i);var O=L(I);{var y=C=>{var H=Ka();let Z;H.__click=[ua,q,F],H.__keydown=[ua,q,F];var Q=t(H),xe=t(Q);{var be=U=>{var V=Ya(),Se=t(V);{var ze=ie=>{var se=Va(),Ne=t(se,!0);s(se),j(()=>u(Ne,r())),n(ie,se)};h(Se,ie=>{r()&&ie(ze)})}var Pe=a(Se,2);{var ue=ie=>{var se=Ha();se.__click=F,n(ie,se)};h(Pe,ie=>{R()&&ie(ue)})}s(V),n(U,V)};h(xe,U=>{(r()||R())&&U(be)})}var _e=a(xe,2),re=t(_e);pa(re,()=>l.children),s(_e),s(Q),xs(Q,U=>c(G,U),()=>e(G)),s(H),j((U,V)=>{Z=le(H,1,"modal-overlay svelte-z32m4t",null,Z,U),le(Q,1,`modal-content ${V??""}`,"svelte-z32m4t"),ke(Q,"aria-labelledby",r()?"modal-title":void 0)},[()=>({"modal-visible":e(k)&&!e(o),"modal-closing":e(o)}),()=>S(w())]),n(C,H)};h(O,C=>{(e(k)||e(o))&&C(y)})}n(m,I),Ds()}Ps(["click","keydown"]);function Wa(m,l,r){const w=Array.from(m.target.files||[]);if(w.length===0)return;const R=10*1024*1024,q=w.filter(k=>k.size>R?(Ve.error(`File "${k.name}" is too large. Maximum size is 10MB.`),!1):!0);c(l,[...e(l),...q],!0),e(r)&&(e(r).value="")}function Za(m,l){e(l)&&e(l).click()}function Ja(m,l){c(l,!e(l))}function Xa(m,l){c(l,!0)}async function el(m,l,r,w,R,q){const k={status:e(l).status,tentativeDate:e(l).status==="for_compliance"?void 0:e(l).tentativeDate,paymentAmount:e(l).paymentAmount,paymentStatus:e(r)},o=await w()(e(l).requestId,k);c(R,!1),o&&await q()}function sl(m,l){c(l,!0)}async function tl(m,l,r,w,R){await l()(e(r).requestId),c(w,!1),R()()}function al(m,l,r){!e(l)||!e(l).requestId||c(r,!0)}async function ll(m,l,r,w,R,q,k){if(!(!e(l)||!e(l).requestId)){c(r,!1),c(w,!0);try{const o=await qt(`/api/document-requests?action=generateReceipt&requestId=${e(l).requestId}`,{method:"GET"});if(!o.ok){const O=await o.json();Ve.error(O.error||"Failed to generate receipt"),c(w,!1);return}const G=await o.blob(),_=await R(G),F=[{name:`receipt-${e(l).requestId}.pdf`,type:"application/pdf",size:G.size,data:_}],i=`temp-${Date.now()}`,S=`Receipt generated for ${e(l).requestId}`,I={id:i,text:S,author:q().userData?.name||"Admin",authorRole:"admin",created_at:new Date().toISOString(),attachments:F,isPending:!0};e(l).messages=[...e(l).messages||[],I],k();try{const y=await(await qt("/api/document-requests",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"sendMessage",requestId:e(l).requestId,message:S,attachments:F})})).json();y.success?(e(l).messages=e(l).messages.map(C=>C.id===i?{...y.data,id:i,isPending:!1}:C),Ve.success("Receipt generated and sent to chat successfully")):(e(l).messages=e(l).messages.filter(C=>C.id!==i),Ve.error(y.error||"Failed to send receipt to chat"))}catch(O){console.error("Error sending receipt to chat:",O),e(l).messages=e(l).messages.filter(y=>y.id!==i),Ve.error("Receipt generated but failed to send to chat")}}catch(o){console.error("Error generating receipt:",o),Ve.error("An error occurred while generating the receipt")}finally{c(w,!1)}}}function rl(m,l){c(l,e(l)==="paid"?"pending":"paid",!0)}var nl=b('<button class="generate-receipt-btn svelte-qbny1s" title="Generate Receipt"><span class="material-symbols-outlined svelte-qbny1s">receipt</span> <span>Generate Receipt</span></button>'),il=(m,l,r)=>l(e(r).id),ol=b('<button type="button" class="docreq-status-item svelte-qbny1s" role="option"><span></span> <span class="status-text svelte-qbny1s"> </span></button>'),vl=b('<div class="docreq-card svelte-qbny1s"><div class="card-label svelte-qbny1s"><span class="material-symbols-outlined">event</span> </div> <div class="admin-card-value svelte-qbny1s"><div class="date-box readonly svelte-qbny1s"> </div></div></div>'),dl=b('<span class="not-set svelte-qbny1s">Not set</span>'),cl=b('<div class="docreq-card svelte-qbny1s"><div class="card-label svelte-qbny1s"><span class="material-symbols-outlined">event_busy</span> Cancelled Date</div> <div class="admin-card-value svelte-qbny1s"> </div></div>'),ul=b('<div class="message-avatar svelte-qbny1s"><span class="material-symbols-outlined svelte-qbny1s">account_circle</span></div>'),ml=b('<div class="admin-document-request-message-text"> </div>'),pl=(m,l,r)=>l(e(r)),_l=b('<button class="attachment-item svelte-qbny1s"><span class="material-symbols-outlined svelte-qbny1s">attach_file</span> <div class="attachment-info svelte-qbny1s"><span class="attachment-name svelte-qbny1s"> </span> <span class="attachment-size svelte-qbny1s"> </span></div> <span class="material-symbols-outlined svelte-qbny1s">download</span></button>'),fl=b('<div class="message-attachments svelte-qbny1s"></div>'),bl=b('<div><!> <div class="message-bubble svelte-qbny1s"><div class="message-header svelte-qbny1s"><span class="message-author svelte-qbny1s"> </span> <span class="message-time svelte-qbny1s"> </span></div> <!> <!></div></div>'),ql=b('<div class="no-chat svelte-qbny1s"><span class="material-symbols-outlined svelte-qbny1s">chat_bubble_outline</span> <p class="svelte-qbny1s">No messages yet</p> <p class="subtitle svelte-qbny1s">Start a conversation with the student</p></div>'),yl=b('<div class="file-preview-item svelte-qbny1s"><span class="material-symbols-outlined svelte-qbny1s">description</span> <span class="file-preview-name svelte-qbny1s"> </span> <span class="file-preview-size svelte-qbny1s"> </span> <button class="remove-file-btn svelte-qbny1s" title="Remove file"><span class="material-symbols-outlined svelte-qbny1s">close</span></button></div>'),gl=b('<div class="selected-files-preview svelte-qbny1s"></div>'),wl=b('<div class="chat-disabled-notice svelte-qbny1s"><span class="material-symbols-outlined svelte-qbny1s">block</span> <span> </span></div>'),hl=(m,l,r)=>m.key==="Enter"&&!m.shiftKey&&!e(l)&&r(),kl=b('<input type="file" multiple accept="image/*,.pdf,.doc,.docx,.xls,.xlsx,.txt" style="display: none;" class="svelte-qbny1s"/> <button class="attach-btn svelte-qbny1s" title="Attach file" aria-label="Attach file"><span class="material-symbols-outlined svelte-qbny1s">attach_file</span></button> <input placeholder="Type your message..." aria-label="Message input" class="svelte-qbny1s"/> <button class="send-btn svelte-qbny1s" title="Send message" aria-label="Send message"><span class="material-symbols-outlined svelte-qbny1s">send</span></button>',1),xl=b('<div class="confirm-detail-row svelte-qbny1s"><span class="detail-label svelte-qbny1s"> </span> <span class="detail-value svelte-qbny1s"> </span></div>'),Sl=b('<div class="modal-confirm-content svelte-qbny1s"><div class="modal-message svelte-qbny1s"><p class="svelte-qbny1s">Are you sure you want to update this document request?</p> <div class="confirm-details svelte-qbny1s"><div class="confirm-detail-row svelte-qbny1s"><span class="detail-label svelte-qbny1s">Request ID:</span> <span class="detail-value svelte-qbny1s"> </span></div> <div class="confirm-detail-row svelte-qbny1s"><span class="detail-label svelte-qbny1s">New Status:</span> <span class="detail-value svelte-qbny1s"> </span></div> <!> <div class="confirm-detail-row svelte-qbny1s"><span class="detail-label svelte-qbny1s">Payment Amount:</span> <span class="detail-value svelte-qbny1s"><!></span></div> <div class="confirm-detail-row svelte-qbny1s"><span class="detail-label svelte-qbny1s">Payment Status:</span> <span> </span></div></div></div> <div class="modal-actions svelte-qbny1s"><button class="modal-btn modal-btn-secondary svelte-qbny1s">Cancel</button> <button class="modal-btn modal-btn-primary svelte-qbny1s">Confirm</button></div></div>'),Dl=b('<div class="modal-confirm-content svelte-qbny1s"><div class="modal-message svelte-qbny1s"><p class="svelte-qbny1s">Are you sure you want to reject this document request?</p> <div class="confirm-details reject-warning svelte-qbny1s"><div class="confirm-detail-row svelte-qbny1s"><span class="detail-label svelte-qbny1s">Request ID:</span> <span class="detail-value svelte-qbny1s"> </span></div> <div class="confirm-detail-row svelte-qbny1s"><span class="detail-label svelte-qbny1s">Student:</span> <span class="detail-value svelte-qbny1s"> </span></div> <div class="confirm-detail-row svelte-qbny1s"><span class="detail-label svelte-qbny1s">Document Type:</span> <span class="detail-value svelte-qbny1s"> </span></div> <div class="reject-notice svelte-qbny1s"><span class="material-symbols-outlined svelte-qbny1s">warning</span> <span>This action will mark the request as rejected and notify the student.</span></div></div></div> <div class="modal-actions svelte-qbny1s"><button class="modal-btn modal-btn-secondary svelte-qbny1s">Cancel</button> <button class="modal-btn modal-btn-danger svelte-qbny1s">Reject Request</button></div></div>'),Cl=b('<div class="modal-confirm-content svelte-qbny1s"><div class="modal-message svelte-qbny1s"><p class="svelte-qbny1s">Generate receipt for this document request?</p> <div class="confirm-details svelte-qbny1s"><div class="confirm-detail-row svelte-qbny1s"><span class="detail-label svelte-qbny1s">Request ID:</span> <span class="detail-value svelte-qbny1s"> </span></div> <div class="confirm-detail-row svelte-qbny1s"><span class="detail-label svelte-qbny1s">Student:</span> <span class="detail-value svelte-qbny1s"> </span></div> <div class="confirm-detail-row svelte-qbny1s"><span class="detail-label svelte-qbny1s">Document Type:</span> <span class="detail-value svelte-qbny1s"> </span></div> <div class="reject-notice svelte-qbny1s" style="background: rgba(33, 150, 243, 0.1); border-color: #2196F3;"><span class="material-symbols-outlined svelte-qbny1s" style="color: #2196F3;">info</span> <span>The receipt will be generated and automatically sent to the chat.</span></div></div></div> <div class="modal-actions svelte-qbny1s"><button class="modal-btn modal-btn-secondary svelte-qbny1s">Cancel</button> <button class="modal-btn modal-btn-primary svelte-qbny1s"> </button></div></div>'),Tl=b('<div class="docreq-modal-content svelte-qbny1s"><div class="docreq-modal-grid svelte-qbny1s"><div class="docreq-modal-left-container svelte-qbny1s"><header class="docreq-modal-title svelte-qbny1s"><div class="docreq-modal-title-row svelte-qbny1s"><div><h2 class="svelte-qbny1s">Request Details</h2> <div class="docreq-modal-sub svelte-qbny1s">ID: <span> </span></div></div> <!></div></header> <div class="docreq-cards svelte-qbny1s"><div class="docreq-card svelte-qbny1s"><div class="card-label svelte-qbny1s"><span class="material-symbols-outlined">description</span> Document Type</div> <div class="admin-card-value svelte-qbny1s"> </div></div> <div class="docreq-card svelte-qbny1s"><div class="card-label svelte-qbny1s"><span class="material-symbols-outlined">info</span> Status</div> <div class="admin-card-value svelte-qbny1s"><div aria-haspopup="listbox"><button class="docreq-status-dropdown-trigger svelte-qbny1s" aria-label="Change status"><span class="docreq-status-dropdown-label svelte-qbny1s"> </span> <span class="material-symbols-outlined docreq-status-dropdown-caret svelte-qbny1s"> </span></button> <div class="docreq-status-dropdown-menu svelte-qbny1s" role="listbox" aria-label="Select status"></div></div></div></div> <div class="docreq-card svelte-qbny1s"><div class="card-label svelte-qbny1s"><span class="material-symbols-outlined">account_circle</span> Processed By</div> <div class="admin-card-value svelte-qbny1s"> </div></div> <!> <div class="docreq-card svelte-qbny1s"><div class="card-label svelte-qbny1s"><span class="material-symbols-outlined">numbers</span> Quantity</div> <div class="admin-card-value svelte-qbny1s"> </div></div> <div class="docreq-card svelte-qbny1s"><div class="card-label svelte-qbny1s"><span class="material-symbols-outlined">payments</span> Payment Amount</div> <div class="admin-card-value svelte-qbny1s"><div class="payment-display-container svelte-qbny1s"><div><!></div> <div class="payment-actions svelte-qbny1s"><button><span class="material-symbols-outlined svelte-qbny1s"> </span></button></div></div></div></div> <!></div> <div class="docreq-purpose svelte-qbny1s"><div class="purpose-label svelte-qbny1s"><span class="material-symbols-outlined">description</span> Purpose & Details</div> <div class="purpose-content svelte-qbny1s"> </div></div> <div class="action-buttons svelte-qbny1s"><button class="docreq-approve-button svelte-qbny1s"><span class="material-symbols-outlined svelte-qbny1s">check_circle</span> Update Request</button> <button class="docreq-reject-button svelte-qbny1s"><span class="material-symbols-outlined svelte-qbny1s">cancel</span> Reject Request</button> <button class="docreq-complete-button svelte-qbny1s"><span class="material-symbols-outlined svelte-qbny1s">arrow_back</span> Back</button></div></div> <div class="docreq-modal-right-container svelte-qbny1s"><div class="student-info-section svelte-qbny1s"><h3 class="svelte-qbny1s"><span class="material-symbols-outlined">school</span> Student Information</h3> <div class="student-info-grid svelte-qbny1s"><div class="student-field svelte-qbny1s"><div class="field-label svelte-qbny1s">Student ID</div> <div class="field-value svelte-qbny1s"> </div></div> <div class="student-field svelte-qbny1s"><div class="field-label svelte-qbny1s">Full Name</div> <div class="field-value svelte-qbny1s"> </div></div> <div class="student-field svelte-qbny1s"><div class="field-label svelte-qbny1s">Grade & Section</div> <div class="field-value svelte-qbny1s"> </div></div> <div class="student-field svelte-qbny1s"><div class="field-label svelte-qbny1s">Date of birth</div> <div class="field-value svelte-qbny1s"> </div></div></div></div> <div class="chat-container svelte-qbny1s"><div class="chat-header svelte-qbny1s"><h3 class="svelte-qbny1s"><span class="material-symbols-outlined svelte-qbny1s">forum</span> Communication</h3> <span class="chat-count-badge svelte-qbny1s"> </span></div> <div class="admin-chat-messages svelte-qbny1s"><!></div> <div class="admin-chat-input-wrapper svelte-qbny1s"><!> <div><!></div></div></div></div></div></div> <!> <!> <!>',1);function _a(m,l){Ss(l,!0);const[r,w]=ta(),R=()=>aa(Qt,"$authStore",r);let q=Re(l,"request",19,()=>({})),k=Re(l,"requestStatuses",19,()=>[]),o=Re(l,"modalStatuses",19,()=>[]),G=Re(l,"onUpdate",3,async()=>{}),_=Re(l,"onReject",3,async()=>{}),F=Re(l,"onClose",3,()=>{});ma();let i=N(ks({...q()}));hs(()=>{q()&&q().requestId&&c(i,{...q()},!0)});let S=N(!1),I=N(""),O=N(!1),y=N(void 0),C=N(void 0),H=N(void 0),Z=N(ks([])),Q,xe=N(!1),be=N(!1),_e=N(!1),re=N("pending"),U=ns(()=>e(i).messages||[]),V=N(ks(q().status||"")),Se=N(ks(q().paymentStatus||"pending"));hs(()=>{q()&&q().status&&c(V,q().status,!0),q()&&q().paymentStatus?c(Se,q().paymentStatus,!0):q()&&c(Se,"pending")});let ze=ns(()=>e(V)==="released"||e(V)==="cancelled");hs(()=>{e(i)&&e(i).paymentStatus?c(re,e(i).paymentStatus,!0):e(i)&&c(re,"pending")});function Pe(){e(y)&&setTimeout(()=>{e(y).scrollTop=e(y).scrollHeight},100)}function ue(v){c(Z,e(Z).filter((p,T)=>T!==v),!0)}async function ie(v){return new Promise((p,T)=>{const g=new FileReader;g.onload=()=>p(g.result),g.onerror=T,g.readAsDataURL(v)})}function se(v){const p=document.createElement("a");p.href=v.data,p.download=v.name,p.click()}async function Ne(){if(!e(I).trim()&&e(Z).length===0||e(O)||e(ze))return;c(O,!0);const v=e(I).trim(),p=[...e(Z)];let T=[];try{for(const z of p){const M=await ie(z);T.push({name:z.name,type:z.type,size:z.size,data:M})}}catch(z){console.error("Error converting files:",z),Ve.error("Failed to process files. Please try again."),c(O,!1);return}const g=`temp-${Date.now()}`,P={id:g,text:v,author:R().userData?.name||"Admin",authorRole:"admin",created_at:new Date().toISOString(),attachments:T,isPending:!0};e(i).messages=[...e(i).messages||[],P],c(I,""),c(Z,[],!0),Pe(),e(C)&&setTimeout(()=>e(C).focus(),50);try{const M=await(await qt("/api/document-requests",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"sendMessage",requestId:e(i).requestId,message:v,attachments:T})})).json();M.success?e(i).messages=e(i).messages.map(ce=>ce.id===g?{...M.data,id:g,isPending:!1}:ce):(console.error("Failed to send message:",M.error),e(i).messages=e(i).messages.filter(ce=>ce.id!==g),Ve.error("Failed to send message. Please try again."),c(I,v,!0),c(Z,p,!0))}catch(z){console.error("Error sending message:",z),e(i).messages=e(i).messages.filter(M=>M.id!==g),Ve.error("An error occurred while sending the message."),c(I,v,!0),c(Z,p,!0)}finally{c(O,!1)}}function ms(v){if(e(i)){if(e(i).status=v,v==="verifying"||v==="processing"){const p=new Date;p.setDate(p.getDate()+5);const T=p.getFullYear(),g=String(p.getMonth()+1).padStart(2,"0"),P=String(p.getDate()).padStart(2,"0");e(i).tentativeDate=`${T}-${g}-${P}`}else if(v==="for_compliance"){const T=e(V)==="non_compliance"?2:3,g=new Date;g.setDate(g.getDate()+T);const P=g.getFullYear(),z=String(g.getMonth()+1).padStart(2,"0"),M=String(g.getDate()).padStart(2,"0");e(i).tentativeDate=`${P}-${z}-${M}`}else e(i).tentativeDate=null;c(S,!1)}}function ye(v){if(!v)return"--/--/----";const[p,T,g]=v.split("-");return!p||!T||!g?"--/--/----":`${T}/${g}/${p}`}async function Xe(){if(!(!e(i)||!e(i).requestId))try{const p=await(await qt(`/api/document-requests?action=single&requestId=${e(i).requestId}`)).json();p.success&&p.data&&(c(i,{...p.data},!0),p.data.status&&c(V,p.data.status,!0),p.data.paymentStatus?(c(re,p.data.paymentStatus,!0),c(Se,p.data.paymentStatus,!0)):c(Se,"pending"))}catch(v){console.error("Error refreshing request data:",v)}}function He(){c(xe,!1)}function os(){c(be,!1)}async function es(v){return new Promise((p,T)=>{const g=new FileReader;g.onload=()=>p(g.result),g.onerror=T,g.readAsDataURL(v)})}function ge(){c(_e,!1)}let Ie=ns(()=>e(i)&&(k().find(v=>v.id===e(i).status)||{}).name||"Select");function oe(v){v.target.closest(".docreq-status-dropdown")||c(S,!1)}function De(v){v.key==="Escape"&&e(S)&&c(S,!1)}async function Ce(){if(!(!e(i)||e(O)))try{const p=await(await qt(`/api/document-requests?action=single&requestId=${e(i).requestId}`,{method:"GET"})).json();if(p.success&&p.data.messages){const T=e(U).filter(M=>M.isPending),g=p.data.messages,P=new Set(e(U).filter(M=>!M.isPending).map(M=>M.id));g.filter(M=>!P.has(M.id)).length>0&&(e(i).messages=[...g,...T],Pe())}}catch(v){console.error("Error fetching latest messages:",v)}}function me(){document.hidden?Q&&(clearInterval(Q),Q=null):Q||(Ce(),Q=setInterval(Ce,8e3))}hs(()=>{e(U).length>0&&Pe()}),hs(()=>(Q=setInterval(Ce,8e3),document.addEventListener("visibilitychange",me),Pe(),()=>{Q&&clearInterval(Q),document.removeEventListener("visibilitychange",me)}));var Ae=Tl();Xs("click",et,oe),Xs("keydown",et,De);var Be=L(Ae),we=t(Be),ss=t(we),J=t(ss),Y=t(J),X=t(Y),K=a(t(X),2),Oe=a(t(K)),Le=t(Oe,!0);s(Oe),s(K),s(X);var Te=a(X,2);{var te=v=>{var p=nl();p.__click=[al,i,_e],n(v,p)};h(Te,v=>{e(i).status==="for_pickup"&&v(te)})}s(Y),s(J);var Ye=a(J,2),ve=t(Ye),qe=a(t(ve),2),fs=t(qe,!0);s(qe),s(ve);var Fe=a(ve,2),vs=a(t(Fe),2),ts=t(vs);let bs;var Ke=t(ts);Ke.__click=[Ja,S];var st=t(Ke),tt=t(st,!0);s(st);var at=a(st,2),Ut=t(at,!0);s(at),s(Ke);var lt=a(Ke,2);is(lt,21,o,v=>v.id,(v,p)=>{var T=ol();T.__click=[il,ms,p];var g=t(T),P=a(g,2),z=t(P,!0);s(P),s(T),j(()=>{ke(T,"aria-selected",e(i).status===e(p).id),le(g,1,`status-dot ${e(p).id??""}`,"svelte-qbny1s"),u(z,e(p).name)}),n(v,T)}),s(lt),s(ts),s(vs),s(Fe);var rt=a(Fe,2),kt=a(t(rt),2),Vt=t(kt,!0);s(kt),s(rt);var xt=a(rt,2);{var nt=v=>{var p=vl(),T=t(p),g=a(t(T));s(T);var P=a(T,2),z=t(P),M=t(z,!0);s(z),s(P),s(p),j(ce=>{u(g,` ${e(i).status==="for_compliance"?"Deadline":"Tentative Date"}`),u(M,ce)},[()=>ye(e(i).tentativeDate)]),n(v,p)};h(xt,v=>{e(i).tentativeDate&&v(nt)})}var Gs=a(xt,2),St=a(t(Gs),2),Dt=t(St,!0);s(St),s(Gs);var it=a(Gs,2),ot=a(t(it),2),Is=t(ot),Bs=t(Is),vt=t(Bs);{var Ct=v=>{var p=rs();j(T=>u(p,`₱${T??""}`),[()=>e(i).paymentAmount.toFixed(2)]),n(v,p)},Tt=v=>{var p=dl();n(v,p)};h(vt,v=>{e(i).paymentAmount!==null&&e(i).paymentAmount!==void 0?v(Ct):v(Tt,!1)})}s(Bs);var Ls=a(Bs,2),qs=t(Ls);qs.__click=[rl,re];var $t=t(qs),Qs=t($t,!0);s($t),s(qs),s(Ls),s(Is),s(ot),s(it);var Ht=a(it,2);{var Yt=v=>{var p=cl(),T=a(t(p),2),g=t(T,!0);s(T),s(p),j(()=>u(g,e(i).cancelledDate)),n(v,p)};h(Ht,v=>{e(i).status==="cancelled"&&e(i).cancelledDate&&v(Yt)})}s(Ye);var dt=a(Ye,2),ct=a(t(dt),2),Mt=t(ct,!0);s(ct),s(dt);var jt=a(dt,2),As=t(jt);As.__click=[Xa,xe];var Us=a(As,2);Us.__click=[sl,be];var Kt=a(Us,2);Kt.__click=function(...v){F()?.apply(this,v)},s(jt),s(ss);var Rt=a(ss,2),ut=t(Rt),mt=a(t(ut),2),Vs=t(mt),Hs=a(t(Vs),2),Pt=t(Hs,!0);s(Hs),s(Vs);var Ys=a(Vs,2),pt=a(t(Ys),2),It=t(pt,!0);s(pt),s(Ys);var _t=a(Ys,2),ft=a(t(_t),2),Wt=t(ft);s(ft),s(_t);var bt=a(_t,2),At=a(t(bt),2),Zt=t(At,!0);s(At),s(bt),s(mt),s(ut);var Ft=a(ut,2),d=t(Ft),f=a(t(d),2),D=t(f,!0);s(f),s(d);var x=a(d,2),E=t(x);{var $=v=>{var p=ee(),T=L(p);is(T,17,()=>e(U),g=>g.id,(g,P)=>{var z=bl(),M=t(z);{var ce=ne=>{var Ee=ul();n(ne,Ee)};h(M,ne=>{e(P).authorRole!=="admin"&&ne(ce)})}var ae=a(M,2),W=t(ae),je=t(W),ps=t(je,!0);s(je);var as=a(je,2),Ge=t(as,!0);s(as),s(W);var Ue=a(W,2);{var ds=ne=>{var Ee=ml(),Ts=t(Ee,!0);s(Ee),j(()=>u(Ts,e(P).text)),n(ne,Ee)};h(Ue,ne=>{e(P).text&&ne(ds)})}var _s=a(Ue,2);{var cs=ne=>{var Ee=fl();is(Ee,21,()=>e(P).attachments,Os,(Ts,Fs)=>{var $s=_l();$s.__click=[pl,se,Fs];var us=a(t($s),2),gs=t(us),Je=t(gs,!0);s(gs);var ls=a(gs,2),Es=t(ls);s(ls),s(us),Ns(2),s($s),j(ws=>{u(Je,e(Fs).name),u(Es,`${ws??""} KB`)},[()=>(e(Fs).size/1024).toFixed(1)]),n(Ts,$s)}),s(Ee),n(ne,Ee)};h(_s,ne=>{e(P).attachments&&e(P).attachments.length>0&&ne(cs)})}s(ae),s(z),j(ne=>{le(z,1,`message-wrapper ${e(P).authorRole==="admin"?"sent":"received"}`,"svelte-qbny1s"),u(ps,e(P).author),u(Ge,ne)},[()=>new Date(e(P).created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]),n(g,z)}),n(v,p)},A=v=>{var p=ql();n(v,p)};h(E,v=>{e(U).length>0?v($):v(A,!1)})}s(x),xs(x,v=>c(y,v),()=>e(y));var $e=a(x,2),Me=t($e);{var de=v=>{var p=gl();is(p,21,()=>e(Z),Os,(T,g,P)=>{var z=yl(),M=a(t(z),2),ce=t(M,!0);s(M);var ae=a(M,2),W=t(ae);s(ae);var je=a(ae,2);je.__click=()=>ue(P),s(z),j(ps=>{u(ce,e(g).name),u(W,`(${ps??""} KB)`)},[()=>(e(g).size/1024).toFixed(1)]),n(T,z)}),s(p),n(v,p)};h(Me,v=>{e(Z).length>0&&v(de)})}var pe=a(Me,2);let fe;var B=t(pe);{var We=v=>{var p=wl(),T=a(t(p),2),g=t(T);s(T),s(p),j(()=>u(g,`Chat is disabled for ${e(V)==="released"?"released":"cancelled"} requests`)),n(v,p)},Qe=v=>{var p=kl(),T=L(p);T.__change=[Wa,Z,H],xs(T,M=>c(H,M),()=>e(H));var g=a(T,2);g.__click=[Za,H];var P=a(g,2);yt(P),P.__keydown=[hl,O,Ne],xs(P,M=>c(C,M),()=>e(C));var z=a(P,2);z.__click=Ne,j(M=>{P.disabled=e(O),z.disabled=M},[()=>e(O)||!e(I).trim()&&e(Z).length===0]),gt(P,()=>e(I),M=>c(I,M)),n(v,p)};h(B,v=>{e(ze)?v(We):v(Qe,!1)})}s(pe),s($e),s(Ft),s(Rt),s(we),s(Be);var ys=a(Be,2);{var js=v=>{wt(v,{title:"Confirm Update",size:"small",closable:!0,onClose:He,children:(p,T)=>{var g=Sl(),P=t(g),z=a(t(P),2),M=t(z),ce=a(t(M),2),ae=t(ce,!0);s(ce),s(M);var W=a(M,2),je=a(t(W),2),ps=t(je,!0);s(je),s(W);var as=a(W,2);{var Ge=Je=>{var ls=xl(),Es=t(ls),ws=t(Es,!0);s(Es);var zs=a(Es,2),Jt=t(zs,!0);s(zs),s(ls),j(Xt=>{u(ws,e(i).status==="for_compliance"?"Deadline:":"Tentative Date:"),u(Jt,Xt)},[()=>ye(e(i).tentativeDate)]),n(Je,ls)};h(as,Je=>{e(i).tentativeDate&&Je(Ge)})}var Ue=a(as,2),ds=a(t(Ue),2),_s=t(ds);{var cs=Je=>{var ls=rs();j(()=>u(ls,`₱${e(i).paymentAmount??""}`)),n(Je,ls)},ne=Je=>{var ls=rs("Tentative (not set)");n(Je,ls)};h(_s,Je=>{e(i).paymentAmount!==null&&e(i).paymentAmount!==void 0?Je(cs):Je(ne,!1)})}s(ds),s(Ue);var Ee=a(Ue,2),Ts=a(t(Ee),2),Fs=t(Ts,!0);s(Ts),s(Ee),s(z),s(P);var $s=a(P,2),us=t($s);us.__click=He;var gs=a(us,2);gs.__click=[el,i,re,G,xe,Xe],s($s),s(g),j(()=>{u(ae,e(i).requestId),u(ps,e(Ie)),le(Ts,1,`detail-value payment-status-${e(re)??""}`,"svelte-qbny1s"),u(Fs,e(re)==="paid"?"Paid":"Pending")}),n(p,g)},$$slots:{default:!0}})};h(ys,v=>{e(xe)&&v(js)})}var Rs=a(ys,2);{var he=v=>{wt(v,{title:"Reject Request",size:"small",closable:!0,onClose:os,children:(p,T)=>{var g=Dl(),P=t(g),z=a(t(P),2),M=t(z),ce=a(t(M),2),ae=t(ce,!0);s(ce),s(M);var W=a(M,2),je=a(t(W),2),ps=t(je,!0);s(je),s(W);var as=a(W,2),Ge=a(t(as),2),Ue=t(Ge,!0);s(Ge),s(as),Ns(2),s(z),s(P);var ds=a(P,2),_s=t(ds);_s.__click=os;var cs=a(_s,2);cs.__click=[tl,_,i,be,F],s(ds),s(g),j(()=>{u(ae,e(i).requestId),u(ps,e(i).studentName),u(Ue,e(i).documentType)}),n(p,g)},$$slots:{default:!0}})};h(Rs,v=>{e(be)&&v(he)})}var Ze=a(Rs,2);{var Cs=v=>{wt(v,{title:"Generate Receipt",size:"small",closable:!0,onClose:ge,children:(p,T)=>{var g=Cl(),P=t(g),z=a(t(P),2),M=t(z),ce=a(t(M),2),ae=t(ce,!0);s(ce),s(M);var W=a(M,2),je=a(t(W),2),ps=t(je,!0);s(je),s(W);var as=a(W,2),Ge=a(t(as),2),Ue=t(Ge,!0);s(Ge),s(as),Ns(2),s(z),s(P);var ds=a(P,2),_s=t(ds);_s.__click=ge;var cs=a(_s,2);cs.__click=[ll,i,_e,O,es,R,Pe];var ne=t(cs,!0);s(cs),s(ds),s(g),j(()=>{u(ae,e(i).requestId),u(ps,e(i).studentName),u(Ue,e(i).documentType),cs.disabled=e(O),u(ne,e(O)?"Generating...":"Generate Receipt")}),n(p,g)},$$slots:{default:!0}})};h(Ze,v=>{e(_e)&&v(Cs)})}j((v,p)=>{u(Le,e(i).requestId),u(fs,e(i).documentType),bs=le(ts,1,"docreq-status-dropdown svelte-qbny1s",null,bs,v),ke(ts,"aria-expanded",e(S)),Ke.disabled=q()?.status==="cancelled"||q()?.status==="rejected"||q()?.status==="released",u(tt,e(Ie)),u(Ut,e(S)?"expand_less":"expand_more"),u(Vt,e(i).processedBy??"—"),u(Dt,e(i).quantity?`${e(i).quantity} ${e(i).quantity===1?"Copy":"Copies"}`:"—"),le(Bs,1,`payment-readonly ${(q()?.status!=="cancelled"&&q()?.status!=="rejected"&&e(i).paymentAmount!==null&&e(i).paymentAmount!==void 0?e(re):"")??""}`,"svelte-qbny1s"),le(qs,1,`payment-status-toggle ${e(re)==="paid"?"pending":"paid"}`,"svelte-qbny1s"),ke(qs,"title",e(i).paymentAmount===null||e(i).paymentAmount===void 0?"Set payment amount first":e(re)==="paid"?"Mark as pending":"Mark as paid"),ke(qs,"aria-label",e(re)==="paid"?"Mark as pending":"Mark as paid"),qs.disabled=e(V)==="cancelled"||e(V)==="rejected"||e(V)==="released"||e(i).paymentAmount===null||e(i).paymentAmount===void 0,u(Qs,e(re)==="paid"?"cancel":"check_circle"),u(Mt,e(i).purpose??"No purpose provided"),As.disabled=q()?.status==="cancelled"||q()?.status==="rejected"||q()?.status==="released",Us.disabled=e(V)==="cancelled"||e(V)==="rejected"||e(V)==="released",u(Pt,e(i).studentId),u(It,e(i).studentName),u(Wt,`${e(i).gradeLevel??""} - ${e(i).section||"N/A"}`),u(Zt,e(i).dateOfBirth??"—"),u(D,e(U).length),fe=le(pe,1,"admin-chat-input svelte-qbny1s",null,fe,p)},[()=>({open:e(S)}),()=>({disabled:e(ze)})]),n(m,Ae),Ds(),w()}Ps(["click","change","keydown"]);var $l=(m,l,r)=>{e(l).props.onCancel&&e(l).props.onCancel(),r(e(l).id)},Ml=(m,l,r)=>{e(l).props.onConfirm&&e(l).props.onConfirm(),r(e(l).id)},jl=b('<div class="modal-confirm-content svelte-lx5glj"><div><!></div> <div class="modal-actions svelte-lx5glj"><button class="modal-btn modal-btn-secondary svelte-lx5glj">Cancel</button> <button>Confirm</button></div></div>'),Rl=(m,l,r)=>{e(l).props.onClose&&e(l).props.onClose(),r(e(l).id)},Pl=b('<div class="modal-alert-content svelte-lx5glj"><p class="modal-message svelte-lx5glj"> </p> <div class="modal-actions svelte-lx5glj"><button class="modal-btn modal-btn-primary svelte-lx5glj">OK</button></div></div>'),Il=(m,l,r)=>{e(l).props.onCancel&&e(l).props.onCancel(),r(e(l).id)},Al=(m,l,r)=>{e(l).props.onSubmit&&e(l).props.onSubmit(e(l).props.inputValue||e(l).props.defaultValue||""),r(e(l).id)},Fl=b('<div class="modal-prompt-content svelte-lx5glj"><p class="modal-message svelte-lx5glj"> </p> <input type="text" class="modal-input svelte-lx5glj"/> <div class="modal-actions svelte-lx5glj"><button class="modal-btn modal-btn-secondary svelte-lx5glj">Cancel</button> <button class="modal-btn modal-btn-primary svelte-lx5glj">Submit</button></div></div>'),El=(m,l,r)=>{e(l).props.onCancel&&e(l).props.onCancel(),r(e(l).id)},zl=(m,l,r)=>{e(l).props.onDelete&&!e(l).props.deleteDisabled&&e(l).props.onDelete(),r(e(l).id)},Nl=(m,l,r)=>{e(l).props.onSubmit&&e(l).props.onSubmit(e(l).props.field1Value,e(l).props.field2Value),r(e(l).id)},Ol=b('<div class="modal-form-content svelte-lx5glj"><p class="modal-message svelte-lx5glj"> </p> <div class="modal-form-fields svelte-lx5glj"><div class="modal-form-group svelte-lx5glj"><label for="formField1" class="modal-form-label svelte-lx5glj"> </label> <input id="formField1"/></div> <div class="modal-form-group svelte-lx5glj"><label for="formField2" class="modal-form-label svelte-lx5glj"> </label> <input id="formField2"/></div></div> <div class="modal-actions svelte-lx5glj"><button class="modal-btn modal-btn-secondary svelte-lx5glj">Cancel</button> <button class="modal-btn modal-btn-danger svelte-lx5glj">Delete</button> <button class="modal-btn modal-btn-primary svelte-lx5glj">Update</button></div></div>'),Gl=b('<div class="modal-custom-content svelte-lx5glj"><!></div>'),Bl=b('<div class="modal-generic-content svelte-lx5glj"><p> </p></div>');function Ll(m,l){Ss(l,!0);let r=N(ks([]));sa.subscribe(k=>{c(r,k,!0)});function w(k){sa.close(k)}var R=ee(),q=L(R);is(q,17,()=>e(r),k=>k.id,(k,o,G)=>{{let _=ns(()=>e(o).props.title||""),F=ns(()=>e(o).options.size||"medium"),i=ns(()=>e(o).options.closable!==!1),S=ns(()=>e(o).options.backdrop!==!1);wt(k,{get title(){return e(_)},get size(){return e(F)},get closable(){return e(i)},get backdrop(){return e(S)},onClose:()=>w(e(o).id),children:(I,O)=>{var y=ee(),C=L(y);{var H=Q=>{var xe=ee(),be=L(xe);{var _e=U=>{var V=jl(),Se=t(V);let ze;var Pe=t(Se);da(Pe,()=>e(o).props.message),s(Se);var ue=a(Se,2),ie=t(ue);ie.__click=[$l,o,w];var se=a(ie,2);se.__click=[Ml,o,w],s(ue),s(V),j(Ne=>{ze=le(Se,1,"modal-message svelte-lx5glj",null,ze,Ne),le(se,1,`modal-btn ${e(o).props.variant==="danger"?"modal-btn-danger":"modal-btn-primary"}`,"svelte-lx5glj")},[()=>({"danger-message":e(o).props.variant==="danger"})]),n(U,V)},re=U=>{var V=ee(),Se=L(V);{var ze=ue=>{var ie=Pl(),se=t(ie),Ne=t(se,!0);s(se);var ms=a(se,2),ye=t(ms);ye.__click=[Rl,o,w],s(ms),s(ie),j(()=>u(Ne,e(o).props.message)),n(ue,ie)},Pe=ue=>{var ie=ee(),se=L(ie);{var Ne=ye=>{var Xe=Fl(),He=t(Xe),os=t(He,!0);s(He);var es=a(He,2);yt(es);var ge=a(es,2),Ie=t(ge);Ie.__click=[Il,o,w];var oe=a(Ie,2);oe.__click=[Al,o,w],s(ge),s(Xe),j(()=>{u(os,e(o).props.message),ke(es,"placeholder",e(o).props.placeholder||"Enter value...")}),gt(es,()=>e(o).props.inputValue,De=>e(o).props.inputValue=De),n(ye,Xe)},ms=ye=>{var Xe=ee(),He=L(Xe);{var os=ge=>{var Ie=Ol(),oe=t(Ie),De=t(oe,!0);s(oe);var Ce=a(oe,2),me=t(Ce),Ae=t(me),Be=t(Ae,!0);s(Ae);var we=a(Ae,2);yt(we);let ss;s(me);var J=a(me,2),Y=t(J),X=t(Y,!0);s(Y);var K=a(Y,2);yt(K);let Oe;s(J),s(Ce);var Le=a(Ce,2),Te=t(Le);Te.__click=[El,o,w];var te=a(Te,2);te.__click=[zl,o,w];var Ye=a(te,2);Ye.__click=[Nl,o,w],s(Le),s(Ie),j((ve,qe)=>{u(De,e(o).props.message),u(Be,e(o).props.field1Label||"Field 1"),ke(we,"type",e(o).props.field1Type||"text"),ss=le(we,1,"modal-input svelte-lx5glj",null,ss,ve),ke(we,"placeholder",e(o).props.field1Placeholder||"Enter value..."),ke(we,"min",e(o).props.field1Min),ke(we,"max",e(o).props.field1Max),we.disabled=e(o).props.field1Disabled,ke(we,"title",e(o).props.field1Disabled?e(o).props.field1DisabledReason:""),u(X,e(o).props.field2Label||"Field 2"),ke(K,"type",e(o).props.field2Type||"text"),Oe=le(K,1,"modal-input svelte-lx5glj",null,Oe,qe),ke(K,"placeholder",e(o).props.field2Placeholder||"Enter value..."),ke(K,"min",e(o).props.field2Min),ke(K,"max",e(o).props.field2Max),K.disabled=e(o).props.field2Disabled,ke(K,"title",e(o).props.field2Disabled?e(o).props.field2DisabledReason:""),te.disabled=e(o).props.deleteDisabled,ke(te,"title",e(o).props.deleteDisabled?e(o).props.deleteDisabledReason:"Delete this column")},[()=>({"modal-input-disabled":e(o).props.field1Disabled}),()=>({"modal-input-disabled":e(o).props.field2Disabled})]),gt(we,()=>e(o).props.field1Value,ve=>e(o).props.field1Value=ve),gt(K,()=>e(o).props.field2Value,ve=>e(o).props.field2Value=ve),n(ge,Ie)},es=ge=>{var Ie=ee(),oe=L(Ie);{var De=me=>{_a(me,oa(()=>e(o).props,{onClose:()=>w(e(o).id)}))},Ce=me=>{var Ae=ee(),Be=L(Ae);{var we=J=>{var Y=Gl(),X=t(Y);da(X,()=>e(o).props.content),s(Y),n(J,Y)},ss=J=>{var Y=Bl(),X=t(Y),K=t(X);s(X),s(Y),j(()=>u(K,`Component '${e(o).component??""}' not found`)),n(J,Y)};h(Be,J=>{e(o).component==="CustomModal"?J(we):J(ss,!1)},!0)}n(me,Ae)};h(oe,me=>{e(o).component==="DocumentRequestModal"?me(De):me(Ce,!1)},!0)}n(ge,Ie)};h(He,ge=>{e(o).component==="FormModal"?ge(os):ge(es,!1)},!0)}n(ye,Xe)};h(se,ye=>{e(o).component==="PromptModal"?ye(Ne):ye(ms,!1)},!0)}n(ue,ie)};h(Se,ue=>{e(o).component==="AlertModal"?ue(ze):ue(Pe,!1)},!0)}n(U,V)};h(be,U=>{e(o).component==="ConfirmModal"?U(_e):U(re,!1)})}n(Q,xe)},Z=Q=>{const xe=ns(()=>e(o).component);var be=ee(),_e=L(be);Oa(_e,()=>e(xe),(re,U)=>{U(re,oa(()=>e(o).props,{onClose:()=>w(e(o).id)}))}),n(Q,be)};h(C,Q=>{typeof e(o).component=="string"?Q(H):Q(Z,!1)})}n(I,y)},$$slots:{default:!0}})}}),n(m,R),Ds()}Ps(["click"]);var Ql=(m,l)=>m.key==="Enter"&&l(m),Ul=b('<div role="dialog" aria-modal="true" tabindex="-1"><!></div>');function Vl(m,l){Ss(l,!0);const[r,w]=ta();let q=ns(()=>aa(Gt,"$docReqModalStore",r)),k=N(!1),o=N(!1),G=N(null);hs(()=>{e(q).isOpen&&!e(k)&&!e(o)?(setTimeout(()=>{c(k,!0)},10),document.body.style.overflow="hidden"):!e(q).isOpen&&(e(k)||e(o))&&_()});function _(){c(o,!0),setTimeout(()=>{c(k,!1),c(o,!1),document.body.style.overflow=""},300)}function F(y){y.target===y.currentTarget&&Gt.close()}function i(y){y.key==="Escape"&&e(q).isOpen&&Gt.close()}ht(()=>()=>{document.body.style.overflow=""});var S=ee();Xs("keydown",et,i);var I=L(S);{var O=y=>{var C=Ul();let H;C.__click=F,C.__keydown=[Ql,F];var Z=t(C);_a(Z,{get request(){return e(q).request},get requestStatuses(){return e(q).requestStatuses},get modalStatuses(){return e(q).modalStatuses},get onUpdate(){return e(q).onUpdate},get onReject(){return e(q).onReject},onClose:()=>Gt.close()}),s(C),xs(C,Q=>c(G,Q),()=>e(G)),j(Q=>H=le(C,1,"docreq-modal-overlay svelte-1yi457b",null,H,Q),[()=>({"docreq-modal-visible":e(k)&&!e(o),"docreq-modal-closing":e(o)})]),n(y,C)};h(I,y=>{(e(q).isOpen||e(k)||e(o))&&y(O)})}n(m,S),Ds(),w()}Ps(["click","keydown"]);function Hl(m,l,r){const w=Array.from(m.target.files||[]);if(w.length===0)return;const R=10*1024*1024,q=w.filter(k=>k.size>R?(Ve.error(`File "${k.name}" is too large. Maximum size is 10MB.`),!1):!0);c(l,[...e(l),...q],!0),e(r)&&(e(r).value="")}function Yl(m,l){e(l)&&e(l).click()}function Kl(m,l){c(l,!0)}function Wl(m,l){c(l,!0)}function Zl(m,l){c(l,!0)}async function Jl(m,l,r,w,R){l()&&await l()(r),c(w,!1),R()()}var Xl=b('<span class="payment-amount free svelte-1mqkwr3">Free</span>'),er=(m,l)=>{m.preventDefault(),l()},sr=b('<a href="javascript:void(0)" class="payment-amount pending clickable svelte-1mqkwr3" title="Click to view payment instructions" aria-label="View payment instructions" role="button"> </a>'),tr=b('<span class="payment-amount paid svelte-1mqkwr3"> </span>'),ar=b('<div class="student-docreq-card third-row svelte-1mqkwr3"><div class="card-label svelte-1mqkwr3"><span class="material-symbols-outlined svelte-1mqkwr3">payments</span> Total Payment</div> <div class="card-value payment-value svelte-1mqkwr3"><!></div></div>'),lr=b('<div class="student-docreq-card third-row svelte-1mqkwr3"><div class="card-label svelte-1mqkwr3"><span class="material-symbols-outlined svelte-1mqkwr3">event_busy</span> Cancelled Date</div> <div class="card-value svelte-1mqkwr3"> </div></div>'),rr=b('<div class="student-docreq-card third-row svelte-1mqkwr3"><div class="card-label svelte-1mqkwr3"><span class="material-symbols-outlined svelte-1mqkwr3">event</span> </div> <div class="card-value svelte-1mqkwr3"><div class="date-display svelte-1mqkwr3"> </div></div></div>'),nr=b('<div class="student-docreq-card svelte-1mqkwr3"><div class="card-label svelte-1mqkwr3"><span class="material-symbols-outlined svelte-1mqkwr3">check_circle</span> Released Date</div> <div class="card-value svelte-1mqkwr3"> </div></div>'),ir=b('<div class="admin-note-section svelte-1mqkwr3"><div class="note-label svelte-1mqkwr3"><span class="material-symbols-outlined svelte-1mqkwr3">note</span> Admin Note</div> <p class="note-text svelte-1mqkwr3"> </p></div>'),or=b('<div class="message-avatar svelte-1mqkwr3"><span class="material-symbols-outlined svelte-1mqkwr3">admin_panel_settings</span></div>'),vr=b('<div class="student-document-request-message-text"> </div>'),dr=(m,l,r)=>l(e(r)),cr=b('<button class="attachment-item svelte-1mqkwr3"><span class="material-symbols-outlined svelte-1mqkwr3">attach_file</span> <div class="attachment-info svelte-1mqkwr3"><span class="attachment-name svelte-1mqkwr3"> </span> <span class="attachment-size svelte-1mqkwr3"> </span></div> <span class="material-symbols-outlined svelte-1mqkwr3">download</span></button>'),ur=b('<div class="message-attachments svelte-1mqkwr3"></div>'),mr=b('<div><!> <div class="message-bubble svelte-1mqkwr3"><div class="message-header svelte-1mqkwr3"><span class="message-author svelte-1mqkwr3"> </span> <span class="message-time svelte-1mqkwr3"> </span></div> <!> <!></div></div>'),pr=b('<div class="no-chat svelte-1mqkwr3"><span class="material-symbols-outlined svelte-1mqkwr3">chat_bubble_outline</span> <p class="svelte-1mqkwr3">No messages yet</p> <p class="subtitle svelte-1mqkwr3">Start a conversation with the admin</p></div>'),_r=b('<div class="file-preview-item svelte-1mqkwr3"><span class="material-symbols-outlined svelte-1mqkwr3">description</span> <span class="file-preview-name svelte-1mqkwr3"> </span> <span class="file-preview-size svelte-1mqkwr3"> </span> <button class="remove-file-btn svelte-1mqkwr3" title="Remove file"><span class="material-symbols-outlined svelte-1mqkwr3">close</span></button></div>'),fr=b('<div class="selected-files-preview svelte-1mqkwr3"></div>'),br=b('<div class="chat-disabled-notice svelte-1mqkwr3"><span class="material-symbols-outlined svelte-1mqkwr3">block</span> <span> </span></div>'),qr=(m,l,r)=>m.key==="Enter"&&!m.shiftKey&&!e(l)&&r(),yr=b('<input type="file" multiple accept="image/*,.pdf,.doc,.docx,.xls,.xlsx,.txt" style="display: none;" class="svelte-1mqkwr3"/> <button class="attach-btn svelte-1mqkwr3" title="Attach file" aria-label="Attach file"><span class="material-symbols-outlined svelte-1mqkwr3">attach_file</span></button> <input placeholder="Type your message..." aria-label="Message input" class="svelte-1mqkwr3"/> <button class="send-btn svelte-1mqkwr3" title="Send message" aria-label="Send message"><span class="material-symbols-outlined svelte-1mqkwr3">send</span></button>',1),gr=(m,l)=>l(1),wr=(m,l)=>l(2),hr=(m,l)=>m.key==="Escape"&&l(),kr=m=>m.stopPropagation(),xr=m=>m.stopPropagation(),Sr=b('<p class="timeline-user svelte-1mqkwr3"><span class="material-symbols-outlined svelte-1mqkwr3">person</span> </p>'),Dr=b('<div class="timeline-item svelte-1mqkwr3"><div><span class="material-symbols-outlined svelte-1mqkwr3"><!></span></div> <div class="timeline-content svelte-1mqkwr3"><div class="timeline-header svelte-1mqkwr3"><h4 class="svelte-1mqkwr3"> </h4> <span class="timeline-date svelte-1mqkwr3"> </span></div> <!> <p class="timeline-note svelte-1mqkwr3"> </p></div></div>'),Cr=b('<div class="status-timeline svelte-1mqkwr3"></div>'),Tr=b('<div class="no-history svelte-1mqkwr3"><span class="material-symbols-outlined svelte-1mqkwr3">history_toggle_off</span> <p class="svelte-1mqkwr3">No status history available</p> <p class="subtitle svelte-1mqkwr3">Status changes will appear here</p></div>'),$r=b('<div class="status-history-backdrop svelte-1mqkwr3" role="dialog" aria-modal="true" tabindex="-1"><div class="status-history-sidebar svelte-1mqkwr3"><div class="status-history-header svelte-1mqkwr3"><div class="status-history-title svelte-1mqkwr3"><span class="material-symbols-outlined svelte-1mqkwr3">history</span> <h3 class="svelte-1mqkwr3">Status History</h3></div> <button class="status-history-close-btn svelte-1mqkwr3" aria-label="Close"><span class="material-symbols-outlined svelte-1mqkwr3">close</span></button></div> <div class="status-history-body svelte-1mqkwr3"><!></div></div></div>'),Mr=(m,l)=>m.key==="Enter"&&l(),jr=m=>m.stopPropagation(),Rr=m=>m.stopPropagation(),Pr=b('<div class="flow-backdrop svelte-1mqkwr3" role="dialog" aria-modal="true" tabindex="-1"><div class="flow-container svelte-1mqkwr3" role="document"><div class="flow-header svelte-1mqkwr3"><h2 class="svelte-1mqkwr3">Process Status Flow</h2> <button class="flow-close-btn svelte-1mqkwr3" aria-label="Close"><span class="material-symbols-outlined svelte-1mqkwr3">close</span></button></div> <div class="flow-body svelte-1mqkwr3"><div class="flow-list svelte-1mqkwr3"><div class="flow-item svelte-1mqkwr3"><div class="flow-icon-wrapper on_hold svelte-1mqkwr3"><span class="material-symbols-outlined svelte-1mqkwr3">pause_circle</span></div> <div class="flow-content svelte-1mqkwr3"><h3 class="svelte-1mqkwr3">On Hold</h3> <p class="svelte-1mqkwr3">Your request is awaiting review by the admin.</p></div></div> <div class="flow-item svelte-1mqkwr3"><div class="flow-icon-wrapper verifying svelte-1mqkwr3"><span class="material-symbols-outlined svelte-1mqkwr3">fact_check</span></div> <div class="flow-content svelte-1mqkwr3"><h3 class="svelte-1mqkwr3">Verifying</h3> <p class="svelte-1mqkwr3">The document request is currently being verified. (Takes up to 5 days)</p></div></div> <div class="flow-item svelte-1mqkwr3"><div class="flow-icon-wrapper for_compliance svelte-1mqkwr3"><span class="material-symbols-outlined svelte-1mqkwr3">assignment_late</span></div> <div class="flow-content svelte-1mqkwr3"><h3 class="svelte-1mqkwr3">For Compliance</h3> <p class="svelte-1mqkwr3">Additional documents required. You have <strong>3 days</strong> for initial compliance or <strong>2 days</strong> for resubmission. Failure to submit will result in non-compliance or rejection.</p></div></div> <div class="flow-item svelte-1mqkwr3"><div class="flow-icon-wrapper processing svelte-1mqkwr3"><span class="material-symbols-outlined svelte-1mqkwr3">sync</span></div> <div class="flow-content svelte-1mqkwr3"><h3 class="svelte-1mqkwr3">For Processing</h3> <p class="svelte-1mqkwr3">The document is in the processing stage.</p></div></div> <div class="flow-item svelte-1mqkwr3"><div class="flow-icon-wrapper for_pickup svelte-1mqkwr3"><span class="material-symbols-outlined svelte-1mqkwr3">inventory</span></div> <div class="flow-content svelte-1mqkwr3"><h3 class="svelte-1mqkwr3">For Pick Up</h3> <p class="svelte-1mqkwr3">The document is ready and available for pick up.</p></div></div> <div class="flow-item svelte-1mqkwr3"><div class="flow-icon-wrapper released svelte-1mqkwr3"><span class="material-symbols-outlined svelte-1mqkwr3">check_circle</span></div> <div class="flow-content svelte-1mqkwr3"><h3 class="svelte-1mqkwr3">Released</h3> <p class="svelte-1mqkwr3">The document has been released to you.</p></div></div> <div class="flow-item svelte-1mqkwr3"><div class="flow-icon-wrapper non_compliance svelte-1mqkwr3"><span class="material-symbols-outlined svelte-1mqkwr3">warning</span></div> <div class="flow-content svelte-1mqkwr3"><h3 class="svelte-1mqkwr3">Non-Compliant</h3> <p class="svelte-1mqkwr3">Request marked as non-compliant due to no response within the deadline.</p></div></div> <div class="flow-item svelte-1mqkwr3"><div class="flow-icon-wrapper rejected svelte-1mqkwr3"><span class="material-symbols-outlined svelte-1mqkwr3">cancel</span></div> <div class="flow-content svelte-1mqkwr3"><h3 class="svelte-1mqkwr3">Rejected</h3> <p class="svelte-1mqkwr3">The request was rejected. Check the rejection reason or contact admin.</p></div></div></div></div></div></div>'),Ir=b('<div class="modal-confirm-content svelte-1mqkwr3"><div class="modal-message svelte-1mqkwr3"><p class="svelte-1mqkwr3">Are you sure you want to cancel this document request?</p> <div class="confirm-details cancel-warning svelte-1mqkwr3"><div class="confirm-detail-row svelte-1mqkwr3"><span class="detail-label svelte-1mqkwr3">Request ID:</span> <span class="detail-value svelte-1mqkwr3"> </span></div> <div class="confirm-detail-row svelte-1mqkwr3"><span class="detail-label svelte-1mqkwr3">Document Type:</span> <span class="detail-value svelte-1mqkwr3"> </span></div> <div class="confirm-detail-row svelte-1mqkwr3"><span class="detail-label svelte-1mqkwr3">Status:</span> <span class="detail-value svelte-1mqkwr3"> </span></div> <div class="cancel-notice svelte-1mqkwr3"><span class="material-symbols-outlined svelte-1mqkwr3">warning</span> <span>This action will mark your request as cancelled. You may need to submit a new request if needed.</span></div></div></div> <div class="modal-actions svelte-1mqkwr3"><button class="modal-btn modal-btn-secondary svelte-1mqkwr3">Go Back</button> <button class="modal-btn modal-btn-danger svelte-1mqkwr3">Cancel Request</button></div></div>'),Ar=(m,l)=>m.key==="Escape"&&l(),Fr=m=>m.stopPropagation(),Er=b(`<div class="payment-instructions-backdrop svelte-1mqkwr3" role="dialog" aria-modal="true" tabindex="-1"><div class="payment-instructions-container svelte-1mqkwr3"><div class="payment-instructions-header svelte-1mqkwr3"><h2 class="svelte-1mqkwr3">Payment Instructions</h2> <button class="payment-instructions-close-btn svelte-1mqkwr3"><span class="material-symbols-outlined svelte-1mqkwr3">close</span></button></div> <div class="payment-instructions-body svelte-1mqkwr3"><p class="svelte-1mqkwr3">You can pay once your document is ready for pick-up.</p> <p class="svelte-1mqkwr3">Please follow these steps to complete your payment and claim your document:</p> <ol class="payment-instructions-steps svelte-1mqkwr3"><li class="svelte-1mqkwr3">Wait until your request status shows "Ready for Pick-Up."</li> <li class="svelte-1mqkwr3">Go to the Cashier's Office.</li> <li class="svelte-1mqkwr3">Inform the cashier that you are paying for your approved document request.</li> <li class="svelte-1mqkwr3">Provide your Request Reference Number or Student ID.</li> <li class="svelte-1mqkwr3">Pay the required amount for your document.</li> <li class="svelte-1mqkwr3">Get your Official Receipt.</li> <li class="svelte-1mqkwr3">Proceed to the Registrar's Office (or releasing area) and present your receipt to claim your document.</li></ol></div> <div class="payment-instructions-footer svelte-1mqkwr3"><button class="payment-instructions-got-it-btn svelte-1mqkwr3">Got it</button></div></div></div>`),zr=b('<div class="student-docreq-modal-content svelte-1mqkwr3"><div class="student-docreq-modal-grid svelte-1mqkwr3"><div><header class="student-docreq-modal-title svelte-1mqkwr3"><h2 class="svelte-1mqkwr3">Request Details</h2> <div class="student-docreq-modal-sub svelte-1mqkwr3">ID: <span> </span></div></header> <div class="student-docreq-cards svelte-1mqkwr3"><div><div class="status-group svelte-1mqkwr3"><div class="card-label svelte-1mqkwr3"><span class="material-symbols-outlined svelte-1mqkwr3">info</span> Status:</div> <button title="Click to view status history" aria-label="View status history timeline"> </button></div> <button class="status-info-button svelte-1mqkwr3" title="Click to view status flow information" aria-label="View status flow information"><span class="material-symbols-outlined svelte-1mqkwr3">help</span></button></div> <div class="student-docreq-card third-row svelte-1mqkwr3"><div class="card-label svelte-1mqkwr3"><span class="material-symbols-outlined svelte-1mqkwr3">description</span> Document Type</div> <div class="card-value svelte-1mqkwr3"> </div></div> <div class="student-docreq-card third-row svelte-1mqkwr3"><div class="card-label svelte-1mqkwr3"><span class="material-symbols-outlined svelte-1mqkwr3">numbers</span> Quantity</div> <div class="card-value svelte-1mqkwr3"> </div></div> <div class="student-docreq-card third-row svelte-1mqkwr3"><div class="card-label svelte-1mqkwr3"><span class="material-symbols-outlined svelte-1mqkwr3">account_circle</span> Processed By</div> <div class="card-value svelte-1mqkwr3"> </div></div> <!> <div class="student-docreq-card third-row svelte-1mqkwr3"><div class="card-label svelte-1mqkwr3"><span class="material-symbols-outlined svelte-1mqkwr3">calendar_today</span> Requested Date</div> <div class="card-value svelte-1mqkwr3"> </div></div> <!> <!></div> <div class="student-docreq-purpose svelte-1mqkwr3"><div class="purpose-label svelte-1mqkwr3"><span class="material-symbols-outlined svelte-1mqkwr3">description</span> Purpose & Details</div> <div class="purpose-content svelte-1mqkwr3"> </div></div> <!> <div class="student-modal-action-buttons svelte-1mqkwr3"><button class="student-cancel-button svelte-1mqkwr3"><span class="material-symbols-outlined svelte-1mqkwr3">cancel</span> Cancel Request</button> <button class="student-back-button svelte-1mqkwr3"><span class="material-symbols-outlined svelte-1mqkwr3">arrow_back</span> Back</button></div></div> <div><div class="chat-container svelte-1mqkwr3"><div class="chat-header svelte-1mqkwr3"><h3 class="svelte-1mqkwr3"><span class="material-symbols-outlined svelte-1mqkwr3">forum</span> Communication</h3> <span class="chat-count-badge svelte-1mqkwr3"> </span></div> <div class="student-chat-messages svelte-1mqkwr3"><!></div> <div class="student-chat-input-wrapper svelte-1mqkwr3"><!> <div><!></div></div></div></div></div> <div class="mobile-pagination-controls svelte-1mqkwr3"><div class="pagination-dots svelte-1mqkwr3"><button aria-label="Go to request details"><span class="material-symbols-outlined svelte-1mqkwr3">description</span></button> <button aria-label="Go to chat"><span class="material-symbols-outlined svelte-1mqkwr3">forum</span></button></div></div></div> <!> <!> <!> <!>',1);function Nr(m,l){Ss(l,!0);const[r,w]=ta(),R=()=>aa(Qt,"$authStore",r);let q=Re(l,"request",19,()=>({})),k=Re(l,"onCancel",3,()=>{}),o=Re(l,"onRefresh",3,()=>{}),G=Re(l,"onClose",3,()=>{}),_=ks({...q()}),F=N(""),i=N(!1),S=N(!1),I=N(void 0),O=N(void 0),y=N(void 0),C=N(ks([])),H,Z=N(!1),Q=N(!1),xe=N(!1),be=N(1),_e=ns(()=>_.messages||[]),re=ns(()=>_.statusHistory||[]),U=ns(()=>_.status==="released"||_.status==="cancelled");function V(){e(I)&&setTimeout(()=>{e(I).scrollTop=e(I).scrollHeight},100)}function Se(d){c(C,e(C).filter((f,D)=>D!==d),!0)}async function ze(d){return new Promise((f,D)=>{const x=new FileReader;x.onload=()=>f(x.result),x.onerror=D,x.readAsDataURL(d)})}function Pe(d){const f=document.createElement("a");f.href=d.data,f.download=d.name,f.click()}function ue(d){return{on_hold:"On Hold",verifying:"Verifying",for_compliance:"For Compliance",processing:"For Processing",for_pickup:"For Pick Up",released:"Released",non_compliance:"Non-Compliant",rejected:"Rejected",cancelled:"Cancelled"}[d]||d}function ie(d){if(!d)return"N/A";const f=new Date(d),D=String(f.getMonth()+1).padStart(2,"0"),x=String(f.getDate()).padStart(2,"0"),E=f.getFullYear();return`${D}/${x}/${E}`}function se(){c(i,!1)}function Ne(){c(Q,!1)}function ms(){c(xe,!0)}function ye(){c(xe,!1)}async function Xe(){if(!(!e(F).trim()&&e(C).length===0||e(S)||!_||e(U))){if(e(C).length>0){const d=e(C).map(f=>`<li>${f.name} (${(f.size/1024).toFixed(1)} KB)</li>`).join("");sa.confirm("Confirm Send Message",`<p>You are about to send a message with <strong>${e(C).length} file${e(C).length>1?"s":""}</strong>. Please confirm before sending.</p>
				${e(F).trim()?`<p style="margin-top: 12px;"><strong>Message:</strong> ${e(F).trim().length>100?e(F).trim().substring(0,100)+"...":e(F).trim()}</p>`:""}
				<p style="margin-top: 12px;"><strong>Files:</strong></p>
				<ul style="margin: 8px 0; padding-left: 20px;">${d}</ul>`,async()=>{await He()},()=>{},{size:"small"});return}await He()}}async function He(){const d=e(F).trim(),f=[...e(C)];if(!d&&f.length===0||e(S)||!_||e(U))return;c(S,!0);let D=[];try{for(const $ of f){const A=await ze($);D.push({name:$.name,type:$.type,size:$.size,data:A})}}catch($){console.error("Error converting files:",$),Ve.error("Failed to process files. Please try again."),c(S,!1);return}const x=`temp-${Date.now()}`,E={id:x,text:d,author:R().userData?.name||"Student",authorRole:"student",created_at:new Date().toISOString(),attachments:D,isPending:!0};_.messages=[..._.messages||[],E],c(F,""),c(C,[],!0),V(),e(O)&&setTimeout(()=>e(O).focus(),50);try{const $=await va.post("/api/document-requests",{action:"sendMessage",requestId:_.requestId,message:d,attachments:D});$.success?(_.messages=_.messages.map(A=>A.id===x?{...$.data,id:x,isPending:!1}:A),_.status==="for_compliance"&&D.length>0&&(await ge(),o()&&o()())):(console.error("Failed to send message:",$.error),_.messages=_.messages.filter(A=>A.id!==x),Ve.error("Failed to send message. Please try again."),c(F,d,!0),c(C,f,!0))}catch($){console.error("Error sending message:",$),_.messages=_.messages.filter(A=>A.id!==x),Ve.error("An error occurred while sending the message."),c(F,d,!0),c(C,f,!0)}finally{c(S,!1)}}function os(){c(Z,!1)}function es(d){c(be,d,!0)}async function ge(){if(!(!_||e(S)))try{const d=await va.get(`/api/document-requests?action=single&requestId=${_.requestId}`);if(d.success&&d.data){const f=e(_e).filter($=>$.isPending),D=d.data.messages,x=new Set(e(_e).filter($=>!$.isPending).map($=>$.id));D.filter($=>!x.has($.id)).length>0&&(_.messages=[...D,...f],V()),d.data.status&&(_.status=d.data.status),d.data.tentativeDate&&(_.tentativeDate=d.data.tentativeDate),d.data.statusHistory&&(_.statusHistory=d.data.statusHistory)}}catch(d){console.error("Error fetching latest messages:",d)}}function Ie(){document.hidden?H&&(clearInterval(H),H=null):H||(ge(),H=setInterval(ge,8e3))}hs(()=>(H=setInterval(ge,8e3),document.addEventListener("visibilitychange",Ie),V(),()=>{H&&clearInterval(H),document.removeEventListener("visibilitychange",Ie)}));var oe=zr(),De=L(oe),Ce=t(De),me=t(Ce);let Ae;var Be=t(me),we=a(t(Be),2),ss=a(t(we)),J=t(ss,!0);s(ss),s(we),s(Be);var Y=a(Be,2),X=t(Y),K=t(X),Oe=a(t(K),2);Oe.__click=[Wl,Q];var Le=t(Oe,!0);s(Oe),s(K);var Te=a(K,2);Te.__click=[Kl,i],s(X);var te=a(X,2),Ye=a(t(te),2),ve=t(Ye,!0);s(Ye),s(te);var qe=a(te,2),fs=a(t(qe),2),Fe=t(fs);s(fs),s(qe);var vs=a(qe,2),ts=a(t(vs),2),bs=t(ts,!0);s(ts),s(vs);var Ke=a(vs,2);{var st=d=>{var f=ar(),D=a(t(f),2),x=t(D);{var E=A=>{var $e=Xl();n(A,$e)},$=A=>{var $e=ee(),Me=L($e);{var de=fe=>{var B=sr();B.__click=[er,ms];var We=t(B);s(B),j(Qe=>u(We,`₱${Qe??""} (Pending)`),[()=>(_.paymentAmount||0).toFixed(2)]),n(fe,B)},pe=fe=>{var B=tr(),We=t(B);s(B),j(Qe=>u(We,`₱${Qe??""} (Paid)`),[()=>(_.paymentAmount||0).toFixed(2)]),n(fe,B)};h(Me,fe=>{_.paymentStatus==="pending"?fe(de):fe(pe,!1)},!0)}n(A,$e)};h(x,A=>{_.paymentAmount===0?A(E):A($,!1)})}s(D),s(f),n(d,f)};h(Ke,d=>{_.paymentAmount!==null&&_.paymentAmount!==void 0&&d(st)})}var tt=a(Ke,2),at=a(t(tt),2),Ut=t(at,!0);s(at),s(tt);var lt=a(tt,2);{var rt=d=>{var f=lr(),D=a(t(f),2),x=t(D,!0);s(D),s(f),j(()=>u(x,_.cancelledDate)),n(d,f)},kt=d=>{var f=ee(),D=L(f);{var x=E=>{var $=rr(),A=t($),$e=a(t(A));s(A);var Me=a(A,2),de=t(Me),pe=t(de,!0);s(de),s(Me),s($),j(fe=>{u($e,` ${_.status==="for_compliance"?"Deadline":"Tentative Date"}`),u(pe,fe)},[()=>ie(_.tentativeDate)]),n(E,$)};h(D,E=>{_.tentativeDate&&E(x)},!0)}n(d,f)};h(lt,d=>{_.status==="cancelled"&&_.cancelledDate?d(rt):d(kt,!1)})}var Vt=a(lt,2);{var xt=d=>{var f=nr(),D=a(t(f),2),x=t(D,!0);s(D),s(f),j(()=>u(x,_.completedDate)),n(d,f)};h(Vt,d=>{_.status==="released"&&_.completedDate&&d(xt)})}s(Y);var nt=a(Y,2),Gs=a(t(nt),2),St=t(Gs,!0);s(Gs),s(nt);var Dt=a(nt,2);{var it=d=>{var f=ir(),D=a(t(f),2),x=t(D,!0);s(D),s(f),j(()=>u(x,_.adminNote)),n(d,f)};h(Dt,d=>{_.adminNote&&d(it)})}var ot=a(Dt,2),Is=t(ot);Is.__click=[Zl,Z];var Bs=a(Is,2);Bs.__click=function(...d){G()?.apply(this,d)},s(ot),s(me);var vt=a(me,2);let Ct;var Tt=t(vt),Ls=t(Tt),qs=a(t(Ls),2),$t=t(qs,!0);s(qs),s(Ls);var Qs=a(Ls,2),Ht=t(Qs);{var Yt=d=>{var f=ee(),D=L(f);is(D,17,()=>e(_e),x=>x.id,(x,E)=>{var $=mr(),A=t($);{var $e=he=>{var Ze=or();n(he,Ze)};h(A,he=>{e(E).authorRole==="admin"&&he($e)})}var Me=a(A,2),de=t(Me),pe=t(de),fe=t(pe,!0);s(pe);var B=a(pe,2),We=t(B,!0);s(B),s(de);var Qe=a(de,2);{var ys=he=>{var Ze=vr(),Cs=t(Ze,!0);s(Ze),j(()=>u(Cs,e(E).text)),n(he,Ze)};h(Qe,he=>{e(E).text&&he(ys)})}var js=a(Qe,2);{var Rs=he=>{var Ze=ur();is(Ze,21,()=>e(E).attachments,Os,(Cs,v)=>{var p=cr();p.__click=[dr,Pe,v];var T=a(t(p),2),g=t(T),P=t(g,!0);s(g);var z=a(g,2),M=t(z);s(z),s(T),Ns(2),s(p),j(ce=>{u(P,e(v).name),u(M,`${ce??""} KB`)},[()=>(e(v).size/1024).toFixed(1)]),n(Cs,p)}),s(Ze),n(he,Ze)};h(js,he=>{e(E).attachments&&e(E).attachments.length>0&&he(Rs)})}s(Me),s($),j(he=>{le($,1,`message-wrapper ${e(E).authorRole==="admin"?"received":"sent"}`,"svelte-1mqkwr3"),u(fe,e(E).author),u(We,he)},[()=>new Date(e(E).created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]),n(x,$)}),n(d,f)},dt=d=>{var f=pr();n(d,f)};h(Ht,d=>{e(_e).length>0?d(Yt):d(dt,!1)})}s(Qs),xs(Qs,d=>c(I,d),()=>e(I));var ct=a(Qs,2),Mt=t(ct);{var jt=d=>{var f=fr();is(f,21,()=>e(C),Os,(D,x,E)=>{var $=_r(),A=a(t($),2),$e=t(A,!0);s(A);var Me=a(A,2),de=t(Me);s(Me);var pe=a(Me,2);pe.__click=()=>Se(E),s($),j(fe=>{u($e,e(x).name),u(de,`(${fe??""} KB)`)},[()=>(e(x).size/1024).toFixed(1)]),n(D,$)}),s(f),n(d,f)};h(Mt,d=>{e(C).length>0&&d(jt)})}var As=a(Mt,2);let Us;var Kt=t(As);{var Rt=d=>{var f=br(),D=a(t(f),2),x=t(D);s(D),s(f),j(()=>u(x,`Chat is disabled for ${_.status==="released"?"released":"cancelled"} requests`)),n(d,f)},ut=d=>{var f=yr(),D=L(f);D.__change=[Hl,C,y],xs(D,A=>c(y,A),()=>e(y));var x=a(D,2);x.__click=[Yl,y];var E=a(x,2);yt(E),E.__keydown=[qr,S,Xe],xs(E,A=>c(O,A),()=>e(O));var $=a(E,2);$.__click=Xe,j(A=>{E.disabled=e(S),$.disabled=A},[()=>e(S)||!e(F).trim()&&e(C).length===0]),gt(E,()=>e(F),A=>c(F,A)),n(d,f)};h(Kt,d=>{e(U)?d(Rt):d(ut,!1)})}s(As),s(ct),s(Tt),s(vt),s(Ce);var mt=a(Ce,2),Vs=t(mt),Hs=t(Vs);let Pt;Hs.__click=[gr,es];var Ys=a(Hs,2);let pt;Ys.__click=[wr,es],s(Vs),s(mt),s(De);var It=a(De,2);{var _t=d=>{var f=$r();f.__click=Ne,f.__keydown=[hr,Ne];var D=t(f);D.__click=[kr],D.__keydown=[xr];var x=t(D),E=a(t(x),2);E.__click=Ne,s(x);var $=a(x,2),A=t($);{var $e=de=>{var pe=Cr();is(pe,23,()=>e(re),(fe,B)=>fe.timestamp||B,(fe,B)=>{var We=Dr(),Qe=t(We),ys=t(Qe),js=t(ys);{var Rs=ae=>{var W=rs("pause_circle");n(ae,W)},he=ae=>{var W=ee(),je=L(W);{var ps=Ge=>{var Ue=rs("fact_check");n(Ge,Ue)},as=Ge=>{var Ue=ee(),ds=L(Ue);{var _s=ne=>{var Ee=rs("assignment_late");n(ne,Ee)},cs=ne=>{var Ee=ee(),Ts=L(Ee);{var Fs=us=>{var gs=rs("sync");n(us,gs)},$s=us=>{var gs=ee(),Je=L(gs);{var ls=ws=>{var zs=rs("inventory");n(ws,zs)},Es=ws=>{var zs=ee(),Jt=L(zs);{var Xt=Ks=>{var Et=rs("check_circle");n(Ks,Et)},fa=Ks=>{var Et=ee(),ba=L(Et);{var qa=Ws=>{var zt=rs("warning");n(Ws,zt)},ya=Ws=>{var zt=ee(),ga=L(zt);{var wa=Zs=>{var Nt=rs("cancel");n(Zs,Nt)},ha=Zs=>{var Nt=ee(),ka=L(Nt);{var xa=Js=>{var ea=rs("block");n(Js,ea)},Sa=Js=>{var ea=rs("circle");n(Js,ea)};h(ka,Js=>{e(B).status==="cancelled"?Js(xa):Js(Sa,!1)},!0)}n(Zs,Nt)};h(ga,Zs=>{e(B).status==="rejected"?Zs(wa):Zs(ha,!1)},!0)}n(Ws,zt)};h(ba,Ws=>{e(B).status==="non_compliance"?Ws(qa):Ws(ya,!1)},!0)}n(Ks,Et)};h(Jt,Ks=>{e(B).status==="released"?Ks(Xt):Ks(fa,!1)},!0)}n(ws,zs)};h(Je,ws=>{e(B).status==="for_pickup"?ws(ls):ws(Es,!1)},!0)}n(us,gs)};h(Ts,us=>{e(B).status==="processing"?us(Fs):us($s,!1)},!0)}n(ne,Ee)};h(ds,ne=>{e(B).status==="for_compliance"?ne(_s):ne(cs,!1)},!0)}n(Ge,Ue)};h(je,Ge=>{e(B).status==="verifying"?Ge(ps):Ge(as,!1)},!0)}n(ae,W)};h(js,ae=>{e(B).status==="on_hold"?ae(Rs):ae(he,!1)})}s(ys),s(Qe);var Ze=a(Qe,2),Cs=t(Ze),v=t(Cs),p=t(v,!0);s(v);var T=a(v,2),g=t(T,!0);s(T),s(Cs);var P=a(Cs,2);{var z=ae=>{var W=Sr(),je=a(t(W));s(W),j(()=>u(je,` ${e(B).changedBy??""}`)),n(ae,W)};h(P,ae=>{e(B).changedBy&&ae(z)})}var M=a(P,2),ce=t(M,!0);s(M),s(Ze),s(We),j((ae,W)=>{le(Qe,1,`timeline-marker status-${e(B).status??""}`,"svelte-1mqkwr3"),u(p,ae),u(g,W),u(ce,e(B).note||"No additional details")},[()=>ue(e(B).status),()=>new Date(e(B).timestamp).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})]),n(fe,We)}),s(pe),n(de,pe)},Me=de=>{var pe=Tr();n(de,pe)};h(A,de=>{e(re)&&e(re).length>0?de($e):de(Me,!1)})}s($),s(D),s(f),n(d,f)};h(It,d=>{e(Q)&&d(_t)})}var ft=a(It,2);{var Wt=d=>{var f=Pr();f.__click=se,f.__keydown=[Mr,se];var D=t(f);D.__click=[jr],D.__keydown=[Rr];var x=t(D),E=a(t(x),2);E.__click=se,s(x),Ns(2),s(D),s(f),n(d,f)};h(ft,d=>{e(i)&&d(Wt)})}var bt=a(ft,2);{var At=d=>{wt(d,{title:"Cancel Request",size:"small",closable:!0,onClose:os,children:(f,D)=>{var x=Ir(),E=t(x),$=a(t(E),2),A=t($),$e=a(t(A),2),Me=t($e,!0);s($e),s(A);var de=a(A,2),pe=a(t(de),2),fe=t(pe,!0);s(pe),s(de);var B=a(de,2),We=a(t(B),2),Qe=t(We,!0);s(We),s(B),Ns(2),s($),s(E);var ys=a(E,2),js=t(ys);js.__click=os;var Rs=a(js,2);Rs.__click=[Jl,k,_,Z,G],s(ys),s(x),j(he=>{u(Me,_.requestId),u(fe,_.type),u(Qe,he)},[()=>ue(_.status)]),n(f,x)},$$slots:{default:!0}})};h(bt,d=>{e(Z)&&d(At)})}var Zt=a(bt,2);{var Ft=d=>{var f=Er();f.__click=ye,f.__keydown=[Ar,ye];var D=t(f);D.__click=[Fr];var x=t(D),E=a(t(x),2);E.__click=ye,s(x);var $=a(x,4),A=t($);A.__click=ye,s($),s(D),s(f),n(d,f)};h(Zt,d=>{e(xe)&&d(Ft)})}j((d,f,D,x,E,$)=>{Ae=le(me,1,"student-docreq-modal-left-container svelte-1mqkwr3",null,Ae,d),u(J,_.requestId),le(X,1,`student-docreq-card full-width status-card-horizontal status-card-${_.status??""}`,"svelte-1mqkwr3"),le(Oe,1,`status-badge status-${_.status??""}`,"svelte-1mqkwr3"),u(Le,f),u(ve,_.type),u(Fe,`${_.quantity||1} ${(_.quantity||1)===1?"copy":"copies"}`),u(bs,_.processedBy??"—"),u(Ut,_.requestedDate??"—"),u(St,_.purpose||"No purpose provided"),Is.disabled=_.status!=="on_hold",ke(Is,"title",_.status!=="on_hold"?"Can only cancel requests that are on hold":"Cancel this request"),Ct=le(vt,1,"student-docreq-modal-right-container svelte-1mqkwr3",null,Ct,D),u($t,e(_e).length),Us=le(As,1,"student-chat-input svelte-1mqkwr3",null,Us,x),Pt=le(Hs,1,"pagination-dot svelte-1mqkwr3",null,Pt,E),pt=le(Ys,1,"pagination-dot svelte-1mqkwr3",null,pt,$)},[()=>({"mobile-hidden":e(be)!==1}),()=>ue(_.status),()=>({"mobile-hidden":e(be)!==2}),()=>({disabled:e(U)}),()=>({active:e(be)===1}),()=>({active:e(be)===2})]),n(m,oe),Ds(),w()}Ps(["click","change","keydown"]);var Or=(m,l)=>m.key==="Enter"&&l(m),Gr=b('<div role="dialog" aria-modal="true" tabindex="-1"><!></div>');function Br(m,l){Ss(l,!0);let r=N(ks({isOpen:!1,request:null,onCancel:null,onRefresh:null}));Bt.subscribe(S=>{c(r,S,!0)});let w=N(!1),R=N(!1),q=N(null);hs(()=>{e(r).isOpen&&!e(w)&&!e(R)?(setTimeout(()=>{c(w,!0)},10),document.body.style.overflow="hidden"):!e(r).isOpen&&(e(w)||e(R))&&k()});function k(){c(R,!0),setTimeout(()=>{c(w,!1),c(R,!1),document.body.style.overflow=""},300)}function o(S){S.target===S.currentTarget&&Bt.close()}function G(S){S.key==="Escape"&&e(r).isOpen&&Bt.close()}ht(()=>()=>{document.body.style.overflow=""});var _=ee();Xs("keydown",et,G);var F=L(_);{var i=S=>{var I=Gr();let O;I.__click=o,I.__keydown=[Or,o];var y=t(I);Nr(y,{get request(){return e(r).request},get onCancel(){return e(r).onCancel},get onRefresh(){return e(r).onRefresh},onClose:()=>Bt.close()}),s(I),xs(I,C=>c(q,C),()=>e(q)),j(C=>O=le(I,1,"student-docreq-modal-overlay svelte-1ingzcd",null,O,C),[()=>({"student-docreq-modal-visible":e(w)&&!e(R),"student-docreq-modal-closing":e(R)})]),n(S,I)};h(F,S=>{(e(r).isOpen||e(w)||e(R))&&S(i)})}n(m,_),Ds()}Ps(["click","keydown"]);var Lr=b('<div class="score-card svelte-1e19mq7"><div class="score-label svelte-1e19mq7"> </div> <div class="score-value svelte-1e19mq7"> </div></div>'),Qr=b('<div class="breakdown-section svelte-1e19mq7"><div class="breakdown-header svelte-1e19mq7"><div class="breakdown-title svelte-1e19mq7"><span class="material-symbols-outlined svelte-1e19mq7">edit</span> <span>Written Work</span></div> <div class="breakdown-average svelte-1e19mq7"> </div></div> <div class="scores-grid svelte-1e19mq7"></div></div>'),Ur=b('<div class="score-card svelte-1e19mq7"><div class="score-label svelte-1e19mq7"> </div> <div class="score-value svelte-1e19mq7"> </div></div>'),Vr=b('<div class="breakdown-section svelte-1e19mq7"><div class="breakdown-header svelte-1e19mq7"><div class="breakdown-title svelte-1e19mq7"><span class="material-symbols-outlined svelte-1e19mq7">assignment</span> <span>Performance Tasks</span></div> <div class="breakdown-average svelte-1e19mq7"> </div></div> <div class="scores-grid svelte-1e19mq7"></div></div>'),Hr=b('<div class="score-card svelte-1e19mq7"><div class="score-label svelte-1e19mq7"> </div> <div class="score-value svelte-1e19mq7"> </div></div>'),Yr=b('<div class="breakdown-section svelte-1e19mq7"><div class="breakdown-header svelte-1e19mq7"><div class="breakdown-title svelte-1e19mq7"><span class="material-symbols-outlined svelte-1e19mq7">quiz</span> <span>Quarterly Assessment</span></div> <div class="breakdown-average svelte-1e19mq7"> </div></div> <div class="scores-grid svelte-1e19mq7"></div></div>'),Kr=b("<!> <!> <!>",1),Wr=b('<div class="empty-state svelte-1e19mq7"><span class="material-symbols-outlined svelte-1e19mq7">pending</span> <p class="svelte-1e19mq7">No detailed scores available yet</p> <small class="svelte-1e19mq7">Scores will appear here once your teacher uploads them</small></div>'),Zr=b('<div class="modal-header svelte-1e19mq7"><div class="header-info svelte-1e19mq7"><h2 class="subject-title svelte-1e19mq7"> </h2> <div class="header-meta svelte-1e19mq7"><span class="meta-item svelte-1e19mq7"><span class="material-symbols-outlined svelte-1e19mq7">person</span> </span> <span class="meta-item svelte-1e19mq7"><span class="material-symbols-outlined svelte-1e19mq7">calendar_today</span> </span></div></div> <button class="close-btn svelte-1e19mq7" aria-label="Close modal"><span class="material-symbols-outlined svelte-1e19mq7">close</span></button></div> <div class="grade-overview-card svelte-1e19mq7"><div class="grade-display svelte-1e19mq7"><div class="grade-label svelte-1e19mq7">Final Grade</div> <div class="grade-value svelte-1e19mq7"> </div> <div class="grade-status svelte-1e19mq7"> </div></div> <div class="grade-progress svelte-1e19mq7"><div class="progress-bar-container svelte-1e19mq7"><div class="progress-bar-fill svelte-1e19mq7"></div></div></div></div> <div class="tab-content svelte-1e19mq7"><div class="breakdown-tab"><!></div></div>',1),Jr=b('<div class="grade-modal-content svelte-1e19mq7"><!></div>');function Xr(m,l){Ss(l,!0);let r=Re(l,"subject",19,()=>({})),w=Re(l,"quarterName",3,""),R=Re(l,"schoolYear",3,""),q=Re(l,"onClose",3,()=>{});function k(y){return y===0||y===null||y===void 0?"var(--grade-no-grade)":y>=85?"var(--grade-excellent)":y>=80?"var(--grade-good)":y>=75?"var(--grade-satisfactory)":(y>=65,"var(--grade-needs-improvement)")}function o(y){return y>=85?"Excellent":y>=80?"Good":y>=75?"Satisfactory":y>=65?"Needs Improvement":"No Grade"}function G(y){return y==null||y===0?"N/A":y%1===0?y.toString():y.toFixed(1)}function _(y,C){return`${{written:"Quiz",performance:"Project",quarterly:"Exam"}[C]||"Task"} ${y+1}`}function F(y){return!y||y===0?0:Math.min(y/100*100,100)}function i(){return r()?r().writtenWorkScores&&r().writtenWorkScores.length>0||r().performanceTasksScores&&r().performanceTasksScores.length>0||r().quarterlyAssessmentScores&&r().quarterlyAssessmentScores.length>0:!1}var S=Jr(),I=t(S);{var O=y=>{var C=Zr(),H=L(C),Z=t(H),Q=t(Z),xe=t(Q,!0);s(Q);var be=a(Q,2),_e=t(be),re=a(t(_e));s(_e);var U=a(_e,2),V=a(t(U));s(U),s(be),s(Z);var Se=a(Z,2);Se.__click=function(...oe){q()?.apply(this,oe)},s(H);var ze=a(H,2),Pe=t(ze),ue=a(t(Pe),2),ie=t(ue,!0);s(ue);var se=a(ue,2),Ne=t(se,!0);s(se),s(Pe);var ms=a(Pe,2),ye=t(ms),Xe=t(ye);s(ye),s(ms),s(ze);var He=a(ze,2),os=t(He),es=t(os);{var ge=oe=>{var De=Kr(),Ce=L(De);{var me=J=>{var Y=Qr(),X=t(Y),K=a(t(X),2),Oe=t(K);s(K),s(X);var Le=a(X,2);is(Le,21,()=>r().writtenWorkScores,Os,(Te,te,Ye)=>{var ve=Lr(),qe=t(ve),fs=t(qe,!0);s(qe);var Fe=a(qe,2),vs=t(Fe,!0);s(Fe),s(ve),j((ts,bs,Ke)=>{u(fs,ts),Ms(Fe,`color: ${bs??""}`),u(vs,Ke)},[()=>_(Ye,"written"),()=>k(e(te)),()=>G(e(te))]),n(Te,ve)}),s(Le),s(Y),j((Te,te)=>{Ms(K,`color: ${Te??""}`),u(Oe,`Avg: ${te??""}`)},[()=>k(r().writtenWork),()=>G(r().writtenWork)]),n(J,Y)};h(Ce,J=>{r().writtenWorkScores&&r().writtenWorkScores.length>0&&J(me)})}var Ae=a(Ce,2);{var Be=J=>{var Y=Vr(),X=t(Y),K=a(t(X),2),Oe=t(K);s(K),s(X);var Le=a(X,2);is(Le,21,()=>r().performanceTasksScores,Os,(Te,te,Ye)=>{var ve=Ur(),qe=t(ve),fs=t(qe,!0);s(qe);var Fe=a(qe,2),vs=t(Fe,!0);s(Fe),s(ve),j((ts,bs,Ke)=>{u(fs,ts),Ms(Fe,`color: ${bs??""}`),u(vs,Ke)},[()=>_(Ye,"performance"),()=>k(e(te)),()=>G(e(te))]),n(Te,ve)}),s(Le),s(Y),j((Te,te)=>{Ms(K,`color: ${Te??""}`),u(Oe,`Avg: ${te??""}`)},[()=>k(r().performanceTasks),()=>G(r().performanceTasks)]),n(J,Y)};h(Ae,J=>{r().performanceTasksScores&&r().performanceTasksScores.length>0&&J(Be)})}var we=a(Ae,2);{var ss=J=>{var Y=Yr(),X=t(Y),K=a(t(X),2),Oe=t(K);s(K),s(X);var Le=a(X,2);is(Le,21,()=>r().quarterlyAssessmentScores,Os,(Te,te,Ye)=>{var ve=Hr(),qe=t(ve),fs=t(qe,!0);s(qe);var Fe=a(qe,2),vs=t(Fe,!0);s(Fe),s(ve),j((ts,bs,Ke)=>{u(fs,ts),Ms(Fe,`color: ${bs??""}`),u(vs,Ke)},[()=>_(Ye,"quarterly"),()=>k(e(te)),()=>G(e(te))]),n(Te,ve)}),s(Le),s(Y),j((Te,te)=>{Ms(K,`color: ${Te??""}`),u(Oe,`Avg: ${te??""}`)},[()=>k(r().quarterlyAssessment),()=>G(r().quarterlyAssessment)]),n(J,Y)};h(we,J=>{r().quarterlyAssessmentScores&&r().quarterlyAssessmentScores.length>0&&J(ss)})}n(oe,De)},Ie=oe=>{var De=Wr();n(oe,De)};h(es,oe=>{i()?oe(ge):oe(Ie,!1)})}s(os),s(He),j((oe,De,Ce,me,Ae,Be)=>{u(xe,r().name||"Subject"),u(re,` ${r().teacher||"No teacher assigned"}`),u(V,` ${w()??""} • ${R()??""}`),Ms(ue,`color: ${oe??""}`),u(ie,De),Ms(se,`color: ${Ce??""}`),u(Ne,me),Ms(Xe,`width: ${Ae??""}%; background-color: ${Be??""}`)},[()=>k(r().numericGrade),()=>G(r().numericGrade),()=>k(r().numericGrade),()=>o(r().numericGrade),()=>F(r().numericGrade),()=>k(r().numericGrade)]),n(y,C)};h(I,y=>{r()&&y(O)})}s(S),Ea(3,S,()=>Na,()=>({y:20,duration:300,easing:za})),n(m,S),Ds()}Ps(["click"]);var en=(m,l)=>m.key==="Enter"&&l(m),sn=b('<div role="dialog" aria-modal="true" tabindex="-1"><!></div>');function tn(m,l){Ss(l,!0);let r=N(ks({isOpen:!1,subject:null,quarterName:null,schoolYear:null}));Lt.subscribe(S=>{c(r,S,!0)});let w=N(!1),R=N(!1),q=N(null);hs(()=>{e(r).isOpen&&!e(w)&&!e(R)?(setTimeout(()=>{c(w,!0)},10),document.body.style.overflow="hidden"):!e(r).isOpen&&(e(w)||e(R))&&k()});function k(){c(R,!0),setTimeout(()=>{c(w,!1),c(R,!1),document.body.style.overflow=""},300)}function o(S){S.target===S.currentTarget&&Lt.close()}function G(S){S.key==="Escape"&&e(r).isOpen&&Lt.close()}ht(()=>()=>{document.body.style.overflow=""});var _=ee();Xs("keydown",et,G);var F=L(_);{var i=S=>{var I=sn();let O;I.__click=o,I.__keydown=[en,o];var y=t(I);Xr(y,{get subject(){return e(r).subject},get quarterName(){return e(r).quarterName},get schoolYear(){return e(r).schoolYear},onClose:()=>Lt.close()}),s(I),xs(I,C=>c(q,C),()=>e(q)),j(C=>O=le(I,1,"student-grade-modal-overlay svelte-niq90y",null,O,C),[()=>({"student-grade-modal-visible":e(w)&&!e(R),"student-grade-modal-closing":e(R)})]),n(S,I)};h(F,S=>{(e(r).isOpen||e(w)||e(R))&&S(i)})}n(m,_),Ds()}Ps(["click","keydown"]);var an=b('<link rel="icon"/> <link rel="preconnect" href="https://fonts.googleapis.com"/> <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin=""/> <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&amp;display=swap" rel="stylesheet"/> <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/> <meta name="theme-color" content="#1565c0"/>',1),ln=b("<!> <!> <!> <!> <!> <!>",1);function cn(m,l){Ss(l,!0);let r=N(!1),w=N(void 0);hs(()=>Qt.subscribe(O=>{c(w,O,!0)}));let R=ns(()=>e(w)?.isAuthenticated?e(w).userType==="admin"?Ga:e(w).userType==="student"?Ba:e(w).userType==="teacher"?La:ca:ca);ht(()=>{setTimeout(()=>{Qt.initialize(),c(r,!0),window.appLoadingManager&&window.appLoadingManager.setReady()},2800)});var q=ln();Ia(I=>{var O=an(),y=L(O);Ns(12),j(()=>ke(y,"href",e(R))),n(I,O)});var k=L(q);{var o=I=>{var O=ee(),y=L(O);pa(y,()=>l.children??Aa),n(I,O)};h(k,I=>{e(r)&&I(o)})}var G=a(k,2);Ua(G,{});var _=a(G,2);Ll(_,{});var F=a(_,2);Vl(F,{});var i=a(F,2);Br(i,{});var S=a(i,2);tn(S,{}),n(m,q),Ds()}export{cn as component};
