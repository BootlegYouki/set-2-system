import"../chunks/DsnmJJEf.js";import{h as xn,a as Cd,aX as Td,aY as Ed,aZ as Fd,b as Nd,c as $d,d as Ld,e as Pd,s as Md,f as Id,U as Rd,p as Od,a0 as jd,a_ as qd,E as zd,a$ as Gd,b0 as Vd,K as Bd,j as x,b1 as Wd,b2 as Hd,b3 as Ud,b4 as Fc,a8 as Yd,M as Qd,P as ki,aL as Ps,q as qa,ae as pt,_ as Xs,ad as Ya,T as v,t as _,z as o,A as i,B as u,l as e,w as O,C as w,x as m,y as za,v as tt,aV as Ht,aS as Se,ag as mt,aK as Ws,V as yo,ah as aa,i as Es,Q as R,b5 as Ns,b6 as ht,m as Ss,b7 as Ms,b8 as ti,af as Sn,b9 as or,ai as ba,aT as Zs,Z as fr,ba as kn,bb as Kd,aR as Jd,bc as Xd,aW as Zd,bd as eu}from"../chunks/BrR45Eif.js";import{i as E,p as Ma,a as Ja,s as xs,b as Hs,d as el}from"../chunks/CsvhCkDi.js";import{k as tu,d as gs,l as qr,r as ta,s as we,f as Ri,a as Mt,c as ia,e as Dt,i as Ua,t as Te,b as ns,m as cs,n as us,h as la,j as au,o as su,T as ru,p as iu,g as tl}from"../chunks/IeYxAUqq.js";import{i as Fs}from"../chunks/DMNA4brR.js";const nu=!0;function Rs(s,t,a){xn&&Cd();var r=s,n=Rd,l,c,d=null,f=Td()?Ed:Fd;function p(){l&&Od(l),d!==null&&(d.lastChild.remove(),r.before(d),d=null),l=c}Nd(()=>{if(f(n,n=t())){var h=r,g=Md();g&&(d=document.createDocumentFragment(),d.append(h=$d())),c=Ld(()=>a(h)),g?Pd.add_callback(p):p()}}),xn&&(r=Id)}function Wa(s,t,a,r){var n=s.__style;if(xn||n!==t){var l=tu(t);(!xn||l!==s.getAttribute("style"))&&(l==null?s.removeAttribute("style"):s.style.cssText=l),s.__style=t}return r}const ou=()=>performance.now(),Er={tick:s=>requestAnimationFrame(s),now:()=>ou(),tasks:new Set};function Nc(){const s=Er.now();Er.tasks.forEach(t=>{t.c(s)||(Er.tasks.delete(t),t.f())}),Er.tasks.size!==0&&Er.tick(Nc)}function lu(s){let t;return Er.tasks.size===0&&Er.tick(Nc),{promise:new Promise(a=>{Er.tasks.add(t={c:s,f:a})}),abort(){Er.tasks.delete(t)}}}function nn(s,t){Fc(()=>{s.dispatchEvent(new CustomEvent(t))})}function cu(s){if(s==="float")return"cssFloat";if(s==="offset")return"cssOffset";if(s.startsWith("--"))return s;const t=s.split("-");return t.length===1?t[0]:t[0]+t.slice(1).map(a=>a[0].toUpperCase()+a.slice(1)).join("")}function al(s){const t={},a=s.split(";");for(const r of a){const[n,l]=r.split(":");if(!n||l===void 0)break;const c=cu(n.trim());t[c]=l.trim()}return t}const du=s=>s;function Xa(s,t,a,r){var n=(s&Hd)!==0,l=(s&Ud)!==0,c=n&&l,d=(s&Wd)!==0,f=c?"both":n?"in":"out",p,h=t.inert,g=t.style.overflow,b,y;function k(){return Fc(()=>p??=a()(t,r?.()??{},{direction:f}))}var A={is_global:d,in(){if(t.inert=h,!n){y?.abort(),y?.reset?.();return}l||b?.abort(),nn(t,"introstart"),b=fo(t,k(),y,1,()=>{nn(t,"introend"),b?.abort(),b=p=void 0,t.style.overflow=g})},out(S){if(!l){S?.(),p=void 0;return}t.inert=!0,nn(t,"outrostart"),y=fo(t,k(),b,0,()=>{nn(t,"outroend"),S?.()})},stop:()=>{b?.abort(),y?.abort()}},D=jd;if((D.transitions??=[]).push(A),n&&qd){var T=d;if(!T){for(var C=D.parent;C&&(C.f&zd)!==0;)for(;(C=C.parent)&&(C.f&Gd)===0;);T=!C||(C.f&Vd)!==0}T&&Bd(()=>{x(()=>A.in())})}}function fo(s,t,a,r,n){var l=r===1;if(Yd(t)){var c,d=!1;return Qd(()=>{if(!d){var D=t({direction:l?"in":"out"});c=fo(s,D,a,r,n)}}),{abort:()=>{d=!0,c?.abort()},deactivate:()=>c.deactivate(),reset:()=>c.reset(),t:()=>c.t()}}if(a?.deactivate(),!t?.duration)return n(),{abort:ki,deactivate:ki,reset:ki,t:()=>r};const{delay:f=0,css:p,tick:h,easing:g=du}=t;var b=[];if(l&&a===void 0&&(h&&h(0,1),p)){var y=al(p(0,1));b.push(y,y)}var k=()=>1-r,A=s.animate(b,{duration:f,fill:"forwards"});return A.onfinish=()=>{A.cancel();var D=a?.t()??1-r;a?.abort();var T=r-D,C=t.duration*Math.abs(T),S=[];if(C>0){var M=!1;if(p)for(var F=Math.ceil(C/16.666666666666668),j=0;j<=F;j+=1){var P=D+T*g(j/F),Y=al(p(P,1-P));S.push(Y),M||=Y.overflow==="hidden"}M&&(s.style.overflow="hidden"),k=()=>{var W=A.currentTime;return D+T*g(W/C)},h&&lu(()=>{if(A.playState!=="running")return!1;var W=k();return h(W,1-W),!0})}A=s.animate(S,{duration:C,fill:"forwards"}),A.onfinish=()=>{k=()=>r,h?.(r,1-r),n()}},{abort:()=>{A&&(A.cancel(),A.effect=null,A.onfinish=ki)},deactivate:()=>{n=ki},reset:()=>{r===0&&h?.(1,0)},t:()=>k()}}function po(s){return function(...t){var a=t[0];return a.stopPropagation(),s?.apply(this,t)}}function tr(s){return function(...t){var a=t[0];return a.preventDefault(),s?.apply(this,t)}}const sl=nu,$c=s=>{const t=/^[A-Z]{3}-\d{4}-\d{4}$/;return s?t.test(s)?"":"Please enter a valid ID Number (e.g., STU-2025-0001)":"ID Number is required"},Lc=s=>s?"":"Password is required",Pc=()=>document.documentElement.getAttribute("data-theme")||"light",uu=s=>{document.documentElement.setAttribute("data-theme",s),localStorage.setItem("theme",s)},vu=()=>{const t=Pc()==="dark"?"light":"dark";return uu(t),t},fu=()=>{if(typeof window>"u")return!1;const s=navigator.userAgent||navigator.vendor||window.opera;return!!(/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini|mobile|tablet/i.test(s)||window.innerWidth<=768&&("ontouchstart"in window||navigator.maxTouchPoints>0))},pu=async({accountNumber:s,password:t})=>{try{const r=await(await fetch("/api/auth",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accountNumber:s,password:t})})).json();if(r.success){if(r.user.accountType==="admin"&&fu())throw new Error("Admin access is restricted to desktop devices only. Please use a PC to access the admin portal.");const n={id:r.user.id,name:r.user.name,firstName:r.user.firstName,gender:r.user.gender,accountNumber:r.user.accountNumber,accountType:r.user.accountType,isAuthenticated:!0};return gs.login(n.accountType,n),qr(`Login successful! Welcome back, ${n.name}`),console.log("Login successful:",{accountNumber:s,userType:n.accountType}),n}else{const n=new Error(r.error||"Invalid credentials. Please try again.");throw n.attemptsLeft=r.attemptsLeft,n.isLocked=r.isLocked,n}}catch(a){if(a.message==="Failed to fetch"||a instanceof TypeError)throw new Error("Connection failed. Please check your internet connection and try again.");const r=new Error(a.message||"Network error. Please try again.");throw a.attemptsLeft!==void 0&&(r.attemptsLeft=a.attemptsLeft),a.isLocked!==void 0&&(r.isLocked=a.isLocked),r}};function mu(s,t){const a=vu();v(t,a==="dark")}const hu=(s,t,a)=>{v(t,s.target.value,!0),e(a).idNumber&&v(a,{...e(a),idNumber:$c(e(t))},!0)},gu=(s,t,a)=>{v(t,s.target.value,!0),e(a).password&&v(a,{...e(a),password:Lc(e(t))},!0)},rl=(s,t)=>{s.key==="Enter"&&(s.preventDefault(),t(s))};async function _u(s,t,a,r,n){v(t,""),v(a,["","","","","",""],!0),v(r,5),await n({preventDefault:()=>{}})}var bu=_('<div class="error-text"> </div>'),yu=(s,t)=>{s.preventDefault(),s.stopPropagation(),v(t,!e(t))},wu=(s,t)=>{s.key==="Enter"&&(s.preventDefault(),s.stopPropagation(),v(t,!e(t)))},xu=_('<div class="error-text"> </div>'),Su=_('<div class="error-message-item"> </div>'),ku=_('<div class="error-message-item"> </div>'),Au=_('<div class="error-message-item"> </div>'),Du=_('<div class="error-message-item" style="color: #ff9800; font-weight: 500;"> </div>'),Cu=_('<div class="login-error-container"><span class="material-symbols-outlined">error</span> <div class="error-messages"><!> <!> <!> <!></div></div>'),Tu=_('<div class="login-loading-spinner"></div>'),Eu=_("<span>Login Locked</span>"),Fu=_("<span>Login</span>"),Nu=_('<div class="login-header"><h1 class="login-title">Login</h1> <h2 class="login-subtitle">Enter your account details</h2></div> <form class="login-form" novalidate="" autocomplete="off"><div class="form-field"><div><span class="leading-icon material-symbols-outlined">badge</span> <input type="text" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" class="text-input" placeholder=" "/> <label class="text-label" for="idnumber-input">ID Number</label></div> <!></div> <div class="form-field"><div><span class="leading-icon material-symbols-outlined">lock</span> <input autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" class="text-input" placeholder=" "/> <label class="text-label" for="password-input">Password</label> <button type="button" class="trailing-icon-button"><span class="material-symbols-outlined"> </span></button></div> <!></div> <!> <button id="login-submit-btn" type="submit" class="custom-filled-button login-submit" aria-label="Sign in"><!></button> <button type="button" id="forgot-password-btn" class="custom-text-button forgot-password" aria-label="forgot-password">Forgot Password</button></form>',1),$u=_('<div class="success-message-box"><span class="material-symbols-outlined">check_circle</span> <span> </span></div>'),Lu=_('<div class="error-message-box"><span class="material-symbols-outlined">error</span> <span> </span></div>'),Pu=_('<div class="login-loading-spinner"></div>'),Mu=_('<span class="material-symbols-outlined">send</span> <span>Send Code</span>',1),Iu=_('<form class="login-form"><div class="form-field"><div class="custom-text-field"><span class="leading-icon material-symbols-outlined">email</span> <input id="forgot-password-email" type="email" autocomplete="email" class="text-input" placeholder=" " required/> <label for="forgot-password-email" class="text-label">Email Address</label></div></div> <button type="submit" class="custom-filled-button login-submit"><!></button> <button class="back-to-login-btn" aria-label="Back to login">Back to Login</button></form>'),Ru=_('<input type="text" maxlength="1" inputmode="numeric" autocomplete="off" class="code-box" required/>'),Ou=_('<div class="info-text"> </div>'),ju=_('<div class="verification-loading"><div class="login-loading-spinner"></div> <span>Verifying code...</span></div>'),qu=_('<div class="login-loading-spinner"></div>'),zu=_('<span class="material-symbols-outlined">refresh</span> <span>Resend Code</span>',1),Gu=_('<form class="login-form"><div class="form-field"><div class="code-boxes-container"></div> <!> <!></div> <button type="button" class="custom-filled-button login-submit"><!></button> <button class="back-to-login-btn" aria-label="Back to login">Back to Login</button></form>'),Vu=(s,t)=>{s.preventDefault(),v(t,!e(t))},Bu=(s,t)=>{s.preventDefault(),v(t,!e(t))},Wu=_('<div class="login-loading-spinner"></div>'),Hu=_("<span>Reset Password</span>"),Uu=_('<form class="login-form"><div class="form-field"><div class="custom-text-field"><span class="leading-icon material-symbols-outlined">lock</span> <input id="reset-new-password" autocomplete="new-password" class="text-input" placeholder=" " required/> <label for="reset-new-password" class="text-label">New Password</label> <button type="button" class="trailing-icon-button"><span class="material-symbols-outlined"> </span></button></div></div> <div class="form-field"><div class="custom-text-field"><span class="leading-icon material-symbols-outlined">lock_reset</span> <input id="reset-confirm-password" autocomplete="new-password" class="text-input" placeholder=" " required/> <label for="reset-confirm-password" class="text-label">Confirm Password</label> <button type="button" class="trailing-icon-button"><span class="material-symbols-outlined"> </span></button></div></div> <button type="submit" class="custom-filled-button login-submit"><!></button> <button class="back-to-login-btn" aria-label="Back to login">Back to Login</button></form>'),Yu=_('<div class="login-header"><h1 class="login-title"> </h1> <h2 class="login-subtitle"> </h2></div> <!> <!> <!> <!> <!>',1),Qu=_('<div class="login-container"><button class="theme-toggle-btn" aria-label="Toggle dark mode"><span class="material-symbols-outlined"> </span></button> <div class="left-side"><!></div> <div class="right-side"><div class="welcome-text"><h1 class="welcome-title"> </h1> <p class="welcome-subtitle"> </p></div></div></div>');function Ku(s,t){qa(t,!0);let a=pt(""),r=pt(""),n=pt(!1),l=pt(!1),c=pt(Xs({idNumber:"",password:"",general:""})),d=pt(null),f=pt(!1),p=pt(!1),h=pt(1),g=pt(""),b=pt(""),y=pt(""),k=pt(Xs(["","","","","",""])),A=pt(""),D=pt(""),T=pt(!1),C=pt(!1),S=pt(""),M=pt(5),F=pt(!1);const j="forgotPasswordState";function P(){if(!(typeof window>"u"))try{const Ee={showForgotPassword:e(p),forgotPasswordStep:e(h),email:e(g),resetToken:e(b),verificationCode:e(y),codeDigits:e(k),attemptsRemaining:e(M)};sessionStorage.setItem(j,JSON.stringify(Ee))}catch(Ee){console.warn("Failed to save forgot password state:",Ee)}}function Y(){if(!(typeof window>"u"))try{const Ee=sessionStorage.getItem(j);if(Ee){const pe=JSON.parse(Ee);v(p,pe.showForgotPassword||!1,!0),v(h,pe.forgotPasswordStep||1,!0),v(g,pe.email||"",!0),v(b,pe.resetToken||"",!0),v(y,pe.verificationCode||"",!0),v(k,pe.codeDigits||["","","","","",""],!0),v(M,pe.attemptsRemaining||5,!0)}}catch(Ee){console.warn("Failed to load forgot password state:",Ee)}}function W(){if(!(typeof window>"u"))try{sessionStorage.removeItem(j)}catch(Ee){console.warn("Failed to clear forgot password state:",Ee)}}Ya(()=>{const Ee=Pc();v(F,Ee==="dark"),Y()});const N=async Ee=>{Ee.preventDefault(),v(c,{idNumber:"",password:"",general:""},!0),v(d,null),v(f,!1);const pe=$c(e(a)),qe=Lc(e(r));if(pe||qe){v(c,{idNumber:pe,password:qe,general:""},!0);return}v(n,!0);try{const Ae=await pu({accountNumber:e(a),password:e(r)})}catch(Ae){v(c,{...e(c),general:Ae.message},!0),Ae.attemptsLeft!==void 0&&v(d,Ae.attemptsLeft,!0),Ae.isLocked&&(v(f,!0),v(d,0))}finally{v(n,!1)}};function L(){v(p,!e(p)),e(p)?P():(v(h,1),v(g,""),v(b,""),v(y,""),v(k,["","","","","",""],!0),v(A,""),v(D,""),v(c,{idNumber:"",password:"",general:""},!0),v(S,""),v(M,5),W())}function X(Ee,pe){const Ae=pe.target.value.replace(/\D/g,"");if(Ae.length>0)if(e(k)[Ee]=Ae[Ae.length-1],v(y,e(k).join(""),!0),Ee<5&&Ae){const Ie=document.getElementById(`code-digit-${Ee+1}`);Ie&&Ie.focus()}else Ee===5&&e(k).every(Ie=>Ie!=="")&&se({preventDefault:()=>{}});else e(k)[Ee]="",v(y,e(k).join(""),!0)}function ae(Ee,pe){if(pe.key==="Backspace"&&!e(k)[Ee]&&Ee>0){const qe=document.getElementById(`code-digit-${Ee-1}`);qe&&qe.focus()}}function V(Ee){Ee.preventDefault();const pe=Ee.clipboardData.getData("text").replace(/\D/g,"").slice(0,6);if(pe.length>0){const qe=pe.split("");v(k,[...qe,...Array(6-qe.length).fill("")],!0),v(y,e(k).join(""),!0);const Ae=Math.min(qe.length,5),Ie=document.getElementById(`code-digit-${Ae}`);Ie&&Ie.focus(),pe.length===6&&se({preventDefault:()=>{}})}}function ie(Ee){return Ee?/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(Ee)?"":"Please enter a valid email address":"Email address is required"}function he(Ee){return Ee?/^\d{6}$/.test(Ee)?"":"Code must be 6 digits":"Verification code is required"}function Ge(Ee){return Ee?Ee.length<6?"Password must be at least 6 characters":"":"Password is required"}async function ce(Ee){Ee.preventDefault(),v(c,{idNumber:"",password:"",general:""},!0),v(S,"");const pe=ie(e(g));if(pe){v(c,{...e(c),general:pe},!0);return}v(n,!0);try{const qe=await fetch("/api/forgot-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e(g).toLowerCase().trim()})}),Ae=await qe.json();if(!qe.ok)throw new Error(Ae.error||"Failed to send reset code");v(b,Ae.resetToken,!0),v(S,"A verification code has been sent to your email address."),v(h,2),P()}catch(qe){v(c,{...e(c),general:qe.message},!0)}finally{v(n,!1)}}async function se(Ee){Ee.preventDefault(),v(c,{idNumber:"",password:"",general:""},!0),v(S,"");const pe=he(e(y));if(pe){v(c,{...e(c),general:pe},!0);return}v(n,!0);try{const qe=await fetch("/api/forgot-password/verify-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({resetToken:e(b),code:e(y)})}),Ae=await qe.json();if(!qe.ok)throw Ae.attemptsRemaining!==void 0&&v(M,Ae.attemptsRemaining,!0),new Error(Ae.error||"Invalid verification code");v(S,"Code verified! Please enter your new password."),v(h,3),P()}catch(qe){v(c,{...e(c),general:qe.message},!0),P()}finally{v(n,!1)}}async function Re(Ee){Ee.preventDefault(),v(c,{idNumber:"",password:"",general:""},!0),v(S,"");const pe=Ge(e(A));if(pe){v(c,{...e(c),general:pe},!0);return}if(e(A)!==e(D)){v(c,{...e(c),general:"Passwords do not match"},!0);return}v(n,!0);try{const qe=await fetch("/api/forgot-password/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({resetToken:e(b),code:e(y),newPassword:e(A)})}),Ae=await qe.json();if(!qe.ok)throw new Error(Ae.error||"Failed to reset password");v(S,"Password reset successfully! Redirecting to login..."),W(),setTimeout(()=>{L()},2e3)}catch(qe){v(c,{...e(c),general:qe.message},!0)}finally{v(n,!1)}}var Je=Qu(),it=o(Je);it.__click=[mu,F];var Le=o(it),ke=o(Le,!0);i(Le),i(it);var Ke=u(it,2),lt=o(Ke);{var He=Ee=>{var pe=Nu(),qe=u(tt(pe),2),Ae=o(qe),Ie=o(Ae),ut=u(o(Ie),2);ta(ut),ut.__input=[hu,a,c],ut.__keydown=[rl,N],Ht(2),i(Ie);var me=u(Ie,2);{var J=ve=>{var Fe=bu(),Ce=o(Fe,!0);i(Fe),O(()=>w(Ce,e(c).idNumber)),m(ve,Fe)};E(me,ve=>{e(c).idNumber&&ve(J)})}i(Ae);var xe=u(Ae,2),$e=o(xe),B=u(o($e),2);ta(B),B.__input=[gu,r,c],B.__keydown=[rl,N];var te=u(B,4);te.__click=[yu,l],te.__keydown=[wu,l];var ue=o(te),G=o(ue,!0);i(ue),i(te),i($e);var z=u($e,2);{var le=ve=>{var Fe=xu(),Ce=o(Fe,!0);i(Fe),O(()=>w(Ce,e(c).password)),m(ve,Fe)};E(z,ve=>{e(c).password&&ve(le)})}i(xe);var Z=u(xe,2);{var q=ve=>{var Fe=Cu(),Ce=u(o(Fe),2),Be=o(Ce);{var Ue=At=>{var Wt=Su(),Nt=o(Wt,!0);i(Wt),O(()=>w(Nt,e(c).idNumber)),m(At,Wt)};E(Be,At=>{e(c).idNumber&&At(Ue)})}var Pe=u(Be,2);{var Ve=At=>{var Wt=ku(),Nt=o(Wt,!0);i(Wt),O(()=>w(Nt,e(c).password)),m(At,Wt)};E(Pe,At=>{e(c).password&&At(Ve)})}var st=u(Pe,2);{var nt=At=>{var Wt=Au(),Nt=o(Wt,!0);i(Wt),O(()=>w(Nt,e(c).general)),m(At,Wt)};E(st,At=>{e(c).general&&At(nt)})}var vt=u(st,2);{var St=At=>{var Wt=Du(),Nt=o(Wt);i(Wt),O(()=>w(Nt,`${e(d)??""} attempt${e(d)!==1?"s":""} remaining before login lockout`)),m(At,Wt)};E(vt,At=>{e(d)!==null&&e(d)>0&&!e(f)&&At(St)})}i(Ce),i(Fe),m(ve,Fe)};E(Z,ve=>{(e(c).idNumber||e(c).password||e(c).general)&&ve(q)})}var U=u(Z,2),$=o(U);{var I=ve=>{var Fe=Tu();m(ve,Fe)},H=ve=>{var Fe=mt(),Ce=tt(Fe);{var Be=Pe=>{var Ve=Eu();m(Pe,Ve)},Ue=Pe=>{var Ve=Fu();m(Pe,Ve)};E(Ce,Pe=>{e(f)?Pe(Be):Pe(Ue,!1)},!0)}m(ve,Fe)};E($,ve=>{e(n)?ve(I):ve(H,!1)})}i(U);var fe=u(U,2);fe.__click=L,i(qe),O(()=>{we(Ie,1,`custom-text-field ${e(c).idNumber?"error":""}`),Ri(ut,e(a)),we($e,1,`custom-text-field ${e(c).password?"error":""}`),Mt(B,"type",e(l)?"text":"password"),Ri(B,e(r)),Mt(te,"aria-label",e(l)?"Hide password":"Show password"),w(G,e(l)?"visibility":"visibility_off"),U.disabled=e(n)||e(f)}),Se("submit",qe,N),m(Ee,pe)},et=Ee=>{var pe=Yu(),qe=tt(pe),Ae=o(qe),Ie=o(Ae,!0);i(Ae);var ut=u(Ae,2),me=o(ut,!0);i(ut),i(qe);var J=u(qe,2);{var xe=q=>{var U=$u(),$=u(o(U),2),I=o($,!0);i($),i(U),O(()=>w(I,e(S))),m(q,U)};E(J,q=>{e(S)&&q(xe)})}var $e=u(J,2);{var B=q=>{var U=Lu(),$=u(o(U),2),I=o($,!0);i($),i(U),O(()=>w(I,e(c).general)),m(q,U)};E($e,q=>{e(c).general&&q(B)})}var te=u($e,2);{var ue=q=>{var U=Iu(),$=o(U),I=o($),H=u(o(I),2);ta(H),Ht(2),i(I),i($);var fe=u($,2),ve=o(fe);{var Fe=Ue=>{var Pe=Pu();m(Ue,Pe)},Ce=Ue=>{var Pe=Mu();Ht(2),m(Ue,Pe)};E(ve,Ue=>{e(n)?Ue(Fe):Ue(Ce,!1)})}i(fe);var Be=u(fe,2);Be.__click=L,i(U),O(()=>fe.disabled=e(n)),Se("submit",U,ce),ia(H,()=>e(g),Ue=>v(g,Ue)),m(q,U)};E(te,q=>{e(h)===1&&q(ue)})}var G=u(te,2);{var z=q=>{var U=Gu(),$=o(U),I=o($);Dt(I,21,()=>e(k),Ua,(st,nt,vt)=>{var St=Ru();ta(St),Mt(St,"id",`code-digit-${vt}`),St.__input=At=>X(vt,At),St.__keydown=At=>ae(vt,At),O(()=>{Ri(St,e(nt)),St.disabled=e(n)}),Se("paste",St,function(...At){(vt===0?V:null)?.apply(this,At)}),m(st,St)}),i(I);var H=u(I,2);{var fe=st=>{var nt=Ou(),vt=o(nt);i(nt),O(()=>w(vt,`Attempts remaining: ${e(M)??""}`)),m(st,nt)};E(H,st=>{e(M)<5&&st(fe)})}var ve=u(H,2);{var Fe=st=>{var nt=ju();m(st,nt)};E(ve,st=>{e(n)&&st(Fe)})}i($);var Ce=u($,2);Ce.__click=[_u,y,k,M,ce];var Be=o(Ce);{var Ue=st=>{var nt=qu();m(st,nt)},Pe=st=>{var nt=zu();Ht(2),m(st,nt)};E(Be,st=>{e(n)?st(Ue):st(Pe,!1)})}i(Ce);var Ve=u(Ce,2);Ve.__click=L,i(U),O(()=>Ce.disabled=e(n)),Se("submit",U,st=>{st.preventDefault()}),m(q,U)};E(G,q=>{e(h)===2&&q(z)})}var le=u(G,2);{var Z=q=>{var U=Uu(),$=o(U),I=o($),H=u(o(I),2);ta(H);var fe=u(H,4);fe.__click=[Vu,T];var ve=o(fe),Fe=o(ve,!0);i(ve),i(fe),i(I),i($);var Ce=u($,2),Be=o(Ce),Ue=u(o(Be),2);ta(Ue);var Pe=u(Ue,4);Pe.__click=[Bu,C];var Ve=o(Pe),st=o(Ve,!0);i(Ve),i(Pe),i(Be),i(Ce);var nt=u(Ce,2),vt=o(nt);{var St=Nt=>{var It=Wu();m(Nt,It)},At=Nt=>{var It=Hu();m(Nt,It)};E(vt,Nt=>{e(n)?Nt(St):Nt(At,!1)})}i(nt);var Wt=u(nt,2);Wt.__click=L,i(U),O(()=>{Mt(H,"type",e(T)?"text":"password"),Mt(fe,"aria-label",e(T)?"Hide password":"Show password"),w(Fe,e(T)?"visibility":"visibility_off"),Mt(Ue,"type",e(C)?"text":"password"),Mt(Pe,"aria-label",e(C)?"Hide password":"Show password"),w(st,e(C)?"visibility":"visibility_off"),nt.disabled=e(n)}),Se("submit",U,Re),ia(H,()=>e(A),Nt=>v(A,Nt)),ia(Ue,()=>e(D),Nt=>v(D,Nt)),m(q,U)};E(le,q=>{e(h)===3&&q(Z)})}O(()=>{w(Ie,e(h)===1?"Forgot Password?":e(h)===2?"Verify Code":"Reset Password"),w(me,e(h)===1?"Enter your email to receive a verification code":e(h)===2?"Enter the 6-digit code sent to your email":"Create a new password for your account")}),m(Ee,pe)};E(lt,Ee=>{e(p)?Ee(et,!1):Ee(He)})}i(Ke);var Ne=u(Ke,2),ne=o(Ne),oe=o(ne),_e=o(oe,!0);i(oe);var Me=u(oe,2),ze=o(Me,!0);i(Me),i(ne),i(Ne),i(Je),O(()=>{w(ke,e(F)?"light_mode":"dark_mode"),w(_e,e(p)?"Password Reset":"Welcome"),w(ze,e(p)?"Recover your account securely":"Login to access your account")}),m(s,Je),za()}Ps(["click","input","keydown"]);const Ju=300*1e3,il="student_notifications_";function Xu(){const s={notifications:[],unreadCount:0,totalCount:0,currentFilter:"all",isLoading:!1,isRefreshing:!1,error:null,lastUpdated:null,currentStudentId:null},{subscribe:t,set:a,update:r}=Ws(s);function n(){const j=yo(gs);if(!j?.isAuthenticated||!j.userData)return{};const P={id:j.userData.id,name:j.userData.name,account_number:j.userData.accountNumber,account_type:j.userData.account_type||j.userData.accountType};return{"x-user-info":JSON.stringify(P)}}function l(j,P){return`${il}${j}_${P}`}function c(j){return!j||!j.timestamp?!1:Date.now()-j.timestamp<Ju}function d(j,P){try{const Y=l(j,P),W=localStorage.getItem(Y);if(W)return JSON.parse(W).data}catch(Y){console.warn("Failed to retrieve cached student notifications data:",Y)}return null}function f(j,P){try{const Y=l(j,P),W=localStorage.getItem(Y);if(W){const N=JSON.parse(W);if(c(N))return N.data}}catch(Y){console.warn("Failed to retrieve cached student notifications data:",Y)}return null}function p(j,P,Y){try{const W=l(j,P),N={data:Y,timestamp:Date.now()};localStorage.setItem(W,JSON.stringify(N))}catch(W){console.warn("Failed to cache student notifications data:",W)}}function h(j){return Array.isArray(j)?j.map(P=>({id:P.id,title:P.title,message:P.message,type:P.type,timestamp:P.created_at||P.timestamp,isRead:P.is_read||P.isRead||!1,adminNote:P.admin_note||P.adminNote||null,rejectionReason:P.rejection_reason||P.rejectionReason||null,metadata:P.metadata||{}})):[]}function g(j){const P=j.filter(W=>!W.isRead).length,Y=j.length;return{unreadCount:P,totalCount:Y}}async function b(j,P="all",Y=!1){try{r(ie=>({...ie,isLoading:!Y,isRefreshing:Y,error:null,currentStudentId:j,currentFilter:P}));const W=new URLSearchParams({studentId:j,filter:P}),L=await(await fetch(`/api/student-notifications?${W.toString()}`,{headers:n()})).json();if(!L.success)throw new Error(L.error||"Failed to fetch notifications");const X=h(L.data||[]),ae=g(X),V={notifications:X,unreadCount:ae.unreadCount,totalCount:ae.totalCount,currentFilter:P,isLoading:!1,isRefreshing:!1,error:null,lastUpdated:new Date().toISOString(),currentStudentId:j};r(ie=>({...ie,...V})),p(j,P,{notifications:X,unreadCount:ae.unreadCount,totalCount:ae.totalCount,lastUpdated:V.lastUpdated})}catch(W){console.error("Error loading student notifications:",W);const N=d(j,P);N?(r(L=>({...L,notifications:N.notifications||[],unreadCount:N.unreadCount||0,totalCount:N.totalCount||0,lastUpdated:N.lastUpdated,isLoading:!1,isRefreshing:!1,error:null})),Te.error("No internet connection. Showing offline data.")):r(L=>({...L,isLoading:!1,isRefreshing:!1,error:W.message,notifications:[],unreadCount:0,totalCount:0}))}}async function y(j,P,Y){try{const N=await(await fetch("/api/student-notifications",{method:"PATCH",headers:{"Content-Type":"application/json",...n()},body:JSON.stringify({studentId:j,notificationId:P,isRead:Y})})).json();if(!N.success)throw new Error(N.error||"Failed to update notification status");r(L=>{const X=L.notifications.map(V=>V.id===P?{...V,isRead:Y}:V),ae=g(X);return p(j,L.currentFilter,{notifications:X,unreadCount:ae.unreadCount,totalCount:ae.totalCount,lastUpdated:new Date().toISOString()}),{...L,notifications:X,unreadCount:ae.unreadCount}})}catch(W){console.error("Error updating notification status:",W),Te.error("Failed to update notification status")}}async function k(j,P){try{const W=await(await fetch("/api/student-notifications",{method:"DELETE",headers:{"Content-Type":"application/json",...n()},body:JSON.stringify({studentId:j,notificationId:P})})).json();if(!W.success)throw new Error(W.error||"Failed to delete notification");r(N=>{const L=N.notifications.filter(ae=>ae.id!==P),X=g(L);return p(j,N.currentFilter,{notifications:L,unreadCount:X.unreadCount,totalCount:X.totalCount,lastUpdated:new Date().toISOString()}),{...N,notifications:L,unreadCount:X.unreadCount,totalCount:X.totalCount}})}catch(Y){throw console.error("Error deleting notification:",Y),Te.error("Failed to delete notification"),Y}}async function A(j){try{const Y=await(await fetch("/api/student-notifications",{method:"PATCH",headers:{"Content-Type":"application/json",...n()},body:JSON.stringify({studentId:j,markAllAsRead:!0})})).json();if(!Y.success)throw new Error(Y.error||"Failed to mark all as read");r(W=>{const N=W.notifications.map(L=>({...L,isRead:!0}));return p(j,W.currentFilter,{notifications:N,unreadCount:0,totalCount:W.totalCount,lastUpdated:new Date().toISOString()}),{...W,notifications:N,unreadCount:0}}),Te.success("All notifications marked as read")}catch(P){console.error("Error marking all as read:",P),Te.error("Failed to mark all as read")}}async function D(j){try{const Y=await(await fetch("/api/student-notifications",{method:"DELETE",headers:{"Content-Type":"application/json",...n()},body:JSON.stringify({studentId:j,clearAllRead:!0})})).json();if(!Y.success)throw new Error(Y.error||"Failed to clear read notifications");r(W=>{const N=W.notifications.filter(X=>!X.isRead),L=g(N);return p(j,W.currentFilter,{notifications:N,unreadCount:L.unreadCount,totalCount:L.totalCount,lastUpdated:new Date().toISOString()}),{...W,notifications:N,totalCount:L.totalCount}})}catch(P){throw console.error("Error clearing read notifications:",P),Te.error("Failed to clear read notifications"),P}}function T(j){r(P=>({...P,currentFilter:j}))}function C(j,P="all"){const Y=f(j,P);return Y?(r(W=>({...W,...Y,currentStudentId:j,currentFilter:P,isLoading:!1,isRefreshing:!1,error:null})),!0):(r(W=>({...W,currentStudentId:j,currentFilter:P,isLoading:!0,isRefreshing:!1,error:null})),!1)}function S(j,P="all"){try{const Y=l(j,P);localStorage.removeItem(Y)}catch(Y){console.warn("Failed to clear student notifications cache:",Y)}return r(Y=>({...s,currentStudentId:j,currentFilter:P,isLoading:!0})),F.loadNotifications(j,P,!1)}function M(j){try{const P=Object.keys(localStorage),Y=`${il}${j}_`;P.forEach(W=>{W.startsWith(Y)&&localStorage.removeItem(W)})}catch(P){console.warn("Failed to clear all notification cache:",P)}}const F={subscribe:t,init:C,setFilter:T,loadNotifications:b,updateNotificationStatus:y,deleteNotification:k,markAllAsRead:A,clearAllRead:D,forceRefresh:S,clearAllCache:M,getCachedData:(j,P)=>d(j,P)};return F}const xr=Xu();function Zu(s,t){v(t,!e(t))}function ev(s,t,a){v(t,!e(t)),a()}var tv=(s,t)=>t.onnavigate("notifications"),av=_('<span class="navbar-notification-badge"> </span>'),sv=_('<img alt="Profile" class="avatar-image"/>'),rv=_('<div class="avatar-placeholder"> </div>'),iv=(s,t,a)=>{t(),a.onnavigate("profile")},nv=async(s,t,a)=>{t(),await a.onlogout(),qr("Logged out successfully. See you next time!")},ov=_('<div class="user-dropdown-menu"><button class="dropdown-item"><span class="material-symbols-outlined">person</span> Profile</button> <button class="dropdown-item"><span class="material-symbols-outlined">logout</span> Logout</button></div>'),lv=_('<nav class="student-navbar"><div class="navbar-container"><div class="navbar-left"><button class="icon-button hamburger-menu" aria-label="Toggle navigation menu"><span class="material-symbols-outlined">menu</span></button> <div class="logo-section"><span class="material-symbols-outlined logo-icon">school</span> <span class="app-title"> </span></div></div> <div class="navbar-right"><button class="icon-button dark-mode-toggle" aria-label="Toggle dark mode"><span class="material-symbols-outlined"> </span></button> <button class="icon-button notifications-button" aria-label="Notifications"><span class="material-symbols-outlined">notifications</span> <!></button> <div class="user-profile-container"><button class="user-profile"><div class="user-info"><span class="user-name"> </span> <span class="user-id"> </span></div> <div class="user-avatar"><!></div></button> <!></div></div></div></nav>');function cv(s,t){qa(t,!0);const[a,r]=xs(),n=()=>Ja(xr,"$studentNotificationStore",a),l=()=>Ja(gs,"$authStore",a);let c=Ma(t,"studentName",3,"John Does"),d=Ma(t,"firstName",3,"John"),f=Ma(t,"gender",3,"male"),p=Ma(t,"accountNumber",3,"STU-2025-0001"),h=Ma(t,"profileImage",3,null),g=aa(()=>n().unreadCount);function b(_e){return _e==="female"?"Ms.":"Mr."}let y=aa(()=>`${b(f())} ${d()}`),k=pt(!0),A=pt(!1);function D(){v(A,!1)}function T(_e){e(A)&&!_e.target.closest(".user-profile-container")&&D()}async function C(){const _e=l();if(!(!_e.isAuthenticated||!_e.userData?.id))try{await xr.loadNotifications(_e.userData.id,"all",!0)}catch(Me){console.error("Error fetching notification count:",Me)}}Ya(()=>{const _e=localStorage.getItem("theme");v(k,_e!=="light"),S(),document.addEventListener("click",T);let Me;Me=gs.subscribe(Ee=>{Ee.isAuthenticated&&(C(),Me&&Me())});const ze=setInterval(()=>{l().isAuthenticated&&C()},1e4);return()=>{document.removeEventListener("click",T),clearInterval(ze),Me&&Me()}});function S(){e(k)?(document.documentElement.setAttribute("data-theme","dark"),localStorage.setItem("theme","dark")):(document.documentElement.setAttribute("data-theme","light"),localStorage.setItem("theme","light"))}function M(_e){return _e.split(" ").map(Me=>Me.charAt(0)).join("").toUpperCase().slice(0,2)}var F=lv(),j=o(F),P=o(j),Y=o(P);Y.__click=function(..._e){t.onToggleNavRail?.apply(this,_e)};var W=u(Y,2),N=u(o(W),2),L=o(N);i(N),i(W),i(P);var X=u(P,2),ae=o(X);ae.__click=[ev,k,S];var V=o(ae),ie=o(V,!0);i(V),i(ae);var he=u(ae,2);he.__click=[tv,t];var Ge=u(o(he),2);{var ce=_e=>{var Me=av(),ze=o(Me,!0);i(Me),O(()=>w(ze,e(g)>99?"99+":e(g))),m(_e,Me)};E(Ge,_e=>{e(g)>0&&_e(ce)})}i(he);var se=u(he,2),Re=o(se);Re.__click=[Zu,A];var Je=o(Re),it=o(Je),Le=o(it,!0);i(it);var ke=u(it,2),Ke=o(ke);i(ke),i(Je);var lt=u(Je,2),He=o(lt);{var et=_e=>{var Me=sv();O(()=>Mt(Me,"src",h())),m(_e,Me)},Ne=_e=>{var Me=rv(),ze=o(Me,!0);i(Me),O(Ee=>w(ze,Ee),[()=>M(d())]),m(_e,Me)};E(He,_e=>{h()?_e(et):_e(Ne,!1)})}i(lt),i(Re);var ne=u(Re,2);{var oe=_e=>{var Me=ov(),ze=o(Me);ze.__click=[iv,D,t];var Ee=u(ze,2);Ee.__click=[nv,D,t],i(Me),m(_e,Me)};E(ne,_e=>{e(A)&&_e(oe)})}i(se),i(X),i(j),i(F),O(()=>{w(L,`Welcome, ${e(y)??""}`),w(ie,e(k)?"light_mode":"dark_mode"),w(Le,c()),w(Ke,`Account: ${p()??""}`)}),m(s,F),za(),r()}Ps(["click"]);var dv=(s,t,a)=>t(e(a).id),uv=_('<button><div class="rail-icon-container"><span class="material-symbols-outlined rail-icon"> </span></div> <span class="rail-label"> </span></button>'),vv=(s,t,a)=>t(e(a).id),fv=_('<button><div class="nav-icon-container"><span class="material-symbols-outlined nav-icon"> </span></div></button>'),pv=_('<nav aria-label="Student portal navigation"><div class="rail-container"></div></nav> <nav class="bottom-navigation" aria-label="Student portal navigation"><div class="nav-container"></div></nav>',1);function mv(s,t){qa(t,!0);let a=Ma(t,"activeSection",15,"grades"),r=Ma(t,"isNavRailVisible",3,!0);const n=[{id:"grades",label:"My Grades",icon:"grade"},{id:"ranking",label:"Class Ranking",icon:"leaderboard"},{id:"schedule",label:"Schedule",icon:"schedule"},{id:"documents",label:"Documents",icon:"description"},{id:"todo",label:"Todo List",icon:"checklist"}];function l(b){a(b),t.onnavigate&&t.onnavigate({detail:{section:b}})}var c=pv(),d=tt(c);let f;var p=o(d);Dt(p,21,()=>n,b=>b.id,(b,y)=>{var k=uv();let A;k.__click=[dv,l,y];var D=o(k),T=o(D),C=o(T,!0);i(T),i(D);var S=u(D,2),M=o(S,!0);i(S),i(k),O(F=>{A=we(k,1,"rail-item",null,A,F),Mt(k,"aria-label",e(y).label),Mt(k,"aria-current",e(y).id===a()?"page":void 0),w(C,e(y).icon),w(M,e(y).label)},[()=>({active:e(y).id===a()})]),m(b,k)}),i(p),i(d);var h=u(d,2),g=o(h);Dt(g,21,()=>n,b=>b.id,(b,y)=>{var k=fv();let A;k.__click=[vv,l,y];var D=o(k),T=o(D),C=o(T,!0);i(T),i(D),i(k),O(S=>{A=we(k,1,"nav-item",null,A,S),Mt(k,"aria-label",e(y).label),Mt(k,"aria-current",e(y).id===a()?"page":void 0),w(C,e(y).icon)},[()=>({active:e(y).id===a()})]),m(b,k)}),i(g),i(h),O(b=>f=we(d,1,"navigation-rail",null,f,b),[()=>({collapsed:!r()})]),m(s,c),za()}Ps(["click"]);const hv=300*1e3,gv="student_profile_";function _v(){const s={studentData:null,studentProfileData:null,studentSections:[],isLoading:!1,isRefreshing:!1,error:null,lastUpdated:null,currentStudentId:null},{subscribe:t,set:a,update:r}=Ws(s);function n(k){return`${gv}${k}`}function l(k){return!k||!k.timestamp?!1:Date.now()-k.timestamp<hv}function c(k){try{const A=n(k),D=localStorage.getItem(A);if(D)return JSON.parse(D).data}catch(A){console.warn("Failed to retrieve cached student profile data:",A)}return null}function d(k){try{const A=n(k),D=localStorage.getItem(A);if(D){const T=JSON.parse(D);if(l(T))return T.data}}catch(A){console.warn("Failed to retrieve cached student profile data:",A)}return null}function f(k,A){try{const D=n(k),T={data:A,timestamp:Date.now()};localStorage.setItem(D,JSON.stringify(T))}catch(D){console.warn("Failed to cache student profile data:",D)}}async function p(k,A=!1){try{r(j=>({...j,isLoading:!A,isRefreshing:A,error:null,currentStudentId:k}));const D=await ns(`/api/student-profile?studentId=${k}`);if(!D.ok)throw new Error("Failed to fetch student profile data");const T=await D.json();if(!T.success)throw new Error(T.error||"Failed to fetch student profile data");const C=T.data;let S=null;try{const j=await ns(`/api/users?id=${k}`);if(j.ok){const P=await j.json();P.success&&P.user&&(S={id:P.user.id||k,number:P.user.account_number,name:P.user.full_name,firstName:P.user.first_name,lastName:P.user.last_name,middleInitial:P.user.middle_initial||"",email:P.user.email,contactNumber:P.user.contact_number,address:P.user.address,birthdate:P.user.birth_date,age:P.user.age,guardian:P.user.guardian,gender:P.user.gender,gradeLevel:C?.section?.gradeLevel||P.user.grade_level})}}catch(j){console.warn("Failed to fetch basic student data:",j)}if(S||(S={id:k,number:k,name:"Student",gradeLevel:C?.section?.gradeLevel||"Not assigned"}),!C?.subjects||C.subjects.length===0)try{const P=await(await ns("/api/current-quarter")).json(),Y=P.data?.currentQuarter||2,W=P.data?.currentSchoolYear||"2025-2026",N=await ns(`/api/student-grades?student_id=${k}&quarter=${Y}&school_year=${W}`);if(N.ok){const L=await N.json();if(L.success&&L.data.grades){const X=L.data.grades.map(ae=>({id:ae.subject_id,name:ae.name,code:ae.code||"",teacher:ae.teacher,color:h(ae.name)}));C?C.subjects=X:C={section:{id:null,name:"No section assigned",gradeLevel:S.grade_level||"Not assigned",adviser:"No adviser"},subjects:X,academicSummary:{generalAverage:L.data.statistics.overallAverage||"Not available",classRank:"Not available",totalStudentsInSection:0,totalSubjectsEnrolled:X.length,totalSubjectsWithGrades:L.data.statistics.countedSubjects||0}}}}}catch(j){console.warn("Failed to fetch subjects from grades API:",j)}let M=[];try{const Y=(await(await ns("/api/current-quarter")).json()).data?.currentSchoolYear||"2025-2026",W=await ns(`/api/student-sections?studentId=${k}&schoolYear=${Y}`);if(W.ok){const N=await W.json();N.success&&(M=N.data.classData||[])}}catch(j){console.warn("Failed to fetch student sections:",j)}const F={studentData:S,studentProfileData:C,studentSections:M,lastUpdated:new Date().toISOString()};r(j=>({...j,...F,isLoading:!1,isRefreshing:!1,error:null})),f(k,F)}catch(D){console.error("Error loading student profile:",D);const T=c(k);T?(r(C=>({...C,studentData:T.studentData,studentProfileData:T.studentProfileData,studentSections:T.studentSections||[],lastUpdated:T.lastUpdated,isLoading:!1,isRefreshing:!1,error:null})),Te.error("No internet connection. Showing offline data.")):r(C=>({...C,isLoading:!1,isRefreshing:!1,error:D.message}))}}function h(k){const A={Mathematics:["#4F46E5","#6366F1","#8B5CF6","#3B82F6"],Math:["#4F46E5","#6366F1","#8B5CF6","#3B82F6"],Science:["#059669","#10B981","#34D399","#047857"],English:["#DC2626","#EF4444","#F87171","#B91C1C"],"Physical Education":["#EA580C","#F97316","#FB923C","#C2410C"],MAPEH:["#EA580C","#F97316","#FB923C","#C2410C"],PE:["#EA580C","#F97316","#FB923C","#C2410C"],Filipino:["#7C2D12","#A16207","#D97706","#92400E"],"Araling Panlipunan":["#B45309","#D97706","#F59E0B","#A16207"],History:["#B45309","#D97706","#F59E0B","#A16207"],Computer:["#6366F1","#8B5CF6","#A855F7","#7C3AED"],Technology:["#6366F1","#8B5CF6","#A855F7","#7C3AED"],Arts:["#C026D3","#D946EF","#E879F9","#A21CAF"],Music:["#EC4899","#F472B6","#F9A8D4","#DB2777"],Health:["#16A34A","#22C55E","#4ADE80","#15803D"],Values:["#0891B2","#06B6D4","#22D3EE","#0E7490"],Research:["#7C2D12","#A16207","#D97706","#92400E"],TLE:["#9333EA","#A855F7","#C084FC","#7E22CE"],ESP:["#0891B2","#06B6D4","#22D3EE","#0E7490"]},D=["#EF4444","#F97316","#F59E0B","#84CC16","#22C55E","#10B981","#14B8A6","#06B6D4","#0EA5E9","#3B82F6","#6366F1","#8B5CF6","#A855F7","#D946EF","#EC4899","#F43F5E","#E11D48","#BE123C","#9F1239","#881337"];function T(F){let j=0;for(let P=0;P<F.length;P++){const Y=F.charCodeAt(P);j=(j<<5)-j+Y,j=j&j}return Math.abs(j)}const C=k.toLowerCase().trim();for(const[F,j]of Object.entries(A))if(C.includes(F.toLowerCase())){const Y=T(k)%j.length;return j[Y]}const M=T(k)%D.length;return D[M]}function g(k){const A=d(k);return A?(r(D=>({...D,...A,currentStudentId:k,isLoading:!1,isRefreshing:!1,error:null})),!0):(r(D=>({...D,currentStudentId:k,isLoading:!0,isRefreshing:!1,error:null})),!1)}function b(k){try{const A=n(k);localStorage.removeItem(A)}catch(A){console.warn("Failed to clear student profile cache:",A)}return r(A=>({...s,currentStudentId:k,isLoading:!0})),y.loadProfile(k,!1)}const y={subscribe:t,init:g,loadProfile:p,forceRefresh:b,getCachedData:k=>c(k)};return y}const Ai=_v();function bv(s,t){v(t,!e(t))}function yv(s,t){v(t,!e(t))}function wv(s,t){v(t,!e(t))}function xv(s,t){cs.confirm("Change Password",`
			<div class="student-profile-password-form">
				<div class="student-profile-form-group">
					<label for="current-password">Current Password</label>
					<div class="student-profile-password-input-wrapper">
						<input 
							id="current-password"
							type="password" 
							placeholder="Enter current password"
							class="student-profile-form-input"
						/>
						<button type="button" class="student-profile-password-toggle" onclick="togglePasswordVisibility('current-password')">
							<svg class="password-eye-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
								<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
								<line x1="1" y1="1" x2="23" y2="23"/>
							</svg>
						</button>
					</div>
				</div>
				
				<div class="student-profile-form-group">
					<label for="new-password">New Password</label>
					<div class="student-profile-password-input-wrapper">
						<input 
							id="new-password"
							type="password" 
							placeholder="Enter new password"
							class="student-profile-form-input"
						/>
						<button type="button" class="student-profile-password-toggle" onclick="togglePasswordVisibility('new-password')">
							<svg class="password-eye-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
								<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
								<line x1="1" y1="1" x2="23" y2="23"/>
							</svg>
						</button>
					</div>
				</div>
				
				<div class="student-profile-form-group">
					<label for="confirm-password">Confirm New Password</label>
					<div class="student-profile-password-input-wrapper">
						<input 
							id="confirm-password"
							type="password" 
							placeholder="Confirm new password"
							class="student-profile-form-input"
						/>
						<button type="button" class="student-profile-password-toggle" onclick="togglePasswordVisibility('confirm-password')">
							<svg class="password-eye-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
								<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
								<line x1="1" y1="1" x2="23" y2="23"/>
							</svg>
						</button>
					</div>
				</div>
			</div>
		`,t,()=>{},{size:"medium"})}var Sv=_('<div class="error-container"><div class="error-icon"><span class="material-symbols-outlined">error</span></div> <p class="error-message"> </p> <button class="retry-btn"><span class="material-symbols-outlined">refresh</span> Retry</button></div>'),kv=_('<div class="silent-refresh-indicator"><span class="refresh-spinner"></span></div>'),Av=_('<div class="profile-loading-container"><span class="profile-loader"></span> <p class="profile-loading-text">Loading student information...</p></div>'),Dv=_('<div class="info-row row-five"><div class="info-card"><div class="info-icon"><span class="material-symbols-outlined">badge</span></div> <div class="info-content"><div class="info-label">Student ID</div> <div class="info-value"> </div></div></div> <div class="info-card"><div class="info-icon"><span class="material-symbols-outlined">person</span></div> <div class="info-content"><div class="info-label">Full Name</div> <div class="info-value"> </div></div></div> <div class="info-card"><div class="info-icon"><span class="material-symbols-outlined">school</span></div> <div class="info-content"><div class="info-label">Year Level</div> <div class="info-value"> </div></div></div> <div class="info-card"><div class="info-icon"><span class="material-symbols-outlined">group</span></div> <div class="info-content"><div class="info-label">Section</div> <div class="info-value"> </div></div></div> <div class="info-card"><div class="info-icon"><span class="material-symbols-outlined">menu_book</span></div> <div class="info-content"><div class="info-label">Total Subjects</div> <div class="info-value"> </div></div></div></div> <div class="info-row row-three"><div class="info-card"><div class="info-icon"><span class="material-symbols-outlined">email</span></div> <div class="info-content"><div class="info-label">Email</div> <div class="info-value"> </div></div></div> <div class="info-card"><div class="info-icon"><span class="material-symbols-outlined">phone</span></div> <div class="info-content"><div class="info-label">Contact Number</div> <div class="info-value"> </div></div></div> <div class="info-card"><div class="info-icon"><span class="material-symbols-outlined">family_restroom</span></div> <div class="info-content"><div class="info-label">Guardian</div> <div class="info-value"> </div></div></div></div> <div class="info-row row-one"><div class="info-card address-card"><div class="info-icon"><span class="material-symbols-outlined">home</span></div> <div class="info-content"><div class="info-label">Address</div> <div class="info-value"> </div></div></div></div> <div class="info-row row-two"><div class="info-card"><div class="info-icon"><span class="material-symbols-outlined">cake</span></div> <div class="info-content"><div class="info-label">Birth Date</div> <div class="info-value"> </div></div></div> <div class="info-card"><div class="info-icon"><span class="material-symbols-outlined">person_outline</span></div> <div class="info-content"><div class="info-label">Age</div> <div class="info-value"> </div></div></div></div>',1),Cv=_('<div class="profile-loading-container"><span class="profile-loader"></span> <p class="profile-loading-text">Loading academic performance...</p></div>'),Tv=_('<div class="info-row row-three"><div class="info-card"><div class="info-icon"><span class="material-symbols-outlined">person_outline</span></div> <div class="info-content"><div class="info-label">Adviser</div> <div class="info-value"> </div></div></div> <div class="info-card"><div class="info-icon"><span class="material-symbols-outlined">grade</span></div> <div class="info-content"><div class="info-label">General Average</div> <div class="info-value"> </div></div></div> <div class="info-card"><div class="info-icon"><span class="material-symbols-outlined">leaderboard</span></div> <div class="info-content"><div class="info-label">Class Rank</div> <div class="info-value"> </div></div></div></div>'),Ev=_('<div class="profile-loading-container"><span class="profile-loader"></span> <p class="profile-loading-text">Loading enrolled subjects...</p></div>'),Fv=_('<div class="subject-card"><div class="subject-icon-column"><div class="subject-icon"><span class="material-symbols-outlined">book</span></div></div> <div class="subject-details-column"><h3 class="subject-name"> </h3> <p class="teacher-name"> </p></div></div>'),Nv=_('<div class="subjects-grid"></div>'),$v=_('<div class="subjects-empty"><span class="material-symbols-outlined">menu_book</span> <p>No subjects enrolled yet</p></div>'),Lv=_('<div class="profile-header"><div class="header-content"><h1 class="page-title">Student Profile</h1> <p class="page-subtitle">Personal Information & Academic Details</p></div> <div class="header-actions"><!> <button class="student-refresh-btn" aria-label="Refresh profile data"><span class="material-symbols-outlined">refresh</span></button></div></div> <div class="profile-info-section"><h2 class="section-title section-title-desktop">Student Information</h2> <button class="section-header-mobile" aria-label="Toggle student information"><h2 class="section-title">Student Information</h2> <span>expand_more</span></button> <div><!></div></div> <div class="profile-academic-section"><h2 class="section-title section-title-desktop">Academic Performance</h2> <button class="section-header-mobile" aria-label="Toggle academic performance"><h2 class="section-title">Academic Performance</h2> <span>expand_more</span></button> <div><!></div></div> <div class="profile-subjects-section"><h2 class="section-title section-title-desktop">Enrolled Subjects</h2> <button class="section-header-mobile" aria-label="Toggle enrolled subjects"><h2 class="section-title">Enrolled Subjects</h2> <span>expand_more</span></button> <div><!></div></div> <div class="profile-security-section"><h2 class="section-title section-title-desktop">Account Security</h2> <div class="section-content"><div class="info-row row-one"><div class="info-card security-card"><div class="info-content-container"><div class="info-icon"><span class="material-symbols-outlined">lock</span></div> <div class="info-content"><div class="info-label">Password</div> <div class="info-value">Change your account password for security</div></div></div> <div class="security-actions"><button class="security-action-button"><span class="material-symbols-outlined">lock</span> Change Password</button></div></div></div></div></div>',1),Pv=_('<div class="profile-container"><!></div>');function Mv(s,t){qa(t,!0);const[a,r]=xs(),n=()=>Ja(Ai,"$studentProfileStore",a);let l=pt(void 0);Es(()=>gs.subscribe(N=>{v(l,N,!0)}));let c=aa(n),d=aa(()=>e(c).studentData),f=aa(()=>e(c).studentProfileData),p=aa(()=>e(c).isLoading),h=aa(()=>e(c).isRefreshing),g=aa(()=>e(c).error);function b(){e(l)?.userData?.id&&Ai.forceRefresh(e(l).userData.id)}Es(()=>{e(l)?.userData?.id&&(Ai.init(e(l).userData.id)||Ai.loadProfile(e(l).userData.id,!1))}),Ya(()=>{const W=setInterval(()=>{e(l)?.userData?.id&&Ai.loadProfile(e(l).userData.id,!0)},3e5);return()=>clearInterval(W)});let y=aa(()=>({id:e(d)?.number||e(l)?.userData?.accountNumber||"N/A",name:e(d)?.name||e(l)?.userData?.name||"Student Name",firstName:e(d)?.firstName||e(l)?.userData?.firstName||"",lastName:e(d)?.lastName||"",middleInitial:e(d)?.middleInitial||"",yearLevel:e(d)?.gradeLevel?`Grade ${e(d).gradeLevel}`:"Not assigned",section:e(f)?.section?.name||"Not assigned",email:e(d)?.email||"Not available",phone:e(d)?.contactNumber||"Not available",address:e(d)?.address||"Not available",birthDate:e(d)?.birthdate?new Date(e(d).birthdate).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"Not available",age:e(d)?.age||"Not available",guardian:e(d)?.guardian||"Not available",gender:e(d)?.gender||e(l)?.userData?.gender||"male",academicSummary:{adviser:e(f)?.section?.adviser||"Not available",gpa:e(f)?.academicSummary?.generalAverage||"Not available",rank:e(f)?.academicSummary?.classRank||"Not available",totalStudents:e(f)?.academicSummary?.totalStudentsInSection||"Not available"},subjects:e(f)?.subjects||[]})),k=aa(()=>e(y).subjects.length||"Not available"),A=pt(!0),D=pt(!1),T=pt(!0),C=pt(!1);function S(W){const N=document.getElementById(W),X=N.nextElementSibling.querySelector(".password-eye-icon");N.type==="password"?(N.type="text",X.innerHTML='<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/>'):(N.type="password",X.innerHTML='<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/>')}typeof window<"u"&&(window.togglePasswordVisibility=S);async function M(){const W=document.getElementById("current-password"),N=document.getElementById("new-password"),L=document.getElementById("confirm-password");if(!W||!N||!L){us("Password form inputs not found");return}const X=W.value,ae=N.value,V=L.value;if(!X){us("Current password is required");return}if(!ae){us("New password is required");return}if(ae!==V){us("New passwords do not match");return}if(ae.length<8){us("Password must be at least 8 characters long");return}if(X===ae){us("New password must be different from current password");return}try{v(C,!0);const ie=await api.post("/api/change-password",{currentPassword:X,newPassword:ae});ie.success?(W.value="",N.value="",L.value="",qr("Password changed successfully!"),cs.close()):us(ie.error||"Failed to change password")}catch(ie){console.error("Password change error:",ie),us(ie.message||"Failed to change password")}finally{v(C,!1)}}var F=Pv(),j=o(F);{var P=W=>{var N=Sv(),L=u(o(N),2),X=o(L);i(L);var ae=u(L,2);ae.__click=b,i(N),O(()=>w(X,`Failed to load profile data: ${e(g)??""}`)),m(W,N)},Y=W=>{var N=Lv(),L=tt(N),X=u(o(L),2),ae=o(X);{var V=z=>{var le=kv();m(z,le)};E(ae,z=>{e(h)&&z(V)})}var ie=u(ae,2);ie.__click=b,i(X),i(L);var he=u(L,2),Ge=u(o(he),2);Ge.__click=[bv,A];var ce=u(o(Ge),2);let se;i(Ge);var Re=u(Ge,2);let Je;var it=o(Re);{var Le=z=>{var le=Av();m(z,le)},ke=z=>{var le=Dv(),Z=tt(le),q=o(Z),U=u(o(q),2),$=u(o(U),2),I=o($,!0);i($),i(U),i(q);var H=u(q,2),fe=u(o(H),2),ve=u(o(fe),2),Fe=o(ve,!0);i(ve),i(fe),i(H);var Ce=u(H,2),Be=u(o(Ce),2),Ue=u(o(Be),2),Pe=o(Ue,!0);i(Ue),i(Be),i(Ce);var Ve=u(Ce,2),st=u(o(Ve),2),nt=u(o(st),2),vt=o(nt,!0);i(nt),i(st),i(Ve);var St=u(Ve,2),At=u(o(St),2),Wt=u(o(At),2),Nt=o(Wt,!0);i(Wt),i(At),i(St),i(Z);var It=u(Z,2),Gt=o(It),Ot=u(o(Gt),2),sa=u(o(Ot),2),Qt=o(sa,!0);i(sa),i(Ot),i(Gt);var Pt=u(Gt,2),Yt=u(o(Pt),2),ca=u(o(Yt),2),ye=o(ca,!0);i(ca),i(Yt),i(Pt);var Xe=u(Pt,2),ot=u(o(Xe),2),be=u(o(ot),2),je=o(be,!0);i(be),i(ot),i(Xe),i(It);var rt=u(It,2),Ft=o(rt),Vt=u(o(Ft),2),at=u(o(Vt),2),va=o(at,!0);i(at),i(Vt),i(Ft),i(rt);var Ca=u(rt,2),gt=o(Ca),_t=u(o(gt),2),de=u(o(_t),2),ee=o(de,!0);i(de),i(_t),i(gt);var Q=u(gt,2),Ye=u(o(Q),2),Qe=u(o(Ye),2),dt=o(Qe,!0);i(Qe),i(Ye),i(Q),i(Ca),O(()=>{w(I,e(y).id),w(Fe,e(y).name),w(Pe,e(y).yearLevel),w(vt,e(y).section),w(Nt,e(k)),w(Qt,e(y).email||"Not provided"),w(ye,e(y).phone||"Not provided"),w(je,e(y).guardian||"Not provided"),w(va,e(y).address||"Not provided"),w(ee,e(y).birthDate||"Not provided"),w(dt,e(y).age?`${e(y).age} years old`:"Not available")}),m(z,le)};E(it,z=>{e(p)?z(Le):z(ke,!1)})}i(Re),i(he);var Ke=u(he,2),lt=u(o(Ke),2);lt.__click=[yv,D];var He=u(o(lt),2);let et;i(lt);var Ne=u(lt,2);let ne;var oe=o(Ne);{var _e=z=>{var le=Cv();m(z,le)},Me=z=>{var le=Tv(),Z=o(le),q=u(o(Z),2),U=u(o(q),2),$=o(U,!0);i(U),i(q),i(Z);var I=u(Z,2),H=u(o(I),2),fe=u(o(H),2),ve=o(fe,!0);i(fe),i(H),i(I);var Fe=u(I,2),Ce=u(o(Fe),2),Be=u(o(Ce),2),Ue=o(Be,!0);i(Be),i(Ce),i(Fe),i(le),O(()=>{w($,e(y).academicSummary.adviser),w(ve,e(y).academicSummary.gpa!=="Not available"?`${e(y).academicSummary.gpa}`:"Not available"),w(Ue,e(y).academicSummary.rank!=="Not available"&&e(y).academicSummary.totalStudents!=="Not available"?`${e(y).academicSummary.rank} of ${e(y).academicSummary.totalStudents}`:"Not available")}),m(z,le)};E(oe,z=>{e(p)?z(_e):z(Me,!1)})}i(Ne),i(Ke);var ze=u(Ke,2),Ee=u(o(ze),2);Ee.__click=[wv,T];var pe=u(o(Ee),2);let qe;i(Ee);var Ae=u(Ee,2);let Ie;var ut=o(Ae);{var me=z=>{var le=Ev();m(z,le)},J=z=>{var le=mt(),Z=tt(le);{var q=$=>{var I=Nv();Dt(I,21,()=>e(y).subjects,H=>H.id,(H,fe)=>{var ve=Fv(),Fe=o(ve),Ce=o(Fe);i(Fe);var Be=u(Fe,2),Ue=o(Be),Pe=o(Ue,!0);i(Ue);var Ve=u(Ue,2),st=o(Ve,!0);i(Ve),i(Be),i(ve),O(()=>{Wa(ve,`border-color: ${e(fe).color??""};`),Wa(Ce,`background-color: ${e(fe).color??""}20; color: ${e(fe).color??""}`),w(Pe,e(fe).name),w(st,e(fe).teacher)}),m(H,ve)}),i(I),m($,I)},U=$=>{var I=$v();m($,I)};E(Z,$=>{e(y).subjects.length>0?$(q):$(U,!1)},!0)}m(z,le)};E(ut,z=>{e(p)?z(me):z(J,!1)})}i(Ae),i(ze);var xe=u(ze,2),$e=u(o(xe),2),B=o($e),te=o(B),ue=u(o(te),2),G=o(ue);G.__click=[xv,M],i(ue),i(te),i(B),i($e),i(xe),O((z,le,Z,q,U,$)=>{ie.disabled=e(p),se=we(ce,1,"material-symbols-outlined collapse-icon",null,se,z),Je=we(Re,1,"section-content",null,Je,le),et=we(He,1,"material-symbols-outlined collapse-icon",null,et,Z),ne=we(Ne,1,"section-content",null,ne,q),qe=we(pe,1,"material-symbols-outlined collapse-icon",null,qe,U),Ie=we(Ae,1,"section-content",null,Ie,$)},[()=>({rotated:e(A)}),()=>({collapsed:e(A)}),()=>({rotated:e(D)}),()=>({collapsed:e(D)}),()=>({rotated:e(T)}),()=>({collapsed:e(T)})]),m(W,N)};E(j,W=>{e(g)?W(P):W(Y,!1)})}i(F),m(s,F),za(),r()}Ps(["click"]);var An=function(){return An=Object.assign||function(s){for(var t,a=1,r=arguments.length;a<r;a++)for(var n in t=arguments[a])Object.prototype.hasOwnProperty.call(t,n)&&(s[n]=t[n]);return s},An.apply(this,arguments)},Iv=(function(){function s(t,a,r){var n=this;this.endVal=a,this.options=r,this.version="2.9.0",this.defaults={startVal:0,decimalPlaces:0,duration:2,useEasing:!0,useGrouping:!0,useIndianSeparators:!1,smartEasingThreshold:999,smartEasingAmount:333,separator:",",decimal:".",prefix:"",suffix:"",enableScrollSpy:!1,scrollSpyDelay:200,scrollSpyOnce:!1},this.finalEndVal=null,this.useEasing=!0,this.countDown=!1,this.error="",this.startVal=0,this.paused=!0,this.once=!1,this.count=function(l){n.startTime||(n.startTime=l);var c=l-n.startTime;n.remaining=n.duration-c,n.useEasing?n.countDown?n.frameVal=n.startVal-n.easingFn(c,0,n.startVal-n.endVal,n.duration):n.frameVal=n.easingFn(c,n.startVal,n.endVal-n.startVal,n.duration):n.frameVal=n.startVal+(n.endVal-n.startVal)*(c/n.duration);var d=n.countDown?n.frameVal<n.endVal:n.frameVal>n.endVal;n.frameVal=d?n.endVal:n.frameVal,n.frameVal=Number(n.frameVal.toFixed(n.options.decimalPlaces)),n.printValue(n.frameVal),c<n.duration?n.rAF=requestAnimationFrame(n.count):n.finalEndVal!==null?n.update(n.finalEndVal):n.options.onCompleteCallback&&n.options.onCompleteCallback()},this.formatNumber=function(l){var c,d,f,p,h=l<0?"-":"";c=Math.abs(l).toFixed(n.options.decimalPlaces);var g=(c+="").split(".");if(d=g[0],f=g.length>1?n.options.decimal+g[1]:"",n.options.useGrouping){p="";for(var b=3,y=0,k=0,A=d.length;k<A;++k)n.options.useIndianSeparators&&k===4&&(b=2,y=1),k!==0&&y%b==0&&(p=n.options.separator+p),y++,p=d[A-k-1]+p;d=p}return n.options.numerals&&n.options.numerals.length&&(d=d.replace(/[0-9]/g,(function(D){return n.options.numerals[+D]})),f=f.replace(/[0-9]/g,(function(D){return n.options.numerals[+D]}))),h+n.options.prefix+d+f+n.options.suffix},this.easeOutExpo=function(l,c,d,f){return d*(1-Math.pow(2,-10*l/f))*1024/1023+c},this.options=An(An({},this.defaults),r),this.formattingFn=this.options.formattingFn?this.options.formattingFn:this.formatNumber,this.easingFn=this.options.easingFn?this.options.easingFn:this.easeOutExpo,this.el=typeof t=="string"?document.getElementById(t):t,a=a??this.parse(this.el.innerHTML),this.startVal=this.validateValue(this.options.startVal),this.frameVal=this.startVal,this.endVal=this.validateValue(a),this.options.decimalPlaces=Math.max(this.options.decimalPlaces),this.resetDuration(),this.options.separator=String(this.options.separator),this.useEasing=this.options.useEasing,this.options.separator===""&&(this.options.useGrouping=!1),this.el?this.printValue(this.startVal):this.error="[CountUp] target is null or undefined",typeof window<"u"&&this.options.enableScrollSpy&&(this.error?console.error(this.error,t):(window.onScrollFns=window.onScrollFns||[],window.onScrollFns.push((function(){return n.handleScroll(n)})),window.onscroll=function(){window.onScrollFns.forEach((function(l){return l()}))},this.handleScroll(this)))}return s.prototype.handleScroll=function(t){if(t&&window&&!t.once){var a=window.innerHeight+window.scrollY,r=t.el.getBoundingClientRect(),n=r.top+window.pageYOffset,l=r.top+r.height+window.pageYOffset;l<a&&l>window.scrollY&&t.paused?(t.paused=!1,setTimeout((function(){return t.start()}),t.options.scrollSpyDelay),t.options.scrollSpyOnce&&(t.once=!0)):(window.scrollY>l||n>a)&&!t.paused&&t.reset()}},s.prototype.determineDirectionAndSmartEasing=function(){var t=this.finalEndVal?this.finalEndVal:this.endVal;this.countDown=this.startVal>t;var a=t-this.startVal;if(Math.abs(a)>this.options.smartEasingThreshold&&this.options.useEasing){this.finalEndVal=t;var r=this.countDown?1:-1;this.endVal=t+r*this.options.smartEasingAmount,this.duration=this.duration/2}else this.endVal=t,this.finalEndVal=null;this.finalEndVal!==null?this.useEasing=!1:this.useEasing=this.options.useEasing},s.prototype.start=function(t){this.error||(this.options.onStartCallback&&this.options.onStartCallback(),t&&(this.options.onCompleteCallback=t),this.duration>0?(this.determineDirectionAndSmartEasing(),this.paused=!1,this.rAF=requestAnimationFrame(this.count)):this.printValue(this.endVal))},s.prototype.pauseResume=function(){this.paused?(this.startTime=null,this.duration=this.remaining,this.startVal=this.frameVal,this.determineDirectionAndSmartEasing(),this.rAF=requestAnimationFrame(this.count)):cancelAnimationFrame(this.rAF),this.paused=!this.paused},s.prototype.reset=function(){cancelAnimationFrame(this.rAF),this.paused=!0,this.resetDuration(),this.startVal=this.validateValue(this.options.startVal),this.frameVal=this.startVal,this.printValue(this.startVal)},s.prototype.update=function(t){cancelAnimationFrame(this.rAF),this.startTime=null,this.endVal=this.validateValue(t),this.endVal!==this.frameVal&&(this.startVal=this.frameVal,this.finalEndVal==null&&this.resetDuration(),this.finalEndVal=null,this.determineDirectionAndSmartEasing(),this.rAF=requestAnimationFrame(this.count))},s.prototype.printValue=function(t){var a;if(this.el){var r=this.formattingFn(t);!((a=this.options.plugin)===null||a===void 0)&&a.render?this.options.plugin.render(this.el,r):this.el.tagName==="INPUT"?this.el.value=r:this.el.tagName==="text"||this.el.tagName==="tspan"?this.el.textContent=r:this.el.innerHTML=r}},s.prototype.ensureNumber=function(t){return typeof t=="number"&&!isNaN(t)},s.prototype.validateValue=function(t){var a=Number(t);return this.ensureNumber(a)?a:(this.error="[CountUp] invalid start or end value: ".concat(t),null)},s.prototype.resetDuration=function(){this.startTime=null,this.duration=1e3*Number(this.options.duration),this.remaining=this.duration},s.prototype.parse=function(t){var a=function(c){return c.replace(/([.,' ])/g,"\\$1")},r=a(this.options.separator),n=a(this.options.decimal),l=t.replace(new RegExp(r,"g"),"").replace(new RegExp(n,"g"),".");return parseFloat(l)},s})(),Rv=_('<span class="countup-container svelte-185m73z"><!></span>');function Kr(s,t){qa(t,!1);let a=Ma(t,"value",8,0),r=Ma(t,"decimals",8,1),n=Ma(t,"duration",8,2),l=Ma(t,"useEasing",8,!0),c=Ma(t,"useGrouping",8,!0),d=Ma(t,"separator",8,","),f=Ma(t,"decimal",8,"."),p=Ma(t,"prefix",8,""),h=Ma(t,"suffix",8,""),g=Ma(t,"startVal",8,0),b=Ma(t,"colorTransition",8,!1),y=Ma(t,"getGradeColor",8,null),k=R(),A=R(),D=R(!1),T=R(!1),C=R(""),S=null;function M(W,N){return W.toFixed(N).replace(/\.0+$/,"")}Ya(()=>(e(k)&&(Ns(k,e(k).textContent=`${p()}${M(g(),r())}${h()}`),b()&&y()&&v(C,y()(65)),v(D,!0),a()!==g()&&a()>0&&j()),()=>{S&&cancelAnimationFrame(S)}));function F(W){if(!b()||!y()||!sl)return;const L=Date.now()-W,X=Math.min(L/(n()*1e3),1);let ae=0;a()>=85?ae=3:a()>=80?ae=2:a()>=75?ae=1:ae=0;const V=Math.min(X*1.6,1),ie=Math.min(Math.floor(V*(ae+1)),ae),Ge=[65,75,80,85][ie];v(C,y()(Ge)),X<1?S=requestAnimationFrame(()=>F(W)):v(C,y()(a()))}function j(){if(!(!e(k)||!e(D)||e(T)))try{v(A,new Iv(e(k),a(),{startVal:g(),decimalPlaces:r(),duration:n(),useEasing:l(),useGrouping:c(),separator:d(),decimal:f(),prefix:p(),suffix:h(),formattingFn:W=>W.toFixed(r()).replace(/\.0+$/,"")})),e(A).error?(console.error("CountUp error:",e(A).error),Ns(k,e(k).textContent=`${p()}${M(a(),r())}${h()}`),b()&&y()&&v(C,y()(a()))):(e(A).start(),v(T,!0),b()&&y()&&F(Date.now()))}catch(W){console.error("Failed to initialize CountUp:",W),Ns(k,e(k).textContent=`${p()}${M(a(),r())}${h()}`),b()&&y()&&v(C,y()(a()))}}ht(()=>(e(D),Ss(a()),Ss(g()),e(T)),()=>{e(D)&&a()!==g()&&a()>0&&!e(T)&&j()}),ht(()=>(e(A),e(T),Ss(a()),Ss(g()),Ss(p()),Ss(r()),Ss(h())),()=>{if(e(A)&&sl&&e(T)&&a()!==g())try{e(A).update(a())}catch(W){console.error("CountUp update error:",W),Ns(k,e(k).textContent=`${p()}${M(a(),r())}${h()}`)}}),Ms(),Fs();var P=Rv(),Y=o(P);E(Y,W=>{}),i(P),Hs(P,W=>v(k,W),()=>e(k)),O(()=>Wa(P,b()&&e(C)?`color: ${e(C)}`:"")),m(s,P),za()}const Ov=s=>s;function jv(s){const t=s-1;return t*t*t+1}function nl(s){const t=typeof s=="string"&&s.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return t?[parseFloat(t[1]),t[2]||"px"]:[s,"px"]}function qs(s,{delay:t=0,duration:a=400,easing:r=Ov}={}){const n=+getComputedStyle(s).opacity;return{delay:t,duration:a,easing:r,css:l=>`opacity: ${l*n}`}}function zs(s,{delay:t=0,duration:a=400,easing:r=jv,x:n=0,y:l=0,opacity:c=0}={}){const d=getComputedStyle(s),f=+d.opacity,p=d.transform==="none"?"":d.transform,h=f*(1-c),[g,b]=nl(n),[y,k]=nl(l);return{delay:t,duration:a,easing:r,css:(A,D)=>`
			transform: ${p} translate(${(1-A)*g}${b}, ${(1-A)*y}${k});
			opacity: ${f-h*D}`}}function Gs(s){return--s*s*s*s*s+1}/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function Hi(s){return s+.5|0}const Mr=(s,t,a)=>Math.max(Math.min(s,a),t);function Pi(s){return Mr(Hi(s*2.55),0,255)}function Or(s){return Mr(Hi(s*255),0,255)}function Tr(s){return Mr(Hi(s/2.55)/100,0,1)}function ol(s){return Mr(Hi(s*100),0,100)}const ir={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},mo=[..."0123456789ABCDEF"],qv=s=>mo[s&15],zv=s=>mo[(s&240)>>4]+mo[s&15],on=s=>(s&240)>>4===(s&15),Gv=s=>on(s.r)&&on(s.g)&&on(s.b)&&on(s.a);function Vv(s){var t=s.length,a;return s[0]==="#"&&(t===4||t===5?a={r:255&ir[s[1]]*17,g:255&ir[s[2]]*17,b:255&ir[s[3]]*17,a:t===5?ir[s[4]]*17:255}:(t===7||t===9)&&(a={r:ir[s[1]]<<4|ir[s[2]],g:ir[s[3]]<<4|ir[s[4]],b:ir[s[5]]<<4|ir[s[6]],a:t===9?ir[s[7]]<<4|ir[s[8]]:255})),a}const Bv=(s,t)=>s<255?t(s):"";function Wv(s){var t=Gv(s)?qv:zv;return s?"#"+t(s.r)+t(s.g)+t(s.b)+Bv(s.a,t):void 0}const Hv=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function Mc(s,t,a){const r=t*Math.min(a,1-a),n=(l,c=(l+s/30)%12)=>a-r*Math.max(Math.min(c-3,9-c,1),-1);return[n(0),n(8),n(4)]}function Uv(s,t,a){const r=(n,l=(n+s/60)%6)=>a-a*t*Math.max(Math.min(l,4-l,1),0);return[r(5),r(3),r(1)]}function Yv(s,t,a){const r=Mc(s,1,.5);let n;for(t+a>1&&(n=1/(t+a),t*=n,a*=n),n=0;n<3;n++)r[n]*=1-t-a,r[n]+=t;return r}function Qv(s,t,a,r,n){return s===n?(t-a)/r+(t<a?6:0):t===n?(a-s)/r+2:(s-t)/r+4}function wo(s){const a=s.r/255,r=s.g/255,n=s.b/255,l=Math.max(a,r,n),c=Math.min(a,r,n),d=(l+c)/2;let f,p,h;return l!==c&&(h=l-c,p=d>.5?h/(2-l-c):h/(l+c),f=Qv(a,r,n,h,l),f=f*60+.5),[f|0,p||0,d]}function xo(s,t,a,r){return(Array.isArray(t)?s(t[0],t[1],t[2]):s(t,a,r)).map(Or)}function So(s,t,a){return xo(Mc,s,t,a)}function Kv(s,t,a){return xo(Yv,s,t,a)}function Jv(s,t,a){return xo(Uv,s,t,a)}function Ic(s){return(s%360+360)%360}function Xv(s){const t=Hv.exec(s);let a=255,r;if(!t)return;t[5]!==r&&(a=t[6]?Pi(+t[5]):Or(+t[5]));const n=Ic(+t[2]),l=+t[3]/100,c=+t[4]/100;return t[1]==="hwb"?r=Kv(n,l,c):t[1]==="hsv"?r=Jv(n,l,c):r=So(n,l,c),{r:r[0],g:r[1],b:r[2],a}}function Zv(s,t){var a=wo(s);a[0]=Ic(a[0]+t),a=So(a),s.r=a[0],s.g=a[1],s.b=a[2]}function ef(s){if(!s)return;const t=wo(s),a=t[0],r=ol(t[1]),n=ol(t[2]);return s.a<255?`hsla(${a}, ${r}%, ${n}%, ${Tr(s.a)})`:`hsl(${a}, ${r}%, ${n}%)`}const ll={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},cl={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function tf(){const s={},t=Object.keys(cl),a=Object.keys(ll);let r,n,l,c,d;for(r=0;r<t.length;r++){for(c=d=t[r],n=0;n<a.length;n++)l=a[n],d=d.replace(l,ll[l]);l=parseInt(cl[c],16),s[d]=[l>>16&255,l>>8&255,l&255]}return s}let ln;function af(s){ln||(ln=tf(),ln.transparent=[0,0,0,0]);const t=ln[s.toLowerCase()];return t&&{r:t[0],g:t[1],b:t[2],a:t.length===4?t[3]:255}}const sf=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function rf(s){const t=sf.exec(s);let a=255,r,n,l;if(t){if(t[7]!==r){const c=+t[7];a=t[8]?Pi(c):Mr(c*255,0,255)}return r=+t[1],n=+t[3],l=+t[5],r=255&(t[2]?Pi(r):Mr(r,0,255)),n=255&(t[4]?Pi(n):Mr(n,0,255)),l=255&(t[6]?Pi(l):Mr(l,0,255)),{r,g:n,b:l,a}}}function nf(s){return s&&(s.a<255?`rgba(${s.r}, ${s.g}, ${s.b}, ${Tr(s.a)})`:`rgb(${s.r}, ${s.g}, ${s.b})`)}const Zn=s=>s<=.0031308?s*12.92:Math.pow(s,1/2.4)*1.055-.055,li=s=>s<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4);function of(s,t,a){const r=li(Tr(s.r)),n=li(Tr(s.g)),l=li(Tr(s.b));return{r:Or(Zn(r+a*(li(Tr(t.r))-r))),g:Or(Zn(n+a*(li(Tr(t.g))-n))),b:Or(Zn(l+a*(li(Tr(t.b))-l))),a:s.a+a*(t.a-s.a)}}function cn(s,t,a){if(s){let r=wo(s);r[t]=Math.max(0,Math.min(r[t]+r[t]*a,t===0?360:1)),r=So(r),s.r=r[0],s.g=r[1],s.b=r[2]}}function Rc(s,t){return s&&Object.assign(t||{},s)}function dl(s){var t={r:0,g:0,b:0,a:255};return Array.isArray(s)?s.length>=3&&(t={r:s[0],g:s[1],b:s[2],a:255},s.length>3&&(t.a=Or(s[3]))):(t=Rc(s,{r:0,g:0,b:0,a:1}),t.a=Or(t.a)),t}function lf(s){return s.charAt(0)==="r"?rf(s):Xv(s)}class zi{constructor(t){if(t instanceof zi)return t;const a=typeof t;let r;a==="object"?r=dl(t):a==="string"&&(r=Vv(t)||af(t)||lf(t)),this._rgb=r,this._valid=!!r}get valid(){return this._valid}get rgb(){var t=Rc(this._rgb);return t&&(t.a=Tr(t.a)),t}set rgb(t){this._rgb=dl(t)}rgbString(){return this._valid?nf(this._rgb):void 0}hexString(){return this._valid?Wv(this._rgb):void 0}hslString(){return this._valid?ef(this._rgb):void 0}mix(t,a){if(t){const r=this.rgb,n=t.rgb;let l;const c=a===l?.5:a,d=2*c-1,f=r.a-n.a,p=((d*f===-1?d:(d+f)/(1+d*f))+1)/2;l=1-p,r.r=255&p*r.r+l*n.r+.5,r.g=255&p*r.g+l*n.g+.5,r.b=255&p*r.b+l*n.b+.5,r.a=c*r.a+(1-c)*n.a,this.rgb=r}return this}interpolate(t,a){return t&&(this._rgb=of(this._rgb,t._rgb,a)),this}clone(){return new zi(this.rgb)}alpha(t){return this._rgb.a=Or(t),this}clearer(t){const a=this._rgb;return a.a*=1-t,this}greyscale(){const t=this._rgb,a=Hi(t.r*.3+t.g*.59+t.b*.11);return t.r=t.g=t.b=a,this}opaquer(t){const a=this._rgb;return a.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return cn(this._rgb,2,t),this}darken(t){return cn(this._rgb,2,-t),this}saturate(t){return cn(this._rgb,1,t),this}desaturate(t){return cn(this._rgb,1,-t),this}rotate(t){return Zv(this._rgb,t),this}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */function Ar(){}const cf=(()=>{let s=0;return()=>s++})();function ls(s){return s==null}function $s(s){if(Array.isArray&&Array.isArray(s))return!0;const t=Object.prototype.toString.call(s);return t.slice(0,7)==="[object"&&t.slice(-6)==="Array]"}function Ka(s){return s!==null&&Object.prototype.toString.call(s)==="[object Object]"}function dr(s){return(typeof s=="number"||s instanceof Number)&&isFinite(+s)}function hr(s,t){return dr(s)?s:t}function Qa(s,t){return typeof s>"u"?t:s}const df=(s,t)=>typeof s=="string"&&s.endsWith("%")?parseFloat(s)/100:+s/t,Oc=(s,t)=>typeof s=="string"&&s.endsWith("%")?parseFloat(s)/100*t:+s;function ps(s,t,a){if(s&&typeof s.call=="function")return s.apply(a,t)}function as(s,t,a,r){let n,l,c;if($s(s))for(l=s.length,n=0;n<l;n++)t.call(a,s[n],n);else if(Ka(s))for(c=Object.keys(s),l=c.length,n=0;n<l;n++)t.call(a,s[c[n]],c[n])}function Dn(s,t){let a,r,n,l;if(!s||!t||s.length!==t.length)return!1;for(a=0,r=s.length;a<r;++a)if(n=s[a],l=t[a],n.datasetIndex!==l.datasetIndex||n.index!==l.index)return!1;return!0}function Cn(s){if($s(s))return s.map(Cn);if(Ka(s)){const t=Object.create(null),a=Object.keys(s),r=a.length;let n=0;for(;n<r;++n)t[a[n]]=Cn(s[a[n]]);return t}return s}function jc(s){return["__proto__","prototype","constructor"].indexOf(s)===-1}function uf(s,t,a,r){if(!jc(s))return;const n=t[s],l=a[s];Ka(n)&&Ka(l)?Gi(n,l,r):t[s]=Cn(l)}function Gi(s,t,a){const r=$s(t)?t:[t],n=r.length;if(!Ka(s))return s;a=a||{};const l=a.merger||uf;let c;for(let d=0;d<n;++d){if(c=r[d],!Ka(c))continue;const f=Object.keys(c);for(let p=0,h=f.length;p<h;++p)l(f[p],s,c,a)}return s}function Oi(s,t){return Gi(s,t,{merger:vf})}function vf(s,t,a){if(!jc(s))return;const r=t[s],n=a[s];Ka(r)&&Ka(n)?Oi(r,n):Object.prototype.hasOwnProperty.call(t,s)||(t[s]=Cn(n))}const ul={"":s=>s,x:s=>s.x,y:s=>s.y};function ff(s){const t=s.split("."),a=[];let r="";for(const n of t)r+=n,r.endsWith("\\")?r=r.slice(0,-1)+".":(a.push(r),r="");return a}function pf(s){const t=ff(s);return a=>{for(const r of t){if(r==="")break;a=a&&a[r]}return a}}function Zr(s,t){return(ul[t]||(ul[t]=pf(t)))(s)}function ko(s){return s.charAt(0).toUpperCase()+s.slice(1)}const Vi=s=>typeof s<"u",zr=s=>typeof s=="function",vl=(s,t)=>{if(s.size!==t.size)return!1;for(const a of s)if(!t.has(a))return!1;return!0};function mf(s){return s.type==="mouseup"||s.type==="click"||s.type==="contextmenu"}const os=Math.PI,Ts=2*os,Tn=Number.POSITIVE_INFINITY,hf=os/180,Ls=os/2,Wr=os/4,fl=os*2/3,qc=Math.log10,jr=Math.sign;function bn(s,t,a){return Math.abs(s-t)<a}function pl(s){const t=Math.round(s);s=bn(s,t,s/1e3)?t:s;const a=Math.pow(10,Math.floor(qc(s))),r=s/a;return(r<=1?1:r<=2?2:r<=5?5:10)*a}function gf(s){const t=[],a=Math.sqrt(s);let r;for(r=1;r<a;r++)s%r===0&&(t.push(r),t.push(s/r));return a===(a|0)&&t.push(a),t.sort((n,l)=>n-l).pop(),t}function _f(s){return typeof s=="symbol"||typeof s=="object"&&s!==null&&!(Symbol.toPrimitive in s||"toString"in s||"valueOf"in s)}function En(s){return!_f(s)&&!isNaN(parseFloat(s))&&isFinite(s)}function bf(s,t){const a=Math.round(s);return a-t<=s&&a+t>=s}function yf(s,t,a){let r,n,l;for(r=0,n=s.length;r<n;r++)l=s[r][a],isNaN(l)||(t.min=Math.min(t.min,l),t.max=Math.max(t.max,l))}function Fr(s){return s*(os/180)}function wf(s){return s*(180/os)}function ml(s){if(!dr(s))return;let t=1,a=0;for(;Math.round(s*t)/t!==s;)t*=10,a++;return a}function zc(s,t){const a=t.x-s.x,r=t.y-s.y,n=Math.sqrt(a*a+r*r);let l=Math.atan2(r,a);return l<-.5*os&&(l+=Ts),{angle:l,distance:n}}function xf(s,t){return Math.sqrt(Math.pow(t.x-s.x,2)+Math.pow(t.y-s.y,2))}function kr(s){return(s%Ts+Ts)%Ts}function Fn(s,t,a,r){const n=kr(s),l=kr(t),c=kr(a),d=kr(l-n),f=kr(c-n),p=kr(n-l),h=kr(n-c);return n===l||n===c||r&&l===c||d>f&&p<h}function Js(s,t,a){return Math.max(t,Math.min(a,s))}function Sf(s){return Js(s,-32768,32767)}function Jr(s,t,a,r=1e-6){return s>=Math.min(t,a)-r&&s<=Math.max(t,a)+r}function Ao(s,t,a){a=a||(c=>s[c]<t);let r=s.length-1,n=0,l;for(;r-n>1;)l=n+r>>1,a(l)?n=l:r=l;return{lo:n,hi:r}}const ho=(s,t,a,r)=>Ao(s,a,r?n=>{const l=s[n][t];return l<a||l===a&&s[n+1][t]===a}:n=>s[n][t]<a),kf=(s,t,a)=>Ao(s,a,r=>s[r][t]>=a);function Af(s,t,a){let r=0,n=s.length;for(;r<n&&s[r]<t;)r++;for(;n>r&&s[n-1]>a;)n--;return r>0||n<s.length?s.slice(r,n):s}const Gc=["push","pop","shift","splice","unshift"];function Df(s,t){if(s._chartjs){s._chartjs.listeners.push(t);return}Object.defineProperty(s,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[t]}}),Gc.forEach(a=>{const r="_onData"+ko(a),n=s[a];Object.defineProperty(s,a,{configurable:!0,enumerable:!1,value(...l){const c=n.apply(this,l);return s._chartjs.listeners.forEach(d=>{typeof d[r]=="function"&&d[r](...l)}),c}})})}function hl(s,t){const a=s._chartjs;if(!a)return;const r=a.listeners,n=r.indexOf(t);n!==-1&&r.splice(n,1),!(r.length>0)&&(Gc.forEach(l=>{delete s[l]}),delete s._chartjs)}function Vc(s){const t=new Set(s);return t.size===s.length?s:Array.from(t)}const Bc=(function(){return typeof window>"u"?function(s){return s()}:window.requestAnimationFrame})();function Wc(s,t){let a=[],r=!1;return function(...n){a=n,r||(r=!0,Bc.call(window,()=>{r=!1,s.apply(t,a)}))}}function Cf(s,t){let a;return function(...r){return t?(clearTimeout(a),a=setTimeout(s,t,r)):s.apply(this,r),t}}const Do=s=>s==="start"?"left":s==="end"?"right":"center",Vs=(s,t,a)=>s==="start"?t:s==="end"?a:(t+a)/2,Tf=(s,t,a,r)=>s===(r?"left":"right")?a:s==="center"?(t+a)/2:t,dn=s=>s===0||s===1,gl=(s,t,a)=>-(Math.pow(2,10*(s-=1))*Math.sin((s-t)*Ts/a)),_l=(s,t,a)=>Math.pow(2,-10*s)*Math.sin((s-t)*Ts/a)+1,ji={linear:s=>s,easeInQuad:s=>s*s,easeOutQuad:s=>-s*(s-2),easeInOutQuad:s=>(s/=.5)<1?.5*s*s:-.5*(--s*(s-2)-1),easeInCubic:s=>s*s*s,easeOutCubic:s=>(s-=1)*s*s+1,easeInOutCubic:s=>(s/=.5)<1?.5*s*s*s:.5*((s-=2)*s*s+2),easeInQuart:s=>s*s*s*s,easeOutQuart:s=>-((s-=1)*s*s*s-1),easeInOutQuart:s=>(s/=.5)<1?.5*s*s*s*s:-.5*((s-=2)*s*s*s-2),easeInQuint:s=>s*s*s*s*s,easeOutQuint:s=>(s-=1)*s*s*s*s+1,easeInOutQuint:s=>(s/=.5)<1?.5*s*s*s*s*s:.5*((s-=2)*s*s*s*s+2),easeInSine:s=>-Math.cos(s*Ls)+1,easeOutSine:s=>Math.sin(s*Ls),easeInOutSine:s=>-.5*(Math.cos(os*s)-1),easeInExpo:s=>s===0?0:Math.pow(2,10*(s-1)),easeOutExpo:s=>s===1?1:-Math.pow(2,-10*s)+1,easeInOutExpo:s=>dn(s)?s:s<.5?.5*Math.pow(2,10*(s*2-1)):.5*(-Math.pow(2,-10*(s*2-1))+2),easeInCirc:s=>s>=1?s:-(Math.sqrt(1-s*s)-1),easeOutCirc:s=>Math.sqrt(1-(s-=1)*s),easeInOutCirc:s=>(s/=.5)<1?-.5*(Math.sqrt(1-s*s)-1):.5*(Math.sqrt(1-(s-=2)*s)+1),easeInElastic:s=>dn(s)?s:gl(s,.075,.3),easeOutElastic:s=>dn(s)?s:_l(s,.075,.3),easeInOutElastic(s){return dn(s)?s:s<.5?.5*gl(s*2,.1125,.45):.5+.5*_l(s*2-1,.1125,.45)},easeInBack(s){return s*s*((1.70158+1)*s-1.70158)},easeOutBack(s){return(s-=1)*s*((1.70158+1)*s+1.70158)+1},easeInOutBack(s){let t=1.70158;return(s/=.5)<1?.5*(s*s*(((t*=1.525)+1)*s-t)):.5*((s-=2)*s*(((t*=1.525)+1)*s+t)+2)},easeInBounce:s=>1-ji.easeOutBounce(1-s),easeOutBounce(s){return s<1/2.75?7.5625*s*s:s<2/2.75?7.5625*(s-=1.5/2.75)*s+.75:s<2.5/2.75?7.5625*(s-=2.25/2.75)*s+.9375:7.5625*(s-=2.625/2.75)*s+.984375},easeInOutBounce:s=>s<.5?ji.easeInBounce(s*2)*.5:ji.easeOutBounce(s*2-1)*.5+.5};function Hc(s){if(s&&typeof s=="object"){const t=s.toString();return t==="[object CanvasPattern]"||t==="[object CanvasGradient]"}return!1}function bl(s){return Hc(s)?s:new zi(s)}function eo(s){return Hc(s)?s:new zi(s).saturate(.5).darken(.1).hexString()}const Ef=["x","y","borderWidth","radius","tension"],Ff=["color","borderColor","backgroundColor"];function Nf(s){s.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),s.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>t!=="onProgress"&&t!=="onComplete"&&t!=="fn"}),s.set("animations",{colors:{type:"color",properties:Ff},numbers:{type:"number",properties:Ef}}),s.describe("animations",{_fallback:"animation"}),s.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>t|0}}}})}function $f(s){s.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const yl=new Map;function Lf(s,t){t=t||{};const a=s+JSON.stringify(t);let r=yl.get(a);return r||(r=new Intl.NumberFormat(s,t),yl.set(a,r)),r}function Co(s,t,a){return Lf(t,a).format(s)}const Pf={values(s){return $s(s)?s:""+s},numeric(s,t,a){if(s===0)return"0";const r=this.chart.options.locale;let n,l=s;if(a.length>1){const p=Math.max(Math.abs(a[0].value),Math.abs(a[a.length-1].value));(p<1e-4||p>1e15)&&(n="scientific"),l=Mf(s,a)}const c=qc(Math.abs(l)),d=isNaN(c)?1:Math.max(Math.min(-1*Math.floor(c),20),0),f={notation:n,minimumFractionDigits:d,maximumFractionDigits:d};return Object.assign(f,this.options.ticks.format),Co(s,r,f)}};function Mf(s,t){let a=t.length>3?t[2].value-t[1].value:t[1].value-t[0].value;return Math.abs(a)>=1&&s!==Math.floor(s)&&(a=s-Math.floor(s)),a}var Uc={formatters:Pf};function If(s){s.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,a)=>a.lineWidth,tickColor:(t,a)=>a.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Uc.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),s.route("scale.ticks","color","","color"),s.route("scale.grid","color","","borderColor"),s.route("scale.border","color","","borderColor"),s.route("scale.title","color","","color"),s.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&t!=="callback"&&t!=="parser",_indexable:t=>t!=="borderDash"&&t!=="tickBorderDash"&&t!=="dash"}),s.describe("scales",{_fallback:"scale"}),s.describe("scale.ticks",{_scriptable:t=>t!=="backdropPadding"&&t!=="callback",_indexable:t=>t!=="backdropPadding"})}const ei=Object.create(null),go=Object.create(null);function qi(s,t){if(!t)return s;const a=t.split(".");for(let r=0,n=a.length;r<n;++r){const l=a[r];s=s[l]||(s[l]=Object.create(null))}return s}function to(s,t,a){return typeof t=="string"?Gi(qi(s,t),a):Gi(qi(s,""),t)}class Rf{constructor(t,a){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=r=>r.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(r,n)=>eo(n.backgroundColor),this.hoverBorderColor=(r,n)=>eo(n.borderColor),this.hoverColor=(r,n)=>eo(n.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(t),this.apply(a)}set(t,a){return to(this,t,a)}get(t){return qi(this,t)}describe(t,a){return to(go,t,a)}override(t,a){return to(ei,t,a)}route(t,a,r,n){const l=qi(this,t),c=qi(this,r),d="_"+a;Object.defineProperties(l,{[d]:{value:l[a],writable:!0},[a]:{enumerable:!0,get(){const f=this[d],p=c[n];return Ka(f)?Object.assign({},p,f):Qa(f,p)},set(f){this[d]=f}}})}apply(t){t.forEach(a=>a(this))}}var ks=new Rf({_scriptable:s=>!s.startsWith("on"),_indexable:s=>s!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[Nf,$f,If]);function Of(s){return!s||ls(s.size)||ls(s.family)?null:(s.style?s.style+" ":"")+(s.weight?s.weight+" ":"")+s.size+"px "+s.family}function wl(s,t,a,r,n){let l=t[n];return l||(l=t[n]=s.measureText(n).width,a.push(n)),l>r&&(r=l),r}function Hr(s,t,a){const r=s.currentDevicePixelRatio,n=a!==0?Math.max(a/2,.5):0;return Math.round((t-n)*r)/r+n}function xl(s,t){!t&&!s||(t=t||s.getContext("2d"),t.save(),t.resetTransform(),t.clearRect(0,0,s.width,s.height),t.restore())}function Sl(s,t,a,r){Yc(s,t,a,r,null)}function Yc(s,t,a,r,n){let l,c,d,f,p,h,g,b;const y=t.pointStyle,k=t.rotation,A=t.radius;let D=(k||0)*hf;if(y&&typeof y=="object"&&(l=y.toString(),l==="[object HTMLImageElement]"||l==="[object HTMLCanvasElement]")){s.save(),s.translate(a,r),s.rotate(D),s.drawImage(y,-y.width/2,-y.height/2,y.width,y.height),s.restore();return}if(!(isNaN(A)||A<=0)){switch(s.beginPath(),y){default:n?s.ellipse(a,r,n/2,A,0,0,Ts):s.arc(a,r,A,0,Ts),s.closePath();break;case"triangle":h=n?n/2:A,s.moveTo(a+Math.sin(D)*h,r-Math.cos(D)*A),D+=fl,s.lineTo(a+Math.sin(D)*h,r-Math.cos(D)*A),D+=fl,s.lineTo(a+Math.sin(D)*h,r-Math.cos(D)*A),s.closePath();break;case"rectRounded":p=A*.516,f=A-p,c=Math.cos(D+Wr)*f,g=Math.cos(D+Wr)*(n?n/2-p:f),d=Math.sin(D+Wr)*f,b=Math.sin(D+Wr)*(n?n/2-p:f),s.arc(a-g,r-d,p,D-os,D-Ls),s.arc(a+b,r-c,p,D-Ls,D),s.arc(a+g,r+d,p,D,D+Ls),s.arc(a-b,r+c,p,D+Ls,D+os),s.closePath();break;case"rect":if(!k){f=Math.SQRT1_2*A,h=n?n/2:f,s.rect(a-h,r-f,2*h,2*f);break}D+=Wr;case"rectRot":g=Math.cos(D)*(n?n/2:A),c=Math.cos(D)*A,d=Math.sin(D)*A,b=Math.sin(D)*(n?n/2:A),s.moveTo(a-g,r-d),s.lineTo(a+b,r-c),s.lineTo(a+g,r+d),s.lineTo(a-b,r+c),s.closePath();break;case"crossRot":D+=Wr;case"cross":g=Math.cos(D)*(n?n/2:A),c=Math.cos(D)*A,d=Math.sin(D)*A,b=Math.sin(D)*(n?n/2:A),s.moveTo(a-g,r-d),s.lineTo(a+g,r+d),s.moveTo(a+b,r-c),s.lineTo(a-b,r+c);break;case"star":g=Math.cos(D)*(n?n/2:A),c=Math.cos(D)*A,d=Math.sin(D)*A,b=Math.sin(D)*(n?n/2:A),s.moveTo(a-g,r-d),s.lineTo(a+g,r+d),s.moveTo(a+b,r-c),s.lineTo(a-b,r+c),D+=Wr,g=Math.cos(D)*(n?n/2:A),c=Math.cos(D)*A,d=Math.sin(D)*A,b=Math.sin(D)*(n?n/2:A),s.moveTo(a-g,r-d),s.lineTo(a+g,r+d),s.moveTo(a+b,r-c),s.lineTo(a-b,r+c);break;case"line":c=n?n/2:Math.cos(D)*A,d=Math.sin(D)*A,s.moveTo(a-c,r-d),s.lineTo(a+c,r+d);break;case"dash":s.moveTo(a,r),s.lineTo(a+Math.cos(D)*(n?n/2:A),r+Math.sin(D)*A);break;case!1:s.closePath();break}s.fill(),t.borderWidth>0&&s.stroke()}}function Qc(s,t,a){return a=a||.5,!t||s&&s.x>t.left-a&&s.x<t.right+a&&s.y>t.top-a&&s.y<t.bottom+a}function To(s,t){s.save(),s.beginPath(),s.rect(t.left,t.top,t.right-t.left,t.bottom-t.top),s.clip()}function Eo(s){s.restore()}function jf(s,t){t.translation&&s.translate(t.translation[0],t.translation[1]),ls(t.rotation)||s.rotate(t.rotation),t.color&&(s.fillStyle=t.color),t.textAlign&&(s.textAlign=t.textAlign),t.textBaseline&&(s.textBaseline=t.textBaseline)}function qf(s,t,a,r,n){if(n.strikethrough||n.underline){const l=s.measureText(r),c=t-l.actualBoundingBoxLeft,d=t+l.actualBoundingBoxRight,f=a-l.actualBoundingBoxAscent,p=a+l.actualBoundingBoxDescent,h=n.strikethrough?(f+p)/2:p;s.strokeStyle=s.fillStyle,s.beginPath(),s.lineWidth=n.decorationWidth||2,s.moveTo(c,h),s.lineTo(d,h),s.stroke()}}function zf(s,t){const a=s.fillStyle;s.fillStyle=t.color,s.fillRect(t.left,t.top,t.width,t.height),s.fillStyle=a}function Bi(s,t,a,r,n,l={}){const c=$s(t)?t:[t],d=l.strokeWidth>0&&l.strokeColor!=="";let f,p;for(s.save(),s.font=n.string,jf(s,l),f=0;f<c.length;++f)p=c[f],l.backdrop&&zf(s,l.backdrop),d&&(l.strokeColor&&(s.strokeStyle=l.strokeColor),ls(l.strokeWidth)||(s.lineWidth=l.strokeWidth),s.strokeText(p,a,r,l.maxWidth)),s.fillText(p,a,r,l.maxWidth),qf(s,a,r,p,l),r+=Number(n.lineHeight);s.restore()}function Nn(s,t){const{x:a,y:r,w:n,h:l,radius:c}=t;s.arc(a+c.topLeft,r+c.topLeft,c.topLeft,1.5*os,os,!0),s.lineTo(a,r+l-c.bottomLeft),s.arc(a+c.bottomLeft,r+l-c.bottomLeft,c.bottomLeft,os,Ls,!0),s.lineTo(a+n-c.bottomRight,r+l),s.arc(a+n-c.bottomRight,r+l-c.bottomRight,c.bottomRight,Ls,0,!0),s.lineTo(a+n,r+c.topRight),s.arc(a+n-c.topRight,r+c.topRight,c.topRight,0,-Ls,!0),s.lineTo(a+c.topLeft,r)}const Gf=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,Vf=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function Bf(s,t){const a=(""+s).match(Gf);if(!a||a[1]==="normal")return t*1.2;switch(s=+a[2],a[3]){case"px":return s;case"%":s/=100;break}return t*s}const Wf=s=>+s||0;function Fo(s,t){const a={},r=Ka(t),n=r?Object.keys(t):t,l=Ka(s)?r?c=>Qa(s[c],s[t[c]]):c=>s[c]:()=>s;for(const c of n)a[c]=Wf(l(c));return a}function Kc(s){return Fo(s,{top:"y",right:"x",bottom:"y",left:"x"})}function vi(s){return Fo(s,["topLeft","topRight","bottomLeft","bottomRight"])}function ur(s){const t=Kc(s);return t.width=t.left+t.right,t.height=t.top+t.bottom,t}function Bs(s,t){s=s||{},t=t||ks.font;let a=Qa(s.size,t.size);typeof a=="string"&&(a=parseInt(a,10));let r=Qa(s.style,t.style);r&&!(""+r).match(Vf)&&(console.warn('Invalid font style specified: "'+r+'"'),r=void 0);const n={family:Qa(s.family,t.family),lineHeight:Bf(Qa(s.lineHeight,t.lineHeight),a),size:a,style:r,weight:Qa(s.weight,t.weight),string:""};return n.string=Of(n),n}function un(s,t,a,r){let n,l,c;for(n=0,l=s.length;n<l;++n)if(c=s[n],c!==void 0&&c!==void 0)return c}function Hf(s,t,a){const{min:r,max:n}=s,l=Oc(t,(n-r)/2),c=(d,f)=>a&&d===0?0:d+f;return{min:c(r,-Math.abs(l)),max:c(n,l)}}function mi(s,t){return Object.assign(Object.create(s),t)}function No(s,t=[""],a,r,n=()=>s[0]){const l=a||s;typeof r>"u"&&(r=ed("_fallback",s));const c={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:s,_rootScopes:l,_fallback:r,_getTarget:n,override:d=>No([d,...s],t,l,r)};return new Proxy(c,{deleteProperty(d,f){return delete d[f],delete d._keys,delete s[0][f],!0},get(d,f){return Xc(d,f,()=>ep(f,t,s,d))},getOwnPropertyDescriptor(d,f){return Reflect.getOwnPropertyDescriptor(d._scopes[0],f)},getPrototypeOf(){return Reflect.getPrototypeOf(s[0])},has(d,f){return Al(d).includes(f)},ownKeys(d){return Al(d)},set(d,f,p){const h=d._storage||(d._storage=n());return d[f]=h[f]=p,delete d._keys,!0}})}function pi(s,t,a,r){const n={_cacheable:!1,_proxy:s,_context:t,_subProxy:a,_stack:new Set,_descriptors:Jc(s,r),setContext:l=>pi(s,l,a,r),override:l=>pi(s.override(l),t,a,r)};return new Proxy(n,{deleteProperty(l,c){return delete l[c],delete s[c],!0},get(l,c,d){return Xc(l,c,()=>Yf(l,c,d))},getOwnPropertyDescriptor(l,c){return l._descriptors.allKeys?Reflect.has(s,c)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(s,c)},getPrototypeOf(){return Reflect.getPrototypeOf(s)},has(l,c){return Reflect.has(s,c)},ownKeys(){return Reflect.ownKeys(s)},set(l,c,d){return s[c]=d,delete l[c],!0}})}function Jc(s,t={scriptable:!0,indexable:!0}){const{_scriptable:a=t.scriptable,_indexable:r=t.indexable,_allKeys:n=t.allKeys}=s;return{allKeys:n,scriptable:a,indexable:r,isScriptable:zr(a)?a:()=>a,isIndexable:zr(r)?r:()=>r}}const Uf=(s,t)=>s?s+ko(t):t,$o=(s,t)=>Ka(t)&&s!=="adapters"&&(Object.getPrototypeOf(t)===null||t.constructor===Object);function Xc(s,t,a){if(Object.prototype.hasOwnProperty.call(s,t)||t==="constructor")return s[t];const r=a();return s[t]=r,r}function Yf(s,t,a){const{_proxy:r,_context:n,_subProxy:l,_descriptors:c}=s;let d=r[t];return zr(d)&&c.isScriptable(t)&&(d=Qf(t,d,s,a)),$s(d)&&d.length&&(d=Kf(t,d,s,c.isIndexable)),$o(t,d)&&(d=pi(d,n,l&&l[t],c)),d}function Qf(s,t,a,r){const{_proxy:n,_context:l,_subProxy:c,_stack:d}=a;if(d.has(s))throw new Error("Recursion detected: "+Array.from(d).join("->")+"->"+s);d.add(s);let f=t(l,c||r);return d.delete(s),$o(s,f)&&(f=Lo(n._scopes,n,s,f)),f}function Kf(s,t,a,r){const{_proxy:n,_context:l,_subProxy:c,_descriptors:d}=a;if(typeof l.index<"u"&&r(s))return t[l.index%t.length];if(Ka(t[0])){const f=t,p=n._scopes.filter(h=>h!==f);t=[];for(const h of f){const g=Lo(p,n,s,h);t.push(pi(g,l,c&&c[s],d))}}return t}function Zc(s,t,a){return zr(s)?s(t,a):s}const Jf=(s,t)=>s===!0?t:typeof s=="string"?Zr(t,s):void 0;function Xf(s,t,a,r,n){for(const l of t){const c=Jf(a,l);if(c){s.add(c);const d=Zc(c._fallback,a,n);if(typeof d<"u"&&d!==a&&d!==r)return d}else if(c===!1&&typeof r<"u"&&a!==r)return null}return!1}function Lo(s,t,a,r){const n=t._rootScopes,l=Zc(t._fallback,a,r),c=[...s,...n],d=new Set;d.add(r);let f=kl(d,c,a,l||a,r);return f===null||typeof l<"u"&&l!==a&&(f=kl(d,c,l,f,r),f===null)?!1:No(Array.from(d),[""],n,l,()=>Zf(t,a,r))}function kl(s,t,a,r,n){for(;a;)a=Xf(s,t,a,r,n);return a}function Zf(s,t,a){const r=s._getTarget();t in r||(r[t]={});const n=r[t];return $s(n)&&Ka(a)?a:n||{}}function ep(s,t,a,r){let n;for(const l of t)if(n=ed(Uf(l,s),a),typeof n<"u")return $o(s,n)?Lo(a,r,s,n):n}function ed(s,t){for(const a of t){if(!a)continue;const r=a[s];if(typeof r<"u")return r}}function Al(s){let t=s._keys;return t||(t=s._keys=tp(s._scopes)),t}function tp(s){const t=new Set;for(const a of s)for(const r of Object.keys(a).filter(n=>!n.startsWith("_")))t.add(r);return Array.from(t)}function Po(){return typeof window<"u"&&typeof document<"u"}function Mo(s){let t=s.parentNode;return t&&t.toString()==="[object ShadowRoot]"&&(t=t.host),t}function $n(s,t,a){let r;return typeof s=="string"?(r=parseInt(s,10),s.indexOf("%")!==-1&&(r=r/100*t.parentNode[a])):r=s,r}const In=s=>s.ownerDocument.defaultView.getComputedStyle(s,null);function ap(s,t){return In(s).getPropertyValue(t)}const sp=["top","right","bottom","left"];function Xr(s,t,a){const r={};a=a?"-"+a:"";for(let n=0;n<4;n++){const l=sp[n];r[l]=parseFloat(s[t+"-"+l+a])||0}return r.width=r.left+r.right,r.height=r.top+r.bottom,r}const rp=(s,t,a)=>(s>0||t>0)&&(!a||!a.shadowRoot);function ip(s,t){const a=s.touches,r=a&&a.length?a[0]:s,{offsetX:n,offsetY:l}=r;let c=!1,d,f;if(rp(n,l,s.target))d=n,f=l;else{const p=t.getBoundingClientRect();d=r.clientX-p.left,f=r.clientY-p.top,c=!0}return{x:d,y:f,box:c}}function Qr(s,t){if("native"in s)return s;const{canvas:a,currentDevicePixelRatio:r}=t,n=In(a),l=n.boxSizing==="border-box",c=Xr(n,"padding"),d=Xr(n,"border","width"),{x:f,y:p,box:h}=ip(s,a),g=c.left+(h&&d.left),b=c.top+(h&&d.top);let{width:y,height:k}=t;return l&&(y-=c.width+d.width,k-=c.height+d.height),{x:Math.round((f-g)/y*a.width/r),y:Math.round((p-b)/k*a.height/r)}}function np(s,t,a){let r,n;if(t===void 0||a===void 0){const l=s&&Mo(s);if(!l)t=s.clientWidth,a=s.clientHeight;else{const c=l.getBoundingClientRect(),d=In(l),f=Xr(d,"border","width"),p=Xr(d,"padding");t=c.width-p.width-f.width,a=c.height-p.height-f.height,r=$n(d.maxWidth,l,"clientWidth"),n=$n(d.maxHeight,l,"clientHeight")}}return{width:t,height:a,maxWidth:r||Tn,maxHeight:n||Tn}}const Ir=s=>Math.round(s*10)/10;function op(s,t,a,r){const n=In(s),l=Xr(n,"margin"),c=$n(n.maxWidth,s,"clientWidth")||Tn,d=$n(n.maxHeight,s,"clientHeight")||Tn,f=np(s,t,a);let{width:p,height:h}=f;if(n.boxSizing==="content-box"){const b=Xr(n,"border","width"),y=Xr(n,"padding");p-=y.width+b.width,h-=y.height+b.height}return p=Math.max(0,p-l.width),h=Math.max(0,r?p/r:h-l.height),p=Ir(Math.min(p,c,f.maxWidth)),h=Ir(Math.min(h,d,f.maxHeight)),p&&!h&&(h=Ir(p/2)),(t!==void 0||a!==void 0)&&r&&f.height&&h>f.height&&(h=f.height,p=Ir(Math.floor(h*r))),{width:p,height:h}}function Dl(s,t,a){const r=t||1,n=Ir(s.height*r),l=Ir(s.width*r);s.height=Ir(s.height),s.width=Ir(s.width);const c=s.canvas;return c.style&&(a||!c.style.height&&!c.style.width)&&(c.style.height=`${s.height}px`,c.style.width=`${s.width}px`),s.currentDevicePixelRatio!==r||c.height!==n||c.width!==l?(s.currentDevicePixelRatio=r,c.height=n,c.width=l,s.ctx.setTransform(r,0,0,r,0,0),!0):!1}const lp=(function(){let s=!1;try{const t={get passive(){return s=!0,!1}};Po()&&(window.addEventListener("test",null,t),window.removeEventListener("test",null,t))}catch{}return s})();function Cl(s,t){const a=ap(s,t),r=a&&a.match(/^(\d+)(\.\d+)?px$/);return r?+r[1]:void 0}const cp=function(s,t){return{x(a){return s+s+t-a},setWidth(a){t=a},textAlign(a){return a==="center"?a:a==="right"?"left":"right"},xPlus(a,r){return a-r},leftForLtr(a,r){return a-r}}},dp=function(){return{x(s){return s},setWidth(s){},textAlign(s){return s},xPlus(s,t){return s+t},leftForLtr(s,t){return s}}};function fi(s,t,a){return s?cp(t,a):dp()}function td(s,t){let a,r;(t==="ltr"||t==="rtl")&&(a=s.canvas.style,r=[a.getPropertyValue("direction"),a.getPropertyPriority("direction")],a.setProperty("direction",t,"important"),s.prevTextDirection=r)}function ad(s,t){t!==void 0&&(delete s.prevTextDirection,s.canvas.style.setProperty("direction",t[0],t[1]))}function vn(s,t,a){return s.options.clip?s[a]:t[a]}function up(s,t){const{xScale:a,yScale:r}=s;return a&&r?{left:vn(a,t,"left"),right:vn(a,t,"right"),top:vn(r,t,"top"),bottom:vn(r,t,"bottom")}:t}function vp(s,t){const a=t._clip;if(a.disabled)return!1;const r=up(t,s.chartArea);return{left:a.left===!1?0:r.left-(a.left===!0?0:a.left),right:a.right===!1?s.width:r.right+(a.right===!0?0:a.right),top:a.top===!1?0:r.top-(a.top===!0?0:a.top),bottom:a.bottom===!1?s.height:r.bottom+(a.bottom===!0?0:a.bottom)}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */class fp{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,a,r,n){const l=a.listeners[n],c=a.duration;l.forEach(d=>d({chart:t,initial:a.initial,numSteps:c,currentStep:Math.min(r-a.start,c)}))}_refresh(){this._request||(this._running=!0,this._request=Bc.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(t=Date.now()){let a=0;this._charts.forEach((r,n)=>{if(!r.running||!r.items.length)return;const l=r.items;let c=l.length-1,d=!1,f;for(;c>=0;--c)f=l[c],f._active?(f._total>r.duration&&(r.duration=f._total),f.tick(t),d=!0):(l[c]=l[l.length-1],l.pop());d&&(n.draw(),this._notify(n,r,t,"progress")),l.length||(r.running=!1,this._notify(n,r,t,"complete"),r.initial=!1),a+=l.length}),this._lastDate=t,a===0&&(this._running=!1)}_getAnims(t){const a=this._charts;let r=a.get(t);return r||(r={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},a.set(t,r)),r}listen(t,a,r){this._getAnims(t).listeners[a].push(r)}add(t,a){!a||!a.length||this._getAnims(t).items.push(...a)}has(t){return this._getAnims(t).items.length>0}start(t){const a=this._charts.get(t);a&&(a.running=!0,a.start=Date.now(),a.duration=a.items.reduce((r,n)=>Math.max(r,n._duration),0),this._refresh())}running(t){if(!this._running)return!1;const a=this._charts.get(t);return!(!a||!a.running||!a.items.length)}stop(t){const a=this._charts.get(t);if(!a||!a.items.length)return;const r=a.items;let n=r.length-1;for(;n>=0;--n)r[n].cancel();a.items=[],this._notify(t,a,Date.now(),"complete")}remove(t){return this._charts.delete(t)}}var Dr=new fp;const Tl="transparent",pp={boolean(s,t,a){return a>.5?t:s},color(s,t,a){const r=bl(s||Tl),n=r.valid&&bl(t||Tl);return n&&n.valid?n.mix(r,a).hexString():t},number(s,t,a){return s+(t-s)*a}};class mp{constructor(t,a,r,n){const l=a[r];n=un([t.to,n,l,t.from]);const c=un([t.from,l,n]);this._active=!0,this._fn=t.fn||pp[t.type||typeof c],this._easing=ji[t.easing]||ji.linear,this._start=Math.floor(Date.now()+(t.delay||0)),this._duration=this._total=Math.floor(t.duration),this._loop=!!t.loop,this._target=a,this._prop=r,this._from=c,this._to=n,this._promises=void 0}active(){return this._active}update(t,a,r){if(this._active){this._notify(!1);const n=this._target[this._prop],l=r-this._start,c=this._duration-l;this._start=r,this._duration=Math.floor(Math.max(c,t.duration)),this._total+=l,this._loop=!!t.loop,this._to=un([t.to,a,n,t.from]),this._from=un([t.from,n,a])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(t){const a=t-this._start,r=this._duration,n=this._prop,l=this._from,c=this._loop,d=this._to;let f;if(this._active=l!==d&&(c||a<r),!this._active){this._target[n]=d,this._notify(!0);return}if(a<0){this._target[n]=l;return}f=a/r%2,f=c&&f>1?2-f:f,f=this._easing(Math.min(1,Math.max(0,f))),this._target[n]=this._fn(l,d,f)}wait(){const t=this._promises||(this._promises=[]);return new Promise((a,r)=>{t.push({res:a,rej:r})})}_notify(t){const a=t?"res":"rej",r=this._promises||[];for(let n=0;n<r.length;n++)r[n][a]()}}class sd{constructor(t,a){this._chart=t,this._properties=new Map,this.configure(a)}configure(t){if(!Ka(t))return;const a=Object.keys(ks.animation),r=this._properties;Object.getOwnPropertyNames(t).forEach(n=>{const l=t[n];if(!Ka(l))return;const c={};for(const d of a)c[d]=l[d];($s(l.properties)&&l.properties||[n]).forEach(d=>{(d===n||!r.has(d))&&r.set(d,c)})})}_animateOptions(t,a){const r=a.options,n=gp(t,r);if(!n)return[];const l=this._createAnimations(n,r);return r.$shared&&hp(t.options.$animations,r).then(()=>{t.options=r},()=>{}),l}_createAnimations(t,a){const r=this._properties,n=[],l=t.$animations||(t.$animations={}),c=Object.keys(a),d=Date.now();let f;for(f=c.length-1;f>=0;--f){const p=c[f];if(p.charAt(0)==="$")continue;if(p==="options"){n.push(...this._animateOptions(t,a));continue}const h=a[p];let g=l[p];const b=r.get(p);if(g)if(b&&g.active()){g.update(b,h,d);continue}else g.cancel();if(!b||!b.duration){t[p]=h;continue}l[p]=g=new mp(b,t,p,h),n.push(g)}return n}update(t,a){if(this._properties.size===0){Object.assign(t,a);return}const r=this._createAnimations(t,a);if(r.length)return Dr.add(this._chart,r),!0}}function hp(s,t){const a=[],r=Object.keys(t);for(let n=0;n<r.length;n++){const l=s[r[n]];l&&l.active()&&a.push(l.wait())}return Promise.all(a)}function gp(s,t){if(!t)return;let a=s.options;if(!a){s.options=t;return}return a.$shared&&(s.options=a=Object.assign({},a,{$shared:!1,$animations:{}})),a}function El(s,t){const a=s&&s.options||{},r=a.reverse,n=a.min===void 0?t:0,l=a.max===void 0?t:0;return{start:r?l:n,end:r?n:l}}function _p(s,t,a){if(a===!1)return!1;const r=El(s,a),n=El(t,a);return{top:n.end,right:r.end,bottom:n.start,left:r.start}}function bp(s){let t,a,r,n;return Ka(s)?(t=s.top,a=s.right,r=s.bottom,n=s.left):t=a=r=n=s,{top:t,right:a,bottom:r,left:n,disabled:s===!1}}function rd(s,t){const a=[],r=s._getSortedDatasetMetas(t);let n,l;for(n=0,l=r.length;n<l;++n)a.push(r[n].index);return a}function Fl(s,t,a,r={}){const n=s.keys,l=r.mode==="single";let c,d,f,p;if(t===null)return;let h=!1;for(c=0,d=n.length;c<d;++c){if(f=+n[c],f===a){if(h=!0,r.all)continue;break}p=s.values[f],dr(p)&&(l||t===0||jr(t)===jr(p))&&(t+=p)}return!h&&!r.all?0:t}function yp(s,t){const{iScale:a,vScale:r}=t,n=a.axis==="x"?"x":"y",l=r.axis==="x"?"x":"y",c=Object.keys(s),d=new Array(c.length);let f,p,h;for(f=0,p=c.length;f<p;++f)h=c[f],d[f]={[n]:h,[l]:s[h]};return d}function ao(s,t){const a=s&&s.options.stacked;return a||a===void 0&&t.stack!==void 0}function wp(s,t,a){return`${s.id}.${t.id}.${a.stack||a.type}`}function xp(s){const{min:t,max:a,minDefined:r,maxDefined:n}=s.getUserBounds();return{min:r?t:Number.NEGATIVE_INFINITY,max:n?a:Number.POSITIVE_INFINITY}}function Sp(s,t,a){const r=s[t]||(s[t]={});return r[a]||(r[a]={})}function Nl(s,t,a,r){for(const n of t.getMatchingVisibleMetas(r).reverse()){const l=s[n.index];if(a&&l>0||!a&&l<0)return n.index}return null}function $l(s,t){const{chart:a,_cachedMeta:r}=s,n=a._stacks||(a._stacks={}),{iScale:l,vScale:c,index:d}=r,f=l.axis,p=c.axis,h=wp(l,c,r),g=t.length;let b;for(let y=0;y<g;++y){const k=t[y],{[f]:A,[p]:D}=k,T=k._stacks||(k._stacks={});b=T[p]=Sp(n,h,A),b[d]=D,b._top=Nl(b,c,!0,r.type),b._bottom=Nl(b,c,!1,r.type);const C=b._visualValues||(b._visualValues={});C[d]=D}}function so(s,t){const a=s.scales;return Object.keys(a).filter(r=>a[r].axis===t).shift()}function kp(s,t){return mi(s,{active:!1,dataset:void 0,datasetIndex:t,index:t,mode:"default",type:"dataset"})}function Ap(s,t,a){return mi(s,{active:!1,dataIndex:t,parsed:void 0,raw:void 0,element:a,index:t,mode:"default",type:"data"})}function Di(s,t){const a=s.controller.index,r=s.vScale&&s.vScale.axis;if(r){t=t||s._parsed;for(const n of t){const l=n._stacks;if(!l||l[r]===void 0||l[r][a]===void 0)return;delete l[r][a],l[r]._visualValues!==void 0&&l[r]._visualValues[a]!==void 0&&delete l[r]._visualValues[a]}}}const ro=s=>s==="reset"||s==="none",Ll=(s,t)=>t?s:Object.assign({},s),Dp=(s,t,a)=>s&&!t.hidden&&t._stacked&&{keys:rd(a,!0),values:null};class Io{static defaults={};static datasetElementType=null;static dataElementType=null;constructor(t,a){this.chart=t,this._ctx=t.ctx,this.index=a,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=ao(t.vScale,t),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(t){this.index!==t&&Di(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,a=this._cachedMeta,r=this.getDataset(),n=(g,b,y,k)=>g==="x"?b:g==="r"?k:y,l=a.xAxisID=Qa(r.xAxisID,so(t,"x")),c=a.yAxisID=Qa(r.yAxisID,so(t,"y")),d=a.rAxisID=Qa(r.rAxisID,so(t,"r")),f=a.indexAxis,p=a.iAxisID=n(f,l,c,d),h=a.vAxisID=n(f,c,l,d);a.xScale=this.getScaleForId(l),a.yScale=this.getScaleForId(c),a.rScale=this.getScaleForId(d),a.iScale=this.getScaleForId(p),a.vScale=this.getScaleForId(h)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const a=this._cachedMeta;return t===a.iScale?a.vScale:a.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&hl(this._data,this),t._stacked&&Di(t)}_dataCheck(){const t=this.getDataset(),a=t.data||(t.data=[]),r=this._data;if(Ka(a)){const n=this._cachedMeta;this._data=yp(a,n)}else if(r!==a){if(r){hl(r,this);const n=this._cachedMeta;Di(n),n._parsed=[]}a&&Object.isExtensible(a)&&Df(a,this),this._syncList=[],this._data=a}}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const a=this._cachedMeta,r=this.getDataset();let n=!1;this._dataCheck();const l=a._stacked;a._stacked=ao(a.vScale,a),a.stack!==r.stack&&(n=!0,Di(a),a.stack=r.stack),this._resyncElements(t),(n||l!==a._stacked)&&($l(this,a._parsed),a._stacked=ao(a.vScale,a))}configure(){const t=this.chart.config,a=t.datasetScopeKeys(this._type),r=t.getOptionScopes(this.getDataset(),a,!0);this.options=t.createResolver(r,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,a){const{_cachedMeta:r,_data:n}=this,{iScale:l,_stacked:c}=r,d=l.axis;let f=t===0&&a===n.length?!0:r._sorted,p=t>0&&r._parsed[t-1],h,g,b;if(this._parsing===!1)r._parsed=n,r._sorted=!0,b=n;else{$s(n[t])?b=this.parseArrayData(r,n,t,a):Ka(n[t])?b=this.parseObjectData(r,n,t,a):b=this.parsePrimitiveData(r,n,t,a);const y=()=>g[d]===null||p&&g[d]<p[d];for(h=0;h<a;++h)r._parsed[h+t]=g=b[h],f&&(y()&&(f=!1),p=g);r._sorted=f}c&&$l(this,b)}parsePrimitiveData(t,a,r,n){const{iScale:l,vScale:c}=t,d=l.axis,f=c.axis,p=l.getLabels(),h=l===c,g=new Array(n);let b,y,k;for(b=0,y=n;b<y;++b)k=b+r,g[b]={[d]:h||l.parse(p[k],k),[f]:c.parse(a[k],k)};return g}parseArrayData(t,a,r,n){const{xScale:l,yScale:c}=t,d=new Array(n);let f,p,h,g;for(f=0,p=n;f<p;++f)h=f+r,g=a[h],d[f]={x:l.parse(g[0],h),y:c.parse(g[1],h)};return d}parseObjectData(t,a,r,n){const{xScale:l,yScale:c}=t,{xAxisKey:d="x",yAxisKey:f="y"}=this._parsing,p=new Array(n);let h,g,b,y;for(h=0,g=n;h<g;++h)b=h+r,y=a[b],p[h]={x:l.parse(Zr(y,d),b),y:c.parse(Zr(y,f),b)};return p}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,a,r){const n=this.chart,l=this._cachedMeta,c=a[t.axis],d={keys:rd(n,!0),values:a._stacks[t.axis]._visualValues};return Fl(d,c,l.index,{mode:r})}updateRangeFromParsed(t,a,r,n){const l=r[a.axis];let c=l===null?NaN:l;const d=n&&r._stacks[a.axis];n&&d&&(n.values=d,c=Fl(n,l,this._cachedMeta.index)),t.min=Math.min(t.min,c),t.max=Math.max(t.max,c)}getMinMax(t,a){const r=this._cachedMeta,n=r._parsed,l=r._sorted&&t===r.iScale,c=n.length,d=this._getOtherScale(t),f=Dp(a,r,this.chart),p={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:h,max:g}=xp(d);let b,y;function k(){y=n[b];const A=y[d.axis];return!dr(y[t.axis])||h>A||g<A}for(b=0;b<c&&!(!k()&&(this.updateRangeFromParsed(p,t,y,f),l));++b);if(l){for(b=c-1;b>=0;--b)if(!k()){this.updateRangeFromParsed(p,t,y,f);break}}return p}getAllParsedValues(t){const a=this._cachedMeta._parsed,r=[];let n,l,c;for(n=0,l=a.length;n<l;++n)c=a[n][t.axis],dr(c)&&r.push(c);return r}getMaxOverflow(){return!1}getLabelAndValue(t){const a=this._cachedMeta,r=a.iScale,n=a.vScale,l=this.getParsed(t);return{label:r?""+r.getLabelForValue(l[r.axis]):"",value:n?""+n.getLabelForValue(l[n.axis]):""}}_update(t){const a=this._cachedMeta;this.update(t||"default"),a._clip=bp(Qa(this.options.clip,_p(a.xScale,a.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,a=this.chart,r=this._cachedMeta,n=r.data||[],l=a.chartArea,c=[],d=this._drawStart||0,f=this._drawCount||n.length-d,p=this.options.drawActiveElementsOnTop;let h;for(r.dataset&&r.dataset.draw(t,l,d,f),h=d;h<d+f;++h){const g=n[h];g.hidden||(g.active&&p?c.push(g):g.draw(t,l))}for(h=0;h<c.length;++h)c[h].draw(t,l)}getStyle(t,a){const r=a?"active":"default";return t===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(r):this.resolveDataElementOptions(t||0,r)}getContext(t,a,r){const n=this.getDataset();let l;if(t>=0&&t<this._cachedMeta.data.length){const c=this._cachedMeta.data[t];l=c.$context||(c.$context=Ap(this.getContext(),t,c)),l.parsed=this.getParsed(t),l.raw=n.data[t],l.index=l.dataIndex=t}else l=this.$context||(this.$context=kp(this.chart.getContext(),this.index)),l.dataset=n,l.index=l.datasetIndex=this.index;return l.active=!!a,l.mode=r,l}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,a){return this._resolveElementOptions(this.dataElementType.id,a,t)}_resolveElementOptions(t,a="default",r){const n=a==="active",l=this._cachedDataOpts,c=t+"-"+a,d=l[c],f=this.enableOptionSharing&&Vi(r);if(d)return Ll(d,f);const p=this.chart.config,h=p.datasetElementScopeKeys(this._type,t),g=n?[`${t}Hover`,"hover",t,""]:[t,""],b=p.getOptionScopes(this.getDataset(),h),y=Object.keys(ks.elements[t]),k=()=>this.getContext(r,n,a),A=p.resolveNamedOptions(b,y,k,g);return A.$shared&&(A.$shared=f,l[c]=Object.freeze(Ll(A,f))),A}_resolveAnimations(t,a,r){const n=this.chart,l=this._cachedDataOpts,c=`animation-${a}`,d=l[c];if(d)return d;let f;if(n.options.animation!==!1){const h=this.chart.config,g=h.datasetAnimationScopeKeys(this._type,a),b=h.getOptionScopes(this.getDataset(),g);f=h.createResolver(b,this.getContext(t,r,a))}const p=new sd(n,f&&f.animations);return f&&f._cacheable&&(l[c]=Object.freeze(p)),p}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,a){return!a||ro(t)||this.chart._animationsDisabled}_getSharedOptions(t,a){const r=this.resolveDataElementOptions(t,a),n=this._sharedOptions,l=this.getSharedOptions(r),c=this.includeOptions(a,l)||l!==n;return this.updateSharedOptions(l,a,r),{sharedOptions:l,includeOptions:c}}updateElement(t,a,r,n){ro(n)?Object.assign(t,r):this._resolveAnimations(a,n).update(t,r)}updateSharedOptions(t,a,r){t&&!ro(a)&&this._resolveAnimations(void 0,a).update(t,r)}_setStyle(t,a,r,n){t.active=n;const l=this.getStyle(a,n);this._resolveAnimations(a,r,n).update(t,{options:!n&&this.getSharedOptions(l)||l})}removeHoverStyle(t,a,r){this._setStyle(t,r,"active",!1)}setHoverStyle(t,a,r){this._setStyle(t,r,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const a=this._data,r=this._cachedMeta.data;for(const[d,f,p]of this._syncList)this[d](f,p);this._syncList=[];const n=r.length,l=a.length,c=Math.min(l,n);c&&this.parse(0,c),l>n?this._insertElements(n,l-n,t):l<n&&this._removeElements(l,n-l)}_insertElements(t,a,r=!0){const n=this._cachedMeta,l=n.data,c=t+a;let d;const f=p=>{for(p.length+=a,d=p.length-1;d>=c;d--)p[d]=p[d-a]};for(f(l),d=t;d<c;++d)l[d]=new this.dataElementType;this._parsing&&f(n._parsed),this.parse(t,a),r&&this.updateElements(l,t,a,"reset")}updateElements(t,a,r,n){}_removeElements(t,a){const r=this._cachedMeta;if(this._parsing){const n=r._parsed.splice(t,a);r._stacked&&Di(r,n)}r.data.splice(t,a)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[a,r,n]=t;this[a](r,n)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,a){a&&this._sync(["_removeElements",t,a]);const r=arguments.length-2;r&&this._sync(["_insertElements",t,r])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}function Cp(s,t){if(!s._cache.$bar){const a=s.getMatchingVisibleMetas(t);let r=[];for(let n=0,l=a.length;n<l;n++)r=r.concat(a[n].controller.getAllParsedValues(s));s._cache.$bar=Vc(r.sort((n,l)=>n-l))}return s._cache.$bar}function Tp(s){const t=s.iScale,a=Cp(t,s.type);let r=t._length,n,l,c,d;const f=()=>{c===32767||c===-32768||(Vi(d)&&(r=Math.min(r,Math.abs(c-d)||r)),d=c)};for(n=0,l=a.length;n<l;++n)c=t.getPixelForValue(a[n]),f();for(d=void 0,n=0,l=t.ticks.length;n<l;++n)c=t.getPixelForTick(n),f();return r}function Ep(s,t,a,r){const n=a.barThickness;let l,c;return ls(n)?(l=t.min*a.categoryPercentage,c=a.barPercentage):(l=n*r,c=1),{chunk:l/r,ratio:c,start:t.pixels[s]-l/2}}function Fp(s,t,a,r){const n=t.pixels,l=n[s];let c=s>0?n[s-1]:null,d=s<n.length-1?n[s+1]:null;const f=a.categoryPercentage;c===null&&(c=l-(d===null?t.end-t.start:d-l)),d===null&&(d=l+l-c);const p=l-(l-Math.min(c,d))/2*f;return{chunk:Math.abs(d-c)/2*f/r,ratio:a.barPercentage,start:p}}function Np(s,t,a,r){const n=a.parse(s[0],r),l=a.parse(s[1],r),c=Math.min(n,l),d=Math.max(n,l);let f=c,p=d;Math.abs(c)>Math.abs(d)&&(f=d,p=c),t[a.axis]=p,t._custom={barStart:f,barEnd:p,start:n,end:l,min:c,max:d}}function id(s,t,a,r){return $s(s)?Np(s,t,a,r):t[a.axis]=a.parse(s,r),t}function Pl(s,t,a,r){const n=s.iScale,l=s.vScale,c=n.getLabels(),d=n===l,f=[];let p,h,g,b;for(p=a,h=a+r;p<h;++p)b=t[p],g={},g[n.axis]=d||n.parse(c[p],p),f.push(id(b,g,l,p));return f}function io(s){return s&&s.barStart!==void 0&&s.barEnd!==void 0}function $p(s,t,a){return s!==0?jr(s):(t.isHorizontal()?1:-1)*(t.min>=a?1:-1)}function Lp(s){let t,a,r,n,l;return s.horizontal?(t=s.base>s.x,a="left",r="right"):(t=s.base<s.y,a="bottom",r="top"),t?(n="end",l="start"):(n="start",l="end"),{start:a,end:r,reverse:t,top:n,bottom:l}}function Pp(s,t,a,r){let n=t.borderSkipped;const l={};if(!n){s.borderSkipped=l;return}if(n===!0){s.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:c,end:d,reverse:f,top:p,bottom:h}=Lp(s);n==="middle"&&a&&(s.enableBorderRadius=!0,(a._top||0)===r?n=p:(a._bottom||0)===r?n=h:(l[Ml(h,c,d,f)]=!0,n=p)),l[Ml(n,c,d,f)]=!0,s.borderSkipped=l}function Ml(s,t,a,r){return r?(s=Mp(s,t,a),s=Il(s,a,t)):s=Il(s,t,a),s}function Mp(s,t,a){return s===t?a:s===a?t:s}function Il(s,t,a){return s==="start"?t:s==="end"?a:s}function Ip(s,{inflateAmount:t},a){s.inflateAmount=t==="auto"?a===1?.33:0:t}class Rn extends Io{static id="bar";static defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}};static overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};parsePrimitiveData(t,a,r,n){return Pl(t,a,r,n)}parseArrayData(t,a,r,n){return Pl(t,a,r,n)}parseObjectData(t,a,r,n){const{iScale:l,vScale:c}=t,{xAxisKey:d="x",yAxisKey:f="y"}=this._parsing,p=l.axis==="x"?d:f,h=c.axis==="x"?d:f,g=[];let b,y,k,A;for(b=r,y=r+n;b<y;++b)A=a[b],k={},k[l.axis]=l.parse(Zr(A,p),b),g.push(id(Zr(A,h),k,c,b));return g}updateRangeFromParsed(t,a,r,n){super.updateRangeFromParsed(t,a,r,n);const l=r._custom;l&&a===this._cachedMeta.vScale&&(t.min=Math.min(t.min,l.min),t.max=Math.max(t.max,l.max))}getMaxOverflow(){return 0}getLabelAndValue(t){const a=this._cachedMeta,{iScale:r,vScale:n}=a,l=this.getParsed(t),c=l._custom,d=io(c)?"["+c.start+", "+c.end+"]":""+n.getLabelForValue(l[n.axis]);return{label:""+r.getLabelForValue(l[r.axis]),value:d}}initialize(){this.enableOptionSharing=!0,super.initialize();const t=this._cachedMeta;t.stack=this.getDataset().stack}update(t){const a=this._cachedMeta;this.updateElements(a.data,0,a.data.length,t)}updateElements(t,a,r,n){const l=n==="reset",{index:c,_cachedMeta:{vScale:d}}=this,f=d.getBasePixel(),p=d.isHorizontal(),h=this._getRuler(),{sharedOptions:g,includeOptions:b}=this._getSharedOptions(a,n);for(let y=a;y<a+r;y++){const k=this.getParsed(y),A=l||ls(k[d.axis])?{base:f,head:f}:this._calculateBarValuePixels(y),D=this._calculateBarIndexPixels(y,h),T=(k._stacks||{})[d.axis],C={horizontal:p,base:A.base,enableBorderRadius:!T||io(k._custom)||c===T._top||c===T._bottom,x:p?A.head:D.center,y:p?D.center:A.head,height:p?D.size:Math.abs(A.size),width:p?Math.abs(A.size):D.size};b&&(C.options=g||this.resolveDataElementOptions(y,t[y].active?"active":n));const S=C.options||t[y].options;Pp(C,S,T,c),Ip(C,S,h.ratio),this.updateElement(t[y],y,C,n)}}_getStacks(t,a){const{iScale:r}=this._cachedMeta,n=r.getMatchingVisibleMetas(this._type).filter(h=>h.controller.options.grouped),l=r.options.stacked,c=[],d=this._cachedMeta.controller.getParsed(a),f=d&&d[r.axis],p=h=>{const g=h._parsed.find(y=>y[r.axis]===f),b=g&&g[h.vScale.axis];if(ls(b)||isNaN(b))return!0};for(const h of n)if(!(a!==void 0&&p(h))&&((l===!1||c.indexOf(h.stack)===-1||l===void 0&&h.stack===void 0)&&c.push(h.stack),h.index===t))break;return c.length||c.push(void 0),c}_getStackCount(t){return this._getStacks(void 0,t).length}_getAxisCount(){return this._getAxis().length}getFirstScaleIdForIndexAxis(){const t=this.chart.scales,a=this.chart.options.indexAxis;return Object.keys(t).filter(r=>t[r].axis===a).shift()}_getAxis(){const t={},a=this.getFirstScaleIdForIndexAxis();for(const r of this.chart.data.datasets)t[Qa(this.chart.options.indexAxis==="x"?r.xAxisID:r.yAxisID,a)]=!0;return Object.keys(t)}_getStackIndex(t,a,r){const n=this._getStacks(t,r),l=a!==void 0?n.indexOf(a):-1;return l===-1?n.length-1:l}_getRuler(){const t=this.options,a=this._cachedMeta,r=a.iScale,n=[];let l,c;for(l=0,c=a.data.length;l<c;++l)n.push(r.getPixelForValue(this.getParsed(l)[r.axis],l));const d=t.barThickness;return{min:d||Tp(a),pixels:n,start:r._startPixel,end:r._endPixel,stackCount:this._getStackCount(),scale:r,grouped:t.grouped,ratio:d?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){const{_cachedMeta:{vScale:a,_stacked:r,index:n},options:{base:l,minBarLength:c}}=this,d=l||0,f=this.getParsed(t),p=f._custom,h=io(p);let g=f[a.axis],b=0,y=r?this.applyStack(a,f,r):g,k,A;y!==g&&(b=y-g,y=g),h&&(g=p.barStart,y=p.barEnd-p.barStart,g!==0&&jr(g)!==jr(p.barEnd)&&(b=0),b+=g);const D=!ls(l)&&!h?l:b;let T=a.getPixelForValue(D);if(this.chart.getDataVisibility(t)?k=a.getPixelForValue(b+y):k=T,A=k-T,Math.abs(A)<c){A=$p(A,a,d)*c,g===d&&(T-=A/2);const C=a.getPixelForDecimal(0),S=a.getPixelForDecimal(1),M=Math.min(C,S),F=Math.max(C,S);T=Math.max(Math.min(T,F),M),k=T+A,r&&!h&&(f._stacks[a.axis]._visualValues[n]=a.getValueForPixel(k)-a.getValueForPixel(T))}if(T===a.getPixelForValue(d)){const C=jr(A)*a.getLineWidthForValue(d)/2;T+=C,A-=C}return{size:A,base:T,head:k,center:k+A/2}}_calculateBarIndexPixels(t,a){const r=a.scale,n=this.options,l=n.skipNull,c=Qa(n.maxBarThickness,1/0);let d,f;const p=this._getAxisCount();if(a.grouped){const h=l?this._getStackCount(t):a.stackCount,g=n.barThickness==="flex"?Fp(t,a,n,h*p):Ep(t,a,n,h*p),b=this.chart.options.indexAxis==="x"?this.getDataset().xAxisID:this.getDataset().yAxisID,y=this._getAxis().indexOf(Qa(b,this.getFirstScaleIdForIndexAxis())),k=this._getStackIndex(this.index,this._cachedMeta.stack,l?t:void 0)+y;d=g.start+g.chunk*k+g.chunk/2,f=Math.min(c,g.chunk*g.ratio)}else d=r.getPixelForValue(this.getParsed(t)[r.axis],t),f=Math.min(c,a.min*a.ratio);return{base:d-f/2,head:d+f/2,center:d,size:f}}draw(){const t=this._cachedMeta,a=t.vScale,r=t.data,n=r.length;let l=0;for(;l<n;++l)this.getParsed(l)[a.axis]!==null&&!r[l].hidden&&r[l].draw(this._ctx)}}function Rp(s,t,a){let r=1,n=1,l=0,c=0;if(t<Ts){const d=s,f=d+t,p=Math.cos(d),h=Math.sin(d),g=Math.cos(f),b=Math.sin(f),y=(S,M,F)=>Fn(S,d,f,!0)?1:Math.max(M,M*a,F,F*a),k=(S,M,F)=>Fn(S,d,f,!0)?-1:Math.min(M,M*a,F,F*a),A=y(0,p,g),D=y(Ls,h,b),T=k(os,p,g),C=k(os+Ls,h,b);r=(A-T)/2,n=(D-C)/2,l=-(A+T)/2,c=-(D+C)/2}return{ratioX:r,ratioY:n,offsetX:l,offsetY:c}}class Op extends Io{static id="doughnut";static defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"};static descriptors={_scriptable:t=>t!=="spacing",_indexable:t=>t!=="spacing"&&!t.startsWith("borderDash")&&!t.startsWith("hoverBorderDash")};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const a=t.data,{labels:{pointStyle:r,textAlign:n,color:l,useBorderRadius:c,borderRadius:d}}=t.legend.options;return a.labels.length&&a.datasets.length?a.labels.map((f,p)=>{const g=t.getDatasetMeta(0).controller.getStyle(p);return{text:f,fillStyle:g.backgroundColor,fontColor:l,hidden:!t.getDataVisibility(p),lineDash:g.borderDash,lineDashOffset:g.borderDashOffset,lineJoin:g.borderJoinStyle,lineWidth:g.borderWidth,strokeStyle:g.borderColor,textAlign:n,pointStyle:r,borderRadius:c&&(d||g.borderRadius),index:p}}):[]}},onClick(t,a,r){r.chart.toggleDataVisibility(a.index),r.chart.update()}}}};constructor(t,a){super(t,a),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,a){const r=this.getDataset().data,n=this._cachedMeta;if(this._parsing===!1)n._parsed=r;else{let l=f=>+r[f];if(Ka(r[t])){const{key:f="value"}=this._parsing;l=p=>+Zr(r[p],f)}let c,d;for(c=t,d=t+a;c<d;++c)n._parsed[c]=l(c)}}_getRotation(){return Fr(this.options.rotation-90)}_getCircumference(){return Fr(this.options.circumference)}_getRotationExtents(){let t=Ts,a=-Ts;for(let r=0;r<this.chart.data.datasets.length;++r)if(this.chart.isDatasetVisible(r)&&this.chart.getDatasetMeta(r).type===this._type){const n=this.chart.getDatasetMeta(r).controller,l=n._getRotation(),c=n._getCircumference();t=Math.min(t,l),a=Math.max(a,l+c)}return{rotation:t,circumference:a-t}}update(t){const a=this.chart,{chartArea:r}=a,n=this._cachedMeta,l=n.data,c=this.getMaxBorderWidth()+this.getMaxOffset(l)+this.options.spacing,d=Math.max((Math.min(r.width,r.height)-c)/2,0),f=Math.min(df(this.options.cutout,d),1),p=this._getRingWeight(this.index),{circumference:h,rotation:g}=this._getRotationExtents(),{ratioX:b,ratioY:y,offsetX:k,offsetY:A}=Rp(g,h,f),D=(r.width-c)/b,T=(r.height-c)/y,C=Math.max(Math.min(D,T)/2,0),S=Oc(this.options.radius,C),M=Math.max(S*f,0),F=(S-M)/this._getVisibleDatasetWeightTotal();this.offsetX=k*S,this.offsetY=A*S,n.total=this.calculateTotal(),this.outerRadius=S-F*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-F*p,0),this.updateElements(l,0,l.length,t)}_circumference(t,a){const r=this.options,n=this._cachedMeta,l=this._getCircumference();return a&&r.animation.animateRotate||!this.chart.getDataVisibility(t)||n._parsed[t]===null||n.data[t].hidden?0:this.calculateCircumference(n._parsed[t]*l/Ts)}updateElements(t,a,r,n){const l=n==="reset",c=this.chart,d=c.chartArea,p=c.options.animation,h=(d.left+d.right)/2,g=(d.top+d.bottom)/2,b=l&&p.animateScale,y=b?0:this.innerRadius,k=b?0:this.outerRadius,{sharedOptions:A,includeOptions:D}=this._getSharedOptions(a,n);let T=this._getRotation(),C;for(C=0;C<a;++C)T+=this._circumference(C,l);for(C=a;C<a+r;++C){const S=this._circumference(C,l),M=t[C],F={x:h+this.offsetX,y:g+this.offsetY,startAngle:T,endAngle:T+S,circumference:S,outerRadius:k,innerRadius:y};D&&(F.options=A||this.resolveDataElementOptions(C,M.active?"active":n)),T+=S,this.updateElement(M,C,F,n)}}calculateTotal(){const t=this._cachedMeta,a=t.data;let r=0,n;for(n=0;n<a.length;n++){const l=t._parsed[n];l!==null&&!isNaN(l)&&this.chart.getDataVisibility(n)&&!a[n].hidden&&(r+=Math.abs(l))}return r}calculateCircumference(t){const a=this._cachedMeta.total;return a>0&&!isNaN(t)?Ts*(Math.abs(t)/a):0}getLabelAndValue(t){const a=this._cachedMeta,r=this.chart,n=r.data.labels||[],l=Co(a._parsed[t],r.options.locale);return{label:n[t]||"",value:l}}getMaxBorderWidth(t){let a=0;const r=this.chart;let n,l,c,d,f;if(!t){for(n=0,l=r.data.datasets.length;n<l;++n)if(r.isDatasetVisible(n)){c=r.getDatasetMeta(n),t=c.data,d=c.controller;break}}if(!t)return 0;for(n=0,l=t.length;n<l;++n)f=d.resolveDataElementOptions(n),f.borderAlign!=="inner"&&(a=Math.max(a,f.borderWidth||0,f.hoverBorderWidth||0));return a}getMaxOffset(t){let a=0;for(let r=0,n=t.length;r<n;++r){const l=this.resolveDataElementOptions(r);a=Math.max(a,l.offset||0,l.hoverOffset||0)}return a}_getRingWeightOffset(t){let a=0;for(let r=0;r<t;++r)this.chart.isDatasetVisible(r)&&(a+=this._getRingWeight(r));return a}_getRingWeight(t){return Math.max(Qa(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}function Ur(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class Ro{static override(t){Object.assign(Ro.prototype,t)}options;constructor(t){this.options=t||{}}init(){}formats(){return Ur()}parse(){return Ur()}format(){return Ur()}add(){return Ur()}diff(){return Ur()}startOf(){return Ur()}endOf(){return Ur()}}var jp={_date:Ro};function qp(s,t,a,r){const{controller:n,data:l,_sorted:c}=s,d=n._cachedMeta.iScale,f=s.dataset&&s.dataset.options?s.dataset.options.spanGaps:null;if(d&&t===d.axis&&t!=="r"&&c&&l.length){const p=d._reversePixels?kf:ho;if(r){if(n._sharedOptions){const h=l[0],g=typeof h.getRange=="function"&&h.getRange(t);if(g){const b=p(l,t,a-g),y=p(l,t,a+g);return{lo:b.lo,hi:y.hi}}}}else{const h=p(l,t,a);if(f){const{vScale:g}=n._cachedMeta,{_parsed:b}=s,y=b.slice(0,h.lo+1).reverse().findIndex(A=>!ls(A[g.axis]));h.lo-=Math.max(0,y);const k=b.slice(h.hi).findIndex(A=>!ls(A[g.axis]));h.hi+=Math.max(0,k)}return h}}return{lo:0,hi:l.length-1}}function On(s,t,a,r,n){const l=s.getSortedVisibleDatasetMetas(),c=a[t];for(let d=0,f=l.length;d<f;++d){const{index:p,data:h}=l[d],{lo:g,hi:b}=qp(l[d],t,c,n);for(let y=g;y<=b;++y){const k=h[y];k.skip||r(k,p,y)}}}function zp(s){const t=s.indexOf("x")!==-1,a=s.indexOf("y")!==-1;return function(r,n){const l=t?Math.abs(r.x-n.x):0,c=a?Math.abs(r.y-n.y):0;return Math.sqrt(Math.pow(l,2)+Math.pow(c,2))}}function no(s,t,a,r,n){const l=[];return!n&&!s.isPointInArea(t)||On(s,a,t,function(d,f,p){!n&&!Qc(d,s.chartArea,0)||d.inRange(t.x,t.y,r)&&l.push({element:d,datasetIndex:f,index:p})},!0),l}function Gp(s,t,a,r){let n=[];function l(c,d,f){const{startAngle:p,endAngle:h}=c.getProps(["startAngle","endAngle"],r),{angle:g}=zc(c,{x:t.x,y:t.y});Fn(g,p,h)&&n.push({element:c,datasetIndex:d,index:f})}return On(s,a,t,l),n}function Vp(s,t,a,r,n,l){let c=[];const d=zp(a);let f=Number.POSITIVE_INFINITY;function p(h,g,b){const y=h.inRange(t.x,t.y,n);if(r&&!y)return;const k=h.getCenterPoint(n);if(!(!!l||s.isPointInArea(k))&&!y)return;const D=d(t,k);D<f?(c=[{element:h,datasetIndex:g,index:b}],f=D):D===f&&c.push({element:h,datasetIndex:g,index:b})}return On(s,a,t,p),c}function oo(s,t,a,r,n,l){return!l&&!s.isPointInArea(t)?[]:a==="r"&&!r?Gp(s,t,a,n):Vp(s,t,a,r,n,l)}function Rl(s,t,a,r,n){const l=[],c=a==="x"?"inXRange":"inYRange";let d=!1;return On(s,a,t,(f,p,h)=>{f[c]&&f[c](t[a],n)&&(l.push({element:f,datasetIndex:p,index:h}),d=d||f.inRange(t.x,t.y,n))}),r&&!d?[]:l}var Bp={modes:{index(s,t,a,r){const n=Qr(t,s),l=a.axis||"x",c=a.includeInvisible||!1,d=a.intersect?no(s,n,l,r,c):oo(s,n,l,!1,r,c),f=[];return d.length?(s.getSortedVisibleDatasetMetas().forEach(p=>{const h=d[0].index,g=p.data[h];g&&!g.skip&&f.push({element:g,datasetIndex:p.index,index:h})}),f):[]},dataset(s,t,a,r){const n=Qr(t,s),l=a.axis||"xy",c=a.includeInvisible||!1;let d=a.intersect?no(s,n,l,r,c):oo(s,n,l,!1,r,c);if(d.length>0){const f=d[0].datasetIndex,p=s.getDatasetMeta(f).data;d=[];for(let h=0;h<p.length;++h)d.push({element:p[h],datasetIndex:f,index:h})}return d},point(s,t,a,r){const n=Qr(t,s),l=a.axis||"xy",c=a.includeInvisible||!1;return no(s,n,l,r,c)},nearest(s,t,a,r){const n=Qr(t,s),l=a.axis||"xy",c=a.includeInvisible||!1;return oo(s,n,l,a.intersect,r,c)},x(s,t,a,r){const n=Qr(t,s);return Rl(s,n,"x",a.intersect,r)},y(s,t,a,r){const n=Qr(t,s);return Rl(s,n,"y",a.intersect,r)}}};const nd=["left","top","right","bottom"];function Ci(s,t){return s.filter(a=>a.pos===t)}function Ol(s,t){return s.filter(a=>nd.indexOf(a.pos)===-1&&a.box.axis===t)}function Ti(s,t){return s.sort((a,r)=>{const n=t?r:a,l=t?a:r;return n.weight===l.weight?n.index-l.index:n.weight-l.weight})}function Wp(s){const t=[];let a,r,n,l,c,d;for(a=0,r=(s||[]).length;a<r;++a)n=s[a],{position:l,options:{stack:c,stackWeight:d=1}}=n,t.push({index:a,box:n,pos:l,horizontal:n.isHorizontal(),weight:n.weight,stack:c&&l+c,stackWeight:d});return t}function Hp(s){const t={};for(const a of s){const{stack:r,pos:n,stackWeight:l}=a;if(!r||!nd.includes(n))continue;const c=t[r]||(t[r]={count:0,placed:0,weight:0,size:0});c.count++,c.weight+=l}return t}function Up(s,t){const a=Hp(s),{vBoxMaxWidth:r,hBoxMaxHeight:n}=t;let l,c,d;for(l=0,c=s.length;l<c;++l){d=s[l];const{fullSize:f}=d.box,p=a[d.stack],h=p&&d.stackWeight/p.weight;d.horizontal?(d.width=h?h*r:f&&t.availableWidth,d.height=n):(d.width=r,d.height=h?h*n:f&&t.availableHeight)}return a}function Yp(s){const t=Wp(s),a=Ti(t.filter(p=>p.box.fullSize),!0),r=Ti(Ci(t,"left"),!0),n=Ti(Ci(t,"right")),l=Ti(Ci(t,"top"),!0),c=Ti(Ci(t,"bottom")),d=Ol(t,"x"),f=Ol(t,"y");return{fullSize:a,leftAndTop:r.concat(l),rightAndBottom:n.concat(f).concat(c).concat(d),chartArea:Ci(t,"chartArea"),vertical:r.concat(n).concat(f),horizontal:l.concat(c).concat(d)}}function jl(s,t,a,r){return Math.max(s[a],t[a])+Math.max(s[r],t[r])}function od(s,t){s.top=Math.max(s.top,t.top),s.left=Math.max(s.left,t.left),s.bottom=Math.max(s.bottom,t.bottom),s.right=Math.max(s.right,t.right)}function Qp(s,t,a,r){const{pos:n,box:l}=a,c=s.maxPadding;if(!Ka(n)){a.size&&(s[n]-=a.size);const g=r[a.stack]||{size:0,count:1};g.size=Math.max(g.size,a.horizontal?l.height:l.width),a.size=g.size/g.count,s[n]+=a.size}l.getPadding&&od(c,l.getPadding());const d=Math.max(0,t.outerWidth-jl(c,s,"left","right")),f=Math.max(0,t.outerHeight-jl(c,s,"top","bottom")),p=d!==s.w,h=f!==s.h;return s.w=d,s.h=f,a.horizontal?{same:p,other:h}:{same:h,other:p}}function Kp(s){const t=s.maxPadding;function a(r){const n=Math.max(t[r]-s[r],0);return s[r]+=n,n}s.y+=a("top"),s.x+=a("left"),a("right"),a("bottom")}function Jp(s,t){const a=t.maxPadding;function r(n){const l={left:0,top:0,right:0,bottom:0};return n.forEach(c=>{l[c]=Math.max(t[c],a[c])}),l}return r(s?["left","right"]:["top","bottom"])}function Mi(s,t,a,r){const n=[];let l,c,d,f,p,h;for(l=0,c=s.length,p=0;l<c;++l){d=s[l],f=d.box,f.update(d.width||t.w,d.height||t.h,Jp(d.horizontal,t));const{same:g,other:b}=Qp(t,a,d,r);p|=g&&n.length,h=h||b,f.fullSize||n.push(d)}return p&&Mi(n,t,a,r)||h}function fn(s,t,a,r,n){s.top=a,s.left=t,s.right=t+r,s.bottom=a+n,s.width=r,s.height=n}function ql(s,t,a,r){const n=a.padding;let{x:l,y:c}=t;for(const d of s){const f=d.box,p=r[d.stack]||{placed:0,weight:1},h=d.stackWeight/p.weight||1;if(d.horizontal){const g=t.w*h,b=p.size||f.height;Vi(p.start)&&(c=p.start),f.fullSize?fn(f,n.left,c,a.outerWidth-n.right-n.left,b):fn(f,t.left+p.placed,c,g,b),p.start=c,p.placed+=g,c=f.bottom}else{const g=t.h*h,b=p.size||f.width;Vi(p.start)&&(l=p.start),f.fullSize?fn(f,l,n.top,b,a.outerHeight-n.bottom-n.top):fn(f,l,t.top+p.placed,b,g),p.start=l,p.placed+=g,l=f.right}}t.x=l,t.y=c}var lr={addBox(s,t){s.boxes||(s.boxes=[]),t.fullSize=t.fullSize||!1,t.position=t.position||"top",t.weight=t.weight||0,t._layers=t._layers||function(){return[{z:0,draw(a){t.draw(a)}}]},s.boxes.push(t)},removeBox(s,t){const a=s.boxes?s.boxes.indexOf(t):-1;a!==-1&&s.boxes.splice(a,1)},configure(s,t,a){t.fullSize=a.fullSize,t.position=a.position,t.weight=a.weight},update(s,t,a,r){if(!s)return;const n=ur(s.options.layout.padding),l=Math.max(t-n.width,0),c=Math.max(a-n.height,0),d=Yp(s.boxes),f=d.vertical,p=d.horizontal;as(s.boxes,A=>{typeof A.beforeLayout=="function"&&A.beforeLayout()});const h=f.reduce((A,D)=>D.box.options&&D.box.options.display===!1?A:A+1,0)||1,g=Object.freeze({outerWidth:t,outerHeight:a,padding:n,availableWidth:l,availableHeight:c,vBoxMaxWidth:l/2/h,hBoxMaxHeight:c/2}),b=Object.assign({},n);od(b,ur(r));const y=Object.assign({maxPadding:b,w:l,h:c,x:n.left,y:n.top},n),k=Up(f.concat(p),g);Mi(d.fullSize,y,g,k),Mi(f,y,g,k),Mi(p,y,g,k)&&Mi(f,y,g,k),Kp(y),ql(d.leftAndTop,y,g,k),y.x+=y.w,y.y+=y.h,ql(d.rightAndBottom,y,g,k),s.chartArea={left:y.left,top:y.top,right:y.left+y.w,bottom:y.top+y.h,height:y.h,width:y.w},as(d.chartArea,A=>{const D=A.box;Object.assign(D,s.chartArea),D.update(y.w,y.h,{left:0,top:0,right:0,bottom:0})})}};class ld{acquireContext(t,a){}releaseContext(t){return!1}addEventListener(t,a,r){}removeEventListener(t,a,r){}getDevicePixelRatio(){return 1}getMaximumSize(t,a,r,n){return a=Math.max(0,a||t.width),r=r||t.height,{width:a,height:Math.max(0,n?Math.floor(a/n):r)}}isAttached(t){return!0}updateConfig(t){}}class Xp extends ld{acquireContext(t){return t&&t.getContext&&t.getContext("2d")||null}updateConfig(t){t.options.animation=!1}}const yn="$chartjs",Zp={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},zl=s=>s===null||s==="";function em(s,t){const a=s.style,r=s.getAttribute("height"),n=s.getAttribute("width");if(s[yn]={initial:{height:r,width:n,style:{display:a.display,height:a.height,width:a.width}}},a.display=a.display||"block",a.boxSizing=a.boxSizing||"border-box",zl(n)){const l=Cl(s,"width");l!==void 0&&(s.width=l)}if(zl(r))if(s.style.height==="")s.height=s.width/(t||2);else{const l=Cl(s,"height");l!==void 0&&(s.height=l)}return s}const cd=lp?{passive:!0}:!1;function tm(s,t,a){s&&s.addEventListener(t,a,cd)}function am(s,t,a){s&&s.canvas&&s.canvas.removeEventListener(t,a,cd)}function sm(s,t){const a=Zp[s.type]||s.type,{x:r,y:n}=Qr(s,t);return{type:a,chart:t,native:s,x:r!==void 0?r:null,y:n!==void 0?n:null}}function Ln(s,t){for(const a of s)if(a===t||a.contains(t))return!0}function rm(s,t,a){const r=s.canvas,n=new MutationObserver(l=>{let c=!1;for(const d of l)c=c||Ln(d.addedNodes,r),c=c&&!Ln(d.removedNodes,r);c&&a()});return n.observe(document,{childList:!0,subtree:!0}),n}function im(s,t,a){const r=s.canvas,n=new MutationObserver(l=>{let c=!1;for(const d of l)c=c||Ln(d.removedNodes,r),c=c&&!Ln(d.addedNodes,r);c&&a()});return n.observe(document,{childList:!0,subtree:!0}),n}const Wi=new Map;let Gl=0;function dd(){const s=window.devicePixelRatio;s!==Gl&&(Gl=s,Wi.forEach((t,a)=>{a.currentDevicePixelRatio!==s&&t()}))}function nm(s,t){Wi.size||window.addEventListener("resize",dd),Wi.set(s,t)}function om(s){Wi.delete(s),Wi.size||window.removeEventListener("resize",dd)}function lm(s,t,a){const r=s.canvas,n=r&&Mo(r);if(!n)return;const l=Wc((d,f)=>{const p=n.clientWidth;a(d,f),p<n.clientWidth&&a()},window),c=new ResizeObserver(d=>{const f=d[0],p=f.contentRect.width,h=f.contentRect.height;p===0&&h===0||l(p,h)});return c.observe(n),nm(s,l),c}function lo(s,t,a){a&&a.disconnect(),t==="resize"&&om(s)}function cm(s,t,a){const r=s.canvas,n=Wc(l=>{s.ctx!==null&&a(sm(l,s))},s);return tm(r,t,n),n}class dm extends ld{acquireContext(t,a){const r=t&&t.getContext&&t.getContext("2d");return r&&r.canvas===t?(em(t,a),r):null}releaseContext(t){const a=t.canvas;if(!a[yn])return!1;const r=a[yn].initial;["height","width"].forEach(l=>{const c=r[l];ls(c)?a.removeAttribute(l):a.setAttribute(l,c)});const n=r.style||{};return Object.keys(n).forEach(l=>{a.style[l]=n[l]}),a.width=a.width,delete a[yn],!0}addEventListener(t,a,r){this.removeEventListener(t,a);const n=t.$proxies||(t.$proxies={}),c={attach:rm,detach:im,resize:lm}[a]||cm;n[a]=c(t,a,r)}removeEventListener(t,a){const r=t.$proxies||(t.$proxies={}),n=r[a];if(!n)return;({attach:lo,detach:lo,resize:lo}[a]||am)(t,a,n),r[a]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(t,a,r,n){return op(t,a,r,n)}isAttached(t){const a=t&&Mo(t);return!!(a&&a.isConnected)}}function um(s){return!Po()||typeof OffscreenCanvas<"u"&&s instanceof OffscreenCanvas?Xp:dm}class ai{static defaults={};static defaultRoutes=void 0;x;y;active=!1;options;$animations;tooltipPosition(t){const{x:a,y:r}=this.getProps(["x","y"],t);return{x:a,y:r}}hasValue(){return En(this.x)&&En(this.y)}getProps(t,a){const r=this.$animations;if(!a||!r)return this;const n={};return t.forEach(l=>{n[l]=r[l]&&r[l].active()?r[l]._to:this[l]}),n}}function vm(s,t){const a=s.options.ticks,r=fm(s),n=Math.min(a.maxTicksLimit||r,r),l=a.major.enabled?mm(t):[],c=l.length,d=l[0],f=l[c-1],p=[];if(c>n)return hm(t,p,l,c/n),p;const h=pm(l,t,n);if(c>0){let g,b;const y=c>1?Math.round((f-d)/(c-1)):null;for(pn(t,p,h,ls(y)?0:d-y,d),g=0,b=c-1;g<b;g++)pn(t,p,h,l[g],l[g+1]);return pn(t,p,h,f,ls(y)?t.length:f+y),p}return pn(t,p,h),p}function fm(s){const t=s.options.offset,a=s._tickSize(),r=s._length/a+(t?0:1),n=s._maxLength/a;return Math.floor(Math.min(r,n))}function pm(s,t,a){const r=gm(s),n=t.length/a;if(!r)return Math.max(n,1);const l=gf(r);for(let c=0,d=l.length-1;c<d;c++){const f=l[c];if(f>n)return f}return Math.max(n,1)}function mm(s){const t=[];let a,r;for(a=0,r=s.length;a<r;a++)s[a].major&&t.push(a);return t}function hm(s,t,a,r){let n=0,l=a[0],c;for(r=Math.ceil(r),c=0;c<s.length;c++)c===l&&(t.push(s[c]),n++,l=a[n*r])}function pn(s,t,a,r,n){const l=Qa(r,0),c=Math.min(Qa(n,s.length),s.length);let d=0,f,p,h;for(a=Math.ceil(a),n&&(f=n-r,a=f/Math.floor(f/a)),h=l;h<0;)d++,h=Math.round(l+d*a);for(p=Math.max(l,0);p<c;p++)p===h&&(t.push(s[p]),d++,h=Math.round(l+d*a))}function gm(s){const t=s.length;let a,r;if(t<2)return!1;for(r=s[0],a=1;a<t;++a)if(s[a]-s[a-1]!==r)return!1;return r}const _m=s=>s==="left"?"right":s==="right"?"left":s,Vl=(s,t,a)=>t==="top"||t==="left"?s[t]+a:s[t]-a,Bl=(s,t)=>Math.min(t||s,s);function Wl(s,t){const a=[],r=s.length/t,n=s.length;let l=0;for(;l<n;l+=r)a.push(s[Math.floor(l)]);return a}function bm(s,t,a){const r=s.ticks.length,n=Math.min(t,r-1),l=s._startPixel,c=s._endPixel,d=1e-6;let f=s.getPixelForTick(n),p;if(!(a&&(r===1?p=Math.max(f-l,c-f):t===0?p=(s.getPixelForTick(1)-f)/2:p=(f-s.getPixelForTick(n-1))/2,f+=n<t?p:-p,f<l-d||f>c+d)))return f}function ym(s,t){as(s,a=>{const r=a.gc,n=r.length/2;let l;if(n>t){for(l=0;l<n;++l)delete a.data[r[l]];r.splice(0,n)}})}function Ei(s){return s.drawTicks?s.tickLength:0}function Hl(s,t){if(!s.display)return 0;const a=Bs(s.font,t),r=ur(s.padding);return($s(s.text)?s.text.length:1)*a.lineHeight+r.height}function wm(s,t){return mi(s,{scale:t,type:"scale"})}function xm(s,t,a){return mi(s,{tick:a,index:t,type:"tick"})}function Sm(s,t,a){let r=Do(s);return(a&&t!=="right"||!a&&t==="right")&&(r=_m(r)),r}function km(s,t,a,r){const{top:n,left:l,bottom:c,right:d,chart:f}=s,{chartArea:p,scales:h}=f;let g=0,b,y,k;const A=c-n,D=d-l;if(s.isHorizontal()){if(y=Vs(r,l,d),Ka(a)){const T=Object.keys(a)[0],C=a[T];k=h[T].getPixelForValue(C)+A-t}else a==="center"?k=(p.bottom+p.top)/2+A-t:k=Vl(s,a,t);b=d-l}else{if(Ka(a)){const T=Object.keys(a)[0],C=a[T];y=h[T].getPixelForValue(C)-D+t}else a==="center"?y=(p.left+p.right)/2-D+t:y=Vl(s,a,t);k=Vs(r,c,n),g=a==="left"?-Ls:Ls}return{titleX:y,titleY:k,maxWidth:b,rotation:g}}class hi extends ai{constructor(t){super(),this.id=t.id,this.type=t.type,this.options=void 0,this.ctx=t.ctx,this.chart=t.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}parse(t,a){return t}getUserBounds(){let{_userMin:t,_userMax:a,_suggestedMin:r,_suggestedMax:n}=this;return t=hr(t,Number.POSITIVE_INFINITY),a=hr(a,Number.NEGATIVE_INFINITY),r=hr(r,Number.POSITIVE_INFINITY),n=hr(n,Number.NEGATIVE_INFINITY),{min:hr(t,r),max:hr(a,n),minDefined:dr(t),maxDefined:dr(a)}}getMinMax(t){let{min:a,max:r,minDefined:n,maxDefined:l}=this.getUserBounds(),c;if(n&&l)return{min:a,max:r};const d=this.getMatchingVisibleMetas();for(let f=0,p=d.length;f<p;++f)c=d[f].controller.getMinMax(this,t),n||(a=Math.min(a,c.min)),l||(r=Math.max(r,c.max));return a=l&&a>r?r:a,r=n&&a>r?a:r,{min:hr(a,hr(r,a)),max:hr(r,hr(a,r))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}getLabelItems(t=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(t))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){ps(this.options.beforeUpdate,[this])}update(t,a,r){const{beginAtZero:n,grace:l,ticks:c}=this.options,d=c.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=a,this._margins=r=Object.assign({left:0,right:0,top:0,bottom:0},r),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+r.left+r.right:this.height+r.top+r.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=Hf(this,l,n),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const f=d<this.ticks.length;this._convertTicksToLabels(f?Wl(this.ticks,d):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),c.display&&(c.autoSkip||c.source==="auto")&&(this.ticks=vm(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),f&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t=this.options.reverse,a,r;this.isHorizontal()?(a=this.left,r=this.right):(a=this.top,r=this.bottom,t=!t),this._startPixel=a,this._endPixel=r,this._reversePixels=t,this._length=r-a,this._alignToPixels=this.options.alignToPixels}afterUpdate(){ps(this.options.afterUpdate,[this])}beforeSetDimensions(){ps(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){ps(this.options.afterSetDimensions,[this])}_callHooks(t){this.chart.notifyPlugins(t,this.getContext()),ps(this.options[t],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){ps(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(t){const a=this.options.ticks;let r,n,l;for(r=0,n=t.length;r<n;r++)l=t[r],l.label=ps(a.callback,[l.value,r,t],this)}afterTickToLabelConversion(){ps(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){ps(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const t=this.options,a=t.ticks,r=Bl(this.ticks.length,t.ticks.maxTicksLimit),n=a.minRotation||0,l=a.maxRotation;let c=n,d,f,p;if(!this._isVisible()||!a.display||n>=l||r<=1||!this.isHorizontal()){this.labelRotation=n;return}const h=this._getLabelSizes(),g=h.widest.width,b=h.highest.height,y=Js(this.chart.width-g,0,this.maxWidth);d=t.offset?this.maxWidth/r:y/(r-1),g+6>d&&(d=y/(r-(t.offset?.5:1)),f=this.maxHeight-Ei(t.grid)-a.padding-Hl(t.title,this.chart.options.font),p=Math.sqrt(g*g+b*b),c=wf(Math.min(Math.asin(Js((h.highest.height+6)/d,-1,1)),Math.asin(Js(f/p,-1,1))-Math.asin(Js(b/p,-1,1)))),c=Math.max(n,Math.min(l,c))),this.labelRotation=c}afterCalculateLabelRotation(){ps(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){ps(this.options.beforeFit,[this])}fit(){const t={width:0,height:0},{chart:a,options:{ticks:r,title:n,grid:l}}=this,c=this._isVisible(),d=this.isHorizontal();if(c){const f=Hl(n,a.options.font);if(d?(t.width=this.maxWidth,t.height=Ei(l)+f):(t.height=this.maxHeight,t.width=Ei(l)+f),r.display&&this.ticks.length){const{first:p,last:h,widest:g,highest:b}=this._getLabelSizes(),y=r.padding*2,k=Fr(this.labelRotation),A=Math.cos(k),D=Math.sin(k);if(d){const T=r.mirror?0:D*g.width+A*b.height;t.height=Math.min(this.maxHeight,t.height+T+y)}else{const T=r.mirror?0:A*g.width+D*b.height;t.width=Math.min(this.maxWidth,t.width+T+y)}this._calculatePadding(p,h,D,A)}}this._handleMargins(),d?(this.width=this._length=a.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=a.height-this._margins.top-this._margins.bottom)}_calculatePadding(t,a,r,n){const{ticks:{align:l,padding:c},position:d}=this.options,f=this.labelRotation!==0,p=d!=="top"&&this.axis==="x";if(this.isHorizontal()){const h=this.getPixelForTick(0)-this.left,g=this.right-this.getPixelForTick(this.ticks.length-1);let b=0,y=0;f?p?(b=n*t.width,y=r*a.height):(b=r*t.height,y=n*a.width):l==="start"?y=a.width:l==="end"?b=t.width:l!=="inner"&&(b=t.width/2,y=a.width/2),this.paddingLeft=Math.max((b-h+c)*this.width/(this.width-h),0),this.paddingRight=Math.max((y-g+c)*this.width/(this.width-g),0)}else{let h=a.height/2,g=t.height/2;l==="start"?(h=0,g=t.height):l==="end"&&(h=a.height,g=0),this.paddingTop=h+c,this.paddingBottom=g+c}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){ps(this.options.afterFit,[this])}isHorizontal(){const{axis:t,position:a}=this.options;return a==="top"||a==="bottom"||t==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(t){this.beforeTickToLabelConversion(),this.generateTickLabels(t);let a,r;for(a=0,r=t.length;a<r;a++)ls(t[a].label)&&(t.splice(a,1),r--,a--);this.afterTickToLabelConversion()}_getLabelSizes(){let t=this._labelSizes;if(!t){const a=this.options.ticks.sampleSize;let r=this.ticks;a<r.length&&(r=Wl(r,a)),this._labelSizes=t=this._computeLabelSizes(r,r.length,this.options.ticks.maxTicksLimit)}return t}_computeLabelSizes(t,a,r){const{ctx:n,_longestTextCache:l}=this,c=[],d=[],f=Math.floor(a/Bl(a,r));let p=0,h=0,g,b,y,k,A,D,T,C,S,M,F;for(g=0;g<a;g+=f){if(k=t[g].label,A=this._resolveTickFontOptions(g),n.font=D=A.string,T=l[D]=l[D]||{data:{},gc:[]},C=A.lineHeight,S=M=0,!ls(k)&&!$s(k))S=wl(n,T.data,T.gc,S,k),M=C;else if($s(k))for(b=0,y=k.length;b<y;++b)F=k[b],!ls(F)&&!$s(F)&&(S=wl(n,T.data,T.gc,S,F),M+=C);c.push(S),d.push(M),p=Math.max(S,p),h=Math.max(M,h)}ym(l,a);const j=c.indexOf(p),P=d.indexOf(h),Y=W=>({width:c[W]||0,height:d[W]||0});return{first:Y(0),last:Y(a-1),widest:Y(j),highest:Y(P),widths:c,heights:d}}getLabelForValue(t){return t}getPixelForValue(t,a){return NaN}getValueForPixel(t){}getPixelForTick(t){const a=this.ticks;return t<0||t>a.length-1?null:this.getPixelForValue(a[t].value)}getPixelForDecimal(t){this._reversePixels&&(t=1-t);const a=this._startPixel+t*this._length;return Sf(this._alignToPixels?Hr(this.chart,a,0):a)}getDecimalForPixel(t){const a=(t-this._startPixel)/this._length;return this._reversePixels?1-a:a}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:t,max:a}=this;return t<0&&a<0?a:t>0&&a>0?t:0}getContext(t){const a=this.ticks||[];if(t>=0&&t<a.length){const r=a[t];return r.$context||(r.$context=xm(this.getContext(),t,r))}return this.$context||(this.$context=wm(this.chart.getContext(),this))}_tickSize(){const t=this.options.ticks,a=Fr(this.labelRotation),r=Math.abs(Math.cos(a)),n=Math.abs(Math.sin(a)),l=this._getLabelSizes(),c=t.autoSkipPadding||0,d=l?l.widest.width+c:0,f=l?l.highest.height+c:0;return this.isHorizontal()?f*r>d*n?d/r:f/n:f*n<d*r?f/r:d/n}_isVisible(){const t=this.options.display;return t!=="auto"?!!t:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(t){const a=this.axis,r=this.chart,n=this.options,{grid:l,position:c,border:d}=n,f=l.offset,p=this.isHorizontal(),g=this.ticks.length+(f?1:0),b=Ei(l),y=[],k=d.setContext(this.getContext()),A=k.display?k.width:0,D=A/2,T=function(he){return Hr(r,he,A)};let C,S,M,F,j,P,Y,W,N,L,X,ae;if(c==="top")C=T(this.bottom),P=this.bottom-b,W=C-D,L=T(t.top)+D,ae=t.bottom;else if(c==="bottom")C=T(this.top),L=t.top,ae=T(t.bottom)-D,P=C+D,W=this.top+b;else if(c==="left")C=T(this.right),j=this.right-b,Y=C-D,N=T(t.left)+D,X=t.right;else if(c==="right")C=T(this.left),N=t.left,X=T(t.right)-D,j=C+D,Y=this.left+b;else if(a==="x"){if(c==="center")C=T((t.top+t.bottom)/2+.5);else if(Ka(c)){const he=Object.keys(c)[0],Ge=c[he];C=T(this.chart.scales[he].getPixelForValue(Ge))}L=t.top,ae=t.bottom,P=C+D,W=P+b}else if(a==="y"){if(c==="center")C=T((t.left+t.right)/2);else if(Ka(c)){const he=Object.keys(c)[0],Ge=c[he];C=T(this.chart.scales[he].getPixelForValue(Ge))}j=C-D,Y=j-b,N=t.left,X=t.right}const V=Qa(n.ticks.maxTicksLimit,g),ie=Math.max(1,Math.ceil(g/V));for(S=0;S<g;S+=ie){const he=this.getContext(S),Ge=l.setContext(he),ce=d.setContext(he),se=Ge.lineWidth,Re=Ge.color,Je=ce.dash||[],it=ce.dashOffset,Le=Ge.tickWidth,ke=Ge.tickColor,Ke=Ge.tickBorderDash||[],lt=Ge.tickBorderDashOffset;M=bm(this,S,f),M!==void 0&&(F=Hr(r,M,se),p?j=Y=N=X=F:P=W=L=ae=F,y.push({tx1:j,ty1:P,tx2:Y,ty2:W,x1:N,y1:L,x2:X,y2:ae,width:se,color:Re,borderDash:Je,borderDashOffset:it,tickWidth:Le,tickColor:ke,tickBorderDash:Ke,tickBorderDashOffset:lt}))}return this._ticksLength=g,this._borderValue=C,y}_computeLabelItems(t){const a=this.axis,r=this.options,{position:n,ticks:l}=r,c=this.isHorizontal(),d=this.ticks,{align:f,crossAlign:p,padding:h,mirror:g}=l,b=Ei(r.grid),y=b+h,k=g?-h:y,A=-Fr(this.labelRotation),D=[];let T,C,S,M,F,j,P,Y,W,N,L,X,ae="middle";if(n==="top")j=this.bottom-k,P=this._getXAxisLabelAlignment();else if(n==="bottom")j=this.top+k,P=this._getXAxisLabelAlignment();else if(n==="left"){const ie=this._getYAxisLabelAlignment(b);P=ie.textAlign,F=ie.x}else if(n==="right"){const ie=this._getYAxisLabelAlignment(b);P=ie.textAlign,F=ie.x}else if(a==="x"){if(n==="center")j=(t.top+t.bottom)/2+y;else if(Ka(n)){const ie=Object.keys(n)[0],he=n[ie];j=this.chart.scales[ie].getPixelForValue(he)+y}P=this._getXAxisLabelAlignment()}else if(a==="y"){if(n==="center")F=(t.left+t.right)/2-y;else if(Ka(n)){const ie=Object.keys(n)[0],he=n[ie];F=this.chart.scales[ie].getPixelForValue(he)}P=this._getYAxisLabelAlignment(b).textAlign}a==="y"&&(f==="start"?ae="top":f==="end"&&(ae="bottom"));const V=this._getLabelSizes();for(T=0,C=d.length;T<C;++T){S=d[T],M=S.label;const ie=l.setContext(this.getContext(T));Y=this.getPixelForTick(T)+l.labelOffset,W=this._resolveTickFontOptions(T),N=W.lineHeight,L=$s(M)?M.length:1;const he=L/2,Ge=ie.color,ce=ie.textStrokeColor,se=ie.textStrokeWidth;let Re=P;c?(F=Y,P==="inner"&&(T===C-1?Re=this.options.reverse?"left":"right":T===0?Re=this.options.reverse?"right":"left":Re="center"),n==="top"?p==="near"||A!==0?X=-L*N+N/2:p==="center"?X=-V.highest.height/2-he*N+N:X=-V.highest.height+N/2:p==="near"||A!==0?X=N/2:p==="center"?X=V.highest.height/2-he*N:X=V.highest.height-L*N,g&&(X*=-1),A!==0&&!ie.showLabelBackdrop&&(F+=N/2*Math.sin(A))):(j=Y,X=(1-L)*N/2);let Je;if(ie.showLabelBackdrop){const it=ur(ie.backdropPadding),Le=V.heights[T],ke=V.widths[T];let Ke=X-it.top,lt=0-it.left;switch(ae){case"middle":Ke-=Le/2;break;case"bottom":Ke-=Le;break}switch(P){case"center":lt-=ke/2;break;case"right":lt-=ke;break;case"inner":T===C-1?lt-=ke:T>0&&(lt-=ke/2);break}Je={left:lt,top:Ke,width:ke+it.width,height:Le+it.height,color:ie.backdropColor}}D.push({label:M,font:W,textOffset:X,options:{rotation:A,color:Ge,strokeColor:ce,strokeWidth:se,textAlign:Re,textBaseline:ae,translation:[F,j],backdrop:Je}})}return D}_getXAxisLabelAlignment(){const{position:t,ticks:a}=this.options;if(-Fr(this.labelRotation))return t==="top"?"left":"right";let n="center";return a.align==="start"?n="left":a.align==="end"?n="right":a.align==="inner"&&(n="inner"),n}_getYAxisLabelAlignment(t){const{position:a,ticks:{crossAlign:r,mirror:n,padding:l}}=this.options,c=this._getLabelSizes(),d=t+l,f=c.widest.width;let p,h;return a==="left"?n?(h=this.right+l,r==="near"?p="left":r==="center"?(p="center",h+=f/2):(p="right",h+=f)):(h=this.right-d,r==="near"?p="right":r==="center"?(p="center",h-=f/2):(p="left",h=this.left)):a==="right"?n?(h=this.left+l,r==="near"?p="right":r==="center"?(p="center",h-=f/2):(p="left",h-=f)):(h=this.left+d,r==="near"?p="left":r==="center"?(p="center",h+=f/2):(p="right",h=this.right)):p="right",{textAlign:p,x:h}}_computeLabelArea(){if(this.options.ticks.mirror)return;const t=this.chart,a=this.options.position;if(a==="left"||a==="right")return{top:0,left:this.left,bottom:t.height,right:this.right};if(a==="top"||a==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:t.width}}drawBackground(){const{ctx:t,options:{backgroundColor:a},left:r,top:n,width:l,height:c}=this;a&&(t.save(),t.fillStyle=a,t.fillRect(r,n,l,c),t.restore())}getLineWidthForValue(t){const a=this.options.grid;if(!this._isVisible()||!a.display)return 0;const n=this.ticks.findIndex(l=>l.value===t);return n>=0?a.setContext(this.getContext(n)).lineWidth:0}drawGrid(t){const a=this.options.grid,r=this.ctx,n=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t));let l,c;const d=(f,p,h)=>{!h.width||!h.color||(r.save(),r.lineWidth=h.width,r.strokeStyle=h.color,r.setLineDash(h.borderDash||[]),r.lineDashOffset=h.borderDashOffset,r.beginPath(),r.moveTo(f.x,f.y),r.lineTo(p.x,p.y),r.stroke(),r.restore())};if(a.display)for(l=0,c=n.length;l<c;++l){const f=n[l];a.drawOnChartArea&&d({x:f.x1,y:f.y1},{x:f.x2,y:f.y2},f),a.drawTicks&&d({x:f.tx1,y:f.ty1},{x:f.tx2,y:f.ty2},{color:f.tickColor,width:f.tickWidth,borderDash:f.tickBorderDash,borderDashOffset:f.tickBorderDashOffset})}}drawBorder(){const{chart:t,ctx:a,options:{border:r,grid:n}}=this,l=r.setContext(this.getContext()),c=r.display?l.width:0;if(!c)return;const d=n.setContext(this.getContext(0)).lineWidth,f=this._borderValue;let p,h,g,b;this.isHorizontal()?(p=Hr(t,this.left,c)-c/2,h=Hr(t,this.right,d)+d/2,g=b=f):(g=Hr(t,this.top,c)-c/2,b=Hr(t,this.bottom,d)+d/2,p=h=f),a.save(),a.lineWidth=l.width,a.strokeStyle=l.color,a.beginPath(),a.moveTo(p,g),a.lineTo(h,b),a.stroke(),a.restore()}drawLabels(t){if(!this.options.ticks.display)return;const r=this.ctx,n=this._computeLabelArea();n&&To(r,n);const l=this.getLabelItems(t);for(const c of l){const d=c.options,f=c.font,p=c.label,h=c.textOffset;Bi(r,p,0,h,f,d)}n&&Eo(r)}drawTitle(){const{ctx:t,options:{position:a,title:r,reverse:n}}=this;if(!r.display)return;const l=Bs(r.font),c=ur(r.padding),d=r.align;let f=l.lineHeight/2;a==="bottom"||a==="center"||Ka(a)?(f+=c.bottom,$s(r.text)&&(f+=l.lineHeight*(r.text.length-1))):f+=c.top;const{titleX:p,titleY:h,maxWidth:g,rotation:b}=km(this,f,a,d);Bi(t,r.text,0,0,l,{color:r.color,maxWidth:g,rotation:b,textAlign:Sm(d,a,n),textBaseline:"middle",translation:[p,h]})}draw(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}_layers(){const t=this.options,a=t.ticks&&t.ticks.z||0,r=Qa(t.grid&&t.grid.z,-1),n=Qa(t.border&&t.border.z,0);return!this._isVisible()||this.draw!==hi.prototype.draw?[{z:a,draw:l=>{this.draw(l)}}]:[{z:r,draw:l=>{this.drawBackground(),this.drawGrid(l),this.drawTitle()}},{z:n,draw:()=>{this.drawBorder()}},{z:a,draw:l=>{this.drawLabels(l)}}]}getMatchingVisibleMetas(t){const a=this.chart.getSortedVisibleDatasetMetas(),r=this.axis+"AxisID",n=[];let l,c;for(l=0,c=a.length;l<c;++l){const d=a[l];d[r]===this.id&&(!t||d.type===t)&&n.push(d)}return n}_resolveTickFontOptions(t){const a=this.options.ticks.setContext(this.getContext(t));return Bs(a.font)}_maxDigits(){const t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}}class mn{constructor(t,a,r){this.type=t,this.scope=a,this.override=r,this.items=Object.create(null)}isForType(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}register(t){const a=Object.getPrototypeOf(t);let r;Cm(a)&&(r=this.register(a));const n=this.items,l=t.id,c=this.scope+"."+l;if(!l)throw new Error("class does not have id: "+t);return l in n||(n[l]=t,Am(t,c,r),this.override&&ks.override(t.id,t.overrides)),c}get(t){return this.items[t]}unregister(t){const a=this.items,r=t.id,n=this.scope;r in a&&delete a[r],n&&r in ks[n]&&(delete ks[n][r],this.override&&delete ei[r])}}function Am(s,t,a){const r=Gi(Object.create(null),[a?ks.get(a):{},ks.get(t),s.defaults]);ks.set(t,r),s.defaultRoutes&&Dm(t,s.defaultRoutes),s.descriptors&&ks.describe(t,s.descriptors)}function Dm(s,t){Object.keys(t).forEach(a=>{const r=a.split("."),n=r.pop(),l=[s].concat(r).join("."),c=t[a].split("."),d=c.pop(),f=c.join(".");ks.route(l,n,f,d)})}function Cm(s){return"id"in s&&"defaults"in s}class Tm{constructor(){this.controllers=new mn(Io,"datasets",!0),this.elements=new mn(ai,"elements"),this.plugins=new mn(Object,"plugins"),this.scales=new mn(hi,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...t){this._each("register",t)}remove(...t){this._each("unregister",t)}addControllers(...t){this._each("register",t,this.controllers)}addElements(...t){this._each("register",t,this.elements)}addPlugins(...t){this._each("register",t,this.plugins)}addScales(...t){this._each("register",t,this.scales)}getController(t){return this._get(t,this.controllers,"controller")}getElement(t){return this._get(t,this.elements,"element")}getPlugin(t){return this._get(t,this.plugins,"plugin")}getScale(t){return this._get(t,this.scales,"scale")}removeControllers(...t){this._each("unregister",t,this.controllers)}removeElements(...t){this._each("unregister",t,this.elements)}removePlugins(...t){this._each("unregister",t,this.plugins)}removeScales(...t){this._each("unregister",t,this.scales)}_each(t,a,r){[...a].forEach(n=>{const l=r||this._getRegistryForType(n);r||l.isForType(n)||l===this.plugins&&n.id?this._exec(t,l,n):as(n,c=>{const d=r||this._getRegistryForType(c);this._exec(t,d,c)})})}_exec(t,a,r){const n=ko(t);ps(r["before"+n],[],r),a[t](r),ps(r["after"+n],[],r)}_getRegistryForType(t){for(let a=0;a<this._typedRegistries.length;a++){const r=this._typedRegistries[a];if(r.isForType(t))return r}return this.plugins}_get(t,a,r){const n=a.get(t);if(n===void 0)throw new Error('"'+t+'" is not a registered '+r+".");return n}}var Sr=new Tm;class Em{constructor(){this._init=void 0}notify(t,a,r,n){if(a==="beforeInit"&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install")),this._init===void 0)return;const l=n?this._descriptors(t).filter(n):this._descriptors(t),c=this._notify(l,t,a,r);return a==="afterDestroy"&&(this._notify(l,t,"stop"),this._notify(this._init,t,"uninstall"),this._init=void 0),c}_notify(t,a,r,n){n=n||{};for(const l of t){const c=l.plugin,d=c[r],f=[a,n,l.options];if(ps(d,f,c)===!1&&n.cancelable)return!1}return!0}invalidate(){ls(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(t){if(this._cache)return this._cache;const a=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),a}_createDescriptors(t,a){const r=t&&t.config,n=Qa(r.options&&r.options.plugins,{}),l=Fm(r);return n===!1&&!a?[]:$m(t,l,n,a)}_notifyStateChanges(t){const a=this._oldCache||[],r=this._cache,n=(l,c)=>l.filter(d=>!c.some(f=>d.plugin.id===f.plugin.id));this._notify(n(a,r),t,"stop"),this._notify(n(r,a),t,"start")}}function Fm(s){const t={},a=[],r=Object.keys(Sr.plugins.items);for(let l=0;l<r.length;l++)a.push(Sr.getPlugin(r[l]));const n=s.plugins||[];for(let l=0;l<n.length;l++){const c=n[l];a.indexOf(c)===-1&&(a.push(c),t[c.id]=!0)}return{plugins:a,localIds:t}}function Nm(s,t){return!t&&s===!1?null:s===!0?{}:s}function $m(s,{plugins:t,localIds:a},r,n){const l=[],c=s.getContext();for(const d of t){const f=d.id,p=Nm(r[f],n);p!==null&&l.push({plugin:d,options:Lm(s.config,{plugin:d,local:a[f]},p,c)})}return l}function Lm(s,{plugin:t,local:a},r,n){const l=s.pluginScopeKeys(t),c=s.getOptionScopes(r,l);return a&&t.defaults&&c.push(t.defaults),s.createResolver(c,n,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function _o(s,t){const a=ks.datasets[s]||{};return((t.datasets||{})[s]||{}).indexAxis||t.indexAxis||a.indexAxis||"x"}function Pm(s,t){let a=s;return s==="_index_"?a=t:s==="_value_"&&(a=t==="x"?"y":"x"),a}function Mm(s,t){return s===t?"_index_":"_value_"}function Ul(s){if(s==="x"||s==="y"||s==="r")return s}function Im(s){if(s==="top"||s==="bottom")return"x";if(s==="left"||s==="right")return"y"}function bo(s,...t){if(Ul(s))return s;for(const a of t){const r=a.axis||Im(a.position)||s.length>1&&Ul(s[0].toLowerCase());if(r)return r}throw new Error(`Cannot determine type of '${s}' axis. Please provide 'axis' or 'position' option.`)}function Yl(s,t,a){if(a[t+"AxisID"]===s)return{axis:t}}function Rm(s,t){if(t.data&&t.data.datasets){const a=t.data.datasets.filter(r=>r.xAxisID===s||r.yAxisID===s);if(a.length)return Yl(s,"x",a[0])||Yl(s,"y",a[0])}return{}}function Om(s,t){const a=ei[s.type]||{scales:{}},r=t.scales||{},n=_o(s.type,t),l=Object.create(null);return Object.keys(r).forEach(c=>{const d=r[c];if(!Ka(d))return console.error(`Invalid scale configuration for scale: ${c}`);if(d._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${c}`);const f=bo(c,d,Rm(c,s),ks.scales[d.type]),p=Mm(f,n),h=a.scales||{};l[c]=Oi(Object.create(null),[{axis:f},d,h[f],h[p]])}),s.data.datasets.forEach(c=>{const d=c.type||s.type,f=c.indexAxis||_o(d,t),h=(ei[d]||{}).scales||{};Object.keys(h).forEach(g=>{const b=Pm(g,f),y=c[b+"AxisID"]||b;l[y]=l[y]||Object.create(null),Oi(l[y],[{axis:b},r[y],h[g]])})}),Object.keys(l).forEach(c=>{const d=l[c];Oi(d,[ks.scales[d.type],ks.scale])}),l}function ud(s){const t=s.options||(s.options={});t.plugins=Qa(t.plugins,{}),t.scales=Om(s,t)}function vd(s){return s=s||{},s.datasets=s.datasets||[],s.labels=s.labels||[],s}function jm(s){return s=s||{},s.data=vd(s.data),ud(s),s}const Ql=new Map,fd=new Set;function hn(s,t){let a=Ql.get(s);return a||(a=t(),Ql.set(s,a),fd.add(a)),a}const Fi=(s,t,a)=>{const r=Zr(t,a);r!==void 0&&s.add(r)};class qm{constructor(t){this._config=jm(t),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(t){this._config.type=t}get data(){return this._config.data}set data(t){this._config.data=vd(t)}get options(){return this._config.options}set options(t){this._config.options=t}get plugins(){return this._config.plugins}update(){const t=this._config;this.clearCache(),ud(t)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(t){return hn(t,()=>[[`datasets.${t}`,""]])}datasetAnimationScopeKeys(t,a){return hn(`${t}.transition.${a}`,()=>[[`datasets.${t}.transitions.${a}`,`transitions.${a}`],[`datasets.${t}`,""]])}datasetElementScopeKeys(t,a){return hn(`${t}-${a}`,()=>[[`datasets.${t}.elements.${a}`,`datasets.${t}`,`elements.${a}`,""]])}pluginScopeKeys(t){const a=t.id,r=this.type;return hn(`${r}-plugin-${a}`,()=>[[`plugins.${a}`,...t.additionalOptionScopes||[]]])}_cachedScopes(t,a){const r=this._scopeCache;let n=r.get(t);return(!n||a)&&(n=new Map,r.set(t,n)),n}getOptionScopes(t,a,r){const{options:n,type:l}=this,c=this._cachedScopes(t,r),d=c.get(a);if(d)return d;const f=new Set;a.forEach(h=>{t&&(f.add(t),h.forEach(g=>Fi(f,t,g))),h.forEach(g=>Fi(f,n,g)),h.forEach(g=>Fi(f,ei[l]||{},g)),h.forEach(g=>Fi(f,ks,g)),h.forEach(g=>Fi(f,go,g))});const p=Array.from(f);return p.length===0&&p.push(Object.create(null)),fd.has(a)&&c.set(a,p),p}chartOptionScopes(){const{options:t,type:a}=this;return[t,ei[a]||{},ks.datasets[a]||{},{type:a},ks,go]}resolveNamedOptions(t,a,r,n=[""]){const l={$shared:!0},{resolver:c,subPrefixes:d}=Kl(this._resolverCache,t,n);let f=c;if(Gm(c,a)){l.$shared=!1,r=zr(r)?r():r;const p=this.createResolver(t,r,d);f=pi(c,r,p)}for(const p of a)l[p]=f[p];return l}createResolver(t,a,r=[""],n){const{resolver:l}=Kl(this._resolverCache,t,r);return Ka(a)?pi(l,a,void 0,n):l}}function Kl(s,t,a){let r=s.get(t);r||(r=new Map,s.set(t,r));const n=a.join();let l=r.get(n);return l||(l={resolver:No(t,a),subPrefixes:a.filter(d=>!d.toLowerCase().includes("hover"))},r.set(n,l)),l}const zm=s=>Ka(s)&&Object.getOwnPropertyNames(s).some(t=>zr(s[t]));function Gm(s,t){const{isScriptable:a,isIndexable:r}=Jc(s);for(const n of t){const l=a(n),c=r(n),d=(c||l)&&s[n];if(l&&(zr(d)||zm(d))||c&&$s(d))return!0}return!1}var Vm="4.5.1";const Bm=["top","bottom","left","right","chartArea"];function Jl(s,t){return s==="top"||s==="bottom"||Bm.indexOf(s)===-1&&t==="x"}function Xl(s,t){return function(a,r){return a[s]===r[s]?a[t]-r[t]:a[s]-r[s]}}function Zl(s){const t=s.chart,a=t.options.animation;t.notifyPlugins("afterRender"),ps(a&&a.onComplete,[s],t)}function Wm(s){const t=s.chart,a=t.options.animation;ps(a&&a.onProgress,[s],t)}function pd(s){return Po()&&typeof s=="string"?s=document.getElementById(s):s&&s.length&&(s=s[0]),s&&s.canvas&&(s=s.canvas),s}const wn={},ec=s=>{const t=pd(s);return Object.values(wn).filter(a=>a.canvas===t).pop()};function Hm(s,t,a){const r=Object.keys(s);for(const n of r){const l=+n;if(l>=t){const c=s[n];delete s[n],(a>0||l>t)&&(s[l+a]=c)}}}function Um(s,t,a,r){return!a||s.type==="mouseout"?null:r?t:s}class cr{static defaults=ks;static instances=wn;static overrides=ei;static registry=Sr;static version=Vm;static getChart=ec;static register(...t){Sr.add(...t),tc()}static unregister(...t){Sr.remove(...t),tc()}constructor(t,a){const r=this.config=new qm(a),n=pd(t),l=ec(n);if(l)throw new Error("Canvas is already in use. Chart with ID '"+l.id+"' must be destroyed before the canvas with ID '"+l.canvas.id+"' can be reused.");const c=r.createResolver(r.chartOptionScopes(),this.getContext());this.platform=new(r.platform||um(n)),this.platform.updateConfig(r);const d=this.platform.acquireContext(n,c.aspectRatio),f=d&&d.canvas,p=f&&f.height,h=f&&f.width;if(this.id=cf(),this.ctx=d,this.canvas=f,this.width=h,this.height=p,this._options=c,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new Em,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=Cf(g=>this.update(g),c.resizeDelay||0),this._dataChanges=[],wn[this.id]=this,!d||!f){console.error("Failed to create chart: can't acquire context from the given item");return}Dr.listen(this,"complete",Zl),Dr.listen(this,"progress",Wm),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:t,maintainAspectRatio:a},width:r,height:n,_aspectRatio:l}=this;return ls(t)?a&&l?l:n?r/n:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}get registry(){return Sr}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():Dl(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return xl(this.canvas,this.ctx),this}stop(){return Dr.stop(this),this}resize(t,a){Dr.running(this)?this._resizeBeforeDraw={width:t,height:a}:this._resize(t,a)}_resize(t,a){const r=this.options,n=this.canvas,l=r.maintainAspectRatio&&this.aspectRatio,c=this.platform.getMaximumSize(n,t,a,l),d=r.devicePixelRatio||this.platform.getDevicePixelRatio(),f=this.width?"resize":"attach";this.width=c.width,this.height=c.height,this._aspectRatio=this.aspectRatio,Dl(this,d,!0)&&(this.notifyPlugins("resize",{size:c}),ps(r.onResize,[this,c],this),this.attached&&this._doResize(f)&&this.render())}ensureScalesHaveIDs(){const a=this.options.scales||{};as(a,(r,n)=>{r.id=n})}buildOrUpdateScales(){const t=this.options,a=t.scales,r=this.scales,n=Object.keys(r).reduce((c,d)=>(c[d]=!1,c),{});let l=[];a&&(l=l.concat(Object.keys(a).map(c=>{const d=a[c],f=bo(c,d),p=f==="r",h=f==="x";return{options:d,dposition:p?"chartArea":h?"bottom":"left",dtype:p?"radialLinear":h?"category":"linear"}}))),as(l,c=>{const d=c.options,f=d.id,p=bo(f,d),h=Qa(d.type,c.dtype);(d.position===void 0||Jl(d.position,p)!==Jl(c.dposition))&&(d.position=c.dposition),n[f]=!0;let g=null;if(f in r&&r[f].type===h)g=r[f];else{const b=Sr.getScale(h);g=new b({id:f,type:h,ctx:this.ctx,chart:this}),r[g.id]=g}g.init(d,t)}),as(n,(c,d)=>{c||delete r[d]}),as(r,c=>{lr.configure(this,c,c.options),lr.addBox(this,c)})}_updateMetasets(){const t=this._metasets,a=this.data.datasets.length,r=t.length;if(t.sort((n,l)=>n.index-l.index),r>a){for(let n=a;n<r;++n)this._destroyDatasetMeta(n);t.splice(a,r-a)}this._sortedMetasets=t.slice(0).sort(Xl("order","index"))}_removeUnreferencedMetasets(){const{_metasets:t,data:{datasets:a}}=this;t.length>a.length&&delete this._stacks,t.forEach((r,n)=>{a.filter(l=>l===r._dataset).length===0&&this._destroyDatasetMeta(n)})}buildOrUpdateControllers(){const t=[],a=this.data.datasets;let r,n;for(this._removeUnreferencedMetasets(),r=0,n=a.length;r<n;r++){const l=a[r];let c=this.getDatasetMeta(r);const d=l.type||this.config.type;if(c.type&&c.type!==d&&(this._destroyDatasetMeta(r),c=this.getDatasetMeta(r)),c.type=d,c.indexAxis=l.indexAxis||_o(d,this.options),c.order=l.order||0,c.index=r,c.label=""+l.label,c.visible=this.isDatasetVisible(r),c.controller)c.controller.updateIndex(r),c.controller.linkScales();else{const f=Sr.getController(d),{datasetElementType:p,dataElementType:h}=ks.datasets[d];Object.assign(f,{dataElementType:Sr.getElement(h),datasetElementType:p&&Sr.getElement(p)}),c.controller=new f(this,r),t.push(c.controller)}}return this._updateMetasets(),t}_resetElements(){as(this.data.datasets,(t,a)=>{this.getDatasetMeta(a).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){const a=this.config;a.update();const r=this._options=a.createResolver(a.chartOptionScopes(),this.getContext()),n=this._animationsDisabled=!r.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0})===!1)return;const l=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let c=0;for(let p=0,h=this.data.datasets.length;p<h;p++){const{controller:g}=this.getDatasetMeta(p),b=!n&&l.indexOf(g)===-1;g.buildOrUpdateElements(b),c=Math.max(+g.getMaxOverflow(),c)}c=this._minPadding=r.layout.autoPadding?c:0,this._updateLayout(c),n||as(l,p=>{p.reset()}),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(Xl("z","_idx"));const{_active:d,_lastEvent:f}=this;f?this._eventHandler(f,!0):d.length&&this._updateHoverStyles(d,d,!0),this.render()}_updateScales(){as(this.scales,t=>{lr.removeBox(this,t)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const t=this.options,a=new Set(Object.keys(this._listeners)),r=new Set(t.events);(!vl(a,r)||!!this._responsiveListeners!==t.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:t}=this,a=this._getUniformDataChanges()||[];for(const{method:r,start:n,count:l}of a){const c=r==="_removeElements"?-l:l;Hm(t,n,c)}}_getUniformDataChanges(){const t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];const a=this.data.datasets.length,r=l=>new Set(t.filter(c=>c[0]===l).map((c,d)=>d+","+c.splice(1).join(","))),n=r(0);for(let l=1;l<a;l++)if(!vl(n,r(l)))return;return Array.from(n).map(l=>l.split(",")).map(l=>({method:l[1],start:+l[2],count:+l[3]}))}_updateLayout(t){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;lr.update(this,this.width,this.height,t);const a=this.chartArea,r=a.width<=0||a.height<=0;this._layers=[],as(this.boxes,n=>{r&&n.position==="chartArea"||(n.configure&&n.configure(),this._layers.push(...n._layers()))},this),this._layers.forEach((n,l)=>{n._idx=l}),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})!==!1){for(let a=0,r=this.data.datasets.length;a<r;++a)this.getDatasetMeta(a).controller.configure();for(let a=0,r=this.data.datasets.length;a<r;++a)this._updateDataset(a,zr(t)?t({datasetIndex:a}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,a){const r=this.getDatasetMeta(t),n={meta:r,index:t,mode:a,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",n)!==!1&&(r.controller._update(a),n.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",n))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(Dr.has(this)?this.attached&&!Dr.running(this)&&Dr.start(this):(this.draw(),Zl({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){const{width:r,height:n}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(r,n)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const a=this._layers;for(t=0;t<a.length&&a[t].z<=0;++t)a[t].draw(this.chartArea);for(this._drawDatasets();t<a.length;++t)a[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){const a=this._sortedMetasets,r=[];let n,l;for(n=0,l=a.length;n<l;++n){const c=a[n];(!t||c.visible)&&r.push(c)}return r}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const t=this.getSortedVisibleDatasetMetas();for(let a=t.length-1;a>=0;--a)this._drawDataset(t[a]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){const a=this.ctx,r={meta:t,index:t.index,cancelable:!0},n=vp(this,t);this.notifyPlugins("beforeDatasetDraw",r)!==!1&&(n&&To(a,n),t.controller.draw(),n&&Eo(a),r.cancelable=!1,this.notifyPlugins("afterDatasetDraw",r))}isPointInArea(t){return Qc(t,this.chartArea,this._minPadding)}getElementsAtEventForMode(t,a,r,n){const l=Bp.modes[a];return typeof l=="function"?l(this,t,r,n):[]}getDatasetMeta(t){const a=this.data.datasets[t],r=this._metasets;let n=r.filter(l=>l&&l._dataset===a).pop();return n||(n={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:a&&a.order||0,index:t,_dataset:a,_parsed:[],_sorted:!1},r.push(n)),n}getContext(){return this.$context||(this.$context=mi(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){const a=this.data.datasets[t];if(!a)return!1;const r=this.getDatasetMeta(t);return typeof r.hidden=="boolean"?!r.hidden:!a.hidden}setDatasetVisibility(t,a){const r=this.getDatasetMeta(t);r.hidden=!a}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,a,r){const n=r?"show":"hide",l=this.getDatasetMeta(t),c=l.controller._resolveAnimations(void 0,n);Vi(a)?(l.data[a].hidden=!r,this.update()):(this.setDatasetVisibility(t,r),c.update(l,{visible:r}),this.update(d=>d.datasetIndex===t?n:void 0))}hide(t,a){this._updateVisibility(t,a,!1)}show(t,a){this._updateVisibility(t,a,!0)}_destroyDatasetMeta(t){const a=this._metasets[t];a&&a.controller&&a.controller._destroy(),delete this._metasets[t]}_stop(){let t,a;for(this.stop(),Dr.remove(this),t=0,a=this.data.datasets.length;t<a;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:t,ctx:a}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),xl(t,a),this.platform.releaseContext(a),this.canvas=null,this.ctx=null),delete wn[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...t){return this.canvas.toDataURL(...t)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const t=this._listeners,a=this.platform,r=(l,c)=>{a.addEventListener(this,l,c),t[l]=c},n=(l,c,d)=>{l.offsetX=c,l.offsetY=d,this._eventHandler(l)};as(this.options.events,l=>r(l,n))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const t=this._responsiveListeners,a=this.platform,r=(f,p)=>{a.addEventListener(this,f,p),t[f]=p},n=(f,p)=>{t[f]&&(a.removeEventListener(this,f,p),delete t[f])},l=(f,p)=>{this.canvas&&this.resize(f,p)};let c;const d=()=>{n("attach",d),this.attached=!0,this.resize(),r("resize",l),r("detach",c)};c=()=>{this.attached=!1,n("resize",l),this._stop(),this._resize(0,0),r("attach",d)},a.isAttached(this.canvas)?d():c()}unbindEvents(){as(this._listeners,(t,a)=>{this.platform.removeEventListener(this,a,t)}),this._listeners={},as(this._responsiveListeners,(t,a)=>{this.platform.removeEventListener(this,a,t)}),this._responsiveListeners=void 0}updateHoverStyle(t,a,r){const n=r?"set":"remove";let l,c,d,f;for(a==="dataset"&&(l=this.getDatasetMeta(t[0].datasetIndex),l.controller["_"+n+"DatasetHoverStyle"]()),d=0,f=t.length;d<f;++d){c=t[d];const p=c&&this.getDatasetMeta(c.datasetIndex).controller;p&&p[n+"HoverStyle"](c.element,c.datasetIndex,c.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){const a=this._active||[],r=t.map(({datasetIndex:l,index:c})=>{const d=this.getDatasetMeta(l);if(!d)throw new Error("No dataset found at index "+l);return{datasetIndex:l,element:d.data[c],index:c}});!Dn(r,a)&&(this._active=r,this._lastEvent=null,this._updateHoverStyles(r,a))}notifyPlugins(t,a,r){return this._plugins.notify(this,t,a,r)}isPluginEnabled(t){return this._plugins._cache.filter(a=>a.plugin.id===t).length===1}_updateHoverStyles(t,a,r){const n=this.options.hover,l=(f,p)=>f.filter(h=>!p.some(g=>h.datasetIndex===g.datasetIndex&&h.index===g.index)),c=l(a,t),d=r?t:l(t,a);c.length&&this.updateHoverStyle(c,n.mode,!1),d.length&&n.mode&&this.updateHoverStyle(d,n.mode,!0)}_eventHandler(t,a){const r={event:t,replay:a,cancelable:!0,inChartArea:this.isPointInArea(t)},n=c=>(c.options.events||this.options.events).includes(t.native.type);if(this.notifyPlugins("beforeEvent",r,n)===!1)return;const l=this._handleEvent(t,a,r.inChartArea);return r.cancelable=!1,this.notifyPlugins("afterEvent",r,n),(l||r.changed)&&this.render(),this}_handleEvent(t,a,r){const{_active:n=[],options:l}=this,c=a,d=this._getActiveElements(t,n,r,c),f=mf(t),p=Um(t,this._lastEvent,r,f);r&&(this._lastEvent=null,ps(l.onHover,[t,d,this],this),f&&ps(l.onClick,[t,d,this],this));const h=!Dn(d,n);return(h||a)&&(this._active=d,this._updateHoverStyles(d,n,a)),this._lastEvent=p,h}_getActiveElements(t,a,r,n){if(t.type==="mouseout")return[];if(!r)return a;const l=this.options.hover;return this.getElementsAtEventForMode(t,l.mode,l,n)}}function tc(){return as(cr.instances,s=>s._plugins.invalidate())}function Ym(s,t,a){const{startAngle:r,x:n,y:l,outerRadius:c,innerRadius:d,options:f}=t,{borderWidth:p,borderJoinStyle:h}=f,g=Math.min(p/c,kr(r-a));if(s.beginPath(),s.arc(n,l,c-p/2,r+g/2,a-g/2),d>0){const b=Math.min(p/d,kr(r-a));s.arc(n,l,d+p/2,a-b/2,r+b/2,!0)}else{const b=Math.min(p/2,c*kr(r-a));if(h==="round")s.arc(n,l,b,a-os/2,r+os/2,!0);else if(h==="bevel"){const y=2*b*b,k=-y*Math.cos(a+os/2)+n,A=-y*Math.sin(a+os/2)+l,D=y*Math.cos(r+os/2)+n,T=y*Math.sin(r+os/2)+l;s.lineTo(k,A),s.lineTo(D,T)}}s.closePath(),s.moveTo(0,0),s.rect(0,0,s.canvas.width,s.canvas.height),s.clip("evenodd")}function Qm(s,t,a){const{startAngle:r,pixelMargin:n,x:l,y:c,outerRadius:d,innerRadius:f}=t;let p=n/d;s.beginPath(),s.arc(l,c,d,r-p,a+p),f>n?(p=n/f,s.arc(l,c,f,a+p,r-p,!0)):s.arc(l,c,n,a+Ls,r-Ls),s.closePath(),s.clip()}function Km(s){return Fo(s,["outerStart","outerEnd","innerStart","innerEnd"])}function Jm(s,t,a,r){const n=Km(s.options.borderRadius),l=(a-t)/2,c=Math.min(l,r*t/2),d=f=>{const p=(a-Math.min(l,f))*r/2;return Js(f,0,Math.min(l,p))};return{outerStart:d(n.outerStart),outerEnd:d(n.outerEnd),innerStart:Js(n.innerStart,0,c),innerEnd:Js(n.innerEnd,0,c)}}function ci(s,t,a,r){return{x:a+s*Math.cos(t),y:r+s*Math.sin(t)}}function Pn(s,t,a,r,n,l){const{x:c,y:d,startAngle:f,pixelMargin:p,innerRadius:h}=t,g=Math.max(t.outerRadius+r+a-p,0),b=h>0?h+r+a+p:0;let y=0;const k=n-f;if(r){const ie=h>0?h-r:0,he=g>0?g-r:0,Ge=(ie+he)/2,ce=Ge!==0?k*Ge/(Ge+r):k;y=(k-ce)/2}const A=Math.max(.001,k*g-a/os)/g,D=(k-A)/2,T=f+D+y,C=n-D-y,{outerStart:S,outerEnd:M,innerStart:F,innerEnd:j}=Jm(t,b,g,C-T),P=g-S,Y=g-M,W=T+S/P,N=C-M/Y,L=b+F,X=b+j,ae=T+F/L,V=C-j/X;if(s.beginPath(),l){const ie=(W+N)/2;if(s.arc(c,d,g,W,ie),s.arc(c,d,g,ie,N),M>0){const se=ci(Y,N,c,d);s.arc(se.x,se.y,M,N,C+Ls)}const he=ci(X,C,c,d);if(s.lineTo(he.x,he.y),j>0){const se=ci(X,V,c,d);s.arc(se.x,se.y,j,C+Ls,V+Math.PI)}const Ge=(C-j/b+(T+F/b))/2;if(s.arc(c,d,b,C-j/b,Ge,!0),s.arc(c,d,b,Ge,T+F/b,!0),F>0){const se=ci(L,ae,c,d);s.arc(se.x,se.y,F,ae+Math.PI,T-Ls)}const ce=ci(P,T,c,d);if(s.lineTo(ce.x,ce.y),S>0){const se=ci(P,W,c,d);s.arc(se.x,se.y,S,T-Ls,W)}}else{s.moveTo(c,d);const ie=Math.cos(W)*g+c,he=Math.sin(W)*g+d;s.lineTo(ie,he);const Ge=Math.cos(N)*g+c,ce=Math.sin(N)*g+d;s.lineTo(Ge,ce)}s.closePath()}function Xm(s,t,a,r,n){const{fullCircles:l,startAngle:c,circumference:d}=t;let f=t.endAngle;if(l){Pn(s,t,a,r,f,n);for(let p=0;p<l;++p)s.fill();isNaN(d)||(f=c+(d%Ts||Ts))}return Pn(s,t,a,r,f,n),s.fill(),f}function Zm(s,t,a,r,n){const{fullCircles:l,startAngle:c,circumference:d,options:f}=t,{borderWidth:p,borderJoinStyle:h,borderDash:g,borderDashOffset:b,borderRadius:y}=f,k=f.borderAlign==="inner";if(!p)return;s.setLineDash(g||[]),s.lineDashOffset=b,k?(s.lineWidth=p*2,s.lineJoin=h||"round"):(s.lineWidth=p,s.lineJoin=h||"bevel");let A=t.endAngle;if(l){Pn(s,t,a,r,A,n);for(let D=0;D<l;++D)s.stroke();isNaN(d)||(A=c+(d%Ts||Ts))}k&&Qm(s,t,A),f.selfJoin&&A-c>=os&&y===0&&h!=="miter"&&Ym(s,t,A),l||(Pn(s,t,a,r,A,n),s.stroke())}class eh extends ai{static id="arc";static defaults={borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0,selfJoin:!1};static defaultRoutes={backgroundColor:"backgroundColor"};static descriptors={_scriptable:!0,_indexable:t=>t!=="borderDash"};circumference;endAngle;fullCircles;innerRadius;outerRadius;pixelMargin;startAngle;constructor(t){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,t&&Object.assign(this,t)}inRange(t,a,r){const n=this.getProps(["x","y"],r),{angle:l,distance:c}=zc(n,{x:t,y:a}),{startAngle:d,endAngle:f,innerRadius:p,outerRadius:h,circumference:g}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],r),b=(this.options.spacing+this.options.borderWidth)/2,y=Qa(g,f-d),k=Fn(l,d,f)&&d!==f,A=y>=Ts||k,D=Jr(c,p+b,h+b);return A&&D}getCenterPoint(t){const{x:a,y:r,startAngle:n,endAngle:l,innerRadius:c,outerRadius:d}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],t),{offset:f,spacing:p}=this.options,h=(n+l)/2,g=(c+d+p+f)/2;return{x:a+Math.cos(h)*g,y:r+Math.sin(h)*g}}tooltipPosition(t){return this.getCenterPoint(t)}draw(t){const{options:a,circumference:r}=this,n=(a.offset||0)/4,l=(a.spacing||0)/2,c=a.circular;if(this.pixelMargin=a.borderAlign==="inner"?.33:0,this.fullCircles=r>Ts?Math.floor(r/Ts):0,r===0||this.innerRadius<0||this.outerRadius<0)return;t.save();const d=(this.startAngle+this.endAngle)/2;t.translate(Math.cos(d)*n,Math.sin(d)*n);const f=1-Math.sin(Math.min(os,r||0)),p=n*f;t.fillStyle=a.backgroundColor,t.strokeStyle=a.borderColor,Xm(t,this,p,l,c),Zm(t,this,p,l,c),t.restore()}}function md(s,t){const{x:a,y:r,base:n,width:l,height:c}=s.getProps(["x","y","base","width","height"],t);let d,f,p,h,g;return s.horizontal?(g=c/2,d=Math.min(a,n),f=Math.max(a,n),p=r-g,h=r+g):(g=l/2,d=a-g,f=a+g,p=Math.min(r,n),h=Math.max(r,n)),{left:d,top:p,right:f,bottom:h}}function Rr(s,t,a,r){return s?0:Js(t,a,r)}function th(s,t,a){const r=s.options.borderWidth,n=s.borderSkipped,l=Kc(r);return{t:Rr(n.top,l.top,0,a),r:Rr(n.right,l.right,0,t),b:Rr(n.bottom,l.bottom,0,a),l:Rr(n.left,l.left,0,t)}}function ah(s,t,a){const{enableBorderRadius:r}=s.getProps(["enableBorderRadius"]),n=s.options.borderRadius,l=vi(n),c=Math.min(t,a),d=s.borderSkipped,f=r||Ka(n);return{topLeft:Rr(!f||d.top||d.left,l.topLeft,0,c),topRight:Rr(!f||d.top||d.right,l.topRight,0,c),bottomLeft:Rr(!f||d.bottom||d.left,l.bottomLeft,0,c),bottomRight:Rr(!f||d.bottom||d.right,l.bottomRight,0,c)}}function sh(s){const t=md(s),a=t.right-t.left,r=t.bottom-t.top,n=th(s,a/2,r/2),l=ah(s,a/2,r/2);return{outer:{x:t.left,y:t.top,w:a,h:r,radius:l},inner:{x:t.left+n.l,y:t.top+n.t,w:a-n.l-n.r,h:r-n.t-n.b,radius:{topLeft:Math.max(0,l.topLeft-Math.max(n.t,n.l)),topRight:Math.max(0,l.topRight-Math.max(n.t,n.r)),bottomLeft:Math.max(0,l.bottomLeft-Math.max(n.b,n.l)),bottomRight:Math.max(0,l.bottomRight-Math.max(n.b,n.r))}}}}function co(s,t,a,r){const n=t===null,l=a===null,d=s&&!(n&&l)&&md(s,r);return d&&(n||Jr(t,d.left,d.right))&&(l||Jr(a,d.top,d.bottom))}function rh(s){return s.topLeft||s.topRight||s.bottomLeft||s.bottomRight}function ih(s,t){s.rect(t.x,t.y,t.w,t.h)}function uo(s,t,a={}){const r=s.x!==a.x?-t:0,n=s.y!==a.y?-t:0,l=(s.x+s.w!==a.x+a.w?t:0)-r,c=(s.y+s.h!==a.y+a.h?t:0)-n;return{x:s.x+r,y:s.y+n,w:s.w+l,h:s.h+c,radius:s.radius}}class jn extends ai{static id="bar";static defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(t){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,t&&Object.assign(this,t)}draw(t){const{inflateAmount:a,options:{borderColor:r,backgroundColor:n}}=this,{inner:l,outer:c}=sh(this),d=rh(c.radius)?Nn:ih;t.save(),(c.w!==l.w||c.h!==l.h)&&(t.beginPath(),d(t,uo(c,a,l)),t.clip(),d(t,uo(l,-a,c)),t.fillStyle=r,t.fill("evenodd")),t.beginPath(),d(t,uo(l,a)),t.fillStyle=n,t.fill(),t.restore()}inRange(t,a,r){return co(this,t,a,r)}inXRange(t,a){return co(this,t,null,a)}inYRange(t,a){return co(this,null,t,a)}getCenterPoint(t){const{x:a,y:r,base:n,horizontal:l}=this.getProps(["x","y","base","horizontal"],t);return{x:l?(a+n)/2:a,y:l?r:(r+n)/2}}getRange(t){return t==="x"?this.width/2:this.height/2}}const ac=(s,t)=>{let{boxHeight:a=t,boxWidth:r=t}=s;return s.usePointStyle&&(a=Math.min(a,t),r=s.pointStyleWidth||Math.min(r,t)),{boxWidth:r,boxHeight:a,itemHeight:Math.max(t,a)}},nh=(s,t)=>s!==null&&t!==null&&s.datasetIndex===t.datasetIndex&&s.index===t.index;class sc extends ai{constructor(t){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,a,r){this.maxWidth=t,this.maxHeight=a,this._margins=r,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const t=this.options.labels||{};let a=ps(t.generateLabels,[this.chart],this)||[];t.filter&&(a=a.filter(r=>t.filter(r,this.chart.data))),t.sort&&(a=a.sort((r,n)=>t.sort(r,n,this.chart.data))),this.options.reverse&&a.reverse(),this.legendItems=a}fit(){const{options:t,ctx:a}=this;if(!t.display){this.width=this.height=0;return}const r=t.labels,n=Bs(r.font),l=n.size,c=this._computeTitleHeight(),{boxWidth:d,itemHeight:f}=ac(r,l);let p,h;a.font=n.string,this.isHorizontal()?(p=this.maxWidth,h=this._fitRows(c,l,d,f)+10):(h=this.maxHeight,p=this._fitCols(c,n,d,f)+10),this.width=Math.min(p,t.maxWidth||this.maxWidth),this.height=Math.min(h,t.maxHeight||this.maxHeight)}_fitRows(t,a,r,n){const{ctx:l,maxWidth:c,options:{labels:{padding:d}}}=this,f=this.legendHitBoxes=[],p=this.lineWidths=[0],h=n+d;let g=t;l.textAlign="left",l.textBaseline="middle";let b=-1,y=-h;return this.legendItems.forEach((k,A)=>{const D=r+a/2+l.measureText(k.text).width;(A===0||p[p.length-1]+D+2*d>c)&&(g+=h,p[p.length-(A>0?0:1)]=0,y+=h,b++),f[A]={left:0,top:y,row:b,width:D,height:n},p[p.length-1]+=D+d}),g}_fitCols(t,a,r,n){const{ctx:l,maxHeight:c,options:{labels:{padding:d}}}=this,f=this.legendHitBoxes=[],p=this.columnSizes=[],h=c-t;let g=d,b=0,y=0,k=0,A=0;return this.legendItems.forEach((D,T)=>{const{itemWidth:C,itemHeight:S}=oh(r,a,l,D,n);T>0&&y+S+2*d>h&&(g+=b+d,p.push({width:b,height:y}),k+=b+d,A++,b=y=0),f[T]={left:k,top:y,col:A,width:C,height:S},b=Math.max(b,C),y+=S+d}),g+=b,p.push({width:b,height:y}),g}adjustHitBoxes(){if(!this.options.display)return;const t=this._computeTitleHeight(),{legendHitBoxes:a,options:{align:r,labels:{padding:n},rtl:l}}=this,c=fi(l,this.left,this.width);if(this.isHorizontal()){let d=0,f=Vs(r,this.left+n,this.right-this.lineWidths[d]);for(const p of a)d!==p.row&&(d=p.row,f=Vs(r,this.left+n,this.right-this.lineWidths[d])),p.top+=this.top+t+n,p.left=c.leftForLtr(c.x(f),p.width),f+=p.width+n}else{let d=0,f=Vs(r,this.top+t+n,this.bottom-this.columnSizes[d].height);for(const p of a)p.col!==d&&(d=p.col,f=Vs(r,this.top+t+n,this.bottom-this.columnSizes[d].height)),p.top=f,p.left+=this.left+n,p.left=c.leftForLtr(c.x(p.left),p.width),f+=p.height+n}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const t=this.ctx;To(t,this),this._draw(),Eo(t)}}_draw(){const{options:t,columnSizes:a,lineWidths:r,ctx:n}=this,{align:l,labels:c}=t,d=ks.color,f=fi(t.rtl,this.left,this.width),p=Bs(c.font),{padding:h}=c,g=p.size,b=g/2;let y;this.drawTitle(),n.textAlign=f.textAlign("left"),n.textBaseline="middle",n.lineWidth=.5,n.font=p.string;const{boxWidth:k,boxHeight:A,itemHeight:D}=ac(c,g),T=function(j,P,Y){if(isNaN(k)||k<=0||isNaN(A)||A<0)return;n.save();const W=Qa(Y.lineWidth,1);if(n.fillStyle=Qa(Y.fillStyle,d),n.lineCap=Qa(Y.lineCap,"butt"),n.lineDashOffset=Qa(Y.lineDashOffset,0),n.lineJoin=Qa(Y.lineJoin,"miter"),n.lineWidth=W,n.strokeStyle=Qa(Y.strokeStyle,d),n.setLineDash(Qa(Y.lineDash,[])),c.usePointStyle){const N={radius:A*Math.SQRT2/2,pointStyle:Y.pointStyle,rotation:Y.rotation,borderWidth:W},L=f.xPlus(j,k/2),X=P+b;Yc(n,N,L,X,c.pointStyleWidth&&k)}else{const N=P+Math.max((g-A)/2,0),L=f.leftForLtr(j,k),X=vi(Y.borderRadius);n.beginPath(),Object.values(X).some(ae=>ae!==0)?Nn(n,{x:L,y:N,w:k,h:A,radius:X}):n.rect(L,N,k,A),n.fill(),W!==0&&n.stroke()}n.restore()},C=function(j,P,Y){Bi(n,Y.text,j,P+D/2,p,{strikethrough:Y.hidden,textAlign:f.textAlign(Y.textAlign)})},S=this.isHorizontal(),M=this._computeTitleHeight();S?y={x:Vs(l,this.left+h,this.right-r[0]),y:this.top+h+M,line:0}:y={x:this.left+h,y:Vs(l,this.top+M+h,this.bottom-a[0].height),line:0},td(this.ctx,t.textDirection);const F=D+h;this.legendItems.forEach((j,P)=>{n.strokeStyle=j.fontColor,n.fillStyle=j.fontColor;const Y=n.measureText(j.text).width,W=f.textAlign(j.textAlign||(j.textAlign=c.textAlign)),N=k+b+Y;let L=y.x,X=y.y;f.setWidth(this.width),S?P>0&&L+N+h>this.right&&(X=y.y+=F,y.line++,L=y.x=Vs(l,this.left+h,this.right-r[y.line])):P>0&&X+F>this.bottom&&(L=y.x=L+a[y.line].width+h,y.line++,X=y.y=Vs(l,this.top+M+h,this.bottom-a[y.line].height));const ae=f.x(L);if(T(ae,X,j),L=Tf(W,L+k+b,S?L+N:this.right,t.rtl),C(f.x(L),X,j),S)y.x+=N+h;else if(typeof j.text!="string"){const V=p.lineHeight;y.y+=hd(j,V)+h}else y.y+=F}),ad(this.ctx,t.textDirection)}drawTitle(){const t=this.options,a=t.title,r=Bs(a.font),n=ur(a.padding);if(!a.display)return;const l=fi(t.rtl,this.left,this.width),c=this.ctx,d=a.position,f=r.size/2,p=n.top+f;let h,g=this.left,b=this.width;if(this.isHorizontal())b=Math.max(...this.lineWidths),h=this.top+p,g=Vs(t.align,g,this.right-b);else{const k=this.columnSizes.reduce((A,D)=>Math.max(A,D.height),0);h=p+Vs(t.align,this.top,this.bottom-k-t.labels.padding-this._computeTitleHeight())}const y=Vs(d,g,g+b);c.textAlign=l.textAlign(Do(d)),c.textBaseline="middle",c.strokeStyle=a.color,c.fillStyle=a.color,c.font=r.string,Bi(c,a.text,y,h,r)}_computeTitleHeight(){const t=this.options.title,a=Bs(t.font),r=ur(t.padding);return t.display?a.lineHeight+r.height:0}_getLegendItemAt(t,a){let r,n,l;if(Jr(t,this.left,this.right)&&Jr(a,this.top,this.bottom)){for(l=this.legendHitBoxes,r=0;r<l.length;++r)if(n=l[r],Jr(t,n.left,n.left+n.width)&&Jr(a,n.top,n.top+n.height))return this.legendItems[r]}return null}handleEvent(t){const a=this.options;if(!dh(t.type,a))return;const r=this._getLegendItemAt(t.x,t.y);if(t.type==="mousemove"||t.type==="mouseout"){const n=this._hoveredItem,l=nh(n,r);n&&!l&&ps(a.onLeave,[t,n,this],this),this._hoveredItem=r,r&&!l&&ps(a.onHover,[t,r,this],this)}else r&&ps(a.onClick,[t,r,this],this)}}function oh(s,t,a,r,n){const l=lh(r,s,t,a),c=ch(n,r,t.lineHeight);return{itemWidth:l,itemHeight:c}}function lh(s,t,a,r){let n=s.text;return n&&typeof n!="string"&&(n=n.reduce((l,c)=>l.length>c.length?l:c)),t+a.size/2+r.measureText(n).width}function ch(s,t,a){let r=s;return typeof t.text!="string"&&(r=hd(t,a)),r}function hd(s,t){const a=s.text?s.text.length:0;return t*a}function dh(s,t){return!!((s==="mousemove"||s==="mouseout")&&(t.onHover||t.onLeave)||t.onClick&&(s==="click"||s==="mouseup"))}var Ui={id:"legend",_element:sc,start(s,t,a){const r=s.legend=new sc({ctx:s.ctx,options:a,chart:s});lr.configure(s,r,a),lr.addBox(s,r)},stop(s){lr.removeBox(s,s.legend),delete s.legend},beforeUpdate(s,t,a){const r=s.legend;lr.configure(s,r,a),r.options=a},afterUpdate(s){const t=s.legend;t.buildLabels(),t.adjustHitBoxes()},afterEvent(s,t){t.replay||s.legend.handleEvent(t.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(s,t,a){const r=t.datasetIndex,n=a.chart;n.isDatasetVisible(r)?(n.hide(r),t.hidden=!0):(n.show(r),t.hidden=!1)},onHover:null,onLeave:null,labels:{color:s=>s.chart.options.color,boxWidth:40,padding:10,generateLabels(s){const t=s.data.datasets,{labels:{usePointStyle:a,pointStyle:r,textAlign:n,color:l,useBorderRadius:c,borderRadius:d}}=s.legend.options;return s._getSortedDatasetMetas().map(f=>{const p=f.controller.getStyle(a?0:void 0),h=ur(p.borderWidth);return{text:t[f.index].label,fillStyle:p.backgroundColor,fontColor:l,hidden:!f.visible,lineCap:p.borderCapStyle,lineDash:p.borderDash,lineDashOffset:p.borderDashOffset,lineJoin:p.borderJoinStyle,lineWidth:(h.width+h.height)/4,strokeStyle:p.borderColor,pointStyle:r||p.pointStyle,rotation:p.rotation,textAlign:n||p.textAlign,borderRadius:c&&(d||p.borderRadius),datasetIndex:f.index}},this)}},title:{color:s=>s.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:s=>!s.startsWith("on"),labels:{_scriptable:s=>!["generateLabels","filter","sort"].includes(s)}}};class gd extends ai{constructor(t){super(),this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,a){const r=this.options;if(this.left=0,this.top=0,!r.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=t,this.height=this.bottom=a;const n=$s(r.text)?r.text.length:1;this._padding=ur(r.padding);const l=n*Bs(r.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=l:this.width=l}isHorizontal(){const t=this.options.position;return t==="top"||t==="bottom"}_drawArgs(t){const{top:a,left:r,bottom:n,right:l,options:c}=this,d=c.align;let f=0,p,h,g;return this.isHorizontal()?(h=Vs(d,r,l),g=a+t,p=l-r):(c.position==="left"?(h=r+t,g=Vs(d,n,a),f=os*-.5):(h=l-t,g=Vs(d,a,n),f=os*.5),p=n-a),{titleX:h,titleY:g,maxWidth:p,rotation:f}}draw(){const t=this.ctx,a=this.options;if(!a.display)return;const r=Bs(a.font),l=r.lineHeight/2+this._padding.top,{titleX:c,titleY:d,maxWidth:f,rotation:p}=this._drawArgs(l);Bi(t,a.text,0,0,r,{color:a.color,maxWidth:f,rotation:p,textAlign:Do(a.align),textBaseline:"middle",translation:[c,d]})}}function uh(s,t){const a=new gd({ctx:s.ctx,options:t,chart:s});lr.configure(s,a,t),lr.addBox(s,a),s.titleBlock=a}var Yi={id:"title",_element:gd,start(s,t,a){uh(s,a)},stop(s){const t=s.titleBlock;lr.removeBox(s,t),delete s.titleBlock},beforeUpdate(s,t,a){const r=s.titleBlock;lr.configure(s,r,a),r.options=a},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Ii={average(s){if(!s.length)return!1;let t,a,r=new Set,n=0,l=0;for(t=0,a=s.length;t<a;++t){const d=s[t].element;if(d&&d.hasValue()){const f=d.tooltipPosition();r.add(f.x),n+=f.y,++l}}return l===0||r.size===0?!1:{x:[...r].reduce((d,f)=>d+f)/r.size,y:n/l}},nearest(s,t){if(!s.length)return!1;let a=t.x,r=t.y,n=Number.POSITIVE_INFINITY,l,c,d;for(l=0,c=s.length;l<c;++l){const f=s[l].element;if(f&&f.hasValue()){const p=f.getCenterPoint(),h=xf(t,p);h<n&&(n=h,d=f)}}if(d){const f=d.tooltipPosition();a=f.x,r=f.y}return{x:a,y:r}}};function yr(s,t){return t&&($s(t)?Array.prototype.push.apply(s,t):s.push(t)),s}function Cr(s){return(typeof s=="string"||s instanceof String)&&s.indexOf(`
`)>-1?s.split(`
`):s}function vh(s,t){const{element:a,datasetIndex:r,index:n}=t,l=s.getDatasetMeta(r).controller,{label:c,value:d}=l.getLabelAndValue(n);return{chart:s,label:c,parsed:l.getParsed(n),raw:s.data.datasets[r].data[n],formattedValue:d,dataset:l.getDataset(),dataIndex:n,datasetIndex:r,element:a}}function rc(s,t){const a=s.chart.ctx,{body:r,footer:n,title:l}=s,{boxWidth:c,boxHeight:d}=t,f=Bs(t.bodyFont),p=Bs(t.titleFont),h=Bs(t.footerFont),g=l.length,b=n.length,y=r.length,k=ur(t.padding);let A=k.height,D=0,T=r.reduce((M,F)=>M+F.before.length+F.lines.length+F.after.length,0);if(T+=s.beforeBody.length+s.afterBody.length,g&&(A+=g*p.lineHeight+(g-1)*t.titleSpacing+t.titleMarginBottom),T){const M=t.displayColors?Math.max(d,f.lineHeight):f.lineHeight;A+=y*M+(T-y)*f.lineHeight+(T-1)*t.bodySpacing}b&&(A+=t.footerMarginTop+b*h.lineHeight+(b-1)*t.footerSpacing);let C=0;const S=function(M){D=Math.max(D,a.measureText(M).width+C)};return a.save(),a.font=p.string,as(s.title,S),a.font=f.string,as(s.beforeBody.concat(s.afterBody),S),C=t.displayColors?c+2+t.boxPadding:0,as(r,M=>{as(M.before,S),as(M.lines,S),as(M.after,S)}),C=0,a.font=h.string,as(s.footer,S),a.restore(),D+=k.width,{width:D,height:A}}function fh(s,t){const{y:a,height:r}=t;return a<r/2?"top":a>s.height-r/2?"bottom":"center"}function ph(s,t,a,r){const{x:n,width:l}=r,c=a.caretSize+a.caretPadding;if(s==="left"&&n+l+c>t.width||s==="right"&&n-l-c<0)return!0}function mh(s,t,a,r){const{x:n,width:l}=a,{width:c,chartArea:{left:d,right:f}}=s;let p="center";return r==="center"?p=n<=(d+f)/2?"left":"right":n<=l/2?p="left":n>=c-l/2&&(p="right"),ph(p,s,t,a)&&(p="center"),p}function ic(s,t,a){const r=a.yAlign||t.yAlign||fh(s,a);return{xAlign:a.xAlign||t.xAlign||mh(s,t,a,r),yAlign:r}}function hh(s,t){let{x:a,width:r}=s;return t==="right"?a-=r:t==="center"&&(a-=r/2),a}function gh(s,t,a){let{y:r,height:n}=s;return t==="top"?r+=a:t==="bottom"?r-=n+a:r-=n/2,r}function nc(s,t,a,r){const{caretSize:n,caretPadding:l,cornerRadius:c}=s,{xAlign:d,yAlign:f}=a,p=n+l,{topLeft:h,topRight:g,bottomLeft:b,bottomRight:y}=vi(c);let k=hh(t,d);const A=gh(t,f,p);return f==="center"?d==="left"?k+=p:d==="right"&&(k-=p):d==="left"?k-=Math.max(h,b)+n:d==="right"&&(k+=Math.max(g,y)+n),{x:Js(k,0,r.width-t.width),y:Js(A,0,r.height-t.height)}}function gn(s,t,a){const r=ur(a.padding);return t==="center"?s.x+s.width/2:t==="right"?s.x+s.width-r.right:s.x+r.left}function oc(s){return yr([],Cr(s))}function _h(s,t,a){return mi(s,{tooltip:t,tooltipItems:a,type:"tooltip"})}function lc(s,t){const a=t&&t.dataset&&t.dataset.tooltip&&t.dataset.tooltip.callbacks;return a?s.override(a):s}const _d={beforeTitle:Ar,title(s){if(s.length>0){const t=s[0],a=t.chart.data.labels,r=a?a.length:0;if(this&&this.options&&this.options.mode==="dataset")return t.dataset.label||"";if(t.label)return t.label;if(r>0&&t.dataIndex<r)return a[t.dataIndex]}return""},afterTitle:Ar,beforeBody:Ar,beforeLabel:Ar,label(s){if(this&&this.options&&this.options.mode==="dataset")return s.label+": "+s.formattedValue||s.formattedValue;let t=s.dataset.label||"";t&&(t+=": ");const a=s.formattedValue;return ls(a)||(t+=a),t},labelColor(s){const a=s.chart.getDatasetMeta(s.datasetIndex).controller.getStyle(s.dataIndex);return{borderColor:a.borderColor,backgroundColor:a.backgroundColor,borderWidth:a.borderWidth,borderDash:a.borderDash,borderDashOffset:a.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(s){const a=s.chart.getDatasetMeta(s.datasetIndex).controller.getStyle(s.dataIndex);return{pointStyle:a.pointStyle,rotation:a.rotation}},afterLabel:Ar,afterBody:Ar,beforeFooter:Ar,footer:Ar,afterFooter:Ar};function Qs(s,t,a,r){const n=s[t].call(a,r);return typeof n>"u"?_d[t].call(a,r):n}class cc extends ai{static positioners=Ii;constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const t=this._cachedAnimations;if(t)return t;const a=this.chart,r=this.options.setContext(this.getContext()),n=r.enabled&&a.options.animation&&r.animations,l=new sd(this.chart,n);return n._cacheable&&(this._cachedAnimations=Object.freeze(l)),l}getContext(){return this.$context||(this.$context=_h(this.chart.getContext(),this,this._tooltipItems))}getTitle(t,a){const{callbacks:r}=a,n=Qs(r,"beforeTitle",this,t),l=Qs(r,"title",this,t),c=Qs(r,"afterTitle",this,t);let d=[];return d=yr(d,Cr(n)),d=yr(d,Cr(l)),d=yr(d,Cr(c)),d}getBeforeBody(t,a){return oc(Qs(a.callbacks,"beforeBody",this,t))}getBody(t,a){const{callbacks:r}=a,n=[];return as(t,l=>{const c={before:[],lines:[],after:[]},d=lc(r,l);yr(c.before,Cr(Qs(d,"beforeLabel",this,l))),yr(c.lines,Qs(d,"label",this,l)),yr(c.after,Cr(Qs(d,"afterLabel",this,l))),n.push(c)}),n}getAfterBody(t,a){return oc(Qs(a.callbacks,"afterBody",this,t))}getFooter(t,a){const{callbacks:r}=a,n=Qs(r,"beforeFooter",this,t),l=Qs(r,"footer",this,t),c=Qs(r,"afterFooter",this,t);let d=[];return d=yr(d,Cr(n)),d=yr(d,Cr(l)),d=yr(d,Cr(c)),d}_createItems(t){const a=this._active,r=this.chart.data,n=[],l=[],c=[];let d=[],f,p;for(f=0,p=a.length;f<p;++f)d.push(vh(this.chart,a[f]));return t.filter&&(d=d.filter((h,g,b)=>t.filter(h,g,b,r))),t.itemSort&&(d=d.sort((h,g)=>t.itemSort(h,g,r))),as(d,h=>{const g=lc(t.callbacks,h);n.push(Qs(g,"labelColor",this,h)),l.push(Qs(g,"labelPointStyle",this,h)),c.push(Qs(g,"labelTextColor",this,h))}),this.labelColors=n,this.labelPointStyles=l,this.labelTextColors=c,this.dataPoints=d,d}update(t,a){const r=this.options.setContext(this.getContext()),n=this._active;let l,c=[];if(!n.length)this.opacity!==0&&(l={opacity:0});else{const d=Ii[r.position].call(this,n,this._eventPosition);c=this._createItems(r),this.title=this.getTitle(c,r),this.beforeBody=this.getBeforeBody(c,r),this.body=this.getBody(c,r),this.afterBody=this.getAfterBody(c,r),this.footer=this.getFooter(c,r);const f=this._size=rc(this,r),p=Object.assign({},d,f),h=ic(this.chart,r,p),g=nc(r,p,h,this.chart);this.xAlign=h.xAlign,this.yAlign=h.yAlign,l={opacity:1,x:g.x,y:g.y,width:f.width,height:f.height,caretX:d.x,caretY:d.y}}this._tooltipItems=c,this.$context=void 0,l&&this._resolveAnimations().update(this,l),t&&r.external&&r.external.call(this,{chart:this.chart,tooltip:this,replay:a})}drawCaret(t,a,r,n){const l=this.getCaretPosition(t,r,n);a.lineTo(l.x1,l.y1),a.lineTo(l.x2,l.y2),a.lineTo(l.x3,l.y3)}getCaretPosition(t,a,r){const{xAlign:n,yAlign:l}=this,{caretSize:c,cornerRadius:d}=r,{topLeft:f,topRight:p,bottomLeft:h,bottomRight:g}=vi(d),{x:b,y}=t,{width:k,height:A}=a;let D,T,C,S,M,F;return l==="center"?(M=y+A/2,n==="left"?(D=b,T=D-c,S=M+c,F=M-c):(D=b+k,T=D+c,S=M-c,F=M+c),C=D):(n==="left"?T=b+Math.max(f,h)+c:n==="right"?T=b+k-Math.max(p,g)-c:T=this.caretX,l==="top"?(S=y,M=S-c,D=T-c,C=T+c):(S=y+A,M=S+c,D=T+c,C=T-c),F=S),{x1:D,x2:T,x3:C,y1:S,y2:M,y3:F}}drawTitle(t,a,r){const n=this.title,l=n.length;let c,d,f;if(l){const p=fi(r.rtl,this.x,this.width);for(t.x=gn(this,r.titleAlign,r),a.textAlign=p.textAlign(r.titleAlign),a.textBaseline="middle",c=Bs(r.titleFont),d=r.titleSpacing,a.fillStyle=r.titleColor,a.font=c.string,f=0;f<l;++f)a.fillText(n[f],p.x(t.x),t.y+c.lineHeight/2),t.y+=c.lineHeight+d,f+1===l&&(t.y+=r.titleMarginBottom-d)}}_drawColorBox(t,a,r,n,l){const c=this.labelColors[r],d=this.labelPointStyles[r],{boxHeight:f,boxWidth:p}=l,h=Bs(l.bodyFont),g=gn(this,"left",l),b=n.x(g),y=f<h.lineHeight?(h.lineHeight-f)/2:0,k=a.y+y;if(l.usePointStyle){const A={radius:Math.min(p,f)/2,pointStyle:d.pointStyle,rotation:d.rotation,borderWidth:1},D=n.leftForLtr(b,p)+p/2,T=k+f/2;t.strokeStyle=l.multiKeyBackground,t.fillStyle=l.multiKeyBackground,Sl(t,A,D,T),t.strokeStyle=c.borderColor,t.fillStyle=c.backgroundColor,Sl(t,A,D,T)}else{t.lineWidth=Ka(c.borderWidth)?Math.max(...Object.values(c.borderWidth)):c.borderWidth||1,t.strokeStyle=c.borderColor,t.setLineDash(c.borderDash||[]),t.lineDashOffset=c.borderDashOffset||0;const A=n.leftForLtr(b,p),D=n.leftForLtr(n.xPlus(b,1),p-2),T=vi(c.borderRadius);Object.values(T).some(C=>C!==0)?(t.beginPath(),t.fillStyle=l.multiKeyBackground,Nn(t,{x:A,y:k,w:p,h:f,radius:T}),t.fill(),t.stroke(),t.fillStyle=c.backgroundColor,t.beginPath(),Nn(t,{x:D,y:k+1,w:p-2,h:f-2,radius:T}),t.fill()):(t.fillStyle=l.multiKeyBackground,t.fillRect(A,k,p,f),t.strokeRect(A,k,p,f),t.fillStyle=c.backgroundColor,t.fillRect(D,k+1,p-2,f-2))}t.fillStyle=this.labelTextColors[r]}drawBody(t,a,r){const{body:n}=this,{bodySpacing:l,bodyAlign:c,displayColors:d,boxHeight:f,boxWidth:p,boxPadding:h}=r,g=Bs(r.bodyFont);let b=g.lineHeight,y=0;const k=fi(r.rtl,this.x,this.width),A=function(Y){a.fillText(Y,k.x(t.x+y),t.y+b/2),t.y+=b+l},D=k.textAlign(c);let T,C,S,M,F,j,P;for(a.textAlign=c,a.textBaseline="middle",a.font=g.string,t.x=gn(this,D,r),a.fillStyle=r.bodyColor,as(this.beforeBody,A),y=d&&D!=="right"?c==="center"?p/2+h:p+2+h:0,M=0,j=n.length;M<j;++M){for(T=n[M],C=this.labelTextColors[M],a.fillStyle=C,as(T.before,A),S=T.lines,d&&S.length&&(this._drawColorBox(a,t,M,k,r),b=Math.max(g.lineHeight,f)),F=0,P=S.length;F<P;++F)A(S[F]),b=g.lineHeight;as(T.after,A)}y=0,b=g.lineHeight,as(this.afterBody,A),t.y-=l}drawFooter(t,a,r){const n=this.footer,l=n.length;let c,d;if(l){const f=fi(r.rtl,this.x,this.width);for(t.x=gn(this,r.footerAlign,r),t.y+=r.footerMarginTop,a.textAlign=f.textAlign(r.footerAlign),a.textBaseline="middle",c=Bs(r.footerFont),a.fillStyle=r.footerColor,a.font=c.string,d=0;d<l;++d)a.fillText(n[d],f.x(t.x),t.y+c.lineHeight/2),t.y+=c.lineHeight+r.footerSpacing}}drawBackground(t,a,r,n){const{xAlign:l,yAlign:c}=this,{x:d,y:f}=t,{width:p,height:h}=r,{topLeft:g,topRight:b,bottomLeft:y,bottomRight:k}=vi(n.cornerRadius);a.fillStyle=n.backgroundColor,a.strokeStyle=n.borderColor,a.lineWidth=n.borderWidth,a.beginPath(),a.moveTo(d+g,f),c==="top"&&this.drawCaret(t,a,r,n),a.lineTo(d+p-b,f),a.quadraticCurveTo(d+p,f,d+p,f+b),c==="center"&&l==="right"&&this.drawCaret(t,a,r,n),a.lineTo(d+p,f+h-k),a.quadraticCurveTo(d+p,f+h,d+p-k,f+h),c==="bottom"&&this.drawCaret(t,a,r,n),a.lineTo(d+y,f+h),a.quadraticCurveTo(d,f+h,d,f+h-y),c==="center"&&l==="left"&&this.drawCaret(t,a,r,n),a.lineTo(d,f+g),a.quadraticCurveTo(d,f,d+g,f),a.closePath(),a.fill(),n.borderWidth>0&&a.stroke()}_updateAnimationTarget(t){const a=this.chart,r=this.$animations,n=r&&r.x,l=r&&r.y;if(n||l){const c=Ii[t.position].call(this,this._active,this._eventPosition);if(!c)return;const d=this._size=rc(this,t),f=Object.assign({},c,this._size),p=ic(a,t,f),h=nc(t,f,p,a);(n._to!==h.x||l._to!==h.y)&&(this.xAlign=p.xAlign,this.yAlign=p.yAlign,this.width=d.width,this.height=d.height,this.caretX=c.x,this.caretY=c.y,this._resolveAnimations().update(this,h))}}_willRender(){return!!this.opacity}draw(t){const a=this.options.setContext(this.getContext());let r=this.opacity;if(!r)return;this._updateAnimationTarget(a);const n={width:this.width,height:this.height},l={x:this.x,y:this.y};r=Math.abs(r)<.001?0:r;const c=ur(a.padding),d=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;a.enabled&&d&&(t.save(),t.globalAlpha=r,this.drawBackground(l,t,n,a),td(t,a.textDirection),l.y+=c.top,this.drawTitle(l,t,a),this.drawBody(l,t,a),this.drawFooter(l,t,a),ad(t,a.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,a){const r=this._active,n=t.map(({datasetIndex:d,index:f})=>{const p=this.chart.getDatasetMeta(d);if(!p)throw new Error("Cannot find a dataset at index "+d);return{datasetIndex:d,element:p.data[f],index:f}}),l=!Dn(r,n),c=this._positionChanged(n,a);(l||c)&&(this._active=n,this._eventPosition=a,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,a,r=!0){if(a&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const n=this.options,l=this._active||[],c=this._getActiveElements(t,l,a,r),d=this._positionChanged(c,t),f=a||!Dn(c,l)||d;return f&&(this._active=c,(n.enabled||n.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,a))),f}_getActiveElements(t,a,r,n){const l=this.options;if(t.type==="mouseout")return[];if(!n)return a.filter(d=>this.chart.data.datasets[d.datasetIndex]&&this.chart.getDatasetMeta(d.datasetIndex).controller.getParsed(d.index)!==void 0);const c=this.chart.getElementsAtEventForMode(t,l.mode,l,r);return l.reverse&&c.reverse(),c}_positionChanged(t,a){const{caretX:r,caretY:n,options:l}=this,c=Ii[l.position].call(this,t,a);return c!==!1&&(r!==c.x||n!==c.y)}}var Qi={id:"tooltip",_element:cc,positioners:Ii,afterInit(s,t,a){a&&(s.tooltip=new cc({chart:s,options:a}))},beforeUpdate(s,t,a){s.tooltip&&s.tooltip.initialize(a)},reset(s,t,a){s.tooltip&&s.tooltip.initialize(a)},afterDraw(s){const t=s.tooltip;if(t&&t._willRender()){const a={tooltip:t};if(s.notifyPlugins("beforeTooltipDraw",{...a,cancelable:!0})===!1)return;t.draw(s.ctx),s.notifyPlugins("afterTooltipDraw",a)}},afterEvent(s,t){if(s.tooltip){const a=t.replay;s.tooltip.handleEvent(t.event,a,t.inChartArea)&&(t.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(s,t)=>t.bodyFont.size,boxWidth:(s,t)=>t.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:_d},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:s=>s!=="filter"&&s!=="itemSort"&&s!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]};const bh=(s,t,a,r)=>(typeof t=="string"?(a=s.push(t)-1,r.unshift({index:a,label:t})):isNaN(t)&&(a=null),a);function yh(s,t,a,r){const n=s.indexOf(t);if(n===-1)return bh(s,t,a,r);const l=s.lastIndexOf(t);return n!==l?a:n}const wh=(s,t)=>s===null?null:Js(Math.round(s),0,t);function dc(s){const t=this.getLabels();return s>=0&&s<t.length?t[s]:s}class qn extends hi{static id="category";static defaults={ticks:{callback:dc}};constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){const a=this._addedLabels;if(a.length){const r=this.getLabels();for(const{index:n,label:l}of a)r[n]===l&&r.splice(n,1);this._addedLabels=[]}super.init(t)}parse(t,a){if(ls(t))return null;const r=this.getLabels();return a=isFinite(a)&&r[a]===t?a:yh(r,t,Qa(a,t),this._addedLabels),wh(a,r.length-1)}determineDataLimits(){const{minDefined:t,maxDefined:a}=this.getUserBounds();let{min:r,max:n}=this.getMinMax(!0);this.options.bounds==="ticks"&&(t||(r=0),a||(n=this.getLabels().length-1)),this.min=r,this.max=n}buildTicks(){const t=this.min,a=this.max,r=this.options.offset,n=[];let l=this.getLabels();l=t===0&&a===l.length-1?l:l.slice(t,a+1),this._valueRange=Math.max(l.length-(r?0:1),1),this._startValue=this.min-(r?.5:0);for(let c=t;c<=a;c++)n.push({value:c});return n}getLabelForValue(t){return dc.call(this,t)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return typeof t!="number"&&(t=this.parse(t)),t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){const a=this.ticks;return t<0||t>a.length-1?null:this.getPixelForValue(a[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}}function xh(s,t){const a=[],{bounds:n,step:l,min:c,max:d,precision:f,count:p,maxTicks:h,maxDigits:g,includeBounds:b}=s,y=l||1,k=h-1,{min:A,max:D}=t,T=!ls(c),C=!ls(d),S=!ls(p),M=(D-A)/(g+1);let F=pl((D-A)/k/y)*y,j,P,Y,W;if(F<1e-14&&!T&&!C)return[{value:A},{value:D}];W=Math.ceil(D/F)-Math.floor(A/F),W>k&&(F=pl(W*F/k/y)*y),ls(f)||(j=Math.pow(10,f),F=Math.ceil(F*j)/j),n==="ticks"?(P=Math.floor(A/F)*F,Y=Math.ceil(D/F)*F):(P=A,Y=D),T&&C&&l&&bf((d-c)/l,F/1e3)?(W=Math.round(Math.min((d-c)/F,h)),F=(d-c)/W,P=c,Y=d):S?(P=T?c:P,Y=C?d:Y,W=p-1,F=(Y-P)/W):(W=(Y-P)/F,bn(W,Math.round(W),F/1e3)?W=Math.round(W):W=Math.ceil(W));const N=Math.max(ml(F),ml(P));j=Math.pow(10,ls(f)?N:f),P=Math.round(P*j)/j,Y=Math.round(Y*j)/j;let L=0;for(T&&(b&&P!==c?(a.push({value:c}),P<c&&L++,bn(Math.round((P+L*F)*j)/j,c,uc(c,M,s))&&L++):P<c&&L++);L<W;++L){const X=Math.round((P+L*F)*j)/j;if(C&&X>d)break;a.push({value:X})}return C&&b&&Y!==d?a.length&&bn(a[a.length-1].value,d,uc(d,M,s))?a[a.length-1].value=d:a.push({value:d}):(!C||Y===d)&&a.push({value:Y}),a}function uc(s,t,{horizontal:a,minRotation:r}){const n=Fr(r),l=(a?Math.sin(n):Math.cos(n))||.001,c=.75*t*(""+s).length;return Math.min(t/l,c)}class Sh extends hi{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(t,a){return ls(t)||(typeof t=="number"||t instanceof Number)&&!isFinite(+t)?null:+t}handleTickRangeOptions(){const{beginAtZero:t}=this.options,{minDefined:a,maxDefined:r}=this.getUserBounds();let{min:n,max:l}=this;const c=f=>n=a?n:f,d=f=>l=r?l:f;if(t){const f=jr(n),p=jr(l);f<0&&p<0?d(0):f>0&&p>0&&c(0)}if(n===l){let f=l===0?1:Math.abs(l*.05);d(l+f),t||c(n-f)}this.min=n,this.max=l}getTickLimit(){const t=this.options.ticks;let{maxTicksLimit:a,stepSize:r}=t,n;return r?(n=Math.ceil(this.max/r)-Math.floor(this.min/r)+1,n>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${r} would result generating up to ${n} ticks. Limiting to 1000.`),n=1e3)):(n=this.computeTickLimit(),a=a||11),a&&(n=Math.min(a,n)),n}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const t=this.options,a=t.ticks;let r=this.getTickLimit();r=Math.max(2,r);const n={maxTicks:r,bounds:t.bounds,min:t.min,max:t.max,precision:a.precision,step:a.stepSize,count:a.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:a.minRotation||0,includeBounds:a.includeBounds!==!1},l=this._range||this,c=xh(n,l);return t.bounds==="ticks"&&yf(c,this,"value"),t.reverse?(c.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),c}configure(){const t=this.ticks;let a=this.min,r=this.max;if(super.configure(),this.options.offset&&t.length){const n=(r-a)/Math.max(t.length-1,1)/2;a-=n,r+=n}this._startValue=a,this._endValue=r,this._valueRange=r-a}getLabelForValue(t){return Co(t,this.chart.options.locale,this.options.ticks.format)}}class zn extends Sh{static id="linear";static defaults={ticks:{callback:Uc.formatters.numeric}};determineDataLimits(){const{min:t,max:a}=this.getMinMax(!0);this.min=dr(t)?t:0,this.max=dr(a)?a:1,this.handleTickRangeOptions()}computeTickLimit(){const t=this.isHorizontal(),a=t?this.width:this.height,r=Fr(this.options.ticks.minRotation),n=(t?Math.sin(r):Math.cos(r))||.001,l=this._resolveTickFontOptions(0);return Math.ceil(a/Math.min(40,l.lineHeight/n))}getPixelForValue(t){return t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}const Gn={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},Ks=Object.keys(Gn);function vc(s,t){return s-t}function fc(s,t){if(ls(t))return null;const a=s._adapter,{parser:r,round:n,isoWeekday:l}=s._parseOpts;let c=t;return typeof r=="function"&&(c=r(c)),dr(c)||(c=typeof r=="string"?a.parse(c,r):a.parse(c)),c===null?null:(n&&(c=n==="week"&&(En(l)||l===!0)?a.startOf(c,"isoWeek",l):a.startOf(c,n)),+c)}function pc(s,t,a,r){const n=Ks.length;for(let l=Ks.indexOf(s);l<n-1;++l){const c=Gn[Ks[l]],d=c.steps?c.steps:Number.MAX_SAFE_INTEGER;if(c.common&&Math.ceil((a-t)/(d*c.size))<=r)return Ks[l]}return Ks[n-1]}function kh(s,t,a,r,n){for(let l=Ks.length-1;l>=Ks.indexOf(a);l--){const c=Ks[l];if(Gn[c].common&&s._adapter.diff(n,r,c)>=t-1)return c}return Ks[a?Ks.indexOf(a):0]}function Ah(s){for(let t=Ks.indexOf(s)+1,a=Ks.length;t<a;++t)if(Gn[Ks[t]].common)return Ks[t]}function mc(s,t,a){if(!a)s[t]=!0;else if(a.length){const{lo:r,hi:n}=Ao(a,t),l=a[r]>=t?a[r]:a[n];s[l]=!0}}function Dh(s,t,a,r){const n=s._adapter,l=+n.startOf(t[0].value,r),c=t[t.length-1].value;let d,f;for(d=l;d<=c;d=+n.add(d,1,r))f=a[d],f>=0&&(t[f].major=!0);return t}function hc(s,t,a){const r=[],n={},l=t.length;let c,d;for(c=0;c<l;++c)d=t[c],n[d]=c,r.push({value:d,major:!1});return l===0||!a?r:Dh(s,r,n,a)}class gc extends hi{static id="time";static defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}};constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,a={}){const r=t.time||(t.time={}),n=this._adapter=new jp._date(t.adapters.date);n.init(a),Oi(r.displayFormats,n.formats()),this._parseOpts={parser:r.parser,round:r.round,isoWeekday:r.isoWeekday},super.init(t),this._normalized=a.normalized}parse(t,a){return t===void 0?null:fc(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,a=this._adapter,r=t.time.unit||"day";let{min:n,max:l,minDefined:c,maxDefined:d}=this.getUserBounds();function f(p){!c&&!isNaN(p.min)&&(n=Math.min(n,p.min)),!d&&!isNaN(p.max)&&(l=Math.max(l,p.max))}(!c||!d)&&(f(this._getLabelBounds()),(t.bounds!=="ticks"||t.ticks.source!=="labels")&&f(this.getMinMax(!1))),n=dr(n)&&!isNaN(n)?n:+a.startOf(Date.now(),r),l=dr(l)&&!isNaN(l)?l:+a.endOf(Date.now(),r)+1,this.min=Math.min(n,l-1),this.max=Math.max(n+1,l)}_getLabelBounds(){const t=this.getLabelTimestamps();let a=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;return t.length&&(a=t[0],r=t[t.length-1]),{min:a,max:r}}buildTicks(){const t=this.options,a=t.time,r=t.ticks,n=r.source==="labels"?this.getLabelTimestamps():this._generate();t.bounds==="ticks"&&n.length&&(this.min=this._userMin||n[0],this.max=this._userMax||n[n.length-1]);const l=this.min,c=this.max,d=Af(n,l,c);return this._unit=a.unit||(r.autoSkip?pc(a.minUnit,this.min,this.max,this._getLabelCapacity(l)):kh(this,d.length,a.minUnit,this.min,this.max)),this._majorUnit=!r.major.enabled||this._unit==="year"?void 0:Ah(this._unit),this.initOffsets(n),t.reverse&&d.reverse(),hc(this,d,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(t=>+t.value))}initOffsets(t=[]){let a=0,r=0,n,l;this.options.offset&&t.length&&(n=this.getDecimalForValue(t[0]),t.length===1?a=1-n:a=(this.getDecimalForValue(t[1])-n)/2,l=this.getDecimalForValue(t[t.length-1]),t.length===1?r=l:r=(l-this.getDecimalForValue(t[t.length-2]))/2);const c=t.length<3?.5:.25;a=Js(a,0,c),r=Js(r,0,c),this._offsets={start:a,end:r,factor:1/(a+1+r)}}_generate(){const t=this._adapter,a=this.min,r=this.max,n=this.options,l=n.time,c=l.unit||pc(l.minUnit,a,r,this._getLabelCapacity(a)),d=Qa(n.ticks.stepSize,1),f=c==="week"?l.isoWeekday:!1,p=En(f)||f===!0,h={};let g=a,b,y;if(p&&(g=+t.startOf(g,"isoWeek",f)),g=+t.startOf(g,p?"day":c),t.diff(r,a,c)>1e5*d)throw new Error(a+" and "+r+" are too far apart with stepSize of "+d+" "+c);const k=n.ticks.source==="data"&&this.getDataTimestamps();for(b=g,y=0;b<r;b=+t.add(b,d,c),y++)mc(h,b,k);return(b===r||n.bounds==="ticks"||y===1)&&mc(h,b,k),Object.keys(h).sort(vc).map(A=>+A)}getLabelForValue(t){const a=this._adapter,r=this.options.time;return r.tooltipFormat?a.format(t,r.tooltipFormat):a.format(t,r.displayFormats.datetime)}format(t,a){const n=this.options.time.displayFormats,l=this._unit,c=a||n[l];return this._adapter.format(t,c)}_tickFormatFunction(t,a,r,n){const l=this.options,c=l.ticks.callback;if(c)return ps(c,[t,a,r],this);const d=l.time.displayFormats,f=this._unit,p=this._majorUnit,h=f&&d[f],g=p&&d[p],b=r[a],y=p&&g&&b&&b.major;return this._adapter.format(t,n||(y?g:h))}generateTickLabels(t){let a,r,n;for(a=0,r=t.length;a<r;++a)n=t[a],n.label=this._tickFormatFunction(n.value,a,t)}getDecimalForValue(t){return t===null?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const a=this._offsets,r=this.getDecimalForValue(t);return this.getPixelForDecimal((a.start+r)*a.factor)}getValueForPixel(t){const a=this._offsets,r=this.getDecimalForPixel(t)/a.factor-a.end;return this.min+r*(this.max-this.min)}_getLabelSize(t){const a=this.options.ticks,r=this.ctx.measureText(t).width,n=Fr(this.isHorizontal()?a.maxRotation:a.minRotation),l=Math.cos(n),c=Math.sin(n),d=this._resolveTickFontOptions(0).size;return{w:r*l+d*c,h:r*c+d*l}}_getLabelCapacity(t){const a=this.options.time,r=a.displayFormats,n=r[a.unit]||r.millisecond,l=this._tickFormatFunction(t,0,hc(this,[t],this._majorUnit),n),c=this._getLabelSize(l),d=Math.floor(this.isHorizontal()?this.width/c.w:this.height/c.h)-1;return d>0?d:1}getDataTimestamps(){let t=this._cache.data||[],a,r;if(t.length)return t;const n=this.getMatchingVisibleMetas();if(this._normalized&&n.length)return this._cache.data=n[0].controller.getAllParsedValues(this);for(a=0,r=n.length;a<r;++a)t=t.concat(n[a].controller.getAllParsedValues(this));return this._cache.data=this.normalize(t)}getLabelTimestamps(){const t=this._cache.labels||[];let a,r;if(t.length)return t;const n=this.getLabels();for(a=0,r=n.length;a<r;++a)t.push(fc(this,n[a]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return Vc(t.sort(vc))}}function _n(s,t,a){let r=0,n=s.length-1,l,c,d,f;a?(t>=s[r].pos&&t<=s[n].pos&&({lo:r,hi:n}=ho(s,"pos",t)),{pos:l,time:d}=s[r],{pos:c,time:f}=s[n]):(t>=s[r].time&&t<=s[n].time&&({lo:r,hi:n}=ho(s,"time",t)),{time:l,pos:d}=s[r],{time:c,pos:f}=s[n]);const p=c-l;return p?d+(f-d)*(t-l)/p:d}class TD extends gc{static id="timeseries";static defaults=gc.defaults;constructor(t){super(t),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const t=this._getTimestampsForTable(),a=this._table=this.buildLookupTable(t);this._minPos=_n(a,this.min),this._tableRange=_n(a,this.max)-this._minPos,super.initOffsets(t)}buildLookupTable(t){const{min:a,max:r}=this,n=[],l=[];let c,d,f,p,h;for(c=0,d=t.length;c<d;++c)p=t[c],p>=a&&p<=r&&n.push(p);if(n.length<2)return[{time:a,pos:0},{time:r,pos:1}];for(c=0,d=n.length;c<d;++c)h=n[c+1],f=n[c-1],p=n[c],Math.round((h+f)/2)!==p&&l.push({time:p,pos:c/(d-1)});return l}_generate(){const t=this.min,a=this.max;let r=super.getDataTimestamps();return(!r.includes(t)||!r.length)&&r.splice(0,0,t),(!r.includes(a)||r.length===1)&&r.push(a),r.sort((n,l)=>n-l)}_getTimestampsForTable(){let t=this._cache.all||[];if(t.length)return t;const a=this.getDataTimestamps(),r=this.getLabelTimestamps();return a.length&&r.length?t=this.normalize(a.concat(r)):t=a.length?a:r,t=this._cache.all=t,t}getDecimalForValue(t){return(_n(this._table,t)-this._minPos)/this._tableRange}getValueForPixel(t){const a=this._offsets,r=this.getDecimalForPixel(t)/a.factor-a.end;return _n(this._table,r*this._tableRange+this._minPos,!0)}}var Ch=_('<div class="chart-empty svelte-nvktxc"><span class="material-symbols-outlined svelte-nvktxc">show_chart</span> <p class="svelte-nvktxc">No assessment data available</p></div>'),Th=_('<canvas class="svelte-nvktxc"></canvas>'),Eh=_('<div class="chart-container svelte-nvktxc"><!></div>');function Fh(s,t){qa(t,!0),cr.register(Rn,jn,qn,zn,Qi,Ui,Yi);let a=Ma(t,"subjects",19,()=>[]),r=pt(void 0),n;function l(){if(!e(r)||!a()||a().length===0)return;n&&n.destroy();const g=a().filter(T=>T.numericGrade>0&&T.verified);if(g.length===0)return;const b=g.map(T=>T.name),y=g.map(T=>T.writtenWork||0),k=g.map(T=>T.performanceTasks||0),A=g.map(T=>T.quarterlyAssessment||0),D=e(r).getContext("2d");n=new cr(D,{type:"bar",data:{labels:b,datasets:[{label:"Written Work",data:y,backgroundColor:"rgba(33, 150, 243, 1.0)",borderColor:"rgb(33, 150, 243)",borderWidth:2,borderRadius:6,barPercentage:.8,categoryPercentage:.9},{label:"Performance Tasks",data:k,backgroundColor:"rgba(156, 39, 176, 1.0)",borderColor:"rgb(156, 39, 176)",borderWidth:2,borderRadius:6,barPercentage:.8,categoryPercentage:.9},{label:"Quarterly Assessment",data:A,backgroundColor:"rgba(255, 152, 0, 1.0)",borderColor:"rgb(255, 152, 0)",borderWidth:2,borderRadius:6,barPercentage:.8,categoryPercentage:.9}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{display:!0,position:"top",labels:{color:getComputedStyle(document.documentElement).getPropertyValue("--md-sys-color-on-surface").trim(),padding:15,font:{size:13,weight:"600"},usePointStyle:!0,pointStyle:"circle",boxWidth:10,boxHeight:10}},title:{display:!0,text:"Assessment Type Performance Comparison",font:{size:16,weight:"bold"},color:getComputedStyle(document.documentElement).getPropertyValue("--md-sys-color-on-surface").trim(),padding:{top:10,bottom:20}},tooltip:{backgroundColor:"rgba(30, 30, 30, 0.95)",padding:16,cornerRadius:12,titleFont:{size:15,weight:"600",family:"'Inter', 'Segoe UI', sans-serif"},bodyFont:{size:14,weight:"500",family:"'Inter', 'Segoe UI', sans-serif"},titleColor:"#ffffff",bodyColor:"#e0e0e0",borderColor:"rgba(255, 255, 255, 0.1)",borderWidth:1,displayColors:!0,usePointStyle:!0,pointStyle:"circle",boxWidth:8,boxHeight:8,boxPadding:6,titleMarginBottom:10,bodySpacing:8,multiKeyBackground:"transparent",callbacks:{label(T){const C=T.dataset.label||"",S=T.parsed.y;let M="",F="";return S>=85?(M="Excellent",F=""):S>=80?(M="Good",F=""):S>=75?(M="Satisfactory",F=""):S>0&&(M="Needs Improvement",F=""),M?`${C}: ${S.toFixed(1)}% ${F} ${M}`:`${C}: ${S.toFixed(1)}%`}}}},scales:{y:{beginAtZero:!0,max:100,grid:{color:getComputedStyle(document.documentElement).getPropertyValue("--md-sys-color-outline-variant").trim(),lineWidth:1},ticks:{color:getComputedStyle(document.documentElement).getPropertyValue("--md-sys-color-on-surface-variant").trim(),font:{size:12,weight:"500"},padding:8,callback(T){return T+"%"}},title:{display:!0,text:"Grade (%)",color:getComputedStyle(document.documentElement).getPropertyValue("--md-sys-color-on-surface-variant").trim(),font:{size:12,weight:"600"}}},x:{grid:{display:!1},ticks:{color:getComputedStyle(document.documentElement).getPropertyValue("--md-sys-color-on-surface-variant").trim(),font:{size:12,weight:"500"},maxRotation:0,minRotation:0,autoSkip:!1}}}}})}function c(){n&&l()}Ya(()=>{a()&&a().length>0&&l();const g=new MutationObserver(b=>{b.forEach(y=>{y.type==="attributes"&&y.attributeName==="data-theme"&&c()})});return g.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>{g.disconnect()}}),ti(()=>{n&&n.destroy()}),Es(()=>{a()&&e(r)&&l()});var d=Eh(),f=o(d);{var p=g=>{var b=Ch();m(g,b)},h=g=>{var b=Th();Hs(b,y=>v(r,y),()=>e(r)),m(g,b)};E(f,g=>{a().filter(b=>b.numericGrade>0&&b.verified).length===0?g(p):g(h,!1)})}i(d),m(s,d),za()}var Nh=_('<div class="chart-empty svelte-nvktxc"><span class="material-symbols-outlined svelte-nvktxc">analytics</span> <p class="svelte-nvktxc">No grade data available</p></div>'),$h=_('<canvas class="svelte-nvktxc"></canvas>'),Lh=_('<div class="chart-container svelte-nvktxc"><!></div>');function Ph(s,t){qa(t,!0),cr.register(Rn,jn,qn,zn,Qi,Ui,Yi);let a=Ma(t,"subjects",19,()=>[]),r=pt(void 0),n;function l(){if(!e(r)||!a()||a().length===0)return;n&&n.destroy();const g=a().filter(F=>F.numericGrade>0&&F.verified);if(g.length===0)return;const b=g.map(F=>F.name),y=g.map(F=>F.numericGrade),k=y.map(F=>F>=85?"rgba(76, 175, 80, 1.0)":F>=80?"rgba(33, 150, 243, 1.0)":F>=75?"rgba(255, 152, 0, 1.0)":"rgba(244, 67, 54, 1.0)"),A=y.map(F=>F>=85?"rgb(76, 175, 80)":F>=80?"rgb(33, 150, 243)":F>=75?"rgb(255, 152, 0)":"rgb(244, 67, 54)"),D=g.length;let T,C,S;D<=3?(T=50,C=.6,S=.7):D<=6?(T=40,C=.7,S=.75):D<=10?(T=30,C=.8,S=.85):(T=20,C=.9,S=.9);const M=e(r).getContext("2d");n=new cr(M,{type:"bar",data:{labels:b,datasets:[{label:"Grade",data:y,backgroundColor:k,borderColor:A,borderWidth:2,borderRadius:8,maxBarThickness:T,categoryPercentage:C,barPercentage:S}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:"Subject Performance Overview",font:{size:16,weight:"bold"},color:getComputedStyle(document.documentElement).getPropertyValue("--md-sys-color-on-surface").trim(),padding:{top:10,bottom:20}},tooltip:{backgroundColor:"rgba(30, 30, 30, 0.95)",padding:16,cornerRadius:12,titleFont:{size:15,weight:"600",family:"'Inter', 'Segoe UI', sans-serif"},bodyFont:{size:14,weight:"500",family:"'Inter', 'Segoe UI', sans-serif"},titleColor:"#ffffff",bodyColor:"#e0e0e0",borderColor:"rgba(255, 255, 255, 0.1)",borderWidth:1,displayColors:!1,titleMarginBottom:8,bodySpacing:6,callbacks:{label(F){const j=F.parsed.x;let P="",Y="";return j>=85?(P="Excellent",Y=""):j>=80?(P="Good",Y=""):j>=75?(P="Satisfactory",Y=""):(P="Needs Improvement",Y=""),`${Y} ${j.toFixed(1)}% - ${P}`}}}},scales:{x:{beginAtZero:!0,max:100,grid:{color:getComputedStyle(document.documentElement).getPropertyValue("--md-sys-color-outline-variant").trim(),lineWidth:1},ticks:{color:getComputedStyle(document.documentElement).getPropertyValue("--md-sys-color-on-surface-variant").trim(),font:{size:12,weight:"500"},padding:8,callback(F){return F+"%"}},title:{display:!0,text:"Grade (%)",color:getComputedStyle(document.documentElement).getPropertyValue("--md-sys-color-on-surface-variant").trim(),font:{size:12,weight:"600"}}},y:{grid:{display:!1},ticks:{color:getComputedStyle(document.documentElement).getPropertyValue("--md-sys-color-on-surface-variant").trim(),font:{size:12,weight:"500"},padding:10}}}}})}function c(){n&&l()}Ya(()=>{a()&&a().length>0&&l();const g=new MutationObserver(b=>{b.forEach(y=>{y.type==="attributes"&&y.attributeName==="data-theme"&&c()})});return g.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>{g.disconnect()}}),ti(()=>{n&&n.destroy()}),Es(()=>{a()&&e(r)&&l()});var d=Lh(),f=o(d);{var p=g=>{var b=Nh();m(g,b)},h=g=>{var b=$h();Hs(b,y=>v(r,y),()=>e(r)),m(g,b)};E(f,g=>{a().filter(b=>b.numericGrade>0&&b.verified).length===0?g(p):g(h,!1)})}i(d),m(s,d),za()}function Mh(s,t){or(t)}function Ih(s,t,a){e(t)>1&&(or(t,-1),Sn().then(()=>{setTimeout(()=>{const r=e(t)-1,n=a[r];n&&n.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},100)}))}function Rh(s,t,a){v(t,1),Sn().then(()=>{setTimeout(()=>{const r=document.querySelector(".ai-analysis-section");if(r)r.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"});else{const n=a[0];n&&n.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})}},100)})}var Oh=_('<div class="analysis-loading svelte-zopb0m"><div class="system-loader"></div> <p>Generating your personalized analysis...</p></div>'),jh=_('<div class="analysis-error svelte-zopb0m"><span class="material-symbols-outlined svelte-zopb0m">error</span> <div class="error-content svelte-zopb0m"><h4 class="svelte-zopb0m">Unable to Generate Analysis</h4> <p class="svelte-zopb0m"> </p></div></div>'),qh=_('<div class="analysis-section svelte-zopb0m"><div class="section-title svelte-zopb0m"><span class="material-symbols-outlined svelte-zopb0m">psychology</span> <span>Overview</span></div> <p class="section-text svelte-zopb0m"> </p></div>'),zh=_('<div class="change-item svelte-zopb0m"><div class="change-header svelte-zopb0m"><span class="change-subject svelte-zopb0m"> </span> <span> </span></div> <p class="change-observation svelte-zopb0m"> </p></div>'),Gh=_('<div class="notable-changes svelte-zopb0m"><h4 class="subsection-title svelte-zopb0m">Notable Changes:</h4> <!></div>'),Vh=_('<div class="analysis-section quarter-comparison svelte-zopb0m"><div class="section-title svelte-zopb0m"><span class="material-symbols-outlined svelte-zopb0m"><!></span> <span>Progress from Last Quarter</span> <span> </span></div> <p class="section-text svelte-zopb0m"> </p> <!></div>'),Bh=_('<div class="item-row svelte-zopb0m"><div class="item-top svelte-zopb0m"><span class="item-name svelte-zopb0m"> </span> <span class="item-value svelte-zopb0m"> </span></div> <p class="item-text svelte-zopb0m"> </p></div>'),Wh=_('<div class="analysis-section svelte-zopb0m"><div class="section-title svelte-zopb0m"><span class="material-symbols-outlined svelte-zopb0m">emoji_events</span> <span>Strengths</span></div> <!></div>'),Hh=_('<div class="item-row svelte-zopb0m"><div class="item-top svelte-zopb0m"><span class="item-name svelte-zopb0m"> </span> <span class="item-value svelte-zopb0m"> </span></div> <p class="item-text svelte-zopb0m"> </p> <p class="item-note svelte-zopb0m"> </p></div>'),Uh=_('<div class="analysis-section svelte-zopb0m"><div class="section-title svelte-zopb0m"><span class="material-symbols-outlined svelte-zopb0m">trending_up</span> <span>Areas for Growth</span></div> <!></div>'),Yh=_('<div class="assessment-item svelte-zopb0m"><div class="assessment-top svelte-zopb0m"><span class="assessment-name svelte-zopb0m">Written Work</span> <span class="assessment-value svelte-zopb0m"> </span></div> <p class="assessment-text svelte-zopb0m"> </p></div>'),Qh=_('<div class="assessment-item svelte-zopb0m"><div class="assessment-top svelte-zopb0m"><span class="assessment-name svelte-zopb0m">Performance Tasks</span> <span class="assessment-value svelte-zopb0m"> </span></div> <p class="assessment-text svelte-zopb0m"> </p></div>'),Kh=_('<div class="assessment-item svelte-zopb0m"><div class="assessment-top svelte-zopb0m"><span class="assessment-name svelte-zopb0m">Quarterly Assessment</span> <span class="assessment-value svelte-zopb0m"> </span></div> <p class="assessment-text svelte-zopb0m"> </p></div>'),Jh=_('<div class="analysis-section svelte-zopb0m"><div class="section-title svelte-zopb0m"><span class="material-symbols-outlined svelte-zopb0m">analytics</span> <span>Assessment Breakdown</span></div> <div class="assessment-row svelte-zopb0m"><!> <!> <!></div> <div class="charts-section svelte-zopb0m"><!> <!></div></div>'),Xh=_('<div class="item-row action-row svelte-zopb0m"><h4 class="action-name svelte-zopb0m"> </h4> <p class="item-text svelte-zopb0m"> </p> <p class="item-note svelte-zopb0m"> </p></div>'),Zh=_('<div class="analysis-section svelte-zopb0m"><div class="section-title svelte-zopb0m"><span class="material-symbols-outlined svelte-zopb0m">checklist</span> <span>Action Plan</span></div> <!></div>'),eg=_('<button class="show-more-btn svelte-zopb0m"><span class="material-symbols-outlined svelte-zopb0m">close</span> <span>Close All</span></button>'),tg=_('<button class="show-more-btn svelte-zopb0m"><span class="material-symbols-outlined svelte-zopb0m">expand_less</span> <span>Show Less</span></button>'),ag=_('<button class="show-more-btn svelte-zopb0m"><span class="material-symbols-outlined svelte-zopb0m">expand_more</span> <span>Show More</span></button>'),sg=_('<!> <!> <!> <!>  <!> <!> <div class="ai-action-buttons svelte-zopb0m"><!> <!></div>',1),rg=_('<div class="ai-analysis-display svelte-zopb0m"><!></div>');function ig(s,t){qa(t,!0);let a=Ma(t,"analysisData",3,null),r=Ma(t,"isLoading",3,!1),n=Ma(t,"error",3,null),l=Ma(t,"subjects",19,()=>[]),c=pt(0),d=Xs([]),f=pt(0);Es(()=>{r()&&v(c,0)}),Es(()=>{a()&&!r()&&e(c)===0&&Sn().then(()=>{setTimeout(()=>{v(c,1)},50)})}),Es(()=>{e(c)>e(f)&&e(c)>1&&Sn().then(()=>{setTimeout(()=>{const A=e(c)-1,D=d[A];D&&D.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},100)}),v(f,e(c),!0)});let p=aa(()=>a()?1+(a().quarterComparison?1:0)+1+(a().areasForGrowth&&a().areasForGrowth.length>0?1:0)+1+(a().actionPlan&&a().actionPlan.length>0?1:0):0),h=aa(()=>e(c)>=e(p));var g=rg(),b=o(g);{var y=A=>{var D=Oh();m(A,D)},k=A=>{var D=mt(),T=tt(D);{var C=M=>{var F=jh(),j=u(o(F),2),P=u(o(j),2),Y=o(P,!0);i(P),i(j),i(F),O(()=>w(Y,n())),m(M,F)},S=M=>{var F=mt(),j=tt(F);{var P=Y=>{const W=aa(()=>(a().quarterComparison?1:0)+2+(a().areasForGrowth&&a().areasForGrowth.length>0?1:0)+1),N=aa(()=>(a().quarterComparison?1:0)+1+(a().areasForGrowth&&a().areasForGrowth.length>0?1:0)+1);var L=sg(),X=tt(L);{var ae=Ne=>{var ne=qh(),oe=u(o(ne),2),_e=o(oe,!0);i(oe),i(ne),Hs(ne,Me=>d[0]=Me,()=>d?.[0]),O(()=>w(_e,a().overallInsight)),Xa(1,ne,()=>zs,()=>({y:-20,duration:400,easing:Gs})),Xa(2,ne,()=>qs,()=>({duration:200})),m(Ne,ne)};E(X,Ne=>{e(c)>=1&&Ne(ae)})}var V=u(X,2);{var ie=Ne=>{var ne=Vh(),oe=o(ne),_e=o(oe),Me=o(_e);{var ze=J=>{var xe=ba("trending_up");m(J,xe)},Ee=J=>{var xe=mt(),$e=tt(xe);{var B=ue=>{var G=ba("trending_down");m(ue,G)},te=ue=>{var G=ba("trending_flat");m(ue,G)};E($e,ue=>{a().quarterComparison.overallTrend==="declined"?ue(B):ue(te,!1)},!0)}m(J,xe)};E(Me,J=>{a().quarterComparison.overallTrend==="improved"?J(ze):J(Ee,!1)})}i(_e);var pe=u(_e,4),qe=o(pe);i(pe),i(oe);var Ae=u(oe,2),Ie=o(Ae,!0);i(Ae);var ut=u(Ae,2);{var me=J=>{var xe=Gh(),$e=u(o(xe),2);Dt($e,17,()=>a().quarterComparison.notableChanges,Ua,(B,te,ue)=>{var G=zh(),z=o(G),le=o(z),Z=o(le,!0);i(le);var q=u(le,2),U=o(q);i(q),i(z);var $=u(z,2),I=o($,!0);i($),i(G),O(()=>{w(Z,e(te).subject),we(q,1,`change-value ${e(te).change>0?"positive":e(te).change<0?"negative":"neutral"}`,"svelte-zopb0m"),w(U,`${e(te).change>0?"+":""}${e(te).change??""}`),w(I,e(te).observation)}),Xa(1,G,()=>zs,()=>({y:-10,duration:350,delay:100+ue*60,easing:Gs})),Xa(2,G,()=>qs,()=>({duration:200})),m(B,G)}),i(xe),m(J,xe)};E(ut,J=>{a().quarterComparison.notableChanges&&a().quarterComparison.notableChanges.length>0&&J(me)})}i(ne),Hs(ne,J=>d[1]=J,()=>d?.[1]),O(()=>{we(pe,1,`trend-badge ${a().quarterComparison.overallTrend??""}`,"svelte-zopb0m"),w(qe,`${a().quarterComparison.changeAmount>0?"+":""}${a().quarterComparison.changeAmount??""}`),w(Ie,a().quarterComparison.insight)}),Xa(1,ne,()=>zs,()=>({y:-20,duration:400,delay:50,easing:Gs})),Xa(2,ne,()=>qs,()=>({duration:200})),m(Ne,ne)};E(V,Ne=>{a().quarterComparison&&e(c)>=2&&Ne(ie)})}var he=u(V,2);{var Ge=Ne=>{var ne=Wh(),oe=u(o(ne),2);Dt(oe,17,()=>a().strengths,Ua,(_e,Me,ze)=>{var Ee=Bh(),pe=o(Ee),qe=o(pe),Ae=o(qe,!0);i(qe);var Ie=u(qe,2),ut=o(Ie,!0);i(Ie),i(pe);var me=u(pe,2),J=o(me,!0);i(me),i(Ee),O(xe=>{w(Ae,e(Me).subject),w(ut,xe),w(J,e(Me).reason)},[()=>e(Me).score.toFixed(1)]),Xa(1,Ee,()=>zs,()=>({y:-10,duration:350,delay:100+ze*80,easing:Gs})),Xa(2,Ee,()=>qs,()=>({duration:200})),m(_e,Ee)}),i(ne),Hs(ne,_e=>d[a().quarterComparison?2:1]=_e,()=>d?.[a().quarterComparison?2:1]),Xa(1,ne,()=>zs,()=>({y:-20,duration:400,delay:50,easing:Gs})),Xa(2,ne,()=>qs,()=>({duration:200})),m(Ne,ne)};E(he,Ne=>{e(c)>=(a().quarterComparison?3:2)&&Ne(Ge)})}var ce=u(he,2);{var se=Ne=>{const ne=aa(()=>a().quarterComparison?4:3),oe=aa(()=>a().quarterComparison?3:2);var _e=mt(),Me=tt(_e);{var ze=Ee=>{var pe=Uh(),qe=u(o(pe),2);Dt(qe,17,()=>a().areasForGrowth,Ua,(Ae,Ie,ut)=>{var me=Hh(),J=o(me),xe=o(J),$e=o(xe,!0);i(xe);var B=u(xe,2),te=o(B,!0);i(B),i(J);var ue=u(J,2),G=o(ue,!0);i(ue);var z=u(ue,2),le=o(z,!0);i(z),i(me),O(Z=>{w($e,e(Ie).subject),w(te,Z),w(G,e(Ie).currentGap),w(le,e(Ie).potential)},[()=>e(Ie).score.toFixed(1)]),Xa(1,me,()=>zs,()=>({y:-10,duration:350,delay:100+ut*80,easing:Gs})),Xa(2,me,()=>qs,()=>({duration:200})),m(Ae,me)}),i(pe),Hs(pe,Ae=>d[e(oe)]=Ae,()=>d?.[e(oe)]),Xa(1,pe,()=>zs,()=>({y:-20,duration:400,delay:100,easing:Gs})),Xa(2,pe,()=>qs,()=>({duration:200})),m(Ee,pe)};E(Me,Ee=>{e(c)>=e(ne)&&Ee(ze)})}m(Ne,_e)};E(ce,Ne=>{a().areasForGrowth&&a().areasForGrowth.length>0&&Ne(se)})}var Re=u(ce,2);{var Je=Ne=>{var ne=Jh(),oe=u(o(ne),2),_e=o(oe);{var Me=me=>{var J=Yh(),xe=o(J),$e=u(o(xe),2),B=o($e);i($e),i(xe);var te=u(xe,2),ue=o(te,!0);i(te),i(J),O(G=>{w(B,`${G??""}%`),w(ue,a().assessmentInsights.writtenWork.insight)},[()=>a().assessmentInsights.writtenWork.average.toFixed(1)]),Xa(1,J,()=>zs,()=>({y:-10,duration:350,delay:100,easing:Gs})),Xa(2,J,()=>qs,()=>({duration:200})),m(me,J)};E(_e,me=>{a().assessmentInsights.writtenWork&&me(Me)})}var ze=u(_e,2);{var Ee=me=>{var J=Qh(),xe=o(J),$e=u(o(xe),2),B=o($e);i($e),i(xe);var te=u(xe,2),ue=o(te,!0);i(te),i(J),O(G=>{w(B,`${G??""}%`),w(ue,a().assessmentInsights.performanceTasks.insight)},[()=>a().assessmentInsights.performanceTasks.average.toFixed(1)]),Xa(1,J,()=>zs,()=>({y:-10,duration:350,delay:180,easing:Gs})),Xa(2,J,()=>qs,()=>({duration:200})),m(me,J)};E(ze,me=>{a().assessmentInsights.performanceTasks&&me(Ee)})}var pe=u(ze,2);{var qe=me=>{var J=Kh(),xe=o(J),$e=u(o(xe),2),B=o($e);i($e),i(xe);var te=u(xe,2),ue=o(te,!0);i(te),i(J),O(G=>{w(B,`${G??""}%`),w(ue,a().assessmentInsights.quarterlyAssessment.insight)},[()=>a().assessmentInsights.quarterlyAssessment.average.toFixed(1)]),Xa(1,J,()=>zs,()=>({y:-10,duration:350,delay:260,easing:Gs})),Xa(2,J,()=>qs,()=>({duration:200})),m(me,J)};E(pe,me=>{a().assessmentInsights.quarterlyAssessment&&me(qe)})}i(oe);var Ae=u(oe,2),Ie=o(Ae);Fh(Ie,{get subjects(){return l()}});var ut=u(Ie,2);Ph(ut,{get subjects(){return l()}}),i(Ae),i(ne),Hs(ne,me=>d[e(N)]=me,()=>d?.[e(N)]),Xa(1,ne,()=>zs,()=>({y:-20,duration:400,delay:150,easing:Gs})),Xa(2,ne,()=>qs,()=>({duration:200})),m(Ne,ne)};E(Re,Ne=>{e(c)>=e(W)&&Ne(Je)})}var it=u(Re,2);{var Le=Ne=>{const ne=aa(()=>(a().quarterComparison?1:0)+2+(a().areasForGrowth&&a().areasForGrowth.length>0?1:0)+1+1),oe=aa(()=>(a().quarterComparison?1:0)+1+(a().areasForGrowth&&a().areasForGrowth.length>0?1:0)+1+1);var _e=mt(),Me=tt(_e);{var ze=Ee=>{var pe=Zh(),qe=u(o(pe),2);Dt(qe,17,()=>a().actionPlan,Ua,(Ae,Ie,ut)=>{var me=Xh();Wa(me,`--action-index: ${ut};`);var J=o(me),xe=o(J,!0);i(J);var $e=u(J,2),B=o($e,!0);i($e);var te=u($e,2),ue=o(te,!0);i(te),i(me),O(()=>{w(xe,e(Ie).title),w(B,e(Ie).description),w(ue,e(Ie).expectedImpact)}),Xa(1,me,()=>zs,()=>({y:-10,duration:350,delay:100+ut*80,easing:Gs})),Xa(2,me,()=>qs,()=>({duration:200})),m(Ae,me)}),i(pe),Hs(pe,Ae=>d[e(oe)]=Ae,()=>d?.[e(oe)]),Xa(1,pe,()=>zs,()=>({y:-20,duration:400,delay:200,easing:Gs})),Xa(2,pe,()=>qs,()=>({duration:200})),m(Ee,pe)};E(Me,Ee=>{e(c)>=e(ne)&&Ee(ze)})}m(Ne,_e)};E(it,Ne=>{a().actionPlan&&a().actionPlan.length>0&&Ne(Le)})}var ke=u(it,2),Ke=o(ke);{var lt=Ne=>{var ne=mt(),oe=tt(ne);{var _e=ze=>{var Ee=eg();Ee.__click=[Rh,c,d],Xa(1,Ee,()=>zs,()=>({y:20,duration:400,delay:100,easing:Gs})),Xa(2,Ee,()=>qs,()=>({duration:200})),m(ze,Ee)},Me=ze=>{var Ee=tg();Ee.__click=[Ih,c,d],Xa(1,Ee,()=>zs,()=>({y:20,duration:400,delay:100,easing:Gs})),Xa(2,Ee,()=>qs,()=>({duration:200})),m(ze,Ee)};E(oe,ze=>{e(h)?ze(_e):ze(Me,!1)})}m(Ne,ne)};E(Ke,Ne=>{e(c)>1&&Ne(lt)})}var He=u(Ke,2);{var et=Ne=>{var ne=ag();ne.__click=[Mh,c],Xa(1,ne,()=>zs,()=>({y:20,duration:400,delay:100,easing:Gs})),Xa(2,ne,()=>qs,()=>({duration:200})),m(Ne,ne)};E(He,Ne=>{e(h)||Ne(et)})}i(ke),m(Y,L)};E(j,Y=>{a()&&Y(P)},!0)}m(M,F)};E(T,M=>{n()?M(C):M(S,!1)},!0)}m(A,D)};E(b,A=>{r()?A(y):A(k,!1)})}i(g),m(s,g),za()}Ps(["click"]);const ng=300*1e3,_c="student_grades_",bc="student_ai_analysis_",og=10080*60*1e3;function lg(){const s={grades:[],statistics:{overallAverage:0,totalSubjects:0},sectionInfo:null,classRank:null,totalStudentsInSection:0,currentQuarter:2,currentQuarterName:"2nd Quarter",currentSchoolYear:"2025-2026",isLoading:!1,isRefreshing:!1,error:null,lastUpdated:null,currentStudentId:null,previousQuarterAverage:null,averageChange:null,aiAnalysis:null,aiAnalysisLoading:!1,aiAnalysisError:null,aiAnalysisTimestamp:null},{subscribe:t,set:a,update:r}=Ws(s);function n(){const N=yo(gs);if(!N?.isAuthenticated||!N.userData)return{};const L={id:N.userData.id,name:N.userData.name,account_number:N.userData.accountNumber,account_type:N.userData.account_type||N.userData.accountType};return{"x-user-info":JSON.stringify(L)}}function l(N,L,X){return`${_c}${N}_${L}_${X}`}function c(N){return!N||!N.timestamp?!1:Date.now()-N.timestamp<ng}function d(N,L,X){try{const ae=l(N,L,X),V=localStorage.getItem(ae);if(V)return JSON.parse(V).data}catch(ae){console.warn("Failed to retrieve cached student grades data:",ae)}return null}function f(N,L,X){try{const ae=l(N,L,X),V=localStorage.getItem(ae);if(V){const ie=JSON.parse(V);if(c(ie))return ie.data}}catch(ae){console.warn("Failed to retrieve cached student grades data:",ae)}return null}function p(N,L,X,ae){try{const V=l(N,L,X),ie={data:ae,timestamp:Date.now()};localStorage.setItem(V,JSON.stringify(ie))}catch(V){console.warn("Failed to cache student grades data:",V)}}async function h(){try{const L=await(await fetch("/api/current-quarter",{headers:n()})).json();if(L.success&&L.data)return{currentQuarter:L.data.currentQuarter,currentQuarterName:L.data.quarterName,currentSchoolYear:L.data.currentSchoolYear}}catch(N){console.error("Error fetching current quarter/school year:",N)}return{currentQuarter:2,currentQuarterName:"2nd Quarter",currentSchoolYear:"2025-2026"}}async function g(N){try{const X=await(await fetch(`/api/student-profile?studentId=${N}`,{headers:n()})).json();if(X.success){const{section:ae}=X.data;return{sectionInfo:ae}}}catch(L){console.error("Error fetching student profile:",L)}return{sectionInfo:null}}async function b(N,L,X){try{const V=await(await fetch(`/api/class-rankings?studentId=${N}&quarter=${L}&schoolYear=${X}`,{headers:n()})).json();if(V.success)return{classRank:V.myRank,totalStudentsInSection:V.totalStudents}}catch(ae){console.error("Error fetching class rank:",ae)}return{classRank:null,totalStudentsInSection:0}}async function y(N,L,X){try{let ae=L-1,V=X;if(ae<1){ae=4;const[Ge,ce]=X.split("-").map(se=>parseInt(se));V=`${Ge-1}-${ce-1}`}const he=await(await fetch(`/api/student-grades?student_id=${N}&quarter=${ae}&school_year=${V}`,{headers:n()})).json();if(he.success&&he.data.statistics)return he.data.statistics.overallAverage||null}catch(ae){console.error("Error fetching previous quarter average:",ae)}return null}async function k(N,L=null,X=null,ae=!1){try{r(it=>({...it,isLoading:!ae,isRefreshing:ae,error:null,currentStudentId:N}));let V;!L||!X?(V=await h(),L=L||V.currentQuarter,X=X||V.currentSchoolYear):V={currentQuarter:L,currentQuarterName:`${L}${L===1?"st":L===2?"nd":L===3?"rd":"th"} Quarter`,currentSchoolYear:X};const[ie,he,Ge,ce]=await Promise.all([fetch(`/api/student-grades?student_id=${N}&quarter=${L}&school_year=${X}`,{headers:n()}).then(it=>it.json()),g(N),b(N,L,X),y(N,L,X)]);if(!ie.success)throw new Error(ie.error||"Failed to fetch grades data");const se=ie.data.statistics?.overallAverage||0;let Re=null;ce!==null&&se>0&&(Re=se-ce);const Je={grades:ie.data.grades||[],statistics:ie.data.statistics||{overallAverage:0,totalSubjects:0},sectionInfo:he.sectionInfo,classRank:Ge.classRank,totalStudentsInSection:Ge.totalStudentsInSection,currentQuarter:L,currentQuarterName:V.currentQuarterName,currentSchoolYear:X,previousQuarterAverage:ce,averageChange:Re,isLoading:!1,isRefreshing:!1,error:null,lastUpdated:new Date().toISOString(),currentStudentId:N};r(it=>({...it,...Je})),p(N,L,X,{grades:Je.grades,statistics:Je.statistics,sectionInfo:Je.sectionInfo,classRank:Je.classRank,totalStudentsInSection:Je.totalStudentsInSection,currentQuarter:L,currentQuarterName:V.currentQuarterName,currentSchoolYear:X,previousQuarterAverage:Je.previousQuarterAverage,averageChange:Je.averageChange,lastUpdated:Je.lastUpdated})}catch(V){console.error("Error loading student grades:",V);const ie=d(N,L,X);ie?(r(he=>({...he,grades:ie.grades||[],statistics:ie.statistics||{overallAverage:0,totalSubjects:0},sectionInfo:ie.sectionInfo,classRank:ie.classRank,totalStudentsInSection:ie.totalStudentsInSection,currentQuarter:ie.currentQuarter,currentQuarterName:ie.currentQuarterName,currentSchoolYear:ie.currentSchoolYear,previousQuarterAverage:ie.previousQuarterAverage,averageChange:ie.averageChange,lastUpdated:ie.lastUpdated,isLoading:!1,isRefreshing:!1,error:null})),Te.error("No internet connection. Showing offline data.")):r(he=>({...he,isLoading:!1,isRefreshing:!1,error:V.message,grades:[],statistics:{overallAverage:0,totalSubjects:0},previousQuarterAverage:null,averageChange:null}))}}function A(N,L=null,X=null){let ae;if(t(ie=>{ae=ie.currentStudentId})(),ae&&ae!==N&&r(ie=>({...ie,aiAnalysis:null,aiAnalysisLoading:!1,aiAnalysisError:null,aiAnalysisTimestamp:null})),!L||!X)return h().then(ie=>{const he=f(N,ie.currentQuarter,ie.currentSchoolYear);r(he?Ge=>({...Ge,...he,currentStudentId:N,isLoading:!1,isRefreshing:!1,error:null,aiAnalysis:null,aiAnalysisLoading:!1,aiAnalysisError:null,aiAnalysisTimestamp:null}):Ge=>({...Ge,currentStudentId:N,currentQuarter:ie.currentQuarter,currentQuarterName:ie.currentQuarterName,currentSchoolYear:ie.currentSchoolYear,isLoading:!0,isRefreshing:!1,error:null,aiAnalysis:null,aiAnalysisLoading:!1,aiAnalysisError:null,aiAnalysisTimestamp:null}))}),!1;const V=f(N,L,X);return V?(r(ie=>({...ie,...V,currentStudentId:N,isLoading:!1,isRefreshing:!1,error:null,aiAnalysis:null,aiAnalysisLoading:!1,aiAnalysisError:null,aiAnalysisTimestamp:null})),!0):(r(ie=>({...ie,currentStudentId:N,currentQuarter:L,currentSchoolYear:X,isLoading:!0,isRefreshing:!1,error:null,aiAnalysis:null,aiAnalysisLoading:!1,aiAnalysisError:null,aiAnalysisTimestamp:null})),!1)}async function D(N,L,X){const ae=f(N,L,X);ae&&r(V=>({...V,...ae,currentStudentId:N,isLoading:!1,isRefreshing:!1,error:null})),await k(N,L,X,!!ae)}function T(N,L,X){try{const ae=l(N,L,X);localStorage.removeItem(ae)}catch(ae){console.warn("Failed to clear student grades cache:",ae)}return r(ae=>({...s,currentStudentId:N,currentQuarter:L,currentSchoolYear:X,isLoading:!0})),W.loadGrades(N,L,X,!1)}function C(N){try{const L=Object.keys(localStorage),X=`${_c}${N}_`,ae=`${bc}${N}_`;L.forEach(V=>{(V.startsWith(X)||V.startsWith(ae))&&localStorage.removeItem(V)})}catch(L){console.warn("Failed to clear all cache:",L)}}function S(N,L,X){return`${bc}${N}_${L}_${X}`}function M(N,L,X){try{const ae=S(N,L,X),V=localStorage.getItem(ae);if(V){const ie=JSON.parse(V);if(Date.now()-ie.timestamp<og)return ie.data}}catch(ae){console.warn("Failed to retrieve cached AI analysis:",ae)}return null}function F(N,L,X,ae){try{const V=S(N,L,X),ie={data:ae,timestamp:Date.now()};localStorage.setItem(V,JSON.stringify(ie))}catch(V){console.warn("Failed to cache AI analysis:",V)}}async function j(N,L,X,ae=!1){try{r(se=>({...se,aiAnalysisLoading:!0,aiAnalysisError:null}));let V=null,ie=L-1,he=X;if(ie<1){ie=4;const[se,Re]=X.split("-").map(Je=>parseInt(Je));he=`${se-1}-${Re-1}`}if(V={quarter:ie,schoolYear:he},!ae){const se=M(N,L,X);if(se)return console.log("AI Analysis: Using localStorage cache"),r(Re=>({...Re,aiAnalysis:se,aiAnalysisLoading:!1,aiAnalysisError:null,aiAnalysisTimestamp:Date.now()})),se}const Ge=new AbortController,ce=setTimeout(()=>Ge.abort(),9e4);try{const se=await fetch("/api/ai-grade-analysis",{method:"POST",headers:{"Content-Type":"application/json",...n()},body:JSON.stringify({studentId:N,quarter:L,schoolYear:X,forceRefresh:ae,previousQuarterInfo:V}),signal:Ge.signal});if(clearTimeout(ce),!se.ok)throw new Error("Failed to fetch AI analysis");const Re=se.body.getReader(),Je=new TextDecoder;let it="";for(;;){const{value:ke,done:Ke}=await Re.read();if(Ke)break;it+=Je.decode(ke,{stream:!0})}const Le=JSON.parse(it);if(!Le||!Le.overallInsight)throw new Error("Invalid analysis data structure");return F(N,L,X,Le),console.log("AI Analysis: Cached to localStorage and database"),r(ke=>({...ke,aiAnalysis:Le,aiAnalysisLoading:!1,aiAnalysisError:null,aiAnalysisTimestamp:Date.now()})),Le}catch(se){throw clearTimeout(ce),se.name==="AbortError"?new Error("AI analysis is taking longer than expected. Please try again."):se}}catch(V){console.error("Error loading AI analysis:",V);const ie=M(N,L,X);if(ie)return r(he=>({...he,aiAnalysis:ie,aiAnalysisLoading:!1,aiAnalysisError:null,aiAnalysisTimestamp:Date.now()})),ie;throw r(he=>({...he,aiAnalysis:null,aiAnalysisLoading:!1,aiAnalysisError:V.message,aiAnalysisTimestamp:null})),V}}function P(){r(N=>({...N,aiAnalysis:null,aiAnalysisLoading:!1,aiAnalysisError:null,aiAnalysisTimestamp:null}))}function Y(N,L,X){const ae=M(N,L,X);return ae?(r(V=>({...V,aiAnalysis:ae,aiAnalysisTimestamp:Date.now()})),!0):!1}const W={subscribe:t,init:A,loadGrades:k,changeQuarter:D,forceRefresh:T,clearAllCache:C,getCachedData:(N,L,X)=>d(N,L,X),loadAiAnalysis:j,clearAiAnalysis:P,initAiAnalysis:Y,getCachedAiAnalysis:(N,L,X)=>M(N,L,X)};return W}const wr=lg();var cg=_("<button> </button>"),dg=_('<div class="dropdown-menu-quarter"></div>'),ug=_('<div class="error-container"><span class="material-symbols-outlined error-icon">error</span> <p> </p> <button class="retry-btn"><span class="material-symbols-outlined">refresh</span> Try Again</button></div>'),vg=_('<div class="performance-subtitle"> </div>'),fg=_('<div class="grade-comparison no-grades"><span class="material-symbols-outlined comparison-icon">pending</span> <span class="comparison-text">No Grades Yet</span></div>'),pg=_('<div><span class="material-symbols-outlined comparison-icon"><!></span> <span class="comparison-text"><!> from last quarter</span></div>'),mg=_('<div class="grade-comparison first-quarter"><span class="material-symbols-outlined comparison-icon">rocket_launch</span> <span class="comparison-text"> </span></div>'),hg=_('<span class="badge-text"> </span>'),gg=_('<span class="badge-text"> </span>'),_g=_('<div class="performance-stats"><div class="grade-stat-item primary" style="--stat-index: 0;"><div class="stat-header"><div class="stat-label">Quarter Average</div> <div class="stat-icon"><span class="material-symbols-outlined">star</span></div></div> <div class="grade-stat-value"><!></div> <!></div> <div class="grade-stat-item secondary" style="--stat-index: 1;"><div class="stat-header"><div class="stat-label">Total Subjects</div> <div class="stat-icon"><span class="material-symbols-outlined">school</span></div></div> <div class="grade-stat-value"><!></div> <div class="grade-info-badge"><span class="material-symbols-outlined badge-icon">verified</span> <!></div></div> <div class="grade-stat-item tertiary" style="--stat-index: 2;"><div class="stat-header"><div class="stat-label">Class Rank</div> <div class="stat-icon"><span class="material-symbols-outlined">crown</span></div></div> <div class="grade-stat-value">Rank <!></div> <div class="grade-info-badge"><span class="material-symbols-outlined badge-icon">groups</span> <!></div></div></div>'),bg=_('<button class="ai-refresh-btn" title="Refresh analysis"><span class="material-symbols-outlined">refresh</span></button>'),yg=_('<span class="material-symbols-outlined">expand_less</span> <span>Hide Analysis</span>',1),wg=_('<span class="material-symbols-outlined">auto_awesome</span> <span>Get AI Analysis</span>',1),xg=_('<div class="analysis-display-container"><!></div>'),Sg=_('<div class="loading-container"><div class="system-loader"></div> <p>Loading your grades...</p></div>'),kg=_('<div class="no-subjects"><span class="material-symbols-outlined">school</span> <p> </p> <small>Grades will appear here once they are verified by your teachers</small></div>'),Ag=_('<div class="progress-fill progress-fill-animated"></div>'),Dg=_("<span> </span>"),Cg=_('<span class="unverified-indicator" title="Grade not yet verified">*</span>'),Tg=_("<!> <!>",1),Eg=_('<div class="score-item"><span class="score-label"> </span> <span class="score-value"> </span></div>'),Fg=_('<div class="breakdown-category"><div class="category-header"><div class="category-title"><span class="material-symbols-outlined">edit</span> <span>Written Work</span></div> <div class="category-average"> </div></div> <div class="scores-list"></div></div>'),Ng=_('<div class="score-item"><span class="score-label"> </span> <span class="score-value"> </span></div>'),$g=_('<div class="breakdown-category"><div class="category-header"><div class="category-title"><span class="material-symbols-outlined">assignment</span> <span>Performance Tasks</span></div> <div class="category-average"> </div></div> <div class="scores-list"></div></div>'),Lg=_('<div class="score-item"><span class="score-label"> </span> <span class="score-value"> </span></div>'),Pg=_('<div class="breakdown-category quarterly-assessment-category"><div class="category-header"><div class="category-title"><span class="material-symbols-outlined">quiz</span> <span>Quarterly Assessment</span></div> <div class="category-average"> </div></div> <div class="scores-list"></div></div>'),Mg=_('<div class="grade-breakdown-section"><div class="breakdown-container"><!> <!> <!></div></div>'),Ig=_('<div class="subject-accordion"><div><div class="subject-icon-column"><div class="subject-icon"><span class="material-symbols-outlined">book</span></div></div> <div class="subject-details-column"><h3 class="subject-name"> </h3> <p> </p> <div class="progress-bar"><!></div></div> <div class="grade-column"><div class="grade-large"><!></div> <div> </div></div></div> <!></div>'),Rg=_('<div class="subjects-grid"></div>'),Og=_('<div class="performance-card"><div class="performance-header"><div class="performance-title-section"><div class="performance-title-content"><h2 class="performance-title">Academic Performance</h2> <!></div> <button class="refresh-data-btn" title="Refresh data from database"><span class="material-symbols-outlined">refresh</span></button></div></div> <!></div> <div class="ai-analysis-section"><div class="analysis-section-header"><div class="analysis-title-group"><span class="material-symbols-outlined">psychology</span> <h2 class="section-title">AI Performance Insights</h2></div> <div class="analysis-controls"><!> <button><!></button></div></div> <!></div> <div class="subjects-section"><h2 class="section-title">Subject Performance</h2> <!></div>',1),jg=_('<div class="grades-container"><div class="grades-header"><div class="header-content"><h1 class="page-title">My Grades</h1> <p class="page-subtitle">Academic Performance Overview</p></div> <div class="quarter-selector"><div class="custom-dropdown"><button class="dropdown-button"><span class="material-symbols-outlined">calendar_today</span> <span class="dropdown-text"> </span> <span>expand_more</span></button> <!></div></div></div> <!></div>');function qg(s,t){qa(t,!1);const[a,r]=xs(),n=()=>Ja(wr,"$studentGradeStore",a),l=()=>Ja(gs,"$authStore",a),c=R(),d=R(),f=R(),p=R(),h=R(),g=R(),b=R(),y=R(),k=R(),A=R(),D=R(),T=R(),C=R(),S=R(),M=R(),F=R(),j=R(),P=R(),Y=R();let W=["1st Quarter","2nd Quarter","3rd Quarter","4th Quarter"],N=R(!1),L=R(new Set),X=R(!1),ae=R(null),V=R({}),ie={};const he={"1st Quarter":1,"2nd Quarter":2,"3rd Quarter":3,"4th Quarter":4};function Ge(){v(N,!e(N))}async function ce(Z){v(N,!1),wr.clearAiAnalysis(),v(X,!1),Object.values(ie).forEach(U=>{U&&cancelAnimationFrame(U)}),ie={},v(V,{});const q=he[Z];l().userData?.id&&await wr.changeQuarter(l().userData.id,q,e(S))}function se(Z){e(N)&&!Z.target.closest(".custom-dropdown")&&v(N,!1)}function Re(Z){return Z===0||Z===null||Z===void 0?"var(--grade-no-grade)":Z>=85?"var(--grade-excellent)":Z>=80?"var(--grade-good)":Z>=75?"var(--grade-satisfactory)":(Z>=65||Z<65,"var(--grade-needs-improvement)")}function Je(Z,q,U=2500){ie[Z]&&cancelAnimationFrame(ie[Z]);const $=Date.now();function I(){const fe=Date.now()-$,ve=Math.min(fe/U,1);let Fe=0;q>=85?Fe=3:q>=80?Fe=2:q>=75?Fe=1:Fe=0;const Ce=Math.min(ve*1.6,1),Be=Math.min(Math.floor(Ce*(Fe+1)),Fe),Pe=[65,75,80,85][Be];Ns(V,e(V)[Z]=Re(Pe)),v(V,{...e(V)}),ve<1?ie[Z]=requestAnimationFrame(I):(Ns(V,e(V)[Z]=Re(q)),v(V,{...e(V)}),delete ie[Z])}I()}function it(Z,q,U,$){return!q||!U||!$?"N/A":Z>0?Le(Z):"N/A"}function Le(Z){return Z==null||Z===0?"N/A":Z%1===0?Z.toString():Z.toFixed(1)}function ke(Z,q,U,$){return!q||!U||!$||Z===0?0:Math.min(Z/100*100,100)}function Ke(Z){const q=["blue","green","purple","yellow","orange","red","teal","indigo","pink","cyan","lime","amber","deeporange"];return q[Z%q.length]}function lt(Z){const q=Ke(Z);return{border:`var(--subject-card-${q}-border)`,text:`var(--subject-card-${q}-text)`,icon:`var(--subject-card-${q}-icon)`}}function He(Z){return Z>=85?"Excellent":Z>=80?"Good":Z>=75?"Satisfactory":Z>=65?"Needs Improvement":"No Grade"}function et(Z){return Z>=90?"Keep it up!":Z>=85?"Maintain the momentum!":Z>=80?"Push for higher!":Z>=75?"Aim higher next quarter!":"Work harder next quarter!"}function Ne(Z){return!Z||Z.length===0?{verified:0,total:0}:{verified:Z.filter(U=>U.verified&&U.numericGrade>0&&U.teacher!=="No teacher").length,total:Z.length}}let ne=R(0);function oe(Z){e(L).has(Z)?e(L).delete(Z):e(L).add(Z),v(L,new Set(e(L)))}function _e(Z){return Z.verified&&(Z.writtenWorkScores&&Z.writtenWorkScores.length>0||Z.performanceTasksScores&&Z.performanceTasksScores.length>0||Z.quarterlyAssessmentScores&&Z.quarterlyAssessmentScores.length>0)}function Me(Z,q){return`${{written:"Quiz",performance:"Project",quarterly:"Exam"}[q]||"Task"} ${Z+1}`}async function ze(Z=!1){if(!(e(d)||!e(h).length||!l().userData?.id)){v(X,!0);try{const q=he[e(C)];await wr.loadAiAnalysis(l().userData.id,q,e(S),Z),Z||Te.success("AI Analysis generated successfully")}catch(q){console.error("AI Analysis Error:",q),Te.error("Failed to generate AI analysis")}}}async function Ee(){try{await ze(!0),Te.success("Analysis refreshed successfully")}catch(Z){console.error("Error refreshing analysis:",Z)}}function pe(){if(!e(X)&&!e(c)){const Z=l().userData?.id,q=he[e(C)];Z&&(wr.initAiAnalysis(Z,q,e(S))?v(X,!0):ze())}else v(X,!e(X))}Ya(async()=>{if(l().userData?.id){const Z=wr.init(l().userData.id);await wr.loadGrades(l().userData.id,null,null,Z)}return()=>{Object.values(ie).forEach(Z=>{Z&&cancelAnimationFrame(Z)})}}),ht(()=>n(),()=>{v(c,n().aiAnalysis)}),ht(()=>n(),()=>{v(d,n().aiAnalysisLoading)}),ht(()=>n(),()=>{v(f,n().aiAnalysisError)}),ht(()=>l(),()=>{l().userData?.id&&v(ae,l().userData.id)}),ht(()=>(l(),e(ae)),()=>{l().userData?.id&&e(ae)&&e(ae)!==l().userData.id&&v(X,!1)}),ht(()=>n(),()=>{v(p,n().grades)}),ht(()=>e(p),()=>{v(h,e(p))}),ht(()=>n(),()=>{v(g,n().statistics)}),ht(()=>e(g),()=>{v(b,e(g).overallAverage)}),ht(()=>e(g),()=>{v(y,e(g).totalSubjects)}),ht(()=>n(),()=>{v(k,n().sectionInfo)}),ht(()=>n(),()=>{v(A,n().classRank)}),ht(()=>n(),()=>{v(D,n().totalStudentsInSection)}),ht(()=>n(),()=>{v(T,n().currentQuarter)}),ht(()=>n(),()=>{v(C,n().currentQuarterName)}),ht(()=>n(),()=>{v(S,n().currentSchoolYear)}),ht(()=>n(),()=>{v(M,n().isLoading)}),ht(()=>n(),()=>{v(F,n().error)}),ht(()=>n(),()=>{v(j,n().previousQuarterAverage)}),ht(()=>n(),()=>{v(P,n().averageChange)}),ht(()=>(e(p),e(V)),()=>{e(p)&&e(p).length>0&&e(p).some(q=>q.numericGrade>0&&q.teacher!=="No teacher"&&q.verified&&!e(V)[q.id])&&(e(p).forEach(q=>{q.numericGrade>0&&q.teacher!=="No teacher"&&q.verified&&(e(V)[q.id]||Ns(V,e(V)[q.id]=Re(65)))}),v(V,{...e(V)}),setTimeout(()=>{e(p).forEach(q=>{q.numericGrade>0&&q.teacher!=="No teacher"&&q.verified&&Je(q.id,q.numericGrade)})},100))}),ht(()=>e(p),()=>{v(Y,Ne(e(p)))}),ht(()=>(e(T),e(p)),()=>{e(T)&&v(Y,Ne(e(p)))}),ht(()=>(e(T),e(ne)),()=>{e(T),or(ne)}),Ms(),Fs();var qe=jg();Se("click",Zs,se);var Ae=o(qe),Ie=u(o(Ae),2),ut=o(Ie),me=o(ut),J=u(o(me),2),xe=o(J,!0);i(J);var $e=u(J,2);let B;i(me);var te=u(me,2);{var ue=Z=>{var q=dg();Dt(q,5,()=>W,Ua,(U,$)=>{var I=cg();let H;var fe=o(I,!0);i(I),O(ve=>{H=we(I,1,"dropdown-item-quarter",null,H,ve),w(fe,e($))},[()=>({active:e($)===e(C)})]),Se("click",I,()=>ce(e($))),m(U,I)}),i(q),m(Z,q)};E(te,Z=>{e(N)&&Z(ue)})}i(ut),i(Ie),i(Ae);var G=u(Ae,2);{var z=Z=>{var q=ug(),U=u(o(q),2),$=o(U);i(U);var I=u(U,2);i(q),O(()=>w($,`Error: ${e(F)??""}`)),Se("click",I,()=>wr.loadGrades(l().userData.id)),m(Z,q)},le=Z=>{var q=Og(),U=tt(q),$=o(U),I=o($),H=o(I),fe=u(o(H),2);{var ve=Pt=>{var Yt=vg(),ca=o(Yt);i(Yt),O(()=>w(ca,`Grade ${e(k),x(()=>e(k).gradeLevel)??""}  ${e(k),x(()=>e(k).name)??""}`)),m(Pt,Yt)};E(fe,Pt=>{e(k)&&Pt(ve)})}i(H);var Fe=u(H,2);i(I),i($);var Ce=u($,2);Rs(Ce,()=>`stats-${e(T)}-${e(S)}`,Pt=>{var Yt=_g(),ca=o(Yt),ye=u(o(ca),2),Xe=o(ye);Rs(Xe,()=>`${e(T)}-${e(S)}`,de=>{Kr(de,{get value(){return e(b)},decimals:1,duration:2.5,colorTransition:!0,getGradeColor:Re})}),i(ye);var ot=u(ye,2);Rs(ot,()=>`${e(T)}-${e(S)}`,de=>{var ee=mt(),Q=tt(ee);{var Ye=dt=>{var yt=fg();m(dt,yt)},Qe=dt=>{var yt=mt(),zt=tt(yt);{var ga=Oe=>{var ft=pg();let $t;var jt=o(ft),Kt=o(jt);{var oa=ha=>{var Fa=ba("trending_up");m(ha,Fa)},Jt=ha=>{var Fa=mt(),La=tt(Fa);{var da=K=>{var De=ba("trending_down");m(K,De)},fa=K=>{var De=ba("trending_flat");m(K,De)};E(La,K=>{e(P)<0?K(da):K(fa,!1)},!0)}m(ha,Fa)};E(Kt,ha=>{e(P)>0?ha(oa):ha(Jt,!1)})}i(jt);var Ta=u(jt,2),Aa=o(Ta);{var ya=ha=>{var Fa=ba();O(La=>w(Fa,`+${La??""}`),[()=>(e(P),x(()=>e(P).toFixed(1)))]),m(ha,Fa)},ma=ha=>{var Fa=mt(),La=tt(Fa);{var da=K=>{var De=ba();O(Ze=>w(De,Ze),[()=>(e(P),x(()=>e(P).toFixed(1)))]),m(K,De)},fa=K=>{var De=ba("No change");m(K,De)};E(La,K=>{e(P)<0?K(da):K(fa,!1)},!0)}m(ha,Fa)};E(Aa,ha=>{e(P)>0?ha(ya):ha(ma,!1)})}Ht(),i(Ta),i(ft),O(ha=>$t=we(ft,1,"grade-comparison",null,$t,ha),[()=>({positive:e(P)>0,negative:e(P)<0,neutral:e(P)===0})]),m(Oe,ft)},bt=Oe=>{var ft=mt(),$t=tt(ft);{var jt=Kt=>{var oa=mg(),Jt=u(o(oa),2),Ta=o(Jt,!0);i(Jt),i(oa),O(Aa=>w(Ta,Aa),[()=>(e(b),x(()=>et(e(b))))]),m(Kt,oa)};E($t,Kt=>{e(T)===1&&e(b)>0&&Kt(jt)},!0)}m(Oe,ft)};E(zt,Oe=>{e(P)!==null?Oe(ga):Oe(bt,!1)},!0)}m(dt,yt)};E(Q,dt=>{e(b)===0?dt(Ye):dt(Qe,!1)})}m(de,ee)}),i(ca);var be=u(ca,2),je=u(o(be),2),rt=o(je);Rs(rt,()=>`${e(T)}-${e(S)}`,de=>{Kr(de,{get value(){return e(y)},decimals:0,duration:2})}),i(je);var Ft=u(je,2),Vt=u(o(Ft),2);Rs(Vt,()=>`${e(T)}-${e(S)}`,de=>{var ee=hg(),Q=o(ee);i(ee),O(()=>w(Q,`${e(Y),x(()=>e(Y).verified)??""}/${e(Y),x(()=>e(Y).total)??""} Verified Grades`)),m(de,ee)}),i(Ft),i(be);var at=u(be,2),va=u(o(at),2),Ca=u(o(va));Rs(Ca,()=>`${e(T)}-${e(S)}`,de=>{Kr(de,{get value(){return e(A)},decimals:0,duration:2})}),i(va);var gt=u(va,2),_t=u(o(gt),2);Rs(_t,()=>`${e(T)}-${e(S)}`,de=>{var ee=gg(),Q=o(ee);i(ee),O(()=>w(Q,`Out of ${e(D)??""} Students`)),m(de,ee)}),i(gt),i(at),i(Yt),m(Pt,Yt)}),i(U);var Be=u(U,2),Ue=o(Be),Pe=u(o(Ue),2),Ve=o(Pe);{var st=Pt=>{var Yt=bg();Se("click",Yt,Ee),m(Pt,Yt)};E(Ve,Pt=>{e(c)&&!e(d)&&Pt(st)})}var nt=u(Ve,2);let vt;var St=o(nt);{var At=Pt=>{var Yt=yg();Ht(2),m(Pt,Yt)},Wt=Pt=>{var Yt=wg();Ht(2),m(Pt,Yt)};E(St,Pt=>{e(X)?Pt(At):Pt(Wt,!1)})}i(nt),i(Pe),i(Ue);var Nt=u(Ue,2);{var It=Pt=>{var Yt=xg(),ca=o(Yt);ig(ca,{get analysisData(){return e(c)},get isLoading(){return e(d)},get error(){return e(f)},get subjects(){return e(p)}}),i(Yt),m(Pt,Yt)};E(Nt,Pt=>{e(X)&&Pt(It)})}i(Be);var Gt=u(Be,2),Ot=u(o(Gt),2);{var sa=Pt=>{var Yt=Sg();m(Pt,Yt)},Qt=Pt=>{var Yt=mt(),ca=tt(Yt);{var ye=ot=>{var be=kg(),je=u(o(be),2),rt=o(je);i(je),Ht(2),i(be),O(()=>w(rt,`No subjects found for ${e(C)??""}`)),m(ot,be)},Xe=ot=>{var be=mt(),je=tt(be);Rs(je,()=>e(ne),rt=>{var Ft=Rg();Dt(Ft,7,()=>e(h),Vt=>Vt.subject_id||Vt.id,(Vt,at,va)=>{const Ca=fr(()=>(Ss(e(va)),x(()=>lt(e(va))))),gt=fr(()=>(e(at),x(()=>_e(e(at)))));var _t=Ig(),de=o(_t);let ee;var Q=o(de),Ye=o(Q);i(Q);var Qe=u(Q,2),dt=o(Qe),yt=o(dt,!0);i(dt);var zt=u(dt,2);let ga;var bt=o(zt,!0);i(zt);var Oe=u(zt,2),ft=o(Oe);Rs(ft,()=>(e(at),e(T),e(S),x(()=>`${e(at).id}-${e(T)}-${e(S)}`)),ya=>{var ma=mt(),ha=tt(ma);{var Fa=La=>{var da=Ag();O((fa,K)=>Wa(da,`width: ${fa??""}%; background-color: ${K??""}`),[()=>(e(at),x(()=>ke(e(at).numericGrade,e(at).teacher!=="No teacher",e(at).numericGrade>0,e(at).verified))),()=>(e(V),e(at),x(()=>e(V)[e(at).id]||Re(e(at).numericGrade)))]),m(La,da)};E(ha,La=>{e(at),x(()=>ke(e(at).numericGrade,e(at).teacher!=="No teacher",e(at).numericGrade>0,e(at).verified)>0)&&La(Fa)})}m(ya,ma)}),i(Oe),i(Qe);var $t=u(Qe,2),jt=o($t),Kt=o(jt);Rs(Kt,()=>(e(at),e(T),x(()=>`${e(at).id}-${e(T)}`)),ya=>{var ma=Tg(),ha=tt(ma);{var Fa=K=>{Kr(K,{get value(){return e(at),x(()=>e(at).numericGrade)},decimals:1,duration:2.5,colorTransition:!0,getGradeColor:Re})},La=K=>{var De=Dg(),Ze=o(De,!0);i(De),O((wt,qt)=>{Wa(De,`color: ${wt??""}`),w(Ze,qt)},[()=>(e(at),x(()=>Re(e(at).numericGrade))),()=>(e(at),x(()=>it(e(at).numericGrade,e(at).teacher!=="No teacher",e(at).numericGrade>0,e(at).verified)))]),m(K,De)};E(ha,K=>{e(at),x(()=>e(at).numericGrade>0&&e(at).teacher!=="No teacher"&&e(at).verified)?K(Fa):K(La,!1)})}var da=u(ha,2);{var fa=K=>{var De=Cg();m(K,De)};E(da,K=>{e(at),x(()=>e(at).numericGrade>0&&!e(at).verified)&&K(fa)})}m(ya,ma)}),i(jt);var oa=u(jt,2),Jt=o(oa,!0);i(oa),i($t),i(de);var Ta=u(de,2);{var Aa=ya=>{var ma=Mg(),ha=o(ma),Fa=o(ha);{var La=Ze=>{var wt=Fg(),qt=o(wt),Tt=u(o(qt),2),kt=o(Tt,!0);i(Tt),i(qt);var Ea=u(qt,2);Dt(Ea,5,()=>(e(at),x(()=>e(at).writtenWorkScores)),Ua,(_a,ua,Sa)=>{var Ut=Eg(),Xt=o(Ut),ka=o(Xt,!0);i(Xt);var wa=u(Xt,2),Na=o(wa,!0);i(wa),i(Ut),O((pa,xa)=>{w(ka,pa),Wa(wa,`color: ${xa??""}`),w(Na,e(ua))},[()=>x(()=>Me(Sa,"written")),()=>(e(ua),x(()=>Re(e(ua))))]),m(_a,Ut)}),i(Ea),i(wt),O((_a,ua)=>{Wa(Tt,`color: ${_a??""}`),w(kt,ua)},[()=>(e(at),x(()=>Re(e(at).writtenWork))),()=>(e(at),x(()=>Le(e(at).writtenWork)))]),m(Ze,wt)};E(Fa,Ze=>{e(at),x(()=>e(at).writtenWorkScores&&e(at).writtenWorkScores.length>0)&&Ze(La)})}var da=u(Fa,2);{var fa=Ze=>{var wt=$g(),qt=o(wt),Tt=u(o(qt),2),kt=o(Tt,!0);i(Tt),i(qt);var Ea=u(qt,2);Dt(Ea,5,()=>(e(at),x(()=>e(at).performanceTasksScores)),Ua,(_a,ua,Sa)=>{var Ut=Ng(),Xt=o(Ut),ka=o(Xt,!0);i(Xt);var wa=u(Xt,2),Na=o(wa,!0);i(wa),i(Ut),O((pa,xa)=>{w(ka,pa),Wa(wa,`color: ${xa??""}`),w(Na,e(ua))},[()=>x(()=>Me(Sa,"performance")),()=>(e(ua),x(()=>Re(e(ua))))]),m(_a,Ut)}),i(Ea),i(wt),O((_a,ua)=>{Wa(Tt,`color: ${_a??""}`),w(kt,ua)},[()=>(e(at),x(()=>Re(e(at).performanceTasks))),()=>(e(at),x(()=>Le(e(at).performanceTasks)))]),m(Ze,wt)};E(da,Ze=>{e(at),x(()=>e(at).performanceTasksScores&&e(at).performanceTasksScores.length>0)&&Ze(fa)})}var K=u(da,2);{var De=Ze=>{var wt=Pg(),qt=o(wt),Tt=u(o(qt),2),kt=o(Tt,!0);i(Tt),i(qt);var Ea=u(qt,2);Dt(Ea,5,()=>(e(at),x(()=>e(at).quarterlyAssessmentScores)),Ua,(_a,ua,Sa)=>{var Ut=Lg(),Xt=o(Ut),ka=o(Xt,!0);i(Xt);var wa=u(Xt,2),Na=o(wa,!0);i(wa),i(Ut),O((pa,xa)=>{w(ka,pa),Wa(wa,`color: ${xa??""}`),w(Na,e(ua))},[()=>x(()=>Me(Sa,"quarterly")),()=>(e(ua),x(()=>Re(e(ua))))]),m(_a,Ut)}),i(Ea),i(wt),O((_a,ua)=>{Wa(Tt,`color: ${_a??""}`),w(kt,ua)},[()=>(e(at),x(()=>Re(e(at).quarterlyAssessment))),()=>(e(at),x(()=>Le(e(at).quarterlyAssessment)))]),m(Ze,wt)};E(K,Ze=>{e(at),x(()=>e(at).quarterlyAssessmentScores&&e(at).quarterlyAssessmentScores.length>0)&&Ze(De)})}i(ha),i(ma),m(ya,ma)};E(Ta,ya=>{e(L),e(at),x(()=>e(L).has(e(at).id))&&ya(Aa)})}i(_t),O((ya,ma,ha,Fa)=>{Wa(_t,`--card-index: ${e(va)??""};`),ee=we(de,1,"subject-card",null,ee,ya),Wa(de,`border: 2px solid ${Ss(e(Ca)),x(()=>e(Ca).border)??""};`),Mt(de,"role",e(gt)?"button":void 0),Wa(Ye,`color: ${Ss(e(Ca)),x(()=>e(Ca).icon)??""};`),Wa(dt,`color: ${Ss(e(Ca)),x(()=>e(Ca).text)??""};`),w(yt,(e(at),x(()=>e(at).name))),ga=we(zt,1,"teacher-name",null,ga,ma),w(bt,(e(at),x(()=>e(at).teacher))),we(oa,1,`grade-indicator ${ha??""}`),w(Jt,Fa)},[()=>({clickable:e(gt)}),()=>({"no-teacher":e(at).teacher==="No teacher"}),()=>(e(at),x(()=>He(e(at).numericGrade).color)),()=>(e(at),x(()=>He(e(at).numericGrade).text))]),Se("click",de,function(...ya){(e(gt)?()=>oe(e(at).id):void 0)?.apply(this,ya)}),Se("keydown",de,function(...ya){(e(gt)?ma=>ma.key==="Enter"&&oe(e(at).id):void 0)?.apply(this,ya)}),m(Vt,_t)}),i(Ft),m(rt,Ft)}),m(ot,be)};E(ca,ot=>{e(h),x(()=>e(h).length===0)?ot(ye):ot(Xe,!1)},!0)}m(Pt,Yt)};E(Ot,Pt=>{e(M)?Pt(sa):Pt(Qt,!1)})}i(Gt),O(Pt=>{Fe.disabled=e(M),vt=we(nt,1,"toggle-analysis-btn",null,vt,Pt),Mt(nt,"title",e(X)?"Hide Analysis":"Get AI Analysis")},[()=>({active:e(X)})]),Se("click",Fe,()=>wr.forceRefresh(l().userData.id,e(T),e(S))),Se("click",nt,pe),m(Z,q)};E(G,Z=>{e(F)?Z(z):Z(le,!1)})}i(qe),O(Z=>{w(xe,e(C)),B=we($e,1,"material-symbols-outlined dropdown-arrow",null,B,Z)},[()=>({rotated:e(N)})]),Se("click",me,Ge),m(s,qe),za(),r()}const zg=300*1e3,yc="student_class_ranking_";function Gg(){const s={myRank:0,totalStudents:0,myAverage:0,sectionInfo:null,rankingsList:[],isLoading:!1,isRefreshing:!1,error:null,lastUpdated:null,currentStudentId:null,currentQuarter:null,currentSchoolYear:null},{subscribe:t,set:a,update:r}=Ws(s);function n(){const g=yo(gs);if(!g?.isAuthenticated||!g.userData)return{};const b={id:g.userData.id,name:g.userData.name,account_number:g.userData.accountNumber,account_type:g.userData.account_type||g.userData.accountType};return{"x-user-info":JSON.stringify(b)}}function l(g,b,y){return`${yc}${g}_${b}_${y}`}function c(g){return!g||!g.timestamp?!1:Date.now()-g.timestamp<zg}function d(g,b,y){try{const k=l(g,b,y),A=localStorage.getItem(k);if(A)return JSON.parse(A).data}catch(k){console.warn("Failed to retrieve cached class ranking data:",k)}return null}function f(g,b,y){try{const k=l(g,b,y),A=localStorage.getItem(k);if(A){const D=JSON.parse(A);if(c(D))return D.data}}catch(k){console.warn("Failed to retrieve cached class ranking data:",k)}return null}function p(g,b,y,k){try{const A=l(g,b,y),D={data:k,timestamp:Date.now()};localStorage.setItem(A,JSON.stringify(D))}catch(A){console.warn("Failed to cache class ranking data:",A)}}async function h(g,b,y){const k=await fetch(`/api/class-rankings?studentId=${g}&quarter=${b}&schoolYear=${y}`,{headers:n()});if(!k.ok)throw new Error("Failed to load class rankings");return await k.json()}return{subscribe:t,init(g,b,y){const k=f(g,b,y);return k?(r(A=>({...A,...k,currentStudentId:g,currentQuarter:b,currentSchoolYear:y,isLoading:!1,isRefreshing:!1,error:null})),!0):(r(A=>({...A,currentStudentId:g,currentQuarter:b,currentSchoolYear:y,isLoading:!0,isRefreshing:!1,error:null})),!1)},async loadRankings(g,b,y,k=!1){if(!g){console.warn("Student ID is required to load rankings");return}r(A=>({...A,isLoading:A.rankingsList.length===0&&!k,isRefreshing:A.rankingsList.length>0||k,error:null,currentStudentId:g,currentQuarter:b,currentSchoolYear:y}));try{const A=await h(g,b,y),D={myRank:A.myRank||0,totalStudents:A.totalStudents||0,myAverage:A.myAverage||0,sectionInfo:A.sectionInfo||null,rankingsList:A.rankings||[],isLoading:!1,isRefreshing:!1,error:null,lastUpdated:Date.now(),currentStudentId:g,currentQuarter:b,currentSchoolYear:y};p(g,b,y,{myRank:D.myRank,totalStudents:D.totalStudents,myAverage:D.myAverage,sectionInfo:D.sectionInfo,rankingsList:D.rankingsList,lastUpdated:D.lastUpdated}),a(D)}catch(A){console.error("Error loading class rankings:",A);const D=d(g,b,y);console.log("Rankings fetch failed, checking cache:",{hasCachedData:!!D,studentId:g,quarter:b,schoolYear:y}),D?(console.log("Using cached rankings data and showing toast"),r(T=>({...T,myRank:D.myRank||0,totalStudents:D.totalStudents||0,myAverage:D.myAverage||0,sectionInfo:D.sectionInfo||null,rankingsList:D.rankingsList||[],lastUpdated:D.lastUpdated,isLoading:!1,isRefreshing:!1,error:null})),setTimeout(()=>{Te.error("No internet connection. Showing offline data.")},100)):(console.log("No cached data available, showing error container"),r(T=>({...T,isLoading:!1,isRefreshing:!1,error:A.message||"Failed to load rankings"})))}},async refresh(){let g;t(y=>{g=y})(),g.currentStudentId&&g.currentQuarter&&g.currentSchoolYear&&await this.loadRankings(g.currentStudentId,g.currentQuarter,g.currentSchoolYear,!0)},reset(){a(s)},clearCache(g,b,y){try{const k=l(g,b,y);localStorage.removeItem(k)}catch(k){console.warn("Failed to clear cache:",k)}},clearAllCache(){try{Object.keys(localStorage).forEach(b=>{b.startsWith(yc)&&localStorage.removeItem(b)})}catch(g){console.warn("Failed to clear all caches:",g)}}}}const wc=Gg();var Vg=_("<button> </button>"),Bg=_('<div class="dropdown-menu-quarter"></div>'),Wg=_('<div class="error-container"><span class="material-symbols-outlined error-icon">error</span> <p> </p> <button class="retry-btn"><span class="material-symbols-outlined">refresh</span> Try Again</button></div>'),Hg=_('<div class="loading-container"><div class="system-loader"></div> <p>Loading rankings...</p></div>'),Ug=_('<div class="no-rankings"><span class="material-symbols-outlined">leaderboard</span> <p> </p> <small>Rankings will appear here once grades are finalized</small></div>'),Yg=_(`<div class="message-text"><strong>Outstanding!</strong> You're the top student in your class!</div>`),Qg=_(`<div class="message-text"><strong>Excellent work!</strong> You're in 2nd place. Keep pushing for the top!</div>`),Kg=_(`<div class="message-text"><strong>Great job!</strong> You're in 3rd place and in the top tier!</div>`),Jg=_(`<div class="message-text"><strong>Fantastic!</strong> You're in the top 10% of your class!</div>`),Xg=_(`<div class="message-text"><strong>Well done!</strong> You're in the top 25% of your class!</div>`),Zg=_(`<div class="message-text"><strong>Good work!</strong> You're in the top half of your class!</div>`),e_=_('<div class="message-text"><strong>Keep going!</strong> You have great potential to improve!</div>'),t_=_('<div><div class="rank-banner-content"><div class="rank-display"><span> </span> <div class="rank-info"><span class="rank-banner-label">Your Rank</span> <div class="rank-banner-value"><span class="rank-number-display"><!></span> <span class="rank-total"> </span></div></div></div> <div class="rank-divider"></div> <div class="rank-message"><!></div></div></div>'),a_=_('<div><div class="rank-position"><span class="material-symbols-outlined rank-icon"> </span> <span class="rank-number"> </span></div> <div class="student-info"><h3 class="student-name"> </h3> <p class="student-id"> </p></div> <div class="student-average"><span class="average-label">Average</span> <span class="average-value"> </span></div></div>'),s_=_('<div class="rankings-list"></div>'),r_=_("<!> <!>",1),i_=_('<div class="rankings-section"><!></div>'),n_=_('<div class="rankings-container"><div class="rankings-header"><div class="header-content"><h1 class="page-title">Class Rankings</h1> <p class="page-subtitle">Academic Performance Standings</p></div> <div class="quarter-selector"><div class="custom-dropdown"><button class="dropdown-button"><span class="material-symbols-outlined">calendar_today</span> <span class="dropdown-text"> </span> <span>expand_more</span></button> <!></div></div></div> <!></div>');function o_(s,t){qa(t,!1);const[a,r]=xs(),n=()=>Ja(wr,"$studentGradeStore",a),l=()=>Ja(wc,"$studentClassRankingStore",a),c=()=>Ja(gs,"$authStore",a),d=R(),f=R(),p=R(),h=R(),g=R(),b=R(),y=R(),k=R(),A=R();let D=["1st Quarter","2nd Quarter","3rd Quarter","4th Quarter"],T=R(!1);const C={"1st Quarter":1,"2nd Quarter":2,"3rd Quarter":3,"4th Quarter":4};let S=R(0),M=R(!1),F=R(null);function j(){v(T,!e(T))}function P(He){v(T,!1),v(d,He)}function Y(He){e(T)&&!He.target.closest(".custom-dropdown")&&v(T,!1)}function W(He){return He===1?"var(--rank-gold)":He===2?"var(--rank-silver)":He===3?"var(--rank-bronze)":"var(--md-sys-color-on-surface)"}function N(He){return He<=3?"trophy":"military_tech"}function L(He){return He===0||He===null||He===void 0?"var(--grade-no-grade)":He>=85?"var(--grade-excellent)":He>=80?"var(--grade-good)":He>=75?"var(--grade-satisfactory)":(He>=65,"var(--grade-needs-improvement)")}async function X(){if(!c().userData?.id)return;const He=C[e(d)];await wc.loadRankings(c().userData.id,He,e(f))}ht(()=>n(),()=>{v(d,n().currentQuarterName||"1st Quarter")}),ht(()=>n(),()=>{v(f,n().currentSchoolYear||"2025-2026")}),ht(()=>l(),()=>{v(p,l().myRank)}),ht(()=>l(),()=>{v(h,l().totalStudents)}),ht(()=>l(),()=>{v(g,l().myAverage)}),ht(()=>l(),()=>{v(b,l().sectionInfo)}),ht(()=>l(),()=>{v(y,l().rankingsList)}),ht(()=>l(),()=>{v(k,l().isLoading||l().isRefreshing)}),ht(()=>l(),()=>{v(A,l().error)}),ht(()=>(e(S),e(p)),()=>{or(S),v(M,!1),e(p)>0&&setTimeout(()=>{v(M,!0)},700)}),ht(()=>(e(d),c(),e(F)),()=>{e(d)&&c().userData?.id&&(e(F)===null||e(d)!==e(F))&&(v(F,e(d)),X())}),Ms(),Fs();var ae=n_();Se("click",Zs,Y);var V=o(ae),ie=u(o(V),2),he=o(ie),Ge=o(he),ce=u(o(Ge),2),se=o(ce,!0);i(ce);var Re=u(ce,2);let Je;i(Ge);var it=u(Ge,2);{var Le=He=>{var et=Bg();Dt(et,5,()=>D,Ua,(Ne,ne)=>{var oe=Vg();let _e;var Me=o(oe,!0);i(oe),O(ze=>{_e=we(oe,1,"dropdown-item-quarter",null,_e,ze),w(Me,e(ne))},[()=>({active:e(ne)===e(d)})]),Se("click",oe,()=>P(e(ne))),m(Ne,oe)}),i(et),m(He,et)};E(it,He=>{e(T)&&He(Le)})}i(he),i(ie),i(V);var ke=u(V,2);{var Ke=He=>{var et=Wg(),Ne=u(o(et),2),ne=o(Ne);i(Ne);var oe=u(Ne,2);i(et),O(()=>w(ne,`Error: ${e(A)??""}`)),Se("click",oe,X),m(He,et)},lt=He=>{var et=mt(),Ne=tt(et);{var ne=_e=>{var Me=Hg();m(_e,Me)},oe=_e=>{var Me=i_(),ze=o(Me);{var Ee=qe=>{var Ae=Ug(),Ie=u(o(Ae),2),ut=o(Ie);i(Ie),Ht(2),i(Ae),O(()=>w(ut,`No rankings available for ${e(d)??""}`)),m(qe,Ae)},pe=qe=>{var Ae=r_(),Ie=tt(Ae);Rs(Ie,()=>e(S),me=>{var J=t_();let xe;var $e=o(J),B=o($e),te=o(B);let ue;var G=o(te,!0);i(te);var z=u(te,2),le=u(o(z),2),Z=o(le),q=o(Z);{var U=Be=>{var Ue=mt(),Pe=tt(Ue);Rs(Pe,()=>e(p),Ve=>{Kr(Ve,{get value(){return e(p)},get startVal(){return e(h)},duration:1.6,decimals:0})}),m(Be,Ue)},$=Be=>{var Ue=ba();O(()=>w(Ue,e(h))),m(Be,Ue)};E(q,Be=>{e(M)?Be(U):Be($,!1)})}i(Z);var I=u(Z,2),H=o(I);i(I),i(le),i(z),i(B);var fe=u(B,4),ve=o(fe);{var Fe=Be=>{var Ue=Yg();m(Be,Ue)},Ce=Be=>{var Ue=mt(),Pe=tt(Ue);{var Ve=nt=>{var vt=Qg();m(nt,vt)},st=nt=>{var vt=mt(),St=tt(vt);{var At=Nt=>{var It=Kg();m(Nt,It)},Wt=Nt=>{var It=mt(),Gt=tt(It);{var Ot=Qt=>{var Pt=Jg();m(Qt,Pt)},sa=Qt=>{var Pt=mt(),Yt=tt(Pt);{var ca=Xe=>{var ot=Xg();m(Xe,ot)},ye=Xe=>{var ot=mt(),be=tt(ot);{var je=Ft=>{var Vt=Zg();m(Ft,Vt)},rt=Ft=>{var Vt=e_();m(Ft,Vt)};E(be,Ft=>{e(p)<=e(h)*.5?Ft(je):Ft(rt,!1)},!0)}m(Xe,ot)};E(Yt,Xe=>{e(p)<=e(h)*.25?Xe(ca):Xe(ye,!1)},!0)}m(Qt,Pt)};E(Gt,Qt=>{e(p)<=e(h)*.1?Qt(Ot):Qt(sa,!1)},!0)}m(Nt,It)};E(St,Nt=>{e(p)===3?Nt(At):Nt(Wt,!1)},!0)}m(nt,vt)};E(Pe,nt=>{e(p)===2?nt(Ve):nt(st,!1)},!0)}m(Be,Ue)};E(ve,Be=>{e(p)===1?Be(Fe):Be(Ce,!1)})}i(fe),i($e),i(J),O((Be,Ue,Pe,Ve)=>{xe=we(J,1,"student-rank-banner",null,xe,Be),ue=we(te,1,"material-symbols-outlined rank-banner-icon",null,ue,Ue),Wa(te,`color: ${Pe??""};`),w(G,Ve),w(H,`/ ${e(h)??""}`)},[()=>({"top-rank":e(p)<=3}),()=>({"show-icon":e(M)}),()=>(e(p),x(()=>W(e(p)))),()=>(e(p),x(()=>N(e(p))))]),m(me,J)});var ut=u(Ie,2);Rs(ut,()=>e(S),me=>{var J=s_();Dt(J,7,()=>e(y),xe=>xe.studentId,(xe,$e,B)=>{var te=a_();let ue;var G=o(te),z=o(G),le=o(z,!0);i(z);var Z=u(z,2),q=o(Z,!0);i(Z),i(G);var U=u(G,2),$=o(U),I=o($,!0);i($);var H=u($,2),fe=o(H);i(H),i(U);var ve=u(U,2),Fe=u(o(ve),2),Ce=o(Fe,!0);i(Fe),i(ve),i(te),O((Be,Ue,Pe,Ve,st,nt)=>{ue=we(te,1,"ranking-card",null,ue,Be),Wa(te,`--card-index: ${e(B)??""};`),Wa(z,`color: ${Ue??""};`),w(le,Pe),Wa(Z,`color: ${Ve??""};`),w(q,(e($e),x(()=>e($e).rank))),w(I,(e($e),c(),x(()=>e($e).studentId===c().userData?.id?"You":e($e).name))),w(fe,`ID: ${e($e),x(()=>e($e).studentNumber)??""}`),Wa(Fe,`color: ${st??""};`),w(Ce,nt)},[()=>({"my-rank":e($e).studentId===c().userData?.id}),()=>(e($e),x(()=>W(e($e).rank))),()=>(e($e),x(()=>N(e($e).rank))),()=>(e($e),x(()=>W(e($e).rank))),()=>(e($e),x(()=>L(e($e).average))),()=>(e($e),x(()=>e($e).average.toFixed(1)))]),m(xe,te)}),i(J),m(me,J)}),m(qe,Ae)};E(ze,qe=>{e(y),x(()=>e(y).length===0)?qe(Ee):qe(pe,!1)})}i(Me),m(_e,Me)};E(Ne,_e=>{e(k)?_e(ne):_e(oe,!1)},!0)}m(He,et)};E(ke,He=>{e(A)?He(Ke):He(lt,!1)})}i(ae),O(He=>{w(se,e(d)),Je=we(Re,1,"material-symbols-outlined dropdown-arrow",null,Je,He)},[()=>({rotated:e(T)})]),Se("click",Ge,j),m(s,ae),za(),r()}const l_=300*1e3,c_="student_schedule_";function xc(){let s;return gs.subscribe(t=>{s=t.userData})(),s?{"x-user-info":JSON.stringify({id:s.id,name:s.name,account_number:s.accountNumber,account_type:s.accountType})}:(console.warn("No user info available for authentication"),{})}function d_(){const s={scheduleData:{Mon:[],Tue:[],Wed:[],Thu:[],Fri:[]},isLoading:!1,isRefreshing:!1,error:null,lastUpdated:null,currentStudentId:null},{subscribe:t,set:a,update:r}=Ws(s);function n(C){return`${c_}${C}`}function l(C){return!C||!C.timestamp?!1:Date.now()-C.timestamp<l_}function c(C){try{const S=n(C),M=localStorage.getItem(S);if(M)return JSON.parse(M).data}catch(S){console.warn("Failed to retrieve cached student schedule data:",S)}return null}function d(C){try{const S=n(C),M=localStorage.getItem(S);if(M){const F=JSON.parse(M);if(l(F))return F.data}}catch(S){console.warn("Failed to retrieve cached student schedule data:",S)}return null}function f(C,S){try{const M=n(C),F={data:S,timestamp:Date.now()};localStorage.setItem(M,JSON.stringify(F))}catch(M){console.warn("Failed to cache student schedule data:",M)}}const p={monday:"Mon",tuesday:"Tue",wednesday:"Wed",thursday:"Thu",friday:"Fri"},h=["blue","green","purple","yellow","orange"];function g(C){return h[C%h.length]}function b(C){const[S,M]=C.split(":"),F=parseInt(S),j=F>=12?"PM":"AM";return`${(F===0?12:F>12?F-12:F).toString().padStart(2,"0")}:${M} ${j}`}function y(C){const S={Mon:[],Tue:[],Wed:[],Thu:[],Fri:[]},M={Mon:0,Tue:0,Wed:0,Thu:0,Fri:0};return C.forEach(F=>{const j=p[F.day_of_week.toLowerCase()];if(j){const P=b(F.start_time),Y=b(F.end_time);let W,N;F.schedule_type==="subject"?(W=F.subject_name||"Unknown Subject",N=F.teacher_name||"No Teacher Assigned"):F.schedule_type==="activity"&&(W=F.activity_type_name||"Activity",N=F.teacher_name||"");const L={name:W,time:`${P} - ${Y}`,room:F.room_name||"TBA",teacher:N,scheduleType:F.schedule_type,color:g(M[j])};S[j].push(L),M[j]++}}),S}async function k(C,S=!1){try{r(N=>({...N,isLoading:!S,isRefreshing:S,error:null,currentStudentId:C}));const j=(await(await fetch("/api/current-quarter",{headers:xc()})).json()).data?.currentSchoolYear||"2025-2026",Y=await(await fetch(`/api/schedules?action=student-schedules&studentId=${C}&schoolYear=${j}`,{headers:xc()})).json();if(!Y.success)throw new Error(Y.error||"Failed to fetch schedule data");const W=y(Y.data);r(N=>({...N,scheduleData:W,isLoading:!1,isRefreshing:!1,error:null,lastUpdated:new Date().toISOString()})),f(C,{scheduleData:W,lastUpdated:new Date().toISOString()})}catch(M){console.error("Error loading student schedule:",M);const F=c(C);F?(r(j=>({...j,isLoading:!1,isRefreshing:!1,error:null,scheduleData:F.scheduleData||{Mon:[],Tue:[],Wed:[],Thu:[],Fri:[]},lastUpdated:F.lastUpdated})),Te.error("No internet connection. Showing offline data.")):r(j=>({...j,isLoading:!1,isRefreshing:!1,error:M.message,scheduleData:{Mon:[],Tue:[],Wed:[],Thu:[],Fri:[]}}))}}function A(C){const S=d(C);return S?(r(M=>({...M,...S,currentStudentId:C,isLoading:!1,isRefreshing:!1,error:null})),!0):(r(M=>({...M,currentStudentId:C,isLoading:!0,isRefreshing:!1,error:null})),!1)}function D(C){try{const S=n(C);localStorage.removeItem(S)}catch(S){console.warn("Failed to clear student schedule cache:",S)}return r(S=>({...s,currentStudentId:C,isLoading:!0})),T.loadSchedule(C,!1)}const T={subscribe:t,init:A,loadSchedule:k,forceRefresh:D,getCachedData:C=>c(C)};return T}const Ni=d_();var u_=_('<button><div class="day-name"> </div> <div class="day-name-full"> </div></button>'),v_=_("<button> </button>"),f_=_('<div class="schedule-dropdown-menu"></div>'),p_=_('<div class="loading-message"><div class="system-loader"></div> <p>Loading Schedule...</p></div>'),m_=_('<div class="error-message"><div class="error-icon"><span class="material-symbols-outlined">error</span></div> <p>Error Loading Schedule</p> <p> </p> <button class="retry-button"><span class="material-symbols-outlined">refresh</span> Try Again</button></div>'),h_=_('<div class="class-teacher"><span class="material-symbols-outlined">person_book</span> <span> </span></div>'),g_=_('<div><div class="class-header"><h3 class="class-name"> </h3> <span class="class-time"> </span></div> <div class="class-details"><div class="class-location"><span class="material-symbols-outlined">location_on</span> <span> </span></div> <!></div></div>'),__=_('<div class="classes-list"></div>'),b_=_('<div class="no-classes-message"><div class="no-classes-icon"><span class="material-symbols-outlined">event_available</span></div> <h3>No Classes Scheduled</h3> <p> </p></div>'),y_=_('<div class="schedule-container" role="button" tabindex="0"><div class="schedule-header"><div class="schedule-header-content"><div class="schedule-header-text"><h1 class="page-title">Schedule</h1> <p class="page-subtitle">Your weekly class schedule</p></div></div></div> <div class="week-navigation"><div class="week-title"><span> </span></div> <div class="day-selector"></div> <div class="schedule-mobile-dropdown"><button class="schedule-dropdown-toggle-date"><span> </span> <span>expand_more</span></button> <!></div></div> <div class="classes-section"><div class="classes-header"><h2> </h2> <div class="refresh-controls"><button class="refresh-button"><span class="material-symbols-outlined">refresh</span></button></div></div> <!></div></div>');function w_(s,t){qa(t,!1);const[a,r]=xs(),n=()=>Ja(Ni,"$studentScheduleStore",a),l=()=>Ja(gs,"$authStore",a),c=R(),d=R(),f=R(),p=R(),h=R(),g=R(),b=R(),y=new Date,k=["January","February","March","April","May","June","July","August","September","October","November","December"],A=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],D=k[y.getMonth()],T=y.getDate(),C=A[y.getDay()],S={1:"Mon",2:"Tue",3:"Wed",4:"Thu",5:"Fri"},M=y.getDay();let F=R(S[M]||"Mon");async function j(){const pe=l();pe.isAuthenticated&&pe.userData?.id&&await Ni.forceRefresh(pe.userData.id)}Ya(()=>{const pe=l();if(pe.isAuthenticated&&pe.userData?.id){const qe=Ni.init(pe.userData.id);Ni.loadSchedule(pe.userData.id,qe);const Ae=setInterval(()=>{const Ie=l();Ie.isAuthenticated&&Ie.userData?.id&&Ni.loadSchedule(Ie.userData.id,!0)},300*1e3);return()=>{clearInterval(Ae)}}});const P=[{day:"Mon"},{day:"Tue"},{day:"Wed"},{day:"Thu"},{day:"Fri"}],Y={Mon:"Monday",Tue:"Tuesday",Wed:"Wednesday",Thu:"Thursday",Fri:"Friday"};let W=R(0),N=R(!1);function L(pe){pe.target.closest(".schedule-mobile-dropdown")||v(N,!1)}function X(){v(N,!e(N))}function ae(pe){v(F,pe),v(N,!1)}ht(()=>(e(c),e(d),e(f),e(p),e(h),n()),()=>{(pe=>{v(c,pe.scheduleData),v(d,pe.isLoading),v(f,pe.isRefreshing),v(p,pe.error),v(h,pe.lastUpdated)})(n())}),ht(()=>(e(c),e(F)),()=>{v(g,e(c)[e(F)]||[])}),ht(()=>e(F),()=>{v(b,Y[e(F)]||"Monday")}),ht(()=>(e(F),e(W)),()=>{e(F),or(W)}),Ms(),Fs();var V=y_(),ie=u(o(V),2),he=o(ie),Ge=o(he),ce=o(Ge);i(Ge),i(he);var se=u(he,2);Dt(se,5,()=>P,Ua,(pe,qe)=>{let Ae=()=>e(qe).day;var Ie=u_(),ut=o(Ie),me=o(ut,!0);i(ut);var J=u(ut,2),xe=o(J,!0);i(J),i(Ie),O(()=>{we(Ie,1,`day-btn ${Ae()===e(F)?"active":""}`),w(me,Ae()),w(xe,(Ae(),x(()=>Y[Ae()])))}),Se("click",Ie,()=>ae(Ae())),m(pe,Ie)}),i(se);var Re=u(se,2),Je=o(Re),it=o(Je),Le=o(it,!0);i(it);var ke=u(it,2);i(Je);var Ke=u(Je,2);{var lt=pe=>{var qe=f_();Dt(qe,5,()=>P,Ua,(Ae,Ie)=>{let ut=()=>e(Ie).day;var me=v_(),J=o(me,!0);i(me),O(()=>{we(me,1,`schedule-dropdown-item ${ut()===e(F)?"selected":""}`),w(J,(ut(),x(()=>Y[ut()])))}),Se("click",me,()=>ae(ut())),m(Ae,me)}),i(qe),m(pe,qe)};E(Ke,pe=>{e(N)&&pe(lt)})}i(Re),i(ie);var He=u(ie,2),et=o(He),Ne=o(et),ne=o(Ne);i(Ne);var oe=u(Ne,2),_e=o(oe);i(oe),i(et);var Me=u(et,2);{var ze=pe=>{var qe=p_();m(pe,qe)},Ee=pe=>{var qe=mt(),Ae=tt(qe);{var Ie=me=>{var J=m_(),xe=u(o(J),4),$e=o(xe,!0);i(xe);var B=u(xe,2);i(J),O(()=>w($e,e(p))),Se("click",B,j),m(me,J)},ut=me=>{var J=mt(),xe=tt(J);{var $e=te=>{var ue=mt(),G=tt(ue);Rs(G,()=>e(W),z=>{var le=__();Dt(le,5,()=>e(g),Ua,(Z,q,U)=>{var $=g_();Wa($,`--card-index: ${U};`);var I=o($),H=o(I),fe=o(H,!0);i(H);var ve=u(H,2),Fe=o(ve,!0);i(ve),i(I);var Ce=u(I,2),Be=o(Ce),Ue=u(o(Be),2),Pe=o(Ue,!0);i(Ue),i(Be);var Ve=u(Be,2);{var st=nt=>{var vt=h_(),St=u(o(vt),2),At=o(St,!0);i(St),i(vt),O(()=>w(At,(e(q),x(()=>e(q).teacher)))),m(nt,vt)};E(Ve,nt=>{e(q),x(()=>e(q).teacher)&&nt(st)})}i(Ce),i($),O(()=>{we($,1,`class-card ${e(q),x(()=>e(q).color)??""}`),w(fe,(e(q),x(()=>e(q).name))),w(Fe,(e(q),x(()=>e(q).time))),w(Pe,(e(q),x(()=>e(q).scheduleType==="activity"?"No room":e(q).room)))}),m(Z,$)}),i(le),m(z,le)}),m(te,ue)},B=te=>{var ue=b_(),G=u(o(ue),4),z=o(G);i(G),i(ue),O(()=>w(z,`You don't have any classes scheduled for ${e(b)??""}. Enjoy your free day!`)),m(te,ue)};E(xe,te=>{e(g),x(()=>e(g).length>0)?te($e):te(B,!1)},!0)}m(me,J)};E(Ae,me=>{e(p)?me(Ie):me(ut,!1)},!0)}m(pe,qe)};E(Me,pe=>{e(d)?pe(ze):pe(Ee,!1)})}i(He),i(V),O(()=>{w(ce,`${C??""}, ${D??""} ${T??""}`),w(Le,(e(F),x(()=>Y[e(F)]||"Select Day"))),we(ke,1,`material-symbols-outlined schedule-dropdown-icon ${e(N)?"open":""}`),w(ne,`${e(b)??""} Classes`),_e.disabled=e(d)}),Se("click",Je,X),Se("click",_e,j),Se("click",V,L),Se("keydown",V,L),m(s,V),za(),r()}const x_=300*1e3,S_="student_doc_requests_";function k_(){const s={requestHistory:[],isLoading:!1,isRefreshing:!1,error:null,lastUpdated:null,currentStudentId:null},{subscribe:t,set:a,update:r}=Ws(s);function n(C){return`${S_}${C}`}function l(C){return!C||!C.timestamp?!1:Date.now()-C.timestamp<x_}function c(C){try{const S=n(C),M=localStorage.getItem(S);if(M)return JSON.parse(M).data}catch(S){console.warn("Failed to retrieve cached document request data:",S)}return null}function d(C){try{const S=n(C),M=localStorage.getItem(S);if(M){const F=JSON.parse(M);if(l(F))return F.data}}catch(S){console.warn("Failed to retrieve cached document request data:",S)}return null}function f(C,S){try{const M=n(C),F={data:S,timestamp:Date.now()};localStorage.setItem(M,JSON.stringify(F))}catch(M){console.warn("Failed to cache document request data:",M)}}function p(C){return C}async function h(C=!1){try{r(P=>({...P,isLoading:!C,isRefreshing:C,error:null}));const S=await la.get("/api/document-requests?action=student");if(!S.success)throw new Error(S.error||"Failed to load document requests");const M=S.data.map(P=>({id:P.id,requestId:P.requestId,type:P.documentType,purpose:P.purpose,status:P.status,requestedDate:P.submittedDate,completedDate:P.completedDate,cancelledDate:P.cancelledDate,tentativeDate:P.tentativeDate,payment:P.payment,paymentAmount:P.paymentAmount,paymentStatus:P.paymentStatus||"pending",processedBy:P.processedBy,adminName:P.processedBy,adminNote:P.adminNote,rejectionReason:P.rejectionReason,messages:P.messages||[],lastReadAt:P.lastReadAt||null}));r(P=>({...P,requestHistory:M,isLoading:!1,isRefreshing:!1,error:null,lastUpdated:new Date().toISOString()}));const F={requestHistory:M,lastUpdated:new Date().toISOString()};let j;r(P=>(j=P.currentStudentId,P)),j&&f(j,F)}catch(S){console.error("Error loading document requests:",S);let M;r(j=>(M=j.currentStudentId,j));const F=c(M);F?(r(j=>({...j,requestHistory:F.requestHistory||[],lastUpdated:F.lastUpdated,isLoading:!1,isRefreshing:!1,error:null})),Te.error("No internet connection. Showing offline data.")):r(j=>({...j,isLoading:!1,isRefreshing:!1,error:S.message,requestHistory:[]}))}}function g(C){const S=d(C);return S?(r(M=>({...M,...S,currentStudentId:C,isLoading:!1,isRefreshing:!1,error:null})),!0):(r(M=>({...M,currentStudentId:C,isLoading:!0,isRefreshing:!1,error:null})),!1)}async function b(C){try{const S=n(C);localStorage.removeItem(S)}catch(S){console.warn("Failed to clear document request cache:",S)}return r(S=>({...s,currentStudentId:C,isLoading:!0})),await T.loadDocumentRequests(!1)}async function y(C,S){try{const M=await la.post("/api/document-requests",{action:"create",documentType:C,purpose:S.trim(),paymentAmount:null,isUrgent:!1});if(!M.success)throw new Error(M.error||"Failed to submit request");return await T.loadDocumentRequests(!1),{success:!0}}catch(M){return console.error("Error submitting document request:",M),{success:!1,error:M.message}}}async function k(C){try{const S=await la.post("/api/document-requests",{action:"cancel",requestId:C});if(!S.success)throw new Error(S.error||"Failed to cancel request");return await T.loadDocumentRequests(!1),{success:!0}}catch(S){return console.error("Error cancelling document request:",S),{success:!1,error:S.message}}}async function A(C){try{const S=await la.post("/api/document-requests",{action:"markAsRead",requestId:C});return S.success&&r(M=>({...M,requestHistory:M.requestHistory.map(F=>F.requestId===C?{...F,lastReadAt:S.data.lastReadAt}:F)})),{success:S.success}}catch(S){return console.error("Error marking messages as read:",S),{success:!1,error:S.message}}}async function D(C){try{const S=await la.get(`/api/document-requests?action=single&requestId=${C}`);if(!S.success)throw new Error(S.error||"Failed to load request details");return{success:!0,data:{...S.data,type:S.data.documentType,requestedDate:S.data.submittedDate,paymentAmount:S.data.paymentAmount,paymentStatus:S.data.paymentStatus??"pending"}}}catch(S){return console.error("Error fetching request details:",S),{success:!1,error:S.message}}}const T={subscribe:t,init:g,loadDocumentRequests:h,forceRefresh:b,submitRequest:y,cancelRequest:k,markMessagesAsRead:A,getRequestDetails:D,getCachedData:C=>c(C)};return T}const gr=k_();function Sc(s,t){s.target.closest(".custom-dropdown")||v(t,!1)}function A_(s,t){v(t,!e(t))}var D_=(s,t,a)=>t(e(a)),C_=_('<button><div class="doc-dropdown-item-content"><span class="doc-dropdown-item-name"> </span> <span class="doc-dropdown-item-desc"> </span></div></button>'),T_=_('<div class="dropdown-menu-document"></div>'),E_=_('<div class="request-form-section"><div class="form-container"><div class="form-header"><h2 class="form-title">New Document Request</h2> <p class="form-subtitle">Fill out the form below to request a document</p></div> <div class="form-content"><div class="form-group"><label class="form-label" for="document-type-dropdown"><span class="material-symbols-outlined form-icon">description</span> Document Type</label> <div class="custom-dropdown"><button id="document-type-dropdown" class="dropdown-toggle"><span><!></span> <span>expand_more</span></button> <!></div></div> <div class="form-group"><label class="form-label" for="description"><span class="material-symbols-outlined form-icon">edit_note</span> Purpose & Details</label> <textarea id="description" class="form-textarea enhanced" placeholder="Please describe the purpose of your request and any specific requirements..." rows="5" maxlength="200"></textarea> <div class="form-help"><span class="material-symbols-outlined help-icon">info</span> Be specific about your needs to help us process your request efficiently <span class="char-counter"> </span></div></div> <div class="document-form-actions"><button class="document-cancel-button">Cancel</button> <button class="submit-button"><!></button></div></div></div></div>'),F_=_('<div class="error-message" style="padding: 20px; background: #fee; border-radius: 8px; color: #c33; margin: 20px 0;"><strong>Error:</strong> </div>'),N_=_('<div class="loading-message"><div class="system-loader"></div> Loading your document requests...</div>'),$_=_('<div class="no-requests-message"><span class="material-symbols-outlined">description</span> <p>No document requests found</p> <p class="subtitle">Start by requesting your first document above</p></div>'),L_=(s,t,a)=>t(e(a)),P_=_('<span class="chat-badge"> </span>'),M_=_('<div class="request-footer completed-footer"><span class="footer-info"> </span></div>'),I_=_("<span> </span>"),R_=_('<div class="request-footer processing-footer"><span class="footer-info"><!> <!></span></div>'),O_=_('<div class="request-footer pending-footer"><span class="footer-info">Awaiting review</span></div>'),j_=_('<div class="request-footer cancelled-footer"><span class="footer-info"> </span></div>'),q_=_('<div class="request-footer rejected-footer"><span class="footer-info"> </span></div>'),z_=_('<div><div class="request-main-content"><div class="request-status-icon"><span class="material-symbols-outlined"> </span></div> <div class="request-content"><div class="request-header"><div class="request-info"><h3 class="request-title"> </h3> <p class="request-date"> </p></div> <div class="request-header-actions"><div> </div> <button class="chat-indicator-btn"><span class="material-symbols-outlined">chat_bubble</span> <!></button></div></div></div></div> <!></div>'),G_=_('<div class="request-history-grid"></div>'),V_=_('<div class="document-request-container"><div class="document-header"><div class="header-content"><h1 class="page-title">Document Requests</h1> <p class="page-subtitle">Request new documents or check existing requests</p></div></div> <div class="quick-actions-section"><div class="quick-actions-header"><h2 class="quick-actions-title">Request a Document</h2> <div style="display: flex; gap: 8px;"><button class="request-new-button"><span class="material-symbols-outlined"> </span> <span class="request-new-button-text"> </span></button></div></div></div> <!> <div class="request-history-section"><div class="request-history-header"><h2 class="section-title">Request History</h2> <button class="refresh-button" title="Refresh document requests"><span class="material-symbols-outlined">refresh</span></button></div> <!> <!></div></div>');function B_(s,t){qa(t,!0);const[a,r]=xs(),n=()=>Ja(gr,"$studentDocumentRequestStore",a),l=()=>Ja(gs,"$authStore",a);let c=Ma(t,"openRequestId",15,null),d=pt(!1),f=pt(""),p=pt(""),h=pt(!1),g=pt(!1),b,y=aa(()=>n().requestHistory),k=aa(()=>n().isLoading),A=aa(()=>n().error);function D(ne){v(f,ne.id,!0),v(g,!1)}const T=[{id:"Transcript of Records (TOR)",name:"Transcript of Records (TOR)",description:"Official academic record"},{id:"Enrollment Certificate",name:"Enrollment Certificate",description:"Proof of enrollment"},{id:"Grade Report",name:"Grade Report",description:"Semester grade report"},{id:"Diploma",name:"Diploma",description:"Official graduation certificate"},{id:"Certificate",name:"Certificate",description:"Academic achievement certificate"},{id:"Good Moral",name:"Good Moral",description:"Certificate of good moral character"},{id:"Grade Slip",name:"Grade Slip",description:"Grade slip for specific period"}];async function C(){const ne=l();ne.isAuthenticated&&ne.userData?.id&&await gr.forceRefresh(ne.userData.id)}Ya(()=>{const ne=l();if(ne.isAuthenticated&&ne.userData?.id){const oe=gr.init(ne.userData.id);gr.loadDocumentRequests(oe),b=setInterval(()=>{const _e=l();_e.isAuthenticated&&_e.userData?.id&&gr.loadDocumentRequests(!0)},30*1e3)}}),Es(()=>{if(c()&&e(y).length>0){const ne=e(y).find(oe=>oe.requestId===c());ne&&W(ne),c(null)}}),ti(()=>{b&&clearInterval(b)});function S(ne){return{on_hold:"On Hold",verifying:"Verifying",processing:"For Processing",for_pickup:"For Pick Up",released:"Released",rejected:"Rejected",cancelled:"Cancelled"}[ne]||ne}function M(ne){if(!ne)return"N/A";const oe=new Date(ne),_e=String(oe.getMonth()+1).padStart(2,"0"),Me=String(oe.getDate()).padStart(2,"0"),ze=oe.getFullYear();return`${_e}/${Me}/${ze}`}async function F(){if(!(!e(f)||!e(p).trim()))try{v(h,!0);const ne=T.find(_e=>_e.id===e(f))?.name,oe=await gr.submitRequest(ne||e(f),e(p));oe.success?(j(),Te.success("Document request submitted successfully")):Te.error(oe.error||"Failed to submit request")}catch(ne){console.error("Error submitting request:",ne),Te.error("Failed to submit document request")}finally{v(h,!1)}}function j(){v(d,!e(d)),e(d)?setTimeout(()=>{const ne=document.querySelector(".request-form-section");ne&&ne.scrollIntoView({behavior:"smooth",block:"center"})},100):(v(f,""),v(p,""),v(g,!1))}function P(ne){switch(ne){case"on_hold":return"pause_circle";case"verifying":return"fact_check";case"processing":return"sync";case"for_pickup":return"hand_package";case"released":return"check_circle";case"rejected":return"cancel";case"cancelled":return"block";default:return"help"}}function Y(ne){if(!ne.messages||ne.messages.length===0)return 0;if(!ne.lastReadAt)return ne.messages.length;const oe=new Date(ne.lastReadAt).getTime();return ne.messages.filter(_e=>new Date(_e.created_at).getTime()>oe).length}async function W(ne){try{const oe=await gr.getRequestDetails(ne.requestId);oe.success?(au.open(oe.data,N,()=>gr.loadDocumentRequests(!1)),await gr.markMessagesAsRead(ne.requestId)):(console.error("Failed to fetch request details:",oe.error),Te.error("Failed to load request details. Please try again."))}catch(oe){console.error("Error fetching request details:",oe),Te.error("An error occurred while loading the request details.")}}async function N(ne){try{const oe=await gr.cancelRequest(ne.requestId);oe.success?Te.success("Document request cancelled successfully"):(console.error("Failed to cancel request:",oe.error),Te.error(oe.error||"Failed to cancel request"))}catch(oe){console.error("Error cancelling request:",oe),Te.error("Failed to cancel request")}}var L=V_();L.__click=[Sc,g],L.__keydown=[Sc,g];var X=u(o(L),2),ae=o(X),V=u(o(ae),2),ie=o(V);ie.__click=j;var he=o(ie),Ge=o(he,!0);i(he);var ce=u(he,2),se=o(ce,!0);i(ce),i(ie),i(V),i(ae),i(X);var Re=u(X,2);{var Je=ne=>{var oe=E_(),_e=o(oe),Me=u(o(_e),2),ze=o(Me),Ee=u(o(ze),2),pe=o(Ee);pe.__click=[A_,g];var qe=o(pe),Ae=o(qe);{var Ie=I=>{var H=ba();O(fe=>w(H,fe),[()=>T.find(fe=>fe.id===e(f))?.name||"Select Document Type"]),m(I,H)},ut=I=>{var H=ba("Choose the document you need");m(I,H)};E(Ae,I=>{e(f)?I(Ie):I(ut,!1)})}i(qe);var me=u(qe,2);i(pe);var J=u(pe,2);{var xe=I=>{var H=T_();Dt(H,21,()=>T,Ua,(fe,ve)=>{var Fe=C_();Fe.__click=[D_,D,ve];var Ce=o(Fe),Be=o(Ce),Ue=o(Be,!0);i(Be);var Pe=u(Be,2),Ve=o(Pe,!0);i(Pe),i(Ce),i(Fe),O(()=>{we(Fe,1,`doc-dropdown-item ${e(ve).id===e(f)?"selected":""}`),w(Ue,e(ve).name),w(Ve,e(ve).description)}),m(fe,Fe)}),i(H),m(I,H)};E(J,I=>{e(g)&&I(xe)})}i(Ee),i(ze);var $e=u(ze,2),B=u(o($e),2);kn(B);var te=u(B,2),ue=u(o(te),2),G=o(ue);i(ue),i(te),i($e);var z=u($e,2),le=o(z);le.__click=j;var Z=u(le,2);Z.__click=F;var q=o(Z);{var U=I=>{var H=ba("Submitting...");m(I,H)},$=I=>{var H=ba("Submit");m(I,H)};E(q,I=>{e(h)?I(U):I($,!1)})}i(Z),i(z),i(Me),i(_e),i(oe),O(I=>{we(me,1,`material-symbols-outlined dropdown-icon ${e(g)?"open":""}`),w(G,`${e(p).length??""}/200`),le.disabled=e(h),Z.disabled=I},[()=>!e(f)||!e(p).trim()||e(h)]),ia(B,()=>e(p),I=>v(p,I)),m(ne,oe)};E(Re,ne=>{e(d)&&ne(Je)})}var it=u(Re,2),Le=o(it),ke=u(o(Le),2);ke.__click=C,i(Le);var Ke=u(Le,2);{var lt=ne=>{var oe=F_(),_e=u(o(oe));i(oe),O(()=>w(_e,` ${e(A)??""}`)),m(ne,oe)};E(Ke,ne=>{e(A)&&ne(lt)})}var He=u(Ke,2);{var et=ne=>{var oe=N_();m(ne,oe)},Ne=ne=>{var oe=mt(),_e=tt(oe);{var Me=Ee=>{var pe=$_();m(Ee,pe)},ze=Ee=>{var pe=G_();Dt(pe,23,()=>e(y),qe=>qe.id,(qe,Ae,Ie)=>{var ut=z_();ut.__click=[L_,W,Ae];var me=o(ut),J=o(me),xe=o(J),$e=o(xe,!0);i(xe),i(J);var B=u(J,2),te=o(B),ue=o(te),G=o(ue),z=o(G,!0);i(G);var le=u(G,2),Z=o(le);i(le),i(ue);var q=u(ue,2),U=o(q),$=o(U,!0);i(U);var I=u(U,2),H=u(o(I),2);{var fe=Be=>{var Ue=P_(),Pe=o(Ue,!0);i(Ue),O(Ve=>w(Pe,Ve),[()=>Y(e(Ae))]),m(Be,Ue)};E(H,Be=>{Y(e(Ae))>0&&Be(fe)})}i(I),i(q),i(te),i(B),i(me);var ve=u(me,2);{var Fe=Be=>{var Ue=M_(),Pe=o(Ue),Ve=o(Pe);i(Pe),i(Ue),O(()=>w(Ve,`${e(Ae).status==="released"?"Released":"Ready for pick up"}${e(Ae).processedBy?` by ${e(Ae).processedBy}`:""}`)),m(Be,Ue)},Ce=Be=>{var Ue=mt(),Pe=tt(Ue);{var Ve=nt=>{var vt=R_(),St=o(vt),At=o(St);{var Wt=Ot=>{var sa=ba();O(()=>w(sa,`Note${e(Ae).processedBy?` by ${e(Ae).processedBy}`:""}: ${e(Ae).adminNote??""}`)),m(Ot,sa)},Nt=Ot=>{var sa=ba();O(()=>w(sa,e(Ae).processedBy?`Being ${e(Ae).status==="verifying"?"verified":"processed"} by ${e(Ae).processedBy}`:`${e(Ae).status==="verifying"?"Verifying":"Processing"} your request`)),m(Ot,sa)};E(At,Ot=>{e(Ae).adminNote?Ot(Wt):Ot(Nt,!1)})}var It=u(At,2);{var Gt=Ot=>{var sa=I_(),Qt=o(sa);i(sa),O(()=>w(Qt,` Tentative: ${e(Ae).tentativeDate??""}`)),m(Ot,sa)};E(It,Ot=>{e(Ae).tentativeDate&&e(Ae).status==="processing"&&Ot(Gt)})}i(St),i(vt),m(nt,vt)},st=nt=>{var vt=mt(),St=tt(vt);{var At=Nt=>{var It=O_();m(Nt,It)},Wt=Nt=>{var It=mt(),Gt=tt(It);{var Ot=Qt=>{var Pt=j_(),Yt=o(Pt),ca=o(Yt);i(Yt),i(Pt),O(ye=>w(ca,`Cancelled on ${ye??""}`),[()=>M(e(Ae).cancelledDate||e(Ae).submittedDate)]),m(Qt,Pt)},sa=Qt=>{var Pt=mt(),Yt=tt(Pt);{var ca=ye=>{var Xe=q_(),ot=o(Xe),be=o(ot);i(ot),i(Xe),O(()=>w(be,`Rejected${e(Ae).processedBy?` by ${e(Ae).processedBy}`:""}${e(Ae).rejectionReason?`: ${e(Ae).rejectionReason}`:""}`)),m(ye,Xe)};E(Yt,ye=>{e(Ae).status==="rejected"&&ye(ca)},!0)}m(Qt,Pt)};E(Gt,Qt=>{e(Ae).status==="cancelled"?Qt(Ot):Qt(sa,!1)},!0)}m(Nt,It)};E(St,Nt=>{e(Ae).status==="on_hold"?Nt(At):Nt(Wt,!1)},!0)}m(nt,vt)};E(Pe,nt=>{e(Ae).status==="processing"||e(Ae).status==="verifying"?nt(Ve):nt(st,!1)},!0)}m(Be,Ue)};E(ve,Be=>{e(Ae).status==="released"||e(Ae).status==="for_pickup"?Be(Fe):Be(Ce,!1)})}i(ut),O((Be,Ue,Pe)=>{we(ut,1,`request-card ${e(Ae).status??""}`),Wa(ut,`--card-index: ${e(Ie)??""};`),w($e,Be),w(z,e(Ae).type),w(Z,`Requested on ${e(Ae).requestedDate??""}`),we(U,1,`student-status-badge status-${e(Ae).status??""}`),w($,Ue),Mt(I,"title",Pe)},[()=>P(e(Ae).status),()=>S(e(Ae).status),()=>Y(e(Ae))>0?`${Y(e(Ae))} unread message${Y(e(Ae))!==1?"s":""}`:"View messages"]),m(qe,ut)}),i(pe),m(Ee,pe)};E(_e,Ee=>{e(y).length===0?Ee(Me):Ee(ze,!1)},!0)}m(ne,oe)};E(He,ne=>{e(k)?ne(et):ne(Ne,!1)})}i(it),i(L),O(()=>{ie.disabled=e(k),w(Ge,e(d)?"remove":"add"),w(se,e(d)?"Cancel":"New Document"),ke.disabled=e(k)}),m(s,L),za(),r()}Ps(["click","keydown"]);function W_(s,t){v(t,!e(t))}function H_(s,t){t()}function U_(s,t,a){const r=e(t).filter(n=>n.isRead).length;cs.confirm("Clear All Read Notifications",`<p>Are you sure you want to delete all <strong>${r}</strong> read notification${r!==1?"s":""}?</p>
       <p style="margin-top: 8px; color: var(--md-sys-color-on-surface-variant); font-size: 0.9rem;">This action cannot be undone.</p>`,async()=>{await a(),Te.success(`${r} read notification${r!==1?"s":""} cleared successfully`)},()=>{},{size:"small"})}var Y_=(s,t,a)=>t(e(a).value),Q_=_('<span class="count-badge"> </span>'),K_=_('<button><span class="material-symbols-outlined"> </span> <span> </span> <!></button>'),J_=_('<div class="filter-dropdown-menu"></div>'),X_=_('<button class="notifications-action-btn mark-all-read" title="Mark All Read"><span class="material-symbols-outlined">done_all</span></button>'),Z_=_('<button class="notifications-action-btn clear-read" title="Clear Read"><span class="material-symbols-outlined">clear_all</span></button>'),eb=_('<div class="loading-state"><div class="system-loader"></div> <p>Loading notifications...</p></div>'),tb=_('<div class="error-state"><div class="error-icon"><span class="material-symbols-outlined">error</span></div> <h3>Error Loading Notifications</h3> <p> </p> <button class="retry-btn">Reload</button></div>'),ab=(s,t,a)=>t(e(a)),sb=(s,t,a)=>s.key==="Enter"&&t(e(a)),rb=_('<div class="admin-note"><span class="material-symbols-outlined">note</span> <div class="note-content"><span class="note-label">Admin Note:</span> <span class="note-text"> </span></div></div>'),ib=_('<div class="rejection-reason"><span class="material-symbols-outlined">error</span> <div class="reason-content"><span class="reason-label">Rejection Reason:</span> <span class="reason-text"> </span></div></div>'),nb=(s,t,a)=>{s.stopPropagation(),t(e(a).id)},ob=(s,t,a)=>{s.stopPropagation(),t(e(a).id)},lb=_('<div role="button" tabindex="0"><div class="notification-header-card"><h3 class="notification-title"> </h3> <span class="notification-time"> </span></div> <div class="notification-details"><div class="notification-content"><p class="notification-message"> </p> <!> <!></div> <div class="notification-actions"><button class="action-btn-small read-toggle"><span class="material-symbols-outlined"> </span></button> <button class="action-btn-small delete-btn" title="Delete notification"><span class="material-symbols-outlined">delete</span></button></div></div></div>'),cb=(s,t,a)=>{s.stopPropagation(),t(e(a).id)},db=(s,t,a)=>{s.stopPropagation(),t(e(a).id)},ub=_('<div><div class="notification-header-card"><h3 class="notification-title"> </h3> <span class="notification-time"> </span></div> <div class="notification-details"><div class="notification-content"><p class="notification-message"> </p></div> <div class="notification-actions"><button class="action-btn-small read-toggle"><span class="material-symbols-outlined"> </span></button> <button class="action-btn-small delete-btn" title="Delete notification"><span class="material-symbols-outlined">delete</span></button></div></div></div>'),vb=_('<div class="notifications-list"></div>'),fb=_('<div class="no-notifications"><div class="no-notifications-icon"><span class="material-symbols-outlined"> </span></div> <h3> </h3> <p> </p></div>'),pb=_('<div class="notification-container"><div class="notification-header"><div class="header-content"><h1 class="page-title">Notifications</h1> <p class="page-subtitle">Stay updated with your academic activities <span class="notification-badge"> </span></p></div></div> <div class="filter-actions-section"><div class="filter-section"><div class="filter-dropdown"><button class="filter-toggle"><div class="filter-toggle-content"><span class="material-symbols-outlined filter-icon"> </span> <span class="filter-label"> </span></div> <span>expand_more</span></button> <!></div></div> <div class="actions-section"><!> <!></div></div> <div class="notifications-section"><!></div></div>');function mb(s,t){qa(t,!0);const[a,r]=xs(),n=()=>Ja(xr,"$studentNotificationStore",a),l=()=>Ja(gs,"$authStore",a);let c=aa(()=>n().notifications),d=aa(()=>n().isLoading),f=aa(()=>n().error),p=aa(()=>n().unreadCount);const h=[{value:"all",label:"All Notifications",icon:"notifications"},{value:"unread",label:"Unread Only",icon:"mark_email_unread"},{value:"grade",label:"Grades",icon:"grade"},{value:"document",label:"Document Requests",icon:"description"}];let g=pt("all"),b=pt(!1);function y(J){v(g,J,!0),v(b,!1),xr.setFilter(J),F()}function k(J){J.target.closest(".filter-dropdown")||v(b,!1)}function A(J){const xe=e(c).find($e=>$e.id===J);xe?j(J,!xe.isRead):console.warn("Notification not found for toggle:",J)}function D(J){const xe=e(c).find(B=>B.id===J),$e=xe?xe.title:"this notification";cs.confirm("Delete Notification",`<p>Are you sure you want to delete <strong>"${$e}"</strong>?</p>
       <p style="margin-top: 8px; color: var(--md-sys-color-on-surface-variant); font-size: 0.9rem;">This action cannot be undone.</p>`,async()=>{await P(J),Te.success("Notification deleted successfully")},()=>{},{size:"small"})}function T(J){if(J.type==="document"||J.type==="document_request"){const xe=J.metadata?.relatedId;t.onnavigate&&t.onnavigate({detail:{section:"documents",requestId:xe}})}}function C(J){const xe=new Date(J),$e=new Date,B=Math.floor(($e-xe)/(1e3*60*60));if(B<1){const te=Math.floor(($e-xe)/6e4);return te<=1?"Just now":`${te} minutes ago`}else{if(B<24)return`${B} hour${B>1?"s":""} ago`;{const te=Math.floor(B/24);return te<7?`${te} day${te>1?"s":""} ago`:xe.toLocaleDateString("en-US",{month:"short",day:"numeric",year:xe.getFullYear()!==$e.getFullYear()?"numeric":void 0})}}}function S(J){const xe=h.find($e=>$e.value===J);return xe?xe.label:"All Notifications"}function M(J){const xe=h.find($e=>$e.value===J);return xe?xe.icon:"notifications"}async function F(){const J=l().userData;if(!J?.id){v(f,"User not authenticated");return}await xr.loadNotifications(J.id,e(g))}async function j(J,xe){const $e=l().userData;$e?.id&&await xr.updateNotificationStatus($e.id,J,xe)}async function P(J){const xe=l().userData;xe?.id&&await xr.deleteNotification(xe.id,J)}async function Y(){const J=l().userData;J?.id&&await xr.markAllAsRead(J.id)}async function W(){const J=l().userData;J?.id&&await xr.clearAllRead(J.id)}Ya(()=>{if(l().userData?.id){const J=l().userData;xr.init(J.id,e(g)),F()}});let N=aa(()=>Array.isArray(e(c))?e(g)==="all"?e(c):e(g)==="unread"?e(c).filter(J=>!J.isRead):e(c).filter(J=>J.type===e(g)):[]),L=pt(0),X=pt(0),ae=pt("all");Es(()=>{(e(g)!==e(ae)||e(N).length!==e(X))&&(or(L),v(ae,e(g),!0),v(X,e(N).length,!0))});var V=pb();Se("click",Zs,k);var ie=o(V),he=o(ie),Ge=u(o(he),2),ce=u(o(Ge)),se=o(ce);i(ce),i(Ge),i(he),i(ie);var Re=u(ie,2),Je=o(Re),it=o(Je),Le=o(it);Le.__click=[W_,b];var ke=o(Le),Ke=o(ke),lt=o(Ke,!0);i(Ke);var He=u(Ke,2),et=o(He,!0);i(He),i(ke);var Ne=u(ke,2);let ne;i(Le);var oe=u(Le,2);{var _e=J=>{var xe=J_();Dt(xe,21,()=>h,Ua,($e,B)=>{var te=K_();let ue;te.__click=[Y_,y,B];var G=o(te),z=o(G,!0);i(G);var le=u(G,2),Z=o(le,!0);i(le);var q=u(le,2);{var U=$=>{var I=Q_(),H=o(I,!0);i(I),O(()=>w(H,e(p))),m($,I)};E(q,$=>{e(B).value==="unread"&&$(U)})}i(te),O($=>{ue=we(te,1,"filter-dropdown-item",null,ue,$),w(z,e(B).icon),w(Z,e(B).label)},[()=>({active:e(B).value===e(g)})]),m($e,te)}),i(xe),m(J,xe)};E(oe,J=>{e(b)&&J(_e)})}i(it),i(Je);var Me=u(Je,2),ze=o(Me);{var Ee=J=>{var xe=X_();xe.__click=[H_,Y],m(J,xe)};E(ze,J=>{e(p)>0&&J(Ee)})}var pe=u(ze,2);{var qe=J=>{var xe=Z_();xe.__click=[U_,c,W],m(J,xe)};E(pe,J=>{e(c).some(xe=>xe.isRead)&&J(qe)})}i(Me),i(Re);var Ae=u(Re,2),Ie=o(Ae);{var ut=J=>{var xe=eb();m(J,xe)},me=J=>{var xe=mt(),$e=tt(xe);{var B=ue=>{var G=tb(),z=u(o(G),4),le=o(z,!0);i(z);var Z=u(z,2);Z.__click=F,i(G),O(()=>w(le,e(f))),m(ue,G)},te=ue=>{var G=mt(),z=tt(G);{var le=q=>{var U=mt(),$=tt(U);Rs($,()=>e(L),I=>{var H=vb();Dt(H,23,()=>e(N),fe=>fe.id,(fe,ve,Fe)=>{var Ce=mt(),Be=tt(Ce);{var Ue=Ve=>{var st=lb();st.__click=[ab,T,ve],st.__keydown=[sb,T,ve];var nt=o(st),vt=o(nt),St=o(vt,!0);i(vt);var At=u(vt,2),Wt=o(At,!0);i(At),i(nt);var Nt=u(nt,2),It=o(Nt),Gt=o(It),Ot=o(Gt,!0);i(Gt);var sa=u(Gt,2);{var Qt=je=>{var rt=rb(),Ft=u(o(rt),2),Vt=u(o(Ft),2),at=o(Vt,!0);i(Vt),i(Ft),i(rt),O(()=>w(at,e(ve).adminNote)),m(je,rt)};E(sa,je=>{e(ve).adminNote&&je(Qt)})}var Pt=u(sa,2);{var Yt=je=>{var rt=ib(),Ft=u(o(rt),2),Vt=u(o(Ft),2),at=o(Vt,!0);i(Vt),i(Ft),i(rt),O(()=>w(at,e(ve).rejectionReason)),m(je,rt)};E(Pt,je=>{e(ve).rejectionReason&&je(Yt)})}i(It);var ca=u(It,2),ye=o(ca);ye.__click=[nb,A,ve];var Xe=o(ye),ot=o(Xe,!0);i(Xe),i(ye);var be=u(ye,2);be.__click=[ob,D,ve],i(ca),i(Nt),i(st),O(je=>{we(st,1,`notification-card ${e(ve).isRead?"read":"unread"} clickable`),Wa(st,`--card-index: ${e(Fe)??""};`),w(St,e(ve).title),w(Wt,je),w(Ot,e(ve).message),Mt(ye,"title",e(ve).isRead?"Mark as unread":"Mark as read"),w(ot,e(ve).isRead?"mark_email_unread":"mark_email_read")},[()=>C(e(ve).timestamp)]),m(Ve,st)},Pe=Ve=>{var st=ub(),nt=o(st),vt=o(nt),St=o(vt,!0);i(vt);var At=u(vt,2),Wt=o(At,!0);i(At),i(nt);var Nt=u(nt,2),It=o(Nt),Gt=o(It),Ot=o(Gt,!0);i(Gt),i(It);var sa=u(It,2),Qt=o(sa);Qt.__click=[cb,A,ve];var Pt=o(Qt),Yt=o(Pt,!0);i(Pt),i(Qt);var ca=u(Qt,2);ca.__click=[db,D,ve],i(sa),i(Nt),i(st),O(ye=>{we(st,1,`notification-card ${e(ve).isRead?"read":"unread"}`),Wa(st,`--card-index: ${e(Fe)??""};`),w(St,e(ve).title),w(Wt,ye),w(Ot,e(ve).message),Mt(Qt,"title",e(ve).isRead?"Mark as unread":"Mark as read"),w(Yt,e(ve).isRead?"mark_email_unread":"mark_email_read")},[()=>C(e(ve).timestamp)]),m(Ve,st)};E(Be,Ve=>{e(ve).type==="document"||e(ve).type==="document_request"?Ve(Ue):Ve(Pe,!1)})}m(fe,Ce)}),i(H),m(I,H)}),m(q,U)},Z=q=>{var U=fb(),$=o(U),I=o($),H=o(I,!0);i(I),i($);var fe=u($,2),ve=o(fe,!0);i(fe);var Fe=u(fe,2),Ce=o(Fe,!0);i(Fe),i(U),O(Be=>{w(H,e(g)==="unread"?"mark_email_read":"notifications_off"),w(ve,e(g)==="unread"?"All Caught Up!":"No Notifications"),w(Ce,Be)},[()=>e(g)==="unread"?"You have no unread notifications. Great job staying on top of things!":e(g)==="all"?"You don't have any notifications yet.":`No ${S(e(g)).toLowerCase()} notifications found.`]),m(q,U)};E(z,q=>{e(N).length>0?q(le):q(Z,!1)},!0)}m(ue,G)};E($e,ue=>{e(f)?ue(B):ue(te,!1)},!0)}m(J,xe)};E(Ie,J=>{e(d)?J(ut):J(me,!1)})}i(Ae),i(V),O((J,xe,$e)=>{w(se,`${e(p)??""} unread`),w(lt,J),w(et,xe),ne=we(Ne,1,"material-symbols-outlined dropdown-arrow",null,ne,$e)},[()=>M(e(g)),()=>S(e(g)),()=>({rotated:e(b)})]),m(s,V),za(),r()}Ps(["click","keydown"]);const hb=300*1e3,gb="student_todolist_";function _b(){const s={todos:[],isLoading:!1,isRefreshing:!1,error:null,lastUpdated:null,currentStudentId:null},{subscribe:t,set:a,update:r}=Ws(s);function n(T){return`${gb}${T}`}function l(T){return!T||!T.timestamp?!1:Date.now()-T.timestamp<hb}function c(T){try{const C=n(T),S=localStorage.getItem(C);if(S)return JSON.parse(S).data}catch(C){console.warn("Failed to retrieve cached student todolist data:",C)}return null}function d(T){try{const C=n(T),S=localStorage.getItem(C);if(S){const M=JSON.parse(S);if(l(M))return M.data}}catch(C){console.warn("Failed to retrieve cached student todolist data:",C)}return null}function f(T,C){try{const S=n(T),M={data:C,timestamp:Date.now()};localStorage.setItem(S,JSON.stringify(M))}catch(S){console.warn("Failed to cache student todolist data:",S)}}async function p(T,C=!1){try{r(F=>({...F,isLoading:!C,isRefreshing:C,error:null,currentStudentId:T}));const S=await la.get(`/api/student-todos?studentId=${T}`);if(!S.success)throw new Error(S.error||"Failed to fetch todos");const M=S.data||[];r(F=>({...F,todos:M,isLoading:!1,isRefreshing:!1,error:null,lastUpdated:new Date().toISOString()})),f(T,{todos:M,lastUpdated:new Date().toISOString()})}catch(S){console.error("Error loading student todos:",S);let M;r(j=>(M=j.currentStudentId,j));const F=c(M);F?(r(j=>({...j,isLoading:!1,isRefreshing:!1,error:null,todos:F.todos||[],lastUpdated:F.lastUpdated})),Te.error("No internet connection. Showing offline data.")):r(j=>({...j,isLoading:!1,isRefreshing:!1,error:S.message,todos:[]}))}}async function h(T,C){try{const S=await la.post("/api/student-todos",{studentId:T,...C});if(!S.success)throw new Error(S.error||"Failed to add todo");return r(M=>{const F=[S.data,...M.todos];return f(T,{todos:F,lastUpdated:new Date().toISOString()}),{...M,todos:F,lastUpdated:new Date().toISOString()}}),{success:!0,data:S.data}}catch(S){return console.error("Error adding todo:",S),{success:!1,error:S.message}}}async function g(T,C,S){try{const M=await la.put("/api/student-todos",{id:C,studentId:T,action:"update",...S});if(!M.success)throw new Error(M.error||"Failed to update todo");return r(F=>{const j=F.todos.map(P=>P.id===C?M.data:P);return f(T,{todos:j,lastUpdated:new Date().toISOString()}),{...F,todos:j,lastUpdated:new Date().toISOString()}}),{success:!0,data:M.data}}catch(M){return console.error("Error updating todo:",M),{success:!1,error:M.message}}}async function b(T,C){try{const S=await la.put("/api/student-todos",{id:C,studentId:T,action:"toggle"});if(!S.success)throw new Error(S.error||"Failed to toggle todo");return r(M=>{const F=M.todos.map(j=>j.id===C?S.data:j);return f(T,{todos:F,lastUpdated:new Date().toISOString()}),{...M,todos:F,lastUpdated:new Date().toISOString()}}),{success:!0,data:S.data}}catch(S){return console.error("Error toggling todo:",S),{success:!1,error:S.message}}}async function y(T,C){try{const S=await la.delete("/api/student-todos",{id:C,studentId:T});if(!S.success)throw new Error(S.error||"Failed to delete todo");return r(M=>{const F=M.todos.filter(j=>j.id!==C);return f(T,{todos:F,lastUpdated:new Date().toISOString()}),{...M,todos:F,lastUpdated:new Date().toISOString()}}),{success:!0}}catch(S){return console.error("Error deleting todo:",S),{success:!1,error:S.message}}}function k(T){const C=d(T);return C?(r(S=>({...S,...C,currentStudentId:T,isLoading:!1,isRefreshing:!1,error:null})),!0):(r(S=>({...S,currentStudentId:T,isLoading:!0,isRefreshing:!1,error:null})),!1)}function A(T){try{const C=n(T);localStorage.removeItem(C)}catch(C){console.warn("Failed to clear student todolist cache:",C)}return r(C=>({...s,currentStudentId:T,isLoading:!0})),D.loadTodos(T,!1)}const D={subscribe:t,init:k,loadTodos:p,addTodo:h,updateTodo:g,toggleTodo:b,deleteTodo:y,forceRefresh:A,getCachedData:T=>c(T)};return D}const Lr=_b();var bb=_('<button type="button"><span class="material-symbols-outlined"> </span> <span> </span></button>'),yb=_('<div class="dropdown-menu-category"></div>'),wb=_('<button class="clear-date-btn" type="button" title="Clear date"><span class="material-symbols-outlined">close</span></button>'),xb=_('<div class="day-header"> </div>'),Sb=_('<div class="empty-day"></div>'),kb=_('<button type="button"> </button>'),Ab=_('<div class="date-picker-dropdown"><div class="date-picker-header"><button class="nav-btn" type="button"><span class="material-symbols-outlined">chevron_left</span></button> <div class="month-year-display"><span class="month-name"> </span> <span class="year-name"> </span></div> <button class="nav-btn" type="button"><span class="material-symbols-outlined">chevron_right</span></button></div> <div class="calendar-grid"><!> <!> <!></div></div>'),Db=_('<div class="add-todo-section"><h2 class="section-title">Add New Task</h2> <div class="add-todo-form"><input type="text" placeholder="Enter task title..." class="todo-input"/> <textarea placeholder="Enter description (optional)..." class="todo-input todo-textarea" rows="3"></textarea> <div class="form-row"><div class="form-field"><label class="form-label" for="category-dropdown">Category</label> <div class="custom-dropdown"><button class="dropdown-toggle" id="category-dropdown" type="button"><div class="dropdown-toggle-content"><span class="material-symbols-outlined dropdown-icon-left"> </span> <span class="dropdown-label"> </span></div> <span>expand_more</span></button> <!></div></div> <div class="form-field"><label class="form-label" for="due-date-picker">Due Date (optional)</label> <div class="custom-date-picker"><div class="date-picker-toggle-wrapper"><button class="date-picker-toggle" id="due-date-picker" type="button"><div class="date-picker-toggle-content"><span class="material-symbols-outlined date-picker-icon-left">calendar_today</span> <span class="date-picker-label"> </span></div> <div class="date-picker-actions"><!> <span>expand_more</span></div></button></div> <!></div></div></div> <button class="add-todo-btn"> </button></div></div>'),Cb=_('<button class="clear-search-btn"><span class="material-symbols-outlined">close</span></button>'),Tb=_('<button><span class="material-symbols-outlined"> </span> <span> </span></button>'),Eb=_('<div class="filter-dropdown-menu"></div>'),Fb=_('<button><span class="material-symbols-outlined"> </span> <span> </span></button>'),Nb=_('<div class="filter-dropdown-menu"></div>'),$b=_('<div class="loading-state"><div class="system-loader"></div> <p>Loading todos...</p></div>'),Lb=_('<div class="error-state"><span class="material-symbols-outlined">error</span> <p> </p> <button class="retry-btn">Retry</button></div>'),Pb=_('<p class="todo-description"> </p>'),Mb=_('<div><div class="todo-checkbox"><input type="checkbox"/> <label class="checkbox-label"></label></div> <div class="todo-content"><h3> </h3> <!> <div class="todo-meta"><span class="todo-category"> </span> <span class="todo-due-date"> </span></div></div> <div class="todo-actions"><button class="action-btn todo-delete-btn" title="Delete task"><span class="material-symbols-outlined">delete</span></button></div></div>'),Ib=_('<div class="todos-list"></div>'),Rb=_('<div class="no-filtered-todos"><div class="no-todos-icon"><span class="material-symbols-outlined">search_off</span></div> <h3>No Matching Tasks</h3> <p>No tasks match your current search or filter criteria.</p> <button class="clear-filters-btn">Clear all filters</button></div>'),Ob=_(`<div class="no-todos"><div class="no-todos-icon"><span class="material-symbols-outlined">check_circle</span></div> <h3>No Tasks</h3> <p>You don't have any tasks yet. Add one above to get started!</p></div>`),jb=_('<div class="todo-container"><div class="todo-header"><div class="header-content"><div class="header-text-content"><h1 class="page-title">Todo List</h1> <p class="page-subtitle">Keep track of your tasks and assignments <span class="progress-badge"> </span></p></div> <div class="header-actions"></div></div></div> <div class="add-todo-button-section"><button class="add-todo-toggle-btn"><span class="material-symbols-outlined"> </span> </button></div> <!> <div class="search-filter-section"><div class="search-filter-row"><div class="todo-search-input-wrapper"><span class="material-symbols-outlined search-icon">search</span> <input type="text" class="todo-search-input" placeholder="Search todos by title or description..."/> <!></div> <div class="todo-filter-section"><div class="filter-dropdown"><button class="filter-toggle"><div class="filter-toggle-content"><span class="material-symbols-outlined filter-icon"> </span> <span class="filter-label"> </span></div> <span>expand_more</span></button> <!></div> <div class="filter-dropdown"><button class="filter-toggle"><div class="filter-toggle-content"><span class="material-symbols-outlined filter-icon"> </span> <span class="filter-label"> </span></div> <span>expand_more</span></button> <!></div> <button class="todo-refresh-button" title="Refresh todos"><span class="material-symbols-outlined">refresh</span></button></div></div></div> <div class="todos-section"><!></div></div>');function qb(s,t){qa(t,!1);const[a,r]=xs(),n=()=>Ja(Lr,"$studentTodolistStore",a),l=()=>Ja(gs,"$authStore",a),c=R(),d=R(),f=R(),p=R(),h=R(),g=R(),b=R(),y=R(),k=R(),A=R(),D=R();let T=R(!1),C=R(""),S=R("all"),M=R("all"),F=R(!1),j=R(!1),P=R(""),Y=R(""),W=R("personal"),N=R(""),L=R(!1);const X=[{value:"all",label:"All Categories",icon:"category"},{value:"assignment",label:"Assignment",icon:"assignment"},{value:"study",label:"Study",icon:"book"},{value:"personal",label:"Personal",icon:"person"},{value:"project",label:"Project",icon:"folder"},{value:"exam",label:"Exam",icon:"quiz"}],ae=[{value:"all",label:"All Status",icon:"list"},{value:"pending",label:"Pending",icon:"pending"},{value:"completed",label:"Completed",icon:"check_circle"}],V=[{value:"assignment",label:"Assignment",icon:"assignment"},{value:"study",label:"Study",icon:"book"},{value:"personal",label:"Personal",icon:"person"},{value:"project",label:"Project",icon:"folder"},{value:"exam",label:"Exam",icon:"quiz"}];let ie=R(!1),he=R(!1);const Ge=new Date;let ce=R(Ge.getFullYear()),se=R(Ge.getMonth());const Re=["January","February","March","April","May","June","July","August","September","October","November","December"],Je=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];async function it(){const Oe=l();Oe.isAuthenticated&&Oe.userData?.id&&await Lr.forceRefresh(Oe.userData.id)}async function Le(){try{v(T,!0);const Oe=l().userData;if(!Oe||!Oe.id)throw new Error("User not authenticated");if(!e(P).trim()){Te.error("Please enter a title for your todo");return}const ft={title:e(P).trim(),description:e(Y).trim()||null,category:e(W),dueDate:e(N)||null},$t=await Lr.addTodo(Oe.id,ft);if($t.success)Te.success("Todo added successfully!"),v(P,""),v(Y,""),v(W,"personal"),v(N,""),v(L,!1);else throw new Error($t.error||"Failed to add todo")}catch(Oe){console.error("Error adding todo:",Oe),Te.error("Failed to add todo: "+Oe.message)}finally{v(T,!1)}}async function ke(Oe){try{const ft=l().userData;if(!ft||!ft.id)throw new Error("User not authenticated");const $t=await Lr.deleteTodo(ft.id,Oe);if($t.success)Te.success("Todo deleted successfully!");else throw new Error($t.error||"Failed to delete todo")}catch(ft){console.error("Error deleting todo:",ft),Te.error("Failed to delete todo: "+ft.message)}}async function Ke(Oe){try{const ft=l().userData;if(!ft||!ft.id)throw new Error("User not authenticated");const $t=await Lr.toggleTodo(ft.id,Oe);if($t.success){const Kt=$t.data.completed?"Todo marked as completed!":"Todo marked as pending!";Te.success(Kt)}else throw new Error($t.error||"Failed to update todo")}catch(ft){console.error("Error toggling todo:",ft),Te.error("Failed to update todo: "+ft.message)}}Ya(()=>{const Oe=l();if(Oe.isAuthenticated&&Oe.userData?.id){const ft=Lr.init(Oe.userData.id);Lr.loadTodos(Oe.userData.id,ft);const $t=setInterval(()=>{const jt=l();jt.isAuthenticated&&jt.userData?.id&&Lr.loadTodos(jt.userData.id,!0)},300*1e3);return()=>{clearInterval($t)}}});function lt(Oe){cs.confirm("Delete Task",`Are you sure you want to delete "${Oe.title}"? This action cannot be undone.`,async()=>{await ke(Oe.id)},()=>{})}function He(){v(L,!e(L)),e(L)||(v(P,""),v(Y,""),v(W,"personal"),v(N,""),v(ie,!1),v(he,!1))}function et(){v(F,!e(F))}function Ne(){v(j,!e(j))}function ne(Oe){v(S,Oe),v(F,!1)}function oe(Oe){v(M,Oe),v(j,!1)}function _e(Oe){const ft=X.find($t=>$t.value===Oe);return ft?ft.label:"All Categories"}function Me(Oe){const ft=X.find($t=>$t.value===Oe);return ft?ft.icon:"category"}function ze(Oe){const ft=ae.find($t=>$t.value===Oe);return ft?ft.label:"All Status"}function Ee(Oe){const ft=ae.find($t=>$t.value===Oe);return ft?ft.icon:"list"}function pe(){v(ie,!e(ie))}function qe(Oe){v(W,Oe),v(ie,!1)}function Ae(Oe){Oe.target.closest(".custom-dropdown")||v(ie,!1),Oe.target.closest(".custom-date-picker")||v(he,!1),Oe.target.closest(".filter-dropdown")||(v(F,!1),v(j,!1))}Ya(()=>(document.addEventListener("click",Ae),()=>{document.removeEventListener("click",Ae)}));function Ie(Oe){const ft=V.find($t=>$t.value===Oe);return ft?ft.label:"Select Category"}function ut(Oe){const ft=V.find($t=>$t.value===Oe);return ft?ft.icon:"category"}function me(){if(v(he,!e(he)),e(he))if(e(N)){const Oe=new Date(e(N)+"T00:00:00");v(ce,Oe.getFullYear()),v(se,Oe.getMonth()),Oe.getDate()}else{const Oe=new Date;v(ce,Oe.getFullYear()),v(se,Oe.getMonth())}}function J(Oe){const ft=e(ce),$t=e(se)+1,jt=Oe.toString().padStart(2,"0"),Kt=$t.toString().padStart(2,"0");v(N,`${ft}-${Kt}-${jt}`),v(he,!1)}function xe(){v(N,""),v(he,!1)}function $e(){e(se)===0?(v(se,11),or(ce,-1)):or(se,-1)}function B(){e(se)===11?(v(se,0),or(ce)):or(se)}function te(Oe,ft){return new Date(Oe,ft+1,0).getDate()}function ue(Oe,ft){return new Date(Oe,ft,1).getDay()}function G(Oe){const ft=new Date;return Oe===ft.getDate()&&e(se)===ft.getMonth()&&e(ce)===ft.getFullYear()}function z(Oe){if(!e(N))return!1;const ft=new Date(e(N)+"T00:00:00");return Oe===ft.getDate()&&e(se)===ft.getMonth()&&e(ce)===ft.getFullYear()}function le(Oe){if(!Oe||Oe==="No due date")return"No due date";if(Oe==="Today"||Oe==="Tomorrow"||Oe==="Next Week")return Oe;const ft=Oe.split("-");if(ft.length!==3)return Oe;const $t=parseInt(ft[0]),jt=parseInt(ft[1])-1,Kt=parseInt(ft[2]);if(isNaN($t)||isNaN(jt)||isNaN(Kt))return Oe;const oa=new Date,Jt=oa.getFullYear(),Ta=oa.getMonth(),Aa=oa.getDate();if($t===Jt&&jt===Ta&&Kt===Aa)return"Today";const ya=new Date(oa);ya.setDate(ya.getDate()+1);const ma=ya.getFullYear(),ha=ya.getMonth(),Fa=ya.getDate();return $t===ma&&jt===ha&&Kt===Fa?"Tomorrow":new Date($t,jt,Kt).toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"}).replace(/^(\w+),/,"$1:")}let Z=R(0),q=R(""),U=R(e(S)),$=R(e(M));ht(()=>(e(c),e(d),e(f),e(p),e(h),n()),()=>{(Oe=>{v(c,Oe.todos),v(d,Oe.isLoading),v(f,Oe.isRefreshing),v(p,Oe.error),v(h,Oe.lastUpdated)})(n())}),ht(()=>(e(c),e(C),e(S),e(M)),()=>{v(g,(()=>{let Oe=e(c);if(e(C).trim()){const ft=e(C).toLowerCase().trim();Oe=Oe.filter($t=>$t.title.toLowerCase().includes(ft)||$t.description&&$t.description.toLowerCase().includes(ft))}return e(S)!=="all"&&(Oe=Oe.filter(ft=>ft.category===e(S))),e(M)!=="all"&&(e(M)==="completed"?Oe=Oe.filter(ft=>ft.completed):e(M)==="pending"&&(Oe=Oe.filter(ft=>!ft.completed))),Oe})())}),ht(()=>e(N),()=>{v(b,e(N)?new Date(e(N)+"T00:00:00").toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}).replace(/^(\w+),/,"$1:"):"Select due date")}),ht(()=>e(c),()=>{v(y,e(c).filter(Oe=>Oe.completed).length)}),ht(()=>e(c),()=>{v(k,e(c).length)}),ht(()=>e(g),()=>{v(A,e(g).filter(Oe=>Oe.completed).length)}),ht(()=>e(g),()=>{v(D,e(g).length)}),ht(()=>(e(C),e(q),e(S),e(U),e(M),e($),e(Z)),()=>{(e(C)!==e(q)||e(S)!==e(U)||e(M)!==e($))&&(or(Z),v(q,e(C)),v(U,e(S)),v($,e(M)))}),Ms(),Fs();var I=jb();Se("click",Zs,Ae);var H=o(I),fe=o(H),ve=o(fe),Fe=u(o(ve),2),Ce=u(o(Fe)),Be=o(Ce);i(Ce),i(Fe),i(ve),Ht(2),i(fe),i(H);var Ue=u(H,2),Pe=o(Ue),Ve=o(Pe),st=o(Ve,!0);i(Ve);var nt=u(Ve);i(Pe),i(Ue);var vt=u(Ue,2);{var St=Oe=>{var ft=Db(),$t=u(o(ft),2),jt=o($t);ta(jt);var Kt=u(jt,2);kn(Kt);var oa=u(Kt,2),Jt=o(oa),Ta=u(o(Jt),2),Aa=o(Ta),ya=o(Aa),ma=o(ya),ha=o(ma,!0);i(ma);var Fa=u(ma,2),La=o(Fa,!0);i(Fa),i(ya);var da=u(ya,2);i(Aa);var fa=u(Aa,2);{var K=pa=>{var xa=yb();Dt(xa,5,()=>V,Ua,(Ia,re)=>{var ge=bb(),ct=o(ge),Et=o(ct,!0);i(ct);var Ct=u(ct,2),Lt=o(Ct,!0);i(Ct),i(ge),O(()=>{we(ge,1,`dropdown-item ${e(re),e(W),x(()=>e(re).value===e(W)?"selected":"")??""}`),w(Et,(e(re),x(()=>e(re).icon))),w(Lt,(e(re),x(()=>e(re).label)))}),Se("click",ge,()=>qe(e(re).value)),m(Ia,ge)}),i(xa),m(pa,xa)};E(fa,pa=>{e(ie)&&pa(K)})}i(Ta),i(Jt);var De=u(Jt,2),Ze=u(o(De),2),wt=o(Ze),qt=o(wt),Tt=o(qt),kt=u(o(Tt),2),Ea=o(kt,!0);i(kt),i(Tt);var _a=u(Tt,2),ua=o(_a);{var Sa=pa=>{var xa=wb();Se("click",xa,po(xe)),m(pa,xa)};E(ua,pa=>{e(N)&&pa(Sa)})}var Ut=u(ua,2);i(_a),i(qt),i(wt);var Xt=u(wt,2);{var ka=pa=>{var xa=Ab(),Ia=o(xa),re=o(Ia),ge=u(re,2),ct=o(ge),Et=o(ct,!0);i(ct);var Ct=u(ct,2),Lt=o(Ct,!0);i(Ct),i(ge);var ra=u(ge,2);i(Ia);var Da=u(Ia,2),Bt=o(Da);Dt(Bt,1,()=>Je,Ua,(xt,Rt)=>{var ea=xb(),na=o(ea,!0);i(ea),O(()=>w(na,e(Rt))),m(xt,ea)});var We=u(Bt,2);Dt(We,1,()=>(e(ce),e(se),x(()=>Array(ue(e(ce),e(se))))),Ua,(xt,Rt)=>{var ea=Sb();m(xt,ea)});var Zt=u(We,2);Dt(Zt,1,()=>(e(ce),e(se),x(()=>Array(te(e(ce),e(se))))),Ua,(xt,Rt,ea)=>{const na=fr(()=>ea+1);var ja=kb(),$a=o(ja,!0);i(ja),O((Ra,Ba)=>{we(ja,1,`day-cell ${Ra??""} ${Ba??""}`),w($a,e(na))},[()=>(Ss(e(na)),x(()=>G(e(na))?"today":"")),()=>(Ss(e(na)),x(()=>z(e(na))?"selected":""))]),Se("click",ja,()=>J(e(na))),m(xt,ja)}),i(Da),i(xa),O(()=>{w(Et,(e(se),x(()=>Re[e(se)]))),w(Lt,e(ce))}),Se("click",re,$e),Se("click",ra,B),m(pa,xa)};E(Xt,pa=>{e(he)&&pa(ka)})}i(Ze),i(De),i(oa);var wa=u(oa,2),Na=o(wa,!0);i(wa),i($t),i(ft),O((pa,xa,Ia)=>{w(ha,pa),w(La,xa),we(da,1,`material-symbols-outlined dropdown-icon ${e(ie)?"open":""}`),w(Ea,e(b)),we(Ut,1,`material-symbols-outlined dropdown-icon ${e(he)?"open":""}`),wa.disabled=Ia,w(Na,e(T)?"Adding...":"Add Task")},[()=>(e(W),x(()=>ut(e(W)))),()=>(e(W),x(()=>Ie(e(W)))),()=>(e(P),e(T),x(()=>!e(P).trim()||e(T)))]),ia(jt,()=>e(P),pa=>v(P,pa)),Se("keydown",jt,pa=>pa.key==="Enter"&&Le()),ia(Kt,()=>e(Y),pa=>v(Y,pa)),Se("click",Aa,pe),Se("click",qt,me),Se("click",wa,Le),m(Oe,ft)};E(vt,Oe=>{e(L)&&Oe(St)})}var At=u(vt,2),Wt=o(At),Nt=o(Wt),It=u(o(Nt),2);ta(It);var Gt=u(It,2);{var Ot=Oe=>{var ft=Cb();Se("click",ft,()=>v(C,"")),m(Oe,ft)};E(Gt,Oe=>{e(C)&&Oe(Ot)})}i(Nt);var sa=u(Nt,2),Qt=o(sa),Pt=o(Qt),Yt=o(Pt),ca=o(Yt),ye=o(ca,!0);i(ca);var Xe=u(ca,2),ot=o(Xe,!0);i(Xe),i(Yt);var be=u(Yt,2);let je;i(Pt);var rt=u(Pt,2);{var Ft=Oe=>{var ft=Eb();Dt(ft,5,()=>X,Ua,($t,jt)=>{var Kt=Tb();let oa;var Jt=o(Kt),Ta=o(Jt,!0);i(Jt);var Aa=u(Jt,2),ya=o(Aa,!0);i(Aa),i(Kt),O(ma=>{oa=we(Kt,1,"filter-dropdown-item",null,oa,ma),w(Ta,(e(jt),x(()=>e(jt).icon))),w(ya,(e(jt),x(()=>e(jt).label)))},[()=>({active:e(jt).value===e(S)})]),Se("click",Kt,()=>ne(e(jt).value)),m($t,Kt)}),i(ft),m(Oe,ft)};E(rt,Oe=>{e(F)&&Oe(Ft)})}i(Qt);var Vt=u(Qt,2),at=o(Vt),va=o(at),Ca=o(va),gt=o(Ca,!0);i(Ca);var _t=u(Ca,2),de=o(_t,!0);i(_t),i(va);var ee=u(va,2);let Q;i(at);var Ye=u(at,2);{var Qe=Oe=>{var ft=Nb();Dt(ft,5,()=>ae,Ua,($t,jt)=>{var Kt=Fb();let oa;var Jt=o(Kt),Ta=o(Jt,!0);i(Jt);var Aa=u(Jt,2),ya=o(Aa,!0);i(Aa),i(Kt),O(ma=>{oa=we(Kt,1,"filter-dropdown-item",null,oa,ma),w(Ta,(e(jt),x(()=>e(jt).icon))),w(ya,(e(jt),x(()=>e(jt).label)))},[()=>({active:e(jt).value===e(M)})]),Se("click",Kt,()=>oe(e(jt).value)),m($t,Kt)}),i(ft),m(Oe,ft)};E(Ye,Oe=>{e(j)&&Oe(Qe)})}i(Vt);var dt=u(Vt,2);i(sa),i(Wt),i(At);var yt=u(At,2),zt=o(yt);{var ga=Oe=>{var ft=$b();m(Oe,ft)},bt=Oe=>{var ft=mt(),$t=tt(ft);{var jt=oa=>{var Jt=Lb(),Ta=u(o(Jt),2),Aa=o(Ta,!0);i(Ta);var ya=u(Ta,2);i(Jt),O(()=>w(Aa,e(p))),Se("click",ya,it),m(oa,Jt)},Kt=oa=>{var Jt=mt(),Ta=tt(Jt);{var Aa=ma=>{var ha=mt(),Fa=tt(ha);Rs(Fa,()=>e(Z),La=>{var da=Ib();Dt(da,7,()=>e(g),fa=>fa.id,(fa,K,De)=>{var Ze=Mb();let wt;var qt=o(Ze),Tt=o(qt);ta(Tt);var kt=u(Tt,2);i(qt);var Ea=u(qt,2),_a=o(Ea);let ua;var Sa=o(_a,!0);i(_a);var Ut=u(_a,2);{var Xt=ge=>{var ct=Pb(),Et=o(ct,!0);i(ct),O(()=>w(Et,(e(K),x(()=>e(K).description)))),m(ge,ct)};E(Ut,ge=>{e(K),x(()=>e(K).description)&&ge(Xt)})}var ka=u(Ut,2),wa=o(ka),Na=o(wa,!0);i(wa);var pa=u(wa,2),xa=o(pa,!0);i(pa),i(ka),i(Ea);var Ia=u(Ea,2),re=o(Ia);i(Ia),i(Ze),O((ge,ct,Et)=>{wt=we(Ze,1,"todo-card",null,wt,ge),Wa(Ze,`--card-index: ${e(De)??""};`),su(Tt,(e(K),x(()=>e(K).completed))),Mt(Tt,"id",`todo-${e(K),x(()=>e(K).id)??""}`),Tt.disabled=e(d),Mt(kt,"for",`todo-${e(K),x(()=>e(K).id)??""}`),ua=we(_a,1,"todo-title",null,ua,ct),w(Sa,(e(K),x(()=>e(K).title))),w(Na,(e(K),x(()=>e(K).category))),w(xa,Et),re.disabled=e(d)},[()=>({completed:e(K).completed}),()=>({completed:e(K).completed}),()=>(e(K),x(()=>le(e(K).dueDate)))]),Se("change",Tt,()=>Ke(e(K).id)),Se("click",re,()=>lt(e(K))),m(fa,Ze)}),i(da),m(La,da)}),m(ma,ha)},ya=ma=>{var ha=mt(),Fa=tt(ha);{var La=fa=>{var K=Rb(),De=u(o(K),6);i(K),Se("click",De,()=>{v(C,""),v(S,"all"),v(M,"all")}),m(fa,K)},da=fa=>{var K=Ob();m(fa,K)};E(Fa,fa=>{e(c),x(()=>e(c).length>0)?fa(La):fa(da,!1)},!0)}m(ma,ha)};E(Ta,ma=>{e(g),x(()=>e(g).length>0)?ma(Aa):ma(ya,!1)},!0)}m(oa,Jt)};E($t,oa=>{e(p)?oa(jt):oa(Kt,!1)},!0)}m(Oe,ft)};E(zt,Oe=>{e(d)?Oe(ga):Oe(bt,!1)})}i(yt),i(I),O((Oe,ft,$t,jt,Kt,oa)=>{w(Be,`${e(y)??""}/${e(k)??""} completed`),w(st,e(L)?"remove":"add"),w(nt,` ${e(L)?"Cancel":"Add New Task"}`),w(ye,Oe),w(ot,ft),je=we(be,1,"material-symbols-outlined dropdown-arrow",null,je,$t),w(gt,jt),w(de,Kt),Q=we(ee,1,"material-symbols-outlined dropdown-arrow",null,Q,oa),dt.disabled=e(d)},[()=>(e(S),x(()=>Me(e(S)))),()=>(e(S),x(()=>_e(e(S)))),()=>({rotated:e(F)}),()=>(e(M),x(()=>Ee(e(M)))),()=>(e(M),x(()=>ze(e(M)))),()=>({rotated:e(j)})]),Se("click",Pe,He),ia(It,()=>e(C),Oe=>v(C,Oe)),Se("click",Pt,et),Se("click",at,Ne),Se("click",dt,it),m(s,I),za(),r()}function zb(s,t){v(t,!e(t))}function Gb(s,t,a){v(t,!e(t)),a()}var Vb=_('<img alt="Profile" class="avatar-image"/>'),Bb=_('<div class="avatar-placeholder"> </div>'),Wb=(s,t,a)=>{t(),a.onnavigate("profile")},Hb=async(s,t,a)=>{t(),await a.onlogout(),qr("Logged out successfully. See you next time!")},Ub=_('<div class="teacher-navbar-dropdown-menu"><button class="teacher-navbar-dropdown-item"><span class="material-symbols-outlined">person</span> Profile</button> <button class="teacher-navbar-dropdown-item"><span class="material-symbols-outlined">logout</span> Logout</button></div>'),Yb=_('<nav class="teacher-navbar" aria-label="Teacher navigation"><div class="teacher-navbar-container"><div class="teacher-navbar-left"><button class="teacher-navbar-icon-button hamburger-menu" aria-label="Toggle navigation menu"><span class="material-symbols-outlined">menu</span></button> <div class="logo-section"><span class="material-symbols-outlined logo-icon">person_book</span> <span class="app-title"> </span></div></div> <div class="teacher-navbar-right"><button class="teacher-navbar-icon-button dark-mode-toggle" aria-label="Toggle dark mode"><span class="material-symbols-outlined"> </span></button> <div class="user-profile-container"><button class="teacher-navbar-user-profile"><div class="teacher-navbar-user-info"><span class="teacher-navbar-user-name"> </span> <span class="user-id"> </span></div> <div class="teacher-navbar-user-avatar"><!></div></button> <!></div></div></div></nav>');function Qb(s,t){qa(t,!0);let a=Ma(t,"teacherName",3,"John Does"),r=Ma(t,"firstName",3,"John"),n=Ma(t,"gender",3,"male"),l=Ma(t,"accountNumber",3,"TCH-2025-0001"),c=Ma(t,"profileImage",3,null);function d(Le){return Le==="female"?"Ms.":"Mr."}let f=aa(()=>`${d(n())} ${r()}`),p=pt(!0),h=pt(!1);function g(){v(h,!1)}function b(Le){e(h)&&!Le.target.closest(".user-profile-container")&&g()}Ya(()=>{const Le=localStorage.getItem("theme");return v(p,Le!=="light"),y(),document.addEventListener("click",b),()=>{document.removeEventListener("click",b)}});function y(){e(p)?(document.documentElement.setAttribute("data-theme","dark"),localStorage.setItem("theme","dark")):(document.documentElement.setAttribute("data-theme","light"),localStorage.setItem("theme","light"))}function k(Le){return Le.split(" ").map(ke=>ke.charAt(0)).join("").toUpperCase().slice(0,2)}var A=Yb(),D=o(A),T=o(D),C=o(T);C.__click=function(...Le){t.onToggleNavRail?.apply(this,Le)};var S=u(C,2),M=u(o(S),2),F=o(M);i(M),i(S),i(T);var j=u(T,2),P=o(j);P.__click=[Gb,p,y];var Y=o(P),W=o(Y,!0);i(Y),i(P);var N=u(P,2),L=o(N);L.__click=[zb,h];var X=o(L),ae=o(X),V=o(ae,!0);i(ae);var ie=u(ae,2),he=o(ie);i(ie),i(X);var Ge=u(X,2),ce=o(Ge);{var se=Le=>{var ke=Vb();O(()=>Mt(ke,"src",c())),m(Le,ke)},Re=Le=>{var ke=Bb(),Ke=o(ke,!0);i(ke),O(lt=>w(Ke,lt),[()=>k(r())]),m(Le,ke)};E(ce,Le=>{c()?Le(se):Le(Re,!1)})}i(Ge),i(L);var Je=u(L,2);{var it=Le=>{var ke=Ub(),Ke=o(ke);Ke.__click=[Wb,g,t];var lt=u(Ke,2);lt.__click=[Hb,g,t],i(ke),m(Le,ke)};E(Je,Le=>{e(h)&&Le(it)})}i(N),i(j),i(D),i(A),O(()=>{w(F,`Welcome, ${e(f)??""}`),w(W,e(p)?"light_mode":"dark_mode"),w(V,a()),w(he,`Account: ${l()??""}`)}),m(s,A),za()}Ps(["click"]);var Kb=(s,t,a)=>t(e(a).id),Jb=_('<button><div class="teacher-menu-rail-icon-container"><span class="material-symbols-outlined teacher-menu-rail-icon"> </span></div> <span class="teacher-menu-rail-label"> </span></button>'),Xb=(s,t,a)=>t(e(a).id),Zb=_('<button><div class="teacher-menu-nav-icon-container"><span class="material-symbols-outlined teacher-menu-nav-icon"> </span></div></button>'),ey=_('<nav aria-label="Teacher portal navigation"><div class="teacher-menu-rail-container"></div></nav> <nav class="teacher-menu-bottom-navigation" aria-label="Teacher portal navigation"><div class="teacher-menu-nav-container"></div></nav>',1);function ty(s,t){qa(t,!0);let a=Ma(t,"teacherActiveSection",15,"schedule"),r=Ma(t,"teacherNavRailVisible",3,!0);const n=[{id:"schedule",label:"Schedule",icon:"schedule"},{id:"students",label:"Class Management",icon:"group"},{id:"advisory",label:"Advisory Class",icon:"supervisor_account"}];let l=pt(!1),c=pt(!1);Es(()=>{t.teacherId&&!e(c)&&d()});async function d(){try{const D=await la.get(`/api/teacher-advisory?teacher_id=${t.teacherId}`);v(l,D.success&&D.data.advisoryData!==null,!0)}catch(D){console.error("Error checking advisory status:",D),v(l,!1)}finally{v(c,!0)}}let f=aa(()=>n.filter(D=>D.id!=="advisory"||e(l)));function p(D){a(D),t.onnavigate&&t.onnavigate({detail:{section:D}})}var h=ey(),g=tt(h);let b;var y=o(g);Dt(y,21,()=>e(f),D=>D.id,(D,T)=>{var C=Jb();let S;C.__click=[Kb,p,T];var M=o(C),F=o(M),j=o(F,!0);i(F),i(M);var P=u(M,2),Y=o(P,!0);i(P),i(C),O(W=>{S=we(C,1,"teacher-menu-rail-item",null,S,W),Mt(C,"aria-label",e(T).label),Mt(C,"aria-current",e(T).id===a()?"page":void 0),w(j,e(T).icon),w(Y,e(T).label)},[()=>({active:e(T).id===a()})]),m(D,C)}),i(y),i(g);var k=u(g,2),A=o(k);Dt(A,21,()=>e(f),D=>D.id,(D,T)=>{var C=Zb();let S;C.__click=[Xb,p,T];var M=o(C),F=o(M),j=o(F,!0);i(F),i(M),i(C),O(P=>{S=we(C,1,"teacher-menu-nav-item",null,S,P),Mt(C,"aria-label",e(T).label),Mt(C,"aria-current",e(T).id===a()?"page":void 0),w(j,e(T).icon)},[()=>({active:e(T).id===a()})]),m(D,C)}),i(A),i(k),O(D=>b=we(g,1,"teacher-menu-navigation-rail",null,b,D),[()=>({collapsed:!r()})]),m(s,h),za()}Ps(["click"]);const Oo="teacherProfileCache",ay=300*1e3;function sy(){const{subscribe:s,set:t,update:a}=Ws({teacherData:null,teacherProfileData:null,teacherSections:[],isLoading:!1,isRefreshing:!1,error:null,lastUpdated:null,isInitialized:!1}),r={subscribe:s,init:n=>{const l=ry(n);return l?(a(c=>({...c,teacherData:l.teacherData,teacherProfileData:l.teacherProfileData,teacherSections:l.teacherSections,lastUpdated:l.lastUpdated,isInitialized:!0,isLoading:!1,error:null})),!0):!1},setLoading:(n,l=!1)=>{a(c=>({...c,isLoading:n&&!c.isInitialized&&!l,isRefreshing:n&&l,error:n?null:c.error}))},setError:n=>{a(l=>({...l,isLoading:!1,isRefreshing:!1,error:n}))},updateProfileData:(n,l,c,d)=>{const f=Date.now();a(p=>({...p,teacherData:n,teacherProfileData:l,teacherSections:c,isLoading:!1,isRefreshing:!1,error:null,lastUpdated:f,isInitialized:!0})),iy(n,l,c,d,f)},loadProfile:async(n,l=!1)=>{try{a(h=>({...h,isLoading:!l&&!h.isInitialized,isRefreshing:l,error:null}));const c=await la.get("/api/accounts?type=teacher&limit=1000");if(!c.success)throw new Error(c.message||"Failed to fetch teacher data");const d=c.accounts.find(h=>h.id===n||h.number===n);if(!d)throw new Error("Teacher data not found");let f=null;try{const h=await la.get(`/api/teacher-profile?teacherId=${n}`);h.success&&(f=h.data)}catch(h){console.warn("Failed to fetch teacher profile data:",h)}let p=[];try{const b=(await(await fetch("/api/current-quarter")).json()).data?.currentSchoolYear||"2025-2026",y=await fetch(`/api/teacher-sections?teacherId=${n}&schoolYear=${b}`);if(y.ok){const k=await y.json();k.success&&(p=k.data.classData||[])}}catch(h){console.warn("Failed to fetch teacher sections:",h)}r.updateProfileData(d,f,p,n)}catch(c){console.error("Error loading teacher profile:",c),a(d=>({...d,isLoading:!1,isRefreshing:!1,error:c.message}))}},clearCache:n=>{try{const l=`${Oo}_${n}`;localStorage.removeItem(l)}catch(l){console.warn("Failed to clear teacher profile cache:",l)}},forceRefresh:async n=>{r.clearCache(n),a(l=>({...l,isInitialized:!1,teacherData:null,teacherProfileData:null,teacherSections:[]})),await r.loadProfile(n,!1)}};return r}function ry(s){try{const t=`${Oo}_${s}`,a=localStorage.getItem(t);if(!a)return null;const r=JSON.parse(a);return Date.now()-r.timestamp>ay?(localStorage.removeItem(t),null):{teacherData:r.teacherData,teacherProfileData:r.teacherProfileData,teacherSections:r.teacherSections,lastUpdated:r.timestamp}}catch(t){return console.warn("Failed to get cached teacher profile data:",t),null}}function iy(s,t,a,r,n){try{const l=`${Oo}_${r}`,c={teacherData:s,teacherProfileData:t,teacherSections:a,timestamp:n};localStorage.setItem(l,JSON.stringify(c))}catch(l){console.warn("Failed to cache teacher profile data:",l)}}const Yr=sy();function ny(s,t){v(t,!e(t))}function oy(s,t){v(t,!e(t))}function ly(s,t){v(t,!e(t))}function cy(s,t){cs.confirm("Change Password",`
			<div class="teacher-profile-password-form">
				<div class="teacher-profile-form-group">
					<label for="current-password">Current Password</label>
					<div class="teacher-profile-password-input-wrapper">
						<input 
							id="current-password"
							type="password" 
							placeholder="Enter current password"
							class="teacher-profile-form-input"
						/>
						<button type="button" class="teacher-profile-password-toggle" onclick="togglePasswordVisibility('current-password')">
							<svg class="password-eye-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
								<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
								<line x1="1" y1="1" x2="23" y2="23"/>
							</svg>
						</button>
					</div>
				</div>
				
				<div class="teacher-profile-form-group">
					<label for="new-password">New Password</label>
					<div class="teacher-profile-password-input-wrapper">
						<input 
							id="new-password"
							type="password" 
							placeholder="Enter new password"
							class="teacher-profile-form-input"
						/>
						<button type="button" class="teacher-profile-password-toggle" onclick="togglePasswordVisibility('new-password')">
							<svg class="password-eye-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
								<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
								<line x1="1" y1="1" x2="23" y2="23"/>
							</svg>
						</button>
					</div>
				</div>
				
				<div class="teacher-profile-form-group">
					<label for="confirm-password">Confirm New Password</label>
					<div class="teacher-profile-password-input-wrapper">
						<input 
							id="confirm-password"
							type="password" 
							placeholder="Confirm new password"
							class="teacher-profile-form-input"
						/>
						<button type="button" class="teacher-profile-password-toggle" onclick="togglePasswordVisibility('confirm-password')">
							<svg class="password-eye-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
								<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
								<line x1="1" y1="1" x2="23" y2="23"/>
							</svg>
						</button>
					</div>
				</div>
			</div>
		`,t,()=>{},{size:"medium"})}var dy=_('<div class="teacher-error-container"><div class="teacher-error-icon"><span class="material-symbols-outlined">error</span></div> <p class="teacher-error-message"> </p> <button class="teacher-retry-btn"><span class="material-symbols-outlined">refresh</span> Retry</button></div>'),uy=_('<div class="teacher-profile-loading-container"><span class="teacher-profile-loader"></span> <p class="teacher-profile-loading-text">Loading teacher information...</p></div>'),vy=_('<div class="teacher-info-row teacher-row-three"><div class="teacher-info-card"><div class="teacher-info-icon"><span class="material-symbols-outlined">badge</span></div> <div class="teacher-info-content"><div class="teacher-info-label">Teacher ID</div> <div class="teacher-info-value"> </div></div></div> <div class="teacher-info-card"><div class="teacher-info-icon"><span class="material-symbols-outlined">person</span></div> <div class="teacher-info-content"><div class="teacher-info-label">Full Name</div> <div class="teacher-info-value"> </div></div></div> <div class="teacher-info-card"><div class="teacher-info-icon"><span class="material-symbols-outlined">work</span></div> <div class="teacher-info-content"><div class="teacher-info-label">Position</div> <div class="teacher-info-value"> </div></div></div></div> <div class="teacher-info-row teacher-row-three"><div class="teacher-info-card"><div class="teacher-info-icon"><span class="material-symbols-outlined">email</span></div> <div class="teacher-info-content"><div class="teacher-info-label">Email</div> <div class="teacher-info-value"> </div></div></div> <div class="teacher-info-card"><div class="teacher-info-icon"><span class="material-symbols-outlined">menu_book</span></div> <div class="teacher-info-content"><div class="teacher-info-label">Total Subjects</div> <div class="teacher-info-value"> </div></div></div> <div class="teacher-info-card"><div class="teacher-info-icon"><span class="material-symbols-outlined">domain</span></div> <div class="teacher-info-content"><div class="teacher-info-label">Department</div> <div class="teacher-info-value"> </div></div></div></div>',1),fy=_('<div class="teacher-profile-loading-container"><span class="teacher-profile-loader"></span> <p class="teacher-profile-loading-text">Loading teaching sections...</p></div>'),py=_('<div class="teacher-info-card"><div class="teacher-info-icon"><span class="material-symbols-outlined">groups</span></div> <div class="teacher-info-content"><div class="teacher-info-label"> </div> <div class="teacher-info-value"> </div></div></div>'),my=_('<div class="teacher-info-row teacher-row-three"></div>'),hy=_('<div class="teacher-sections-empty"><span class="material-symbols-outlined">groups</span> <p>No teaching sections assigned yet</p></div>'),gy=_('<div class="teacher-profile-loading-container"><span class="teacher-profile-loader"></span> <p class="teacher-profile-loading-text">Loading teaching assignments...</p></div>'),_y=_('<div class="teacher-subject-card"><div class="teacher-subject-icon-column"><div class="teacher-subject-icon"><span class="material-symbols-outlined">book</span></div></div> <div class="teacher-subject-details-column"><h3 class="teacher-subject-name"> </h3> <p class="teacher-subject-classes"><!></p></div></div>'),by=_('<div class="teacher-subjects-grid"></div>'),yy=_('<div class="teacher-subjects-empty"><span class="material-symbols-outlined">menu_book</span> <p>No subjects assigned yet</p></div>'),wy=_('<div class="teacher-profile-header"><div class="teacher-header-content"><h1 class="teacher-page-title">Teacher Profile</h1> <p class="teacher-page-subtitle">Personal Information & Teaching Details</p></div> <div class="teacher-header-actions"><button class="teacher-refresh-btn" aria-label="Refresh profile data"><span class="material-symbols-outlined">refresh</span></button></div></div> <div class="teacher-profile-info-section"><h2 class="teacher-section-title teacher-section-title-desktop">Teacher Information</h2> <button class="teacher-section-header-mobile" aria-label="Toggle teacher information"><h2 class="teacher-section-title">Teacher Information</h2> <span>expand_more</span></button> <div><!></div></div> <div class="teacher-profile-sections-section"><h2 class="teacher-section-title teacher-section-title-desktop">Teaching Sections</h2> <button class="teacher-section-header-mobile" aria-label="Toggle teaching sections"><h2 class="teacher-section-title">Teaching Sections</h2> <span>expand_more</span></button> <div><!></div></div> <div class="teacher-profile-subjects-section"><h2 class="teacher-section-title teacher-section-title-desktop">Teaching Assignments</h2> <button class="teacher-section-header-mobile" aria-label="Toggle teaching assignments"><h2 class="teacher-section-title">Teaching Assignments</h2> <span>expand_more</span></button> <div><!></div></div> <div class="teacher-profile-security-section"><h2 class="teacher-section-title teacher-section-title-desktop">Account Security</h2> <div class="teacher-section-content"><div class="teacher-info-row teacher-row-one"><div class="teacher-info-card teacher-security-card"><div class="teacher-info-content-container"><div class="teacher-info-icon"><span class="material-symbols-outlined">lock</span></div> <div class="teacher-info-content"><div class="teacher-info-label">Password</div> <div class="teacher-info-value">Change your account password for security</div></div></div> <div class="teacher-security-actions"><button class="teacher-security-action-button"><span class="material-symbols-outlined">lock</span> Change Password</button></div></div></div></div></div>',1),xy=_('<div class="teacher-profile-container"><!></div>');function Sy(s,t){qa(t,!0);const[a,r]=xs(),n=()=>Ja(Yr,"$teacherProfileStore",a),l=()=>Ja(gs,"$authStore",a);let c=pt(void 0),d=aa(()=>n().teacherData),f=aa(()=>n().teacherProfileData),p=aa(()=>n().teacherSections),h=aa(()=>n().isLoading),g=aa(()=>n().error);Es(()=>gs.subscribe(N=>{v(c,N,!0)})),Ya(async()=>{if(!e(c)?.userData?.id){console.error("User not authenticated");return}const W=e(c).userData.id,N=Yr.init(W);await Yr.loadProfile(W,N);const L=setInterval(async()=>{await Yr.loadProfile(W,!0)},300*1e3);return()=>{clearInterval(L)}});async function b(){const W=l();if(!W.isAuthenticated||!W.userData?.id){console.error("User not authenticated");return}const N=W.userData.id;await Yr.forceRefresh(N)}Es(()=>{if(e(c)?.userData?.id){const W=e(c).userData.id;Yr.init(W)||Yr.loadProfile(W,!1)}});let y=aa(()=>({id:e(d)?.number||e(c)?.userData?.accountNumber||"N/A",name:e(d)?.name||e(c)?.userData?.name||"Teacher Name",firstName:e(d)?.firstName||e(c)?.userData?.firstName||"",lastName:e(d)?.lastName||"",middleInitial:e(d)?.middleInitial||"",department:e(d)?.department||"Not assigned",position:e(d)?.position||"Teacher",email:e(d)?.email||"Not available",phone:e(d)?.contactNumber||"Not available",address:e(d)?.address||"Not available",birthDate:e(d)?.birthdate?new Date(e(d).birthdate).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"Not available",age:e(d)?.age||"Not available",gender:e(d)?.gender||e(c)?.userData?.gender||"male",employmentInfo:{hireDate:e(d)?.hireDate?new Date(e(d).hireDate).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"Not available",yearsOfService:e(d)?.yearsOfService||"Not available",employeeId:e(d)?.employeeId||"Not available"},subjects:e(f)?.subjects||[],classes:e(f)?.classes||[],sections:e(f)?.sections||[]})),k=aa(()=>e(y).subjects.length||"Not available"),A=pt(!0),D=pt(!0),T=pt(!0),C=pt(!1);function S(W){const N=document.getElementById(W),X=N.nextElementSibling.querySelector(".password-eye-icon");N.type==="password"?(N.type="text",X.innerHTML='<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/>'):(N.type="password",X.innerHTML='<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/>')}typeof window<"u"&&(window.togglePasswordVisibility=S);async function M(){const W=document.getElementById("current-password"),N=document.getElementById("new-password"),L=document.getElementById("confirm-password");if(!W||!N||!L){us("Password form inputs not found");return}const X=W.value,ae=N.value,V=L.value;if(!X){us("Current password is required");return}if(!ae){us("New password is required");return}if(ae!==V){us("New passwords do not match");return}if(ae.length<8){us("Password must be at least 8 characters long");return}if(X===ae){us("New password must be different from current password");return}try{v(C,!0);const ie=await la.post("/api/change-password",{currentPassword:X,newPassword:ae});ie.success?(W.value="",N.value="",L.value="",qr("Password changed successfully!"),cs.close()):us(ie.error||"Failed to change password")}catch(ie){us(ie.message||"Failed to change password")}finally{v(C,!1)}}var F=xy(),j=o(F);{var P=W=>{var N=dy(),L=u(o(N),2),X=o(L);i(L);var ae=u(L,2);ae.__click=b,i(N),O(()=>w(X,`Failed to load profile data: ${e(g)??""}`)),m(W,N)},Y=W=>{var N=wy(),L=tt(N),X=u(o(L),2),ae=o(X);ae.__click=b,i(X),i(L);var V=u(L,2),ie=u(o(V),2);ie.__click=[ny,A];var he=u(o(ie),2);let Ge;i(ie);var ce=u(ie,2);let se;var Re=o(ce);{var Je=ue=>{var G=uy();m(ue,G)},it=ue=>{var G=vy(),z=tt(G),le=o(z),Z=u(o(le),2),q=u(o(Z),2),U=o(q,!0);i(q),i(Z),i(le);var $=u(le,2),I=u(o($),2),H=u(o(I),2),fe=o(H,!0);i(H),i(I),i($);var ve=u($,2),Fe=u(o(ve),2),Ce=u(o(Fe),2),Be=o(Ce,!0);i(Ce),i(Fe),i(ve),i(z);var Ue=u(z,2),Pe=o(Ue),Ve=u(o(Pe),2),st=u(o(Ve),2),nt=o(st,!0);i(st),i(Ve),i(Pe);var vt=u(Pe,2),St=u(o(vt),2),At=u(o(St),2),Wt=o(At,!0);i(At),i(St),i(vt);var Nt=u(vt,2),It=u(o(Nt),2),Gt=u(o(It),2),Ot=o(Gt,!0);i(Gt),i(It),i(Nt),i(Ue),O(()=>{w(U,e(y).id),w(fe,e(y).name),w(Be,e(y).position),w(nt,e(y).email||"Not provided"),w(Wt,e(k)),w(Ot,e(y).department)}),m(ue,G)};E(Re,ue=>{e(h)?ue(Je):ue(it,!1)})}i(ce),i(V);var Le=u(V,2),ke=u(o(Le),2);ke.__click=[oy,D];var Ke=u(o(ke),2);let lt;i(ke);var He=u(ke,2);let et;var Ne=o(He);{var ne=ue=>{var G=fy();m(ue,G)},oe=ue=>{var G=mt(),z=tt(G);{var le=q=>{var U=my();Dt(U,21,()=>e(p),Ua,($,I)=>{var H=mt(),fe=tt(H);Dt(fe,17,()=>e(I).sections,Ua,(ve,Fe)=>{var Ce=py(),Be=u(o(Ce),2),Ue=o(Be),Pe=o(Ue,!0);i(Ue);var Ve=u(Ue,2),st=o(Ve);i(Ve),i(Be),i(Ce),O(()=>{w(Pe,e(Fe).name),w(st,`${e(I).gradeName??""}  ${e(Fe).students??""} students`)}),m(ve,Ce)}),m($,H)}),i(U),m(q,U)},Z=q=>{var U=hy();m(q,U)};E(z,q=>{e(p).length>0?q(le):q(Z,!1)},!0)}m(ue,G)};E(Ne,ue=>{e(h)?ue(ne):ue(oe,!1)})}i(He),i(Le);var _e=u(Le,2),Me=u(o(_e),2);Me.__click=[ly,T];var ze=u(o(Me),2);let Ee;i(Me);var pe=u(Me,2);let qe;var Ae=o(pe);{var Ie=ue=>{var G=gy();m(ue,G)},ut=ue=>{var G=mt(),z=tt(G);{var le=q=>{var U=by();Dt(U,21,()=>e(y).subjects,$=>$.id,($,I)=>{var H=_y(),fe=o(H),ve=o(fe);i(fe);var Fe=u(fe,2),Ce=o(Fe),Be=o(Ce,!0);i(Ce);var Ue=u(Ce,2),Pe=o(Ue);{var Ve=nt=>{var vt=ba();O(()=>w(vt,`${e(I).section_count??""} ${e(I).section_count===1?"section":"sections"}`)),m(nt,vt)},st=nt=>{var vt=ba("No sections assigned");m(nt,vt)};E(Pe,nt=>{e(I).section_count?nt(Ve):nt(st,!1)})}i(Ue),i(Fe),i(H),O(()=>{Wa(H,`border-color: ${e(I).color??""};`),Wa(ve,`background-color: ${e(I).color??""}20; color: ${e(I).color??""}`),w(Be,e(I).name)}),m($,H)}),i(U),m(q,U)},Z=q=>{var U=yy();m(q,U)};E(z,q=>{e(y).subjects.length>0?q(le):q(Z,!1)},!0)}m(ue,G)};E(Ae,ue=>{e(h)?ue(Ie):ue(ut,!1)})}i(pe),i(_e);var me=u(_e,2),J=u(o(me),2),xe=o(J),$e=o(xe),B=u(o($e),2),te=o(B);te.__click=[cy,M],i(B),i($e),i(xe),i(J),i(me),O((ue,G,z,le,Z,q)=>{ae.disabled=e(h),Ge=we(he,1,"material-symbols-outlined teacher-collapse-icon",null,Ge,ue),se=we(ce,1,"teacher-section-content",null,se,G),lt=we(Ke,1,"material-symbols-outlined teacher-collapse-icon",null,lt,z),et=we(He,1,"teacher-section-content",null,et,le),Ee=we(ze,1,"material-symbols-outlined teacher-collapse-icon",null,Ee,Z),qe=we(pe,1,"teacher-section-content",null,qe,q)},[()=>({rotated:e(A)}),()=>({collapsed:e(A)}),()=>({rotated:e(D)}),()=>({collapsed:e(D)}),()=>({rotated:e(T)}),()=>({collapsed:e(T)})]),m(W,N)};E(j,W=>{e(g)?W(P):W(Y,!1)})}i(F),m(s,F),za(),r()}Ps(["click"]);const Mn="teacherScheduleCache",ky=300*1e3;function Ay(){const{subscribe:s,set:t,update:a}=Ws({scheduleData:{Mon:[],Tue:[],Wed:[],Thu:[],Fri:[]},isLoading:!1,isRefreshing:!1,error:null,lastUpdated:null,isInitialized:!1}),r={subscribe:s,init:(n,l)=>{const c=Dy(n,l);return c?(a(d=>({...d,scheduleData:c.scheduleData,lastUpdated:c.lastUpdated,isInitialized:!0,isLoading:!1,error:null})),!0):!1},setLoading:(n,l=!1)=>{a(c=>({...c,isLoading:n&&!c.isInitialized&&!l,isRefreshing:n&&l,error:n?null:c.error}))},updateScheduleData:(n,l,c,d=!1)=>{const f=Date.now();a(p=>({...p,scheduleData:n,isLoading:!1,isRefreshing:!1,error:null,lastUpdated:f,isInitialized:!0})),kc(n,l,c,f)},setError:(n,l=!1)=>{a(c=>({...c,error:n,isLoading:!1,isRefreshing:!1}))},loadSchedule:async(n,l,c=!1)=>{try{a(g=>({...g,isLoading:!c&&!g.isInitialized,isRefreshing:c,error:null}));let d=l;d||(d=(await(await ns("/api/current-quarter")).json()).data?.currentSchoolYear||"2025-2026");const p=await(await ns(`/api/schedules?action=teacher-schedules&teacherId=${n}&schoolYear=${d}`)).json();if(!p.success)throw new Error(p.error||"Failed to fetch schedule data");const h=Cy(p.data);a(g=>({...g,scheduleData:h,isLoading:!1,isRefreshing:!1,error:null,lastUpdated:Date.now(),isInitialized:!0})),kc(h,n,d,Date.now())}catch(d){console.error("Error loading teacher schedule:",d),a(f=>({...f,error:d.message,isLoading:!1,isRefreshing:!1}))}},clearCache:(n,l)=>{try{const c=`${Mn}_${n}_${l}`;localStorage.removeItem(c)}catch(c){console.warn("Failed to clear teacher schedule cache:",c)}},forceRefresh:async(n,l)=>{try{const c=`${Mn}_${n}_${l}`;localStorage.removeItem(c)}catch(c){console.warn("Failed to clear cache during force refresh:",c)}a(c=>({...c,isInitialized:!1,scheduleData:{Mon:[],Tue:[],Wed:[],Thu:[],Fri:[]}})),await r.loadSchedule(n,l,!1)}};return r}function Dy(s,t){try{const a=`${Mn}_${s}_${t}`,r=localStorage.getItem(a);if(!r)return null;const n=JSON.parse(r);return Date.now()-n.timestamp>ky?(localStorage.removeItem(a),null):{scheduleData:n.scheduleData,lastUpdated:n.timestamp}}catch(a){return console.warn("Failed to retrieve cached teacher schedule:",a),null}}function kc(s,t,a,r){try{const n=`${Mn}_${t}_${a}`,l={scheduleData:s,timestamp:r,teacherId:t,schoolYear:a};localStorage.setItem(n,JSON.stringify(l))}catch(n){console.warn("Failed to cache teacher schedule data:",n)}}function Cy(s){const t={Mon:[],Tue:[],Wed:[],Thu:[],Fri:[]},a={monday:"Mon",tuesday:"Tue",wednesday:"Wed",thursday:"Thu",friday:"Fri"},r=["blue","green","purple","yellow","orange"];function n(c){return r[c%r.length]}const l={Mon:0,Tue:0,Wed:0,Thu:0,Fri:0};return s.forEach(c=>{const d=a[c.day_of_week.toLowerCase()];if(d){const f=Ac(c.start_time),p=Ac(c.end_time);let h,g;c.schedule_type==="subject"?(h=c.section_name,g=c.subject_name||"Unknown Subject"):c.schedule_type==="activity"&&(h=c.activity_type_name||"Activity",g=c.activity_type_name||"Activity");const b={name:h,time:`${f} - ${p}`,room:c.room_name||"TBA",subject:g,gradeLevel:c.grade_level,scheduleType:c.schedule_type,color:n(l[d])};t[d].push(b),l[d]++}}),Object.keys(t).forEach(c=>{const d=t[c],f=Ty(d),p=[...d,...f].sort((h,g)=>{const b=ui(h.time.split(" - ")[0]),y=ui(g.time.split(" - ")[0]);return b-y});t[c]=p}),t}function Ac(s){const[t,a]=s.split(":"),r=parseInt(t),n=r>=12?"PM":"AM";return`${(r===0?12:r>12?r-12:r).toString().padStart(2,"0")}:${a} ${n}`}function ui(s){const[t,a]=s.split(" "),[r,n]=t.split(":").map(Number);let l=n;return a==="PM"&&r!==12?l+=(r+12)*60:a==="AM"&&r===12?l+=0:l+=r*60,l}function Dc(s){const t=Math.floor(s/60),a=s%60,r=t>=12?"PM":"AM";return`${(t===0?12:t>12?t-12:t).toString().padStart(2,"0")}:${a.toString().padStart(2,"0")} ${r}`}function Ty(s){if(s.length<=1)return[];const t=[...s].sort((r,n)=>{const l=ui(r.time.split(" - ")[0]),c=ui(n.time.split(" - ")[0]);return l-c}),a=[];for(let r=0;r<t.length-1;r++){const n=t[r],l=t[r+1],c=ui(n.time.split(" - ")[1]),d=ui(l.time.split(" - ")[0]);if(d>c){const f=Dc(c),p=Dc(d);a.push({name:"Vacant Time",time:`${f} - ${p}`,room:"Available",subject:"Free Period",color:"gray",isVacant:!0})}}return a}const $i=Ay();var Ey=_('<button><div class="day-name"> </div> <div class="day-name-full"> </div></button>'),Fy=_("<button> </button>"),Ny=_('<div class="teacher-dropdown-menu"></div>'),$y=_('<div class="loading-message"><div class="system-loader"></div> <p>Loading Schedule...</p></div>'),Ly=_('<div class="error-message"><div class="error-icon"><span class="material-symbols-outlined">error</span></div> <h3>Error Loading Schedule</h3> <p> </p> <button class="retry-button"><span class="material-symbols-outlined">refresh</span> Try Again</button></div>'),Py=_('<div class="schedule-class-location"><span class="material-symbols-outlined">schedule</span> <span>Available Time</span></div>'),My=_('<div class="schedule-class-teacher"><span class="material-symbols-outlined">book</span> <span> </span></div>'),Iy=_('<div class="schedule-class-grade"><span class="material-symbols-outlined">school</span> <span> </span></div>'),Ry=_('<div class="schedule-class-location"><span class="material-symbols-outlined">location_on</span> <span> </span></div> <!> <!>',1),Oy=_('<div><div class="class-header"><h3 class="schedule-class-name"> </h3> <span class="schedule-class-time"> </span></div> <div class="class-details"><!></div></div>'),jy=_('<div class="schedule-classes-grid"></div>'),qy=_('<div class="no-classes-message"><div class="no-classes-icon"><span class="material-symbols-outlined">event_available</span></div> <h3>No Classes Scheduled</h3> <p> </p></div>'),zy=_('<div class="schedule-container" role="button" tabindex="0"><div class="schedule-schedule-header"><h1 class="schedule-page-title">Teaching Schedule</h1> <p class="schedule-page-subtitle">Your weekly teaching schedule</p></div> <div class="week-navigation"><div class="week-title"><span> </span></div> <div class="schedule-day-selector"></div> <div class="teacher-mobile-dropdown"><button class="teacher-dropdown-toggle-date"><span> </span> <span>expand_more</span></button> <!></div></div> <div class="classes-section"><div class="classes-header"><h2> </h2> <div class="refresh-controls"><button class="refresh-button"><span class="material-symbols-outlined">refresh</span></button></div></div> <!></div></div>');function Gy(s,t){qa(t,!1);const[a,r]=xs(),n=()=>Ja($i,"$teacherScheduleStore",a),l=()=>Ja(gs,"$authStore",a),c=R(),d=R(),f=R(),p=R(),h=R(),g=R(),b=R(),y=new Date,k=["January","February","March","April","May","June","July","August","September","October","November","December"],A=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],D=k[y.getMonth()],T=y.getDate(),C=A[y.getDay()],S={1:"Mon",2:"Tue",3:"Wed",4:"Thu",5:"Fri"},M=y.getDay();let F=R(S[M]||"Mon");Ya(async()=>{const pe=l();if(!pe.isAuthenticated||!pe.userData?.id){console.error("User not authenticated");return}const qe=pe.userData.id,Ae=$i.init(qe,null);await $i.loadSchedule(qe,null,Ae);const Ie=setInterval(async()=>{await $i.loadSchedule(qe,null,!0)},300*1e3);return()=>{clearInterval(Ie)}});async function j(){const pe=l();if(!pe.isAuthenticated||!pe.userData?.id){console.error("User not authenticated");return}const qe=pe.userData.id;await $i.forceRefresh(qe,null)}const P={Mon:"Monday",Tue:"Tuesday",Wed:"Wednesday",Thu:"Thursday",Fri:"Friday"},Y=[{day:"Mon"},{day:"Tue"},{day:"Wed"},{day:"Thu"},{day:"Fri"}];let W=R(0),N=R(!1);function L(pe){pe.target.closest(".teacher-mobile-dropdown")||v(N,!1)}function X(){v(N,!e(N))}function ae(pe){v(F,pe),v(N,!1)}ht(()=>(e(c),e(d),e(f),e(p),e(h),n()),()=>{(pe=>{v(c,pe.scheduleData),v(d,pe.isLoading),v(f,pe.isRefreshing),v(p,pe.error),v(h,pe.lastUpdated)})(n())}),ht(()=>(e(c),e(F)),()=>{v(g,e(c)[e(F)]||[])}),ht(()=>e(F),()=>{v(b,P[e(F)]||"Monday")}),ht(()=>(e(F),e(W)),()=>{e(F),or(W)}),Ms(),Fs();var V=zy(),ie=u(o(V),2),he=o(ie),Ge=o(he),ce=o(Ge);i(Ge),i(he);var se=u(he,2);Dt(se,5,()=>Y,Ua,(pe,qe)=>{let Ae=()=>e(qe).day;var Ie=Ey(),ut=o(Ie),me=o(ut,!0);i(ut);var J=u(ut,2),xe=o(J,!0);i(J),i(Ie),O(()=>{we(Ie,1,`schedule-day-btn ${Ae()===e(F)?"active":""}`),w(me,Ae()),w(xe,(Ae(),x(()=>P[Ae()])))}),Se("click",Ie,()=>ae(Ae())),m(pe,Ie)}),i(se);var Re=u(se,2),Je=o(Re),it=o(Je),Le=o(it,!0);i(it);var ke=u(it,2);i(Je);var Ke=u(Je,2);{var lt=pe=>{var qe=Ny();Dt(qe,5,()=>Y,Ua,(Ae,Ie)=>{let ut=()=>e(Ie).day;var me=Fy(),J=o(me,!0);i(me),O(()=>{we(me,1,`teacher-dropdown-item ${ut()===e(F)?"selected":""}`),w(J,(ut(),x(()=>P[ut()])))}),Se("click",me,()=>ae(ut())),m(Ae,me)}),i(qe),m(pe,qe)};E(Ke,pe=>{e(N)&&pe(lt)})}i(Re),i(ie);var He=u(ie,2),et=o(He),Ne=o(et),ne=o(Ne);i(Ne);var oe=u(Ne,2),_e=o(oe);i(oe),i(et);var Me=u(et,2);{var ze=pe=>{var qe=$y();m(pe,qe)},Ee=pe=>{var qe=mt(),Ae=tt(qe);{var Ie=me=>{var J=Ly(),xe=u(o(J),4),$e=o(xe,!0);i(xe);var B=u(xe,2);i(J),O(()=>w($e,e(p))),Se("click",B,j),m(me,J)},ut=me=>{var J=mt(),xe=tt(J);{var $e=te=>{var ue=mt(),G=tt(ue);Rs(G,()=>e(W),z=>{var le=jy();Dt(le,5,()=>e(g),Ua,(Z,q,U)=>{var $=Oy();Wa($,`--card-index: ${U};`);var I=o($),H=o(I),fe=o(H,!0);i(H);var ve=u(H,2),Fe=o(ve,!0);i(ve),i(I);var Ce=u(I,2),Be=o(Ce);{var Ue=Ve=>{var st=Py();m(Ve,st)},Pe=Ve=>{var st=Ry(),nt=tt(st),vt=u(o(nt),2),St=o(vt,!0);i(vt),i(nt);var At=u(nt,2);{var Wt=Gt=>{var Ot=My(),sa=u(o(Ot),2),Qt=o(sa,!0);i(sa),i(Ot),O(()=>w(Qt,(e(q),x(()=>e(q).subject)))),m(Gt,Ot)};E(At,Gt=>{e(q),x(()=>e(q).subject)&&Gt(Wt)})}var Nt=u(At,2);{var It=Gt=>{var Ot=Iy(),sa=u(o(Ot),2),Qt=o(sa);i(sa),i(Ot),O(()=>w(Qt,`Grade ${e(q),x(()=>e(q).gradeLevel)??""}`)),m(Gt,Ot)};E(Nt,Gt=>{e(q),x(()=>e(q).gradeLevel&&e(q).scheduleType==="subject")&&Gt(It)})}O(()=>w(St,(e(q),x(()=>e(q).room)))),m(Ve,st)};E(Be,Ve=>{e(q),x(()=>e(q).scheduleType==="vacant")?Ve(Ue):Ve(Pe,!1)})}i(Ce),i($),O(()=>{we($,1,`schedule-class-card ${e(q),x(()=>e(q).color)??""}`),w(fe,(e(q),x(()=>e(q).name))),w(Fe,(e(q),x(()=>e(q).time)))}),m(Z,$)}),i(le),m(z,le)}),m(te,ue)},B=te=>{var ue=qy(),G=u(o(ue),4),z=o(G);i(G),i(ue),O(()=>w(z,`You don't have any classes scheduled for ${e(b)??""}. Enjoy your free day!`)),m(te,ue)};E(xe,te=>{e(g),x(()=>e(g).length>0)?te($e):te(B,!1)},!0)}m(me,J)};E(Ae,me=>{e(p)?me(Ie):me(ut,!1)},!0)}m(pe,qe)};E(Me,pe=>{e(d)?pe(ze):pe(Ee,!1)})}i(He),i(V),O(()=>{w(ce,`${C??""}, ${D??""} ${T??""}`),w(Le,(e(F),x(()=>P[e(F)]||"Select Day"))),we(ke,1,`material-symbols-outlined teacher-dropdown-icon ${e(N)?"open":""}`),w(ne,`${e(b)??""} Classes`),_e.disabled=e(d)}),Se("click",Je,X),Se("click",_e,j),Se("click",V,L),Se("keydown",V,L),m(s,V),za(),r()}var Vy=_('<div><div class="stat-card-header"><p class="class-mgmt-stat-label"> </p> <div class="class-mgmt-stat-icon"><span class="material-symbols-outlined"> </span></div></div> <div class="stat-card-content"><h3 class="class-mgmt-stat-value"><!></h3></div></div>'),By=_('<div class="loading-container"><div class="system-loader"></div> <p>Loading your teaching assignments...</p></div>'),Wy=_('<div class="error-container"><div class="error-icon"><span class="material-symbols-outlined">error</span></div> <p class="error-message"> </p> <button class="retry-button"><span class="material-symbols-outlined">refresh</span> Retry</button></div>'),Hy=_(`<div class="empty-state"><div class="empty-icon"><span class="material-symbols-outlined">school</span></div> <h3>No Teaching Assignments</h3> <p>You don't have any sections assigned for this school year.</p></div>`),Uy=(s,t,a,r)=>t(e(a).yearLevel,e(r).name,e(r).id),Yy=_('<span class="more-subjects"> </span>'),Qy=_('<div class="section-subjects"><span> </span> <!></div>'),Ky=_('<button class="section-card stagger-section-item"><div class="section-card-content"><div class="section-name"> </div> <!></div> <div class="section-card-icon"><span class="material-symbols-outlined">chevron_right</span></div></button>'),Jy=_('<div class="year-level-container stagger-item"><div class="year-level-header"><div class="year-level-info"><div class="year-level-icon"><span class="material-symbols-outlined">school</span></div> <div class="year-level-details"><h3 class="year-level-title"> </h3> <p class="year-level-summary"> </p></div></div></div> <div class="sections-grid"></div></div>'),Xy=_('<div class="year-levels-grid"></div>'),Zy=_('<div class="class-management-container"><div class="class-mgmt-page-header fade-in"><div class="header-content"><h1 class="class-mgmt-page-title">Class Management</h1> <p class="class-mgmt-page-subtitle">Overview of your teaching assignments and student distribution</p></div></div> <div class="class-mgmt-stats-section"><div class="class-mgmt-stats-grid"></div></div> <div class="classes-section-container"><h2 class="class-mgmt-section-title">Year Levels & Sections</h2> <!></div></div>');function Cc(s,t){qa(t,!0);const[a,r]=xs(),n=()=>Ja(gs,"$authStore",a);let l=pt(Xs({name:"Loading...",yearLevels:[],totalSections:0,totalStudents:0,averagePerSection:0})),c=pt(Xs([])),d=pt(!0),f=pt(null);function p(F,j,P){t.onNavigateToClassList&&t.onNavigateToClassList({detail:{yearLevel:F,sectionName:j,sectionId:P}})}const h=["border-blue","border-green","border-orange","border-purple"];function g(F){return h[F%h.length]}let b=[{id:"year-levels",label:"Year Levels",getValue:()=>e(l).yearLevels.length,icon:"school",color:"var(--school-primary)"},{id:"sections",label:"Total Sections",getValue:()=>e(l).totalSections,icon:"class",color:"var(--school-secondary)"},{id:"students",label:"Total Students",getValue:()=>e(l).totalStudents,icon:"people",color:"var(--success)"},{id:"average",label:"Average Per Section",getValue:()=>e(l).averagePerSection,icon:"analytics",color:"var(--school-accent)"}];async function y(){try{v(d,!0),v(f,null);const F=n();if(!F.isAuthenticated||!F.userData?.id)throw new Error("User not authenticated");const j=F.userData.id,W=(await(await fetch("/api/current-quarter")).json()).data?.currentSchoolYear||"2025-2026",L=await(await fetch(`/api/teacher-sections?teacherId=${j}&schoolYear=${W}`)).json();if(!L.success)throw new Error(L.error||"Failed to fetch teacher sections");v(c,L.data.classData,!0),v(l,{name:F.userData.name||"Teacher",yearLevels:L.data.stats.yearLevels,totalSections:L.data.stats.totalSections,totalStudents:L.data.stats.totalStudents,averagePerSection:L.data.stats.averagePerSection},!0)}catch(F){console.error("Error fetching teacher sections:",F),v(f,F.message,!0),v(c,[],!0),v(l,{name:"Teacher",yearLevels:[],totalSections:0,totalStudents:0,averagePerSection:0},!0)}finally{v(d,!1)}}Ya(()=>{y()});var k=Zy(),A=u(o(k),2),D=o(A);Dt(D,23,()=>b,F=>F.id,(F,j,P)=>{var Y=Vy(),W=o(Y),N=o(W),L=o(N,!0);i(N);var X=u(N,2),ae=o(X),V=o(ae,!0);i(ae),i(X),i(W);var ie=u(W,2),he=o(ie),Ge=o(he);{let ce=aa(()=>e(j).getValue());Kr(Ge,{get value(){return e(ce)},decimals:0,duration:2})}i(he),i(ie),i(Y),O(ce=>{we(Y,1,`class-mgmt-stat-card ${ce??""} stagger-item`),Wa(Y,`--stagger-index: ${e(P)??""}`),w(L,e(j).label),w(V,e(j).icon)},[()=>g(e(P))]),m(F,Y)}),i(D),i(A);var T=u(A,2),C=u(o(T),2);{var S=F=>{var j=By();m(F,j)},M=F=>{var j=mt(),P=tt(j);{var Y=N=>{var L=Wy(),X=u(o(L),2),ae=o(X);i(X);var V=u(X,2);V.__click=y,i(L),O(()=>w(ae,`Error: ${e(f)??""}`)),m(N,L)},W=N=>{var L=mt(),X=tt(L);{var ae=ie=>{var he=Hy();m(ie,he)},V=ie=>{var he=Xy();Dt(he,23,()=>e(c),Ge=>Ge.yearLevel,(Ge,ce,se)=>{var Re=Jy(),Je=o(Re),it=o(Je),Le=u(o(it),2),ke=o(Le),Ke=o(ke,!0);i(ke);var lt=u(ke,2),He=o(lt);i(lt),i(Le),i(it),i(Je);var et=u(Je,2);Dt(et,23,()=>e(ce).sections,Ne=>Ne.name,(Ne,ne,oe)=>{var _e=Ky();_e.__click=[Uy,p,ce,ne];var Me=o(_e),ze=o(Me),Ee=o(ze,!0);i(ze);var pe=u(ze,2);{var qe=Ae=>{var Ie=Qy(),ut=o(Ie),me=o(ut,!0);i(ut);var J=u(ut,2);{var xe=$e=>{var B=Yy(),te=o(B);i(B),O(()=>w(te,`+${e(ne).subjects.length-2} more`)),m($e,B)};E(J,$e=>{e(ne).subjects.length>2&&$e(xe)})}i(Ie),O($e=>w(me,$e),[()=>e(ne).subjects.slice(0,2).join(", ")]),m(Ae,Ie)};E(pe,Ae=>{e(ne).subjects&&e(ne).subjects.length>0&&Ae(qe)})}i(Me),Ht(2),i(_e),O(()=>{Mt(_e,"aria-label",`View class list for ${e(ne).name??""}`),Wa(_e,`--stagger-index: ${e(oe)??""}`),w(Ee,e(ne).name)}),m(Ne,_e)}),i(et),i(Re),O(Ne=>{Wa(Re,`--stagger-index: ${e(se)??""}`),w(Ke,e(ce).gradeName),w(He,`${e(ce).sections.length??""} section${e(ce).sections.length!==1?"s":""}  ${Ne??""} students`)},[()=>e(ce).sections.reduce((Ne,ne)=>Ne+ne.students,0)]),m(Ge,Re)}),i(he),m(ie,he)};E(X,ie=>{e(c).length===0?ie(ae):ie(V,!1)},!0)}m(N,L)};E(P,N=>{e(f)?N(Y):N(W,!1)},!0)}m(F,j)};E(C,F=>{e(d)?F(S):F(M,!1)})}i(T),i(k),m(s,k),za(),r()}Ps(["click"]);async function e1(s,t,a,r,n,l,c,d,f,p,h){if(!t.sectionId||!t.subjectId){Te.error("Missing section or subject information");return}cs.confirm("Send Grades to Adviser","Are you sure you want to send final grades to the adviser?",async()=>{const g=a().filter(y=>!y.isVerified),b=a().length-g.length;if(g.length===0){Te.warning("All student grades have already been verified by the adviser. No grades to send.");return}v(r,!0),v(n,""),v(l,!1);try{const y=g.map(D=>{const T=c(D.writtenWork,d().writtenWork.totals,"writtenWork"),C=c(D.performanceTasks,d().performanceTasks.totals,"performanceTasks"),S=c(D.quarterlyAssessment,d().quarterlyAssessment.totals,"quarterlyAssessment"),M=f(D);return{student_id:D.accountNumber||D.account_number||D.id,written_work_average:T!==""?parseFloat(T):null,performance_tasks_average:C!==""?parseFloat(C):null,quarterly_assessment_average:S!==""?parseFloat(S):null,final_grade:M!==""?parseFloat(M):null,written_work_items:D.writtenWork||[],performance_tasks_items:D.performanceTasks||[],quarterly_assessment_items:D.quarterlyAssessment||[]}}),k=await ns("/api/grades",{method:"POST",body:JSON.stringify({action:"submit_final_grades",section_id:t.sectionId,subject_id:t.subjectId,grading_period_id:p(),teacher_id:h().userData.id,final_grades:y})});if(!k.ok){const D=await k.json().catch(()=>({}));throw console.error("API error response:",D),new Error(D.error||`HTTP ${k.status}: ${k.statusText}`)}const A=await k.json();v(l,!0),b>0?Te.success(`Final grades sent to adviser for ${g.length} students. ${b} verified students were skipped.`):Te.success("Final grades have been sent to the adviser successfully!"),setTimeout(()=>{v(n,"")},3e3)}catch(y){console.error("Error saving final grades:",y),v(l,!1),v(n,y.message||"Failed to save final grades",!0),Te.error(e(n)),setTimeout(()=>{v(n,"")},5e3)}finally{v(r,!1)}},()=>{})}async function t1(s,t,a,r,n,l,c,d,f,p){try{Te.info("Refreshing grades from database...");const h=t(),g=h.isAuthenticated?h.userData?.id:null,b=new URLSearchParams({sectionId:a.sectionId.toString(),subjectId:a.subjectId.toString(),gradingPeriodId:r().toString()});g&&b.append("teacherId",g.toString());const y=await ns(`/api/class-students?${b}`);if(!y.ok)throw new Error(`HTTP ${y.status}: ${y.statusText}`);const k=await y.json();if(k.success&&k.data?.students)n(k.data.students.map(A=>({...A,writtenWork:A.grades?.written_work||[],performanceTasks:A.grades?.performance_tasks||[],quarterlyAssessment:A.grades?.quarterly_assessment||[],grades:A.grades,id:A.account_number||A.id,name:A.full_name||`${A.first_name} ${A.last_name}`,isVerified:A.grades?.verified||A.grades?.verification?.verified||!1}))),l(),v(c,!0),v(d,!1),v(f,p(),!0),Te.success("Grades refreshed successfully");else throw new Error(k.error||"Failed to refresh grades")}catch(h){console.error("Error refreshing grades:",h),Te.error("Failed to refresh grades. Please try again.")}}var a1=_('<span class="material-symbols-outlined spinning">sync</span> <span>Saving...</span>',1),s1=_('<span class="material-symbols-outlined">check_circle</span> <span>Grades Saved</span>',1),r1=_('<span class="material-symbols-outlined">save</span> <span>Save Grades</span>',1),i1=_('<span class="material-symbols-outlined spinning">sync</span> <span>Uploading...</span>',1),n1=_('<span class="material-symbols-outlined">upload</span> <span>Send to Adviser</span>',1),o1=_('<div class="spreadsheet-loading-overlay"><div class="spreadsheet-loader"><div class="loader-spinner"></div> <p>Loading grading spreadsheet...</p></div></div>'),l1=_('<div class="header-overlay"><span class="header-icon material-symbols-outlined">settings</span></div>'),c1=_('<th><span class="header-text"> </span> <!></th>'),d1=_('<input type="text" class="cell-input"/>'),u1=_('<span class="cell-content verified-cell"> </span>'),v1=_('<span class="cell-content"> </span>'),f1=_("<td><!></td>"),p1=_("<tr></tr>"),m1=_('<div class="spreadsheet-container"><table class="spreadsheet-table"><thead><tr></tr></thead><tbody></tbody></table></div>'),h1=_('<div class="save-section"><div class="refresh-button-container"><button class="refresh-grades-button" title="Refresh grades from database"><span class="material-symbols-outlined">refresh</span> <span>Refresh</span></button></div> <div class="save-button-container"><button><!></button> <button class="final-grades-button" title="Upload final grades (averages and computed final grades) to database"><!></button></div></div> <div class="grading-spreadsheet"><!></div>',1);function g1(s,t){qa(t,!0);const[a,r]=xs(),n=()=>Ja(gs,"$authStore",a);let l=Ma(t,"students",23,()=>[]),c=Ma(t,"gradingPeriodId",3,1),d=Ma(t,"gradingConfig",23,()=>({writtenWork:{count:3,weight:.3,totals:[]},performanceTasks:{count:3,weight:.5,totals:[]},quarterlyAssessment:{count:1,weight:.2,totals:[]}})),f=pt(!1),p=pt(!1),h=pt(""),g=pt(!1),b=pt(!1),y=pt(!0),k=pt(null),A,D=pt(null),T=pt(!1),C=pt(""),S=pt(!0),M=pt(!1),F=pt(Xs(new Set)),j=pt(Xs([]));Xs([]);function P(G){if(G==null||G==="")return"0";const z=parseFloat(G);return isNaN(z)?G:(z%1===0,z.toString())}function Y(){return JSON.parse(JSON.stringify(l().map(G=>({id:G.id,writtenWork:Array.isArray(G.writtenWork)?[...G.writtenWork]:[],performanceTasks:Array.isArray(G.performanceTasks)?[...G.performanceTasks]:[],quarterlyAssessment:Array.isArray(G.quarterlyAssessment)?[...G.quarterlyAssessment]:[]}))))}function W(){if(!e(k))return!1;const G=Y(),z=JSON.stringify(G)!==JSON.stringify(e(k));return v(b,z),v(y,!z),z}function N(){const G=["Student ID","Student Name"];for(let z=1;z<=d().writtenWork.count;z++)G.push(it("writtenWork",z-1));G.push("WW Avg");for(let z=1;z<=d().performanceTasks.count;z++)G.push(it("performanceTasks",z-1));G.push("PT Avg");for(let z=1;z<=d().quarterlyAssessment.count;z++)G.push(it("quarterlyAssessment",z-1));G.push("QA Avg"),G.push("Final Grade"),v(j,[G],!0),l().forEach(z=>{if(!z||!z.id||!z.name){console.warn("Invalid student data:",z);return}const le=[z.id,z.name],Z=z.writtenWork||[];for(let $=0;$<d().writtenWork.count;$++)le.push(P(Z[$]));le.push(L(Z,d().writtenWork.totals,"writtenWork"));const q=z.performanceTasks||[];for(let $=0;$<d().performanceTasks.count;$++)le.push(P(q[$]));le.push(L(q,d().performanceTasks.totals,"performanceTasks"));const U=z.quarterlyAssessment||[];for(let $=0;$<d().quarterlyAssessment.count;$++)le.push(P(U[$]));le.push(L(U,d().quarterlyAssessment.totals,"quarterlyAssessment")),le.push(X(z)),e(j).push(le)}),v(k,Y(),!0),v(y,!1),v(b,!1),v(S,!1)}function L(G,z=null,le=null){if(!G||!Array.isArray(G))return"";const Z=G.filter(U=>U!=null&&U!=="");if(Z.length===0)return"";let q=0;if(z&&z.length>0){let U=0,$=0;const I=Math.min(G.length,z.length);for(let fe=0;fe<I;fe++){const ve=G[fe];if(ve!=null&&ve!==""){const Fe=parseFloat(ve),Ce=z[fe];if(Ce&&Ce>0){const Be=Fe/Ce*100;U+=Be,$++}}}if($===0)return"";const H=Math.round(U/$*10)/10;return P(H)}else{q=Z.reduce(($,I)=>$+parseFloat(I),0);const U=Math.round(q/Z.length*10)/10;return P(U)}}function X(G){if(!G)return"";const z=L(G.writtenWork,d().writtenWork.totals,"writtenWork"),le=L(G.performanceTasks,d().performanceTasks.totals,"performanceTasks"),Z=L(G.quarterlyAssessment,d().quarterlyAssessment.totals,"quarterlyAssessment");if(z===""||le===""||Z==="")return"";const q=parseFloat(z)||0,U=parseFloat(le)||0,$=parseFloat(Z)||0,I=q*d().writtenWork.weight+U*d().performanceTasks.weight+$*d().quarterlyAssessment.weight,H=Math.round(I*10)/10;return P(H)}function ae(G,z,le){if(z<2)return;const Z=G-1,q=l()[Z];if(q&&q.isVerified){Te.warning("This student's grades have been verified by the adviser and cannot be edited.");return}v(D,{row:G,col:z},!0),v(T,!1)}function V(G){if(!e(D)||e(T))return;const{row:z,col:le}=e(D);if(G.key==="ArrowUp"||G.key==="ArrowDown"||G.key==="ArrowLeft"||G.key==="ArrowRight"){G.preventDefault(),ie(G.key);return}if(G.key==="Enter"){G.preventDefault(),ie("ArrowDown");return}if(G.key==="Tab"){G.preventDefault(),ie(G.shiftKey?"ArrowLeft":"ArrowRight");return}if(/^[0-9.]$/.test(G.key)&&!Ge(le)&&le>1){const Z=z-1,q=l()[Z];if(q&&q.isVerified){Te.warning("This student's grades have been verified by the adviser and cannot be edited.");return}G.preventDefault(),v(T,!0),v(C,G.key,!0),v(M,!1)}else if(G.key.length===1&&!Ge(le)&&le>1){const Z=z-1,q=l()[Z];if(q&&q.isVerified){Te.warning("This student's grades have been verified by the adviser and cannot be edited.");return}G.preventDefault(),v(T,!0),v(C,G.key,!0),v(M,!1)}}function ie(G){if(!e(D)||!e(j).length)return;const{row:z,col:le}=e(D),Z=e(j).length-1,q=e(j)[0].length-1;let U=z,$=le;switch(G){case"ArrowUp":U=Math.max(1,z-1);break;case"ArrowDown":U=Math.min(Z,z+1);break;case"ArrowLeft":$=Math.max(0,le-1);break;case"ArrowRight":$=Math.min(q,le+1);break}v(D,{row:U,col:$},!0),he(U,$)}function he(G,z){if(!A)return;const le=A.querySelector(`tbody tr:nth-child(${G}) td:nth-child(${z+1})`);le&&le.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})}function Ge(G){const le=e(j)[0][G];return le?.includes("Avg")||le==="Final Grade"}function ce(G){return Je(G)!==null}function se(G){const le=e(j)[0][G];return G<2?"spreadsheet-student-info":le==="Final Grade"||le?.includes("Avg")?"calculated":le?.startsWith("WW")?"written-work":le?.startsWith("PT")?"performance-task":le?.startsWith("QA")?"quarterly-assessment":"default"}function Re(G,z){z.preventDefault(),z.stopPropagation(),ce(G)&&et(G)}function Je(G){let z=2;for(let le=0;le<d().writtenWork.count;le++){if(z===G)return{assessmentType:"writtenWork",columnIndex:le};z++}z++;for(let le=0;le<d().performanceTasks.count;le++){if(z===G)return{assessmentType:"performanceTasks",columnIndex:le};z++}z++;for(let le=0;le<d().quarterlyAssessment.count;le++){if(z===G)return{assessmentType:"quarterlyAssessment",columnIndex:le};z++}return null}function it(G,z){const le=Le(G,z),Z=d()[G].totals[z]||100;return`${le} - ${Z}`}function Le(G,z){if(d()[G].columnNames&&d()[G].columnNames[z])return d()[G].columnNames[z];const le=G==="writtenWork"?"WW":G==="performanceTasks"?"PT":"QA";return d()[G].columnPositions&&d()[G].columnPositions[z]!==void 0?`${le}${d()[G].columnPositions[z]}`:`${le}${z+1}`}function ke(){return l().some(G=>G.isVerified||G.verified)}function Ke(){if(!e(D)||e(D).row===0)return;const{row:G,col:z}=e(D),le=G-1,Z=l()[le];if(!Z)return;const q=Je(z);if(!q)return;const{assessmentType:U,columnIndex:$}=q;let I=e(C).trim(),H=null,fe=!0,ve="";if(I!==""){if(H=parseFloat(I),isNaN(H)||H<0)H=0,fe=!1,ve=isNaN(parseFloat(I))?"Invalid input. Only numbers are allowed.":"Negative scores are not allowed.";else{const Fe=d()[U].totals?.[$];Fe&&H>Fe&&(H=0,fe=!1,ve=`Score cannot exceed the total score of ${Fe}.`)}fe?e(F).delete(`${G}-${z}`):(Te.error(ve),e(F).add(`${G}-${z}`),setTimeout(()=>{e(F).delete(`${G}-${z}`),v(F,new Set(e(F)),!0)},3e3))}else H=null,e(F).delete(`${G}-${z}`);Z[U][$]=H,l([...l()]),N(),W()}function lt(G,z,le){if(e(D)&&e(T)){if(G.key==="Enter"){G.preventDefault();const Z=e(D).row,q=e(D).col;Ke(),v(T,!1),setTimeout(()=>{v(D,{row:Z,col:q},!0),ie("ArrowDown")},0);return}if(G.key==="Tab"){G.preventDefault();const Z=e(D).row,q=e(D).col;Ke(),v(T,!1),setTimeout(()=>{v(D,{row:Z,col:q},!0),ie(G.shiftKey?"ArrowLeft":"ArrowRight")},0);return}if(G.key==="ArrowUp"||G.key==="ArrowDown"||G.key==="ArrowLeft"||G.key==="ArrowRight"){G.preventDefault();const Z=e(D).row,q=e(D).col;Ke(),v(T,!1),setTimeout(()=>{v(D,{row:Z,col:q},!0),ie(G.key)},0);return}if(G.key==="Escape"){G.preventDefault(),v(T,!1),v(C,"");return}}}async function He(){if(!t.sectionId||!t.subjectId){Te.error("Missing section or subject information");return}v(f,!0),v(h,""),v(g,!1);try{const G=l().map(Z=>({student_id:Z.accountNumber||Z.account_number||Z.id,writtenWork:Z.writtenWork,performanceTasks:Z.performanceTasks,quarterlyAssessment:Z.quarterlyAssessment})),z=await ns("/api/grades/save",{method:"POST",body:JSON.stringify({section_id:t.sectionId,subject_id:t.subjectId,grading_period_id:c(),grading_config:d(),grades:G})});if(!z.ok){const Z=await z.json().catch(()=>({}));throw new Error(Z.error||`HTTP ${z.status}: ${z.statusText}`)}const le=await z.json();v(g,!0),Te.success("Grades saved successfully"),v(k,Y(),!0),v(b,!1),v(y,!0),setTimeout(()=>{v(h,"")},3e3)}catch(G){console.error("Error saving grades:",G),v(g,!1),v(h,G.message||"Failed to save grades",!0),Te.error(e(h)),setTimeout(()=>{v(h,"")},5e3)}finally{v(f,!1)}}Es(()=>{const G=l().length,z=d(),le=t.subjectId;x(()=>{(G>0||z||le)&&N()})}),Es(()=>()=>{});function et(G){const z=Je(G);if(!z){Te.error("Cannot edit this column");return}const{assessmentType:le,columnIndex:Z}=z,q=Le(le,Z),U=d()[le].totals[Z]||100,$=d()[le].gradeItemIds?.[Z];if(!$){Te.error("Cannot edit column: Grade item ID not found");return}const I=ke();cs.form("Edit Column","Edit the column name and total score for this assessment:",{label:"Column Name",type:"text",placeholder:"Enter column name",value:q},{label:"Total Score",type:"number",placeholder:"Enter total score",value:U,min:1,max:1e3,disabled:I,disabledReason:I?"Cannot edit total score when grades are verified by adviser":""},async(H,fe)=>{if(!H||!H.trim()){Te.error("Column name cannot be empty");return}const ve=parseInt(fe);if(isNaN(ve)||ve<1||ve>1e3){Te.error("Total score must be between 1 and 1000");return}try{const Fe=await ns("/api/grades/grade-items",{method:"PUT",body:JSON.stringify({grade_item_id:$,name:H.trim(),total_score:ve})});d()[le].columnNames||(d()[le].columnNames=[]),d()[le].columnNames[Z]=H.trim(),d()[le].totals[Z]=ve,d({...d()}),N(),Te.success("Column updated successfully")}catch(Fe){console.error("Error updating column:",Fe),Te.error("Failed to update column. Please try again.")}},()=>{},()=>{cs.confirm("Delete Column",`<p>Are you sure you want to permanently delete the column <strong>"${q}"</strong>?</p>
          <p class="grading-warning">This action will:</p>
          <ul class="grading-warning-list">
            <li>Permanently delete the column and all its grades</li>
            <li>Remove all student scores for this assessment</li>
            <li>This action cannot be undone</li>
          </ul>`,async()=>{try{const H=await ns("/api/grades/grade-items",{method:"DELETE",body:JSON.stringify({grade_item_id:$})});if(!H.ok){const ve=await H.json().catch(()=>({error:H.statusText}));throw new Error(ve.error||`HTTP ${H.status}: ${H.statusText}`)}const fe=await H.json();d()[le].count-=1,d()[le].columnNames&&d()[le].columnNames.splice(Z,1),d()[le].totals&&d()[le].totals.splice(Z,1),d()[le].columnPositions&&d()[le].columnPositions.splice(Z,1),d()[le].gradeItemIds&&d()[le].gradeItemIds.splice(Z,1),d({...d()}),l(l().map(ve=>{const Fe={...ve};return le==="writtenWork"&&Fe.writtenWork?Fe.writtenWork.splice(Z,1):le==="performanceTasks"&&Fe.performanceTasks?Fe.performanceTasks.splice(Z,1):le==="quarterlyAssessment"&&Fe.quarterlyAssessment&&Fe.quarterlyAssessment.splice(Z,1),Fe})),N(),Te.success("Column deleted successfully")}catch(H){console.error("Error deleting column:",H),Te.error("Failed to delete column. Please try again.")}},null,{size:"medium"})},{size:"small",deleteDisabled:I,deleteDisabledReason:I?"Cannot delete columns when grades are verified by adviser":""})}var Ne=h1();Se("keydown",Zs,V);var ne=tt(Ne),oe=o(ne),_e=o(oe);_e.__click=[t1,n,t,c,l,N,y,b,k,Y],i(oe);var Me=u(oe,2),ze=o(Me);let Ee;ze.__click=He;var pe=o(ze);{var qe=G=>{var z=a1();Ht(2),m(G,z)},Ae=G=>{var z=mt(),le=tt(z);{var Z=U=>{var $=s1();Ht(2),m(U,$)},q=U=>{var $=r1();Ht(2),m(U,$)};E(le,U=>{e(y)&&!e(b)?U(Z):U(q,!1)},!0)}m(G,z)};E(pe,G=>{e(f)?G(qe):G(Ae,!1)})}i(ze);var Ie=u(ze,2);Ie.__click=[e1,t,l,p,h,g,L,d,X,c,n];var ut=o(Ie);{var me=G=>{var z=i1();Ht(2),m(G,z)},J=G=>{var z=n1();Ht(2),m(G,z)};E(ut,G=>{e(p)?G(me):G(J,!1)})}i(Ie),i(Me),i(ne);var xe=u(ne,2),$e=o(xe);{var B=G=>{var z=o1();m(G,z)},te=G=>{var z=m1(),le=o(z),Z=o(le),q=o(Z);Dt(q,21,()=>e(j)[0]||[],Ua,($,I,H)=>{var fe=c1();let ve;fe.__click=Pe=>Re(H,Pe);var Fe=o(fe),Ce=o(Fe,!0);i(Fe);var Be=u(Fe,2);{var Ue=Pe=>{var Ve=l1();m(Pe,Ve)};E(Be,Pe=>{ce(H)&&Pe(Ue)})}i(fe),O((Pe,Ve)=>{ve=we(fe,1,"spreadsheet-header",null,ve,Pe),Mt(fe,"title",Ve),w(Ce,e(I))},[()=>({"spreadsheet-student-info":H<2,calculated:Ge(H),"final-grade":se(H)==="final-grade",clickable:ce(H)}),()=>ce(H)?"Click to set total scores":""]),m($,fe)}),i(q),i(Z);var U=u(Z);Dt(U,21,()=>e(j).slice(1),Ua,($,I,H)=>{var fe=p1();let ve;Dt(fe,21,()=>e(I),Ua,(Fe,Ce,Be)=>{var Ue=f1();let Pe;Ue.__click=vt=>ae(H+1,Be);var Ve=o(Ue);{var st=vt=>{var St=d1();ta(St),St.__keydown=At=>lt(At),Kd(St),Se("blur",St,()=>{Ke(),v(T,!1)}),ia(St,()=>e(C),At=>v(C,At)),m(vt,St)},nt=vt=>{var St=mt(),At=tt(St);{var Wt=It=>{var Gt=u1(),Ot=o(Gt,!0);i(Gt),O(()=>w(Ot,e(Ce))),m(It,Gt)},Nt=It=>{var Gt=v1(),Ot=o(Gt,!0);i(Gt),O(()=>w(Ot,e(Ce))),m(It,Gt)};E(At,It=>{e(T)&&e(D)?.row===H+1&&e(D)?.col===Be&&l()[H]?.isVerified?It(Wt):It(Nt,!1)},!0)}m(vt,St)};E(Ve,vt=>{e(T)&&e(D)?.row===H+1&&e(D)?.col===Be&&!l()[H]?.isVerified?vt(st):vt(nt,!1)})}i(Ue),O(vt=>Pe=we(Ue,1,"spreadsheet-cell",null,Pe,vt),[()=>({selected:e(D)?.row===H+1&&e(D)?.col===Be,editing:e(T)&&e(D)?.row===H+1&&e(D)?.col===Be,"spreadsheet-student-info":Be<2,calculated:Ge(Be),"final-grade":se(Be)==="final-grade",editable:!Ge(Be)&&Be>1,invalid:e(F).has(`${H+1}-${Be}`)})]),m(Fe,Ue)}),i(fe),O(Fe=>ve=we(fe,1,"spreadsheet-row",null,ve,Fe),[()=>({verified:l()[H]?.isVerified})]),m($,fe)}),i(U),i(le),i(z),Hs(z,$=>A=$,()=>A),m(G,z)};E($e,G=>{e(S)?G(B):G(te,!1)})}i(xe),Hs(xe,G=>A=G,()=>A),O(G=>{Ee=we(ze,1,"save-grades-button",null,Ee,G),ze.disabled=e(f)||e(y)&&!e(b),Mt(ze,"title",e(y)&&!e(b)?"All grades are saved":"Save all grades to database"),Ie.disabled=e(p)},[()=>({saved:e(y)&&!e(b)})]),m(s,Ne);var ue=za({saveGrades:He});return r(),ue}Ps(["click","keydown"]);function _1(s,t){v(t,!e(t))}var b1=(s,t)=>t.onBackToClassManagement&&t.onBackToClassManagement(),y1=_('<button><span class="material-symbols-outlined">book</span> </button>'),w1=_('<div class="subject-tab-navigation"></div>'),x1=_('<div class="classlist-quarter-selected-option"><span class="material-symbols-outlined classlist-quarter-option-icon"> </span> <div class="classlist-quarter-option-content"><span class="classlist-quarter-option-name"> </span></div></div>'),S1=_('<span class="classlist-quarter-placeholder">Select quarter</span>'),k1=(s,t,a)=>t(e(a)),A1=_('<button type="button"><span class="material-symbols-outlined classlist-quarter-option-icon"> </span> <div class="classlist-quarter-option-content"><span class="classlist-quarter-option-name"> </span></div></button>'),D1=(s,t)=>t("writtenWork"),C1=(s,t)=>t("performanceTasks"),T1=(s,t)=>t("quarterlyAssessment"),E1=_('<div class="loading-container"><div class="system-loader"></div> <p>Loading class data...</p></div>'),F1=_('<div class="error-container"><div class="error-icon"><span class="material-symbols-outlined">error</span></div> <p class="error-message"> </p> <button class="retry-button"><span class="material-symbols-outlined">refresh</span> Retry</button></div>'),N1=_(`<div class="empty-state"><div class="empty-icon"><span class="material-symbols-outlined">school</span></div> <h3>No Students Found</h3> <p>This section doesn't have any enrolled students yet.</p></div>`),$1=_('<div class="class-management-container"><div class="classlist-page-header"><div class="header-content"><div class="header-navigation"><button class="back-button"><span class="material-symbols-outlined">arrow_back</span> <span>Back to Class Management</span></button></div> <h1 class="classlist-page-title">Class Grading Sheet</h1> <p class="classlist-page-subtitle"> </p></div> <!></div> <div class="grading-config-section"><div class="config-header"><h2 class="config-title">Grading Configuration</h2> <div class="classlist-quarter-selector-container"><div><button type="button" id="classlist-quarter-select"><!> <span class="material-symbols-outlined classlist-quarter-dropdown-arrow">expand_more</span></button> <div class="classlist-quarter-dropdown-menu"></div></div></div></div> <div class="config-grid"><div class="config-item"><div class="config-label"> </div> <div class="classlist-column-controls"><div class="classlist-column-count"><span class="classlist-column-text"><!></span></div> <div class="classlist-action-buttons"><button type="button" class="classlist-add-column-button"><span class="material-symbols-outlined">add</span></button></div></div></div> <div class="config-item"><div class="config-label"> </div> <div class="classlist-column-controls"><div class="classlist-column-count"><span class="classlist-column-text"><!></span></div> <div class="classlist-action-buttons"><button type="button" class="classlist-add-column-button"><span class="material-symbols-outlined">add</span></button></div></div></div> <div class="config-item"><div class="config-label"> </div> <div class="classlist-column-controls"><div class="classlist-column-count"><span class="classlist-column-text"><!></span></div> <div class="classlist-action-buttons"><button type="button" class="classlist-add-column-button"><span class="material-symbols-outlined">add</span></button></div></div></div></div> <!></div></div> <!>',1);function L1(s,t){qa(t,!0);const[a,r]=xs(),n=()=>Ja(gs,"$authStore",a);let l=pt(!0),c=pt(null),d=pt(!1),f=pt(!1),p=pt(null),h=pt(1),g=pt("1st Quarter"),b=pt("2025-2026"),y=pt(!1),k=pt(0),A=pt(null),D=aa(()=>e(p)?.subjects?.[e(k)]||null);const T=[{id:1,name:"1st Quarter",icon:"looks_one"},{id:2,name:"2nd Quarter",icon:"looks_two"},{id:3,name:"3rd Quarter",icon:"looks_3"},{id:4,name:"4th Quarter",icon:"looks_4"}],C=aa(()=>T.find(ye=>ye.id===e(h)));async function S(ye){if(!(!e(p)?.subjects||ye<0||ye>=e(p).subjects.length)){if(e(A)&&typeof e(A).saveGrades=="function")try{await e(A).saveGrades()}catch{}v(k,ye,!0),v(L,{writtenWork:{count:0,weight:.3,label:"Written Work",totals:[],columnNames:[],columnPositions:[],gradeItemIds:[]},performanceTasks:{count:0,weight:.5,label:"Performance Tasks",totals:[],columnNames:[],columnPositions:[],gradeItemIds:[]},quarterlyAssessment:{count:0,weight:.2,label:"Quarterly Assessment",totals:[],columnNames:[],columnPositions:[],gradeItemIds:[]}},!0),setTimeout(async()=>{try{await Y(),await N()}catch(Xe){console.error("Error fetching data for subject:",Xe)}},0)}}let M=aa(()=>e(p)?{yearLevel:e(p).section.grade_level,sectionName:e(p).section.section_name,gradeName:`Grade ${e(p).section.grade_level}`,subject:e(D)?.name||"No Subject",section:`Grade ${e(p).section.grade_level} - ${e(p).section.section_name}`,quarter:e(g),totalStudents:e(p).students?.length||0,adviser:`${e(p).section.adviser_first_name||""} ${e(p).section.adviser_last_name||""}`.trim()||"No Adviser",room:e(p).section.room_name||"No Room"}:t.selectedClass?{yearLevel:t.selectedClass.yearLevel,sectionName:t.selectedClass.sectionName,gradeName:`Grade ${t.selectedClass.yearLevel}`,subject:"Loading...",section:`Grade ${t.selectedClass.yearLevel} - ${t.selectedClass.sectionName}`,quarter:e(g),totalStudents:0}:{yearLevel:7,sectionName:"Section A",gradeName:"Grade 7",subject:"Mathematics",section:"Grade 7 - Section A",quarter:e(g),totalStudents:0}),F=pt(Xs([]));async function j(){try{const Xe=await(await fetch("/api/current-quarter")).json();Xe.success&&Xe.data?(v(h,Xe.data.currentQuarter,!0),v(g,Xe.data.quarterName,!0),v(b,Xe.data.currentSchoolYear||"2025-2026",!0),console.log(`Current quarter set to: ${e(g)} (Quarter ${e(h)})`),console.log(`Current school year set to: ${e(b)}`)):(v(h,1),v(g,"1st Quarter"),v(b,"2025-2026"),console.warn("Failed to fetch current quarter, defaulting to 1st Quarter and 2025-2026"))}catch(ye){console.error("Error fetching current quarter:",ye),v(h,1),v(g,"1st Quarter"),v(b,"2025-2026")}}async function P(ye){ye.id!==e(h)?(v(h,ye.id,!0),v(g,ye.name,!0),v(y,!1),await Y(),await N()):v(y,!1)}async function Y(){if(!(!t.selectedClass||!e(D)))try{const ye={id:n().userData.id,name:n().userData.name,account_number:n().userData.accountNumber,account_type:n().userData.account_type||n().userData.accountType},Xe=await fetch(`/api/grades/grade-items?section_id=${t.selectedClass.sectionId}&subject_id=${e(D).id}&grading_period_id=${e(h)}&teacher_id=${n().userData.id}`,{method:"GET",headers:{"Content-Type":"application/json","x-user-info":JSON.stringify(ye)}});if(!Xe.ok)throw new Error(`HTTP error! status: ${Xe.status}`);const be=(await Xe.json()).data||{},je={writtenWork:{count:be.writtenWork?.length||0,weight:.3,label:"Written Work",totals:be.writtenWork?.map(rt=>rt.totalScore)||[],columnNames:be.writtenWork?.map(rt=>rt.name)||[],columnPositions:be.writtenWork?.map((rt,Ft)=>Ft+1)||[],gradeItemIds:be.writtenWork?.map(rt=>rt.id)||[]},performanceTasks:{count:be.performanceTasks?.length||0,weight:.5,label:"Performance Tasks",totals:be.performanceTasks?.map(rt=>rt.totalScore)||[],columnNames:be.performanceTasks?.map(rt=>rt.name)||[],columnPositions:be.performanceTasks?.map((rt,Ft)=>Ft+1)||[],gradeItemIds:be.performanceTasks?.map(rt=>rt.id)||[]},quarterlyAssessment:{count:be.quarterlyAssessment?.length||0,weight:.2,label:"Quarterly Assessment",totals:be.quarterlyAssessment?.map(rt=>rt.totalScore)||[],columnNames:be.quarterlyAssessment?.map(rt=>rt.name)||[],columnPositions:be.quarterlyAssessment?.map((rt,Ft)=>Ft+1)||[],gradeItemIds:be.quarterlyAssessment?.map(rt=>rt.id)||[]}};v(L,je,!0)}catch(ye){console.error("Error fetching grading configuration:",ye),se("Failed to load grading configuration","error")}}async function W(){if(!e(d))try{if(v(c,null),!t.selectedClass?.sectionId)throw new Error("No section selected");const ye=n(),Xe=ye.isAuthenticated?ye.userData?.id:null,ot=new URLSearchParams({sectionId:t.selectedClass.sectionId.toString()});Xe&&ot.append("teacherId",Xe.toString());const je=await(await fetch(`/api/class-students?${ot}`)).json();if(!je.success)throw new Error(je.error||"Failed to fetch section data");v(p,je.data,!0)}catch(ye){console.error("Error fetching section data:",ye),v(c,ye.message,!0)}}async function N(){if(!e(d))try{if(v(l,!0),v(c,null),!t.selectedClass?.sectionId)throw new Error("No section selected");if(!e(D)?.id)return;const ye=n(),Xe=ye.isAuthenticated?ye.userData?.id:null,ot=new URLSearchParams({sectionId:t.selectedClass.sectionId.toString(),schoolYear:e(b)});Xe&&ot.append("teacherId",Xe.toString()),e(D)?.id&&ot.append("subjectId",e(D).id.toString()),e(h)&&ot.append("gradingPeriodId",e(h).toString());const je=await(await fetch(`/api/class-students?${ot}`)).json();if(!je.success)throw new Error(je.error||"Failed to fetch class students");v(p,je.data,!0),v(F,je.data.students.map(rt=>({...rt,writtenWork:rt.grades?.written_work||[],performanceTasks:rt.grades?.performance_tasks||[],quarterlyAssessment:rt.grades?.quarterly_assessment||[],grades:rt.grades,id:rt.account_number||rt.id,name:rt.full_name||`${rt.first_name} ${rt.last_name}`,isVerified:rt.grades?.verified||rt.grades?.verification?.verified||!1})),!0)}catch(ye){console.error("Error fetching class students:",ye),v(c,ye.message,!0),v(p,null),v(F,[],!0)}finally{v(l,!1)}}let L=pt(Xs({writtenWork:{count:0,weight:.3,label:"Written Work",totals:[],columnNames:[],columnPositions:[],gradeItemIds:[]},performanceTasks:{count:0,weight:.5,label:"Performance Tasks",totals:[],columnNames:[],columnPositions:[],gradeItemIds:[]},quarterlyAssessment:{count:0,weight:.2,label:"Quarterly Assessment",totals:[],columnNames:[],columnPositions:[],gradeItemIds:[]}})),X=pt(""),ae=pt("error"),V=pt(!1);function ie(ye){ye.target.closest(".classlist-quarter-dropdown")||v(y,!1)}function he(){return e(F).some(ye=>ye.isVerified||ye.verified)}async function Ge(ye){if(e(L)[ye].count<10&&!e(f)&&!e(d))try{if(v(f,!0),!{writtenWork:1,performanceTasks:2,quarterlyAssessment:3}[ye]){console.error("Invalid category:",ye);return}if(!n().isAuthenticated||!n().userData?.id){console.error("User not authenticated");return}const be={writtenWork:"WW",performanceTasks:"PT",quarterlyAssessment:"QA"},je=e(L)[ye].count,rt=`${be[ye]} ${je+1}`,Ft={id:n().userData.id,name:n().userData.name,account_number:n().userData.accountNumber,account_type:n().userData.account_type||n().userData.accountType},Vt=await fetch("/api/grades/grade-items",{method:"POST",headers:{"Content-Type":"application/json","x-user-info":JSON.stringify(Ft)},body:JSON.stringify({action:"create_grade_item",section_id:t.selectedClass?.sectionId||e(p)?.section?.id,subject_id:e(D)?.id||t.selectedClass?.subjectId||e(p)?.subjects?.[0]?.id,grading_period_id:e(h),teacher_id:n().userData.id,category:ye,name:rt,total_score:100})});if(!Vt.ok){const gt=await Vt.json();console.error("Failed to add grade item:",gt.error);return}const at=await Vt.json();if(e(L)[ye].count+=1,e(L)[ye].gradeItemIds||(e(L)[ye].gradeItemIds=[]),e(L)[ye].gradeItemIds.push(at.data.id),e(L)[ye].columnNames||(e(L)[ye].columnNames=[]),e(L)[ye].columnNames.push(at.data.name),!e(L)[ye].columnPositions){e(L)[ye].columnPositions=[];for(let gt=0;gt<e(L)[ye].count-1;gt++)e(L)[ye].columnPositions[gt]=gt+1}const va=e(L)[ye].columnPositions||[];let Ca=1;for(;va.includes(Ca);)Ca++;e(L)[ye].columnPositions.push(Ca),ce()}catch(Xe){console.error("Error adding column:",Xe)}finally{v(f,!1)}}function ce(){v(F,e(F).map(ye=>ye&&{...ye,writtenWork:Array(e(L).writtenWork.count).fill(0).map((ot,be)=>ye.writtenWork?.[be]||0),performanceTasks:Array(e(L).performanceTasks.count).fill(0).map((ot,be)=>ye.performanceTasks?.[be]||0),quarterlyAssessment:Array(e(L).quarterlyAssessment.count).fill(0).map((ot,be)=>ye.quarterlyAssessment?.[be]||0)}),!0)}function se(ye,Xe="error"){v(V,!1),setTimeout(()=>{v(X,ye,!0),v(ae,Xe,!0),v(V,!0)},50)}Ya(async()=>{e(d)||(await j(),await W(),await new Promise(ye=>setTimeout(ye,0)),e(p)?.subjects&&e(p).subjects.length>0?(e(k)>=e(p).subjects.length&&v(k,0),await N(),await Y()):(v(c,"No subjects found for this section"),v(l,!1)))}),ti(()=>{v(d,!0),v(l,!1)});var Re=$1();Se("click",Zs,ie);var Je=tt(Re),it=o(Je),Le=o(it),ke=o(Le),Ke=o(ke);Ke.__click=[b1,t],i(ke);var lt=u(ke,4),He=o(lt);i(lt),i(Le);var et=u(Le,2);{var Ne=ye=>{var Xe=w1();Dt(Xe,21,()=>e(p).subjects,Ua,(ot,be,je)=>{var rt=y1();let Ft;rt.__click=()=>S(je);var Vt=u(o(rt));i(rt),O(at=>{Ft=we(rt,1,"subject-tab-button",null,Ft,at),w(Vt,` ${e(be).name??""}`)},[()=>({active:e(k)===je})]),m(ot,rt)}),i(Xe),m(ye,Xe)};E(et,ye=>{e(p)?.subjects&&e(p).subjects.length>1&&ye(Ne)})}i(it);var ne=u(it,2),oe=o(ne),_e=u(o(oe),2),Me=o(_e);let ze;var Ee=o(Me);let pe;Ee.__click=[_1,y];var qe=o(Ee);{var Ae=ye=>{var Xe=x1(),ot=o(Xe),be=o(ot,!0);i(ot);var je=u(ot,2),rt=o(je),Ft=o(rt,!0);i(rt),i(je),i(Xe),O(()=>{w(be,e(C).icon),w(Ft,e(C).name)}),m(ye,Xe)},Ie=ye=>{var Xe=S1();m(ye,Xe)};E(qe,ye=>{e(C)?ye(Ae):ye(Ie,!1)})}Ht(2),i(Ee);var ut=u(Ee,2);Dt(ut,21,()=>T,ye=>ye.id,(ye,Xe)=>{var ot=A1();let be;ot.__click=[k1,P,Xe];var je=o(ot),rt=o(je,!0);i(je);var Ft=u(je,2),Vt=o(Ft),at=o(Vt,!0);i(Vt),i(Ft),i(ot),O(va=>{be=we(ot,1,"classlist-quarter-dropdown-option",null,be,va),w(rt,e(Xe).icon),w(at,e(Xe).name)},[()=>({selected:e(h)===e(Xe).id})]),m(ye,ot)}),i(ut),i(Me),i(_e),i(oe);var me=u(oe,2),J=o(me),xe=o(J),$e=o(xe);i(xe);var B=u(xe,2),te=o(B),ue=o(te),G=o(ue);{var z=ye=>{var Xe=ba("Loading...");m(ye,Xe)},le=ye=>{var Xe=ba();O(()=>w(Xe,`${e(L).writtenWork.count??""} Column${e(L).writtenWork.count!==1?"s":""}`)),m(ye,Xe)};E(G,ye=>{e(l)?ye(z):ye(le,!1)})}i(ue),i(te);var Z=u(te,2),q=o(Z);q.__click=[D1,Ge],i(Z),i(B),i(J);var U=u(J,2),$=o(U),I=o($);i($);var H=u($,2),fe=o(H),ve=o(fe),Fe=o(ve);{var Ce=ye=>{var Xe=ba("Loading...");m(ye,Xe)},Be=ye=>{var Xe=ba();O(()=>w(Xe,`${e(L).performanceTasks.count??""} Column${e(L).performanceTasks.count!==1?"s":""}`)),m(ye,Xe)};E(Fe,ye=>{e(l)?ye(Ce):ye(Be,!1)})}i(ve),i(fe);var Ue=u(fe,2),Pe=o(Ue);Pe.__click=[C1,Ge],i(Ue),i(H),i(U);var Ve=u(U,2),st=o(Ve),nt=o(st);i(st);var vt=u(st,2),St=o(vt),At=o(St),Wt=o(At);{var Nt=ye=>{var Xe=ba("Loading...");m(ye,Xe)},It=ye=>{var Xe=ba();O(()=>w(Xe,`${e(L).quarterlyAssessment.count??""} Column${e(L).quarterlyAssessment.count!==1?"s":""}`)),m(ye,Xe)};E(Wt,ye=>{e(l)?ye(Nt):ye(It,!1)})}i(At),i(St);var Gt=u(St,2),Ot=o(Gt);Ot.__click=[T1,Ge],i(Gt),i(vt),i(Ve),i(me);var sa=u(me,2);{var Qt=ye=>{var Xe=E1();m(ye,Xe)},Pt=ye=>{var Xe=mt(),ot=tt(Xe);{var be=rt=>{var Ft=F1(),Vt=u(o(Ft),2),at=o(Vt);i(Vt);var va=u(Vt,2);va.__click=N,i(Ft),O(()=>w(at,`Error: ${e(c)??""}`)),m(rt,Ft)},je=rt=>{var Ft=mt(),Vt=tt(Ft);{var at=Ca=>{var gt=N1();m(Ca,gt)},va=Ca=>{{let gt=aa(()=>t.selectedClass?.sectionId),_t=aa(()=>e(D)?.id);Hs(g1(Ca,{get sectionId(){return e(gt)},get subjectId(){return e(_t)},get gradingPeriodId(){return e(h)},get students(){return e(F)},set students(de){v(F,de,!0)},get gradingConfig(){return e(L)},set gradingConfig(de){v(L,de,!0)}}),de=>v(A,de,!0),()=>e(A))}};E(Vt,Ca=>{e(F).length===0?Ca(at):Ca(va,!1)},!0)}m(rt,Ft)};E(ot,rt=>{e(c)?rt(be):rt(je,!1)},!0)}m(ye,Xe)};E(sa,ye=>{e(l)?ye(Qt):ye(Pt,!1)})}i(ne),i(Je);var Yt=u(Je,2);{var ca=ye=>{ru(ye,{get message(){return e(X)},get type(){return e(ae)},onClose:()=>v(V,!1)})};E(Yt,ye=>{e(V)&&ye(ca)})}O((ye,Xe,ot,be,je,rt,Ft,Vt,at,va,Ca)=>{w(He,`${e(M).section??""}  ${e(M).subject??""}  ${e(M).quarter??""}`),ze=we(Me,1,"classlist-quarter-dropdown",null,ze,ye),pe=we(Ee,1,"classlist-quarter-select-button",null,pe,Xe),w($e,`Written Work (${ot??""}%)`),q.disabled=be,Mt(q,"title",je),w(I,`Performance Tasks (${rt??""}%)`),Pe.disabled=Ft,Mt(Pe,"title",Vt),w(nt,`Quarterly Assessment (${at??""}%)`),Ot.disabled=va,Mt(Ot,"title",Ca)},[()=>({open:e(y)}),()=>({selected:e(h)}),()=>Math.round(e(L).writtenWork.weight*100),()=>e(L).writtenWork.count>=10||e(f)||he(),()=>he()?"Cannot add columns when grades are verified":"Add Column",()=>Math.round(e(L).performanceTasks.weight*100),()=>e(L).performanceTasks.count>=10||e(f)||he(),()=>he()?"Cannot add columns when grades are verified":"Add Column",()=>Math.round(e(L).quarterlyAssessment.weight*100),()=>e(L).quarterlyAssessment.count>=10||e(f)||he(),()=>he()?"Cannot add columns when grades are verified":"Add Column"]),m(s,Re),za(),r()}Ps(["click"]);async function P1(s,t,a,r,n){const l=e(t).filter(c=>c.finalGrades?.some(d=>d.finalGrade===null||d.finalGrade==="N/A"||d.finalGrade===""));if(l.length>0){const c=l.map(d=>d.full_name).join(", ");Te.error(`Cannot verify all grades - the following students have N/A grades: ${c}`);return}cs.confirm("Verify All Students","Are you sure you want to verify all grades for all students in this class?",async()=>{try{const c=await la.post("/api/teacher-advisory",{action:"verify_all_grades",section_id:e(a).section_id,teacher_id:r().userData.id,quarter:e(n),verified:!0});c.success?(v(t,e(t).map(d=>({...d,gradesVerified:!0,finalGrades:d.finalGrades?.map(f=>({...f,verified:!0}))||[],grades:d.grades.map(f=>({...f,verified:!0}))})),!0),Te.success("All student grades verified successfully")):(console.error("Failed to verify all students:",c.error),Te.error(c.error||"Failed to verify all students. Please try again."))}catch(c){console.error("Error verifying all students:",c),Te.error("Failed to verify all students. Please try again.")}},()=>{})}function M1(s,t){v(t,!e(t))}var I1=_('<div class="quarter-selected-option"><span class="material-symbols-outlined quarter-option-icon"> </span> <div class="quarter-option-content"><span class="quarter-option-name"> </span></div></div>'),R1=_('<span class="quarter-placeholder">Select quarter</span>'),O1=(s,t,a)=>t(e(a)),j1=_('<button type="button"><span class="material-symbols-outlined quarter-option-icon"> </span> <div class="quarter-option-content"><span class="quarter-option-name"> </span></div></button>'),q1=_('<span class="stat-suffix"> </span>'),z1=_('<div><div class="stat-card-header"><p class="advisory-stat-label"> </p> <div class="advisory-stat-icon"><span class="material-symbols-outlined"> </span></div></div> <div class="stat-card-content"><h3 class="advisory-stat-value"><!> <!></h3></div></div>'),G1=_('<div class="students-loading"><div class="dashboard-loader"></div> <p>Loading students and grades...</p></div>'),V1=_('<div class="students-error"><span class="material-symbols-outlined error-icon">error</span> <p> </p></div>'),B1=_('<div class="students-empty"><span class="material-symbols-outlined">school</span> <p>No students found in this advisory class</p></div>'),W1=(s,t,a)=>t(e(a)),H1=(s,t,a)=>{s.stopPropagation(),t(e(a).id)},U1=(s,t,a)=>!e(t)?.verified&&a(e(t).id),Y1=_('<div class="loading-spinner"></div> <div class="overlay-text">Processing...</div>',1),Q1=_('<span class="material-symbols-outlined">verified</span> <div class="overlay-text">Verify</div>',1),K1=_('<small class="submitted-date"> </small>'),J1=_('<small class="submitted-date not-submitted">Grades not submitted yet</small>'),X1=_('<div class="grade-score-display"> </div>'),Z1=_('<div class="grade-score-display" style="color: #666;">N/A</div>'),e2=_('<button><div class="grade-overlay"><div class="overlay-content"><!></div></div> <div class="grade-item-header"><div class="grade-info"><div class="subject-name"> </div> <div class="subject-teacher"> </div> <!></div> <div class="grade-controls"><!></div></div></button>'),t2=_('<div class="student-grades"><div class="grades-header"><h4 class="grades-title"> </h4> <div class="student-verification-controls"><button class="verify-btn"><span class="material-symbols-outlined">verified</span> Verify All</button></div></div> <div class="grades-grid"></div></div>'),a2=_('<div><button class="student-header"><div class="student-header-content"><div class="student-title-section"><h3 class="student-title"> </h3></div> <div class="student-info-row"><div class="student-info-item"><span class="material-symbols-outlined">person</span> <span> </span></div> <div class="student-info-item"><span class="material-symbols-outlined"> </span> <span> </span></div> <div class="student-info-item"><span class="material-symbols-outlined">assignment</span> <span> </span></div></div></div> <div class="student-average"><div class="average-score"> </div></div> <div class="expand-icon"><span class="material-symbols-outlined"> </span></div></button> <!></div>'),s2=_('<div class="advisory-class-container"><div class="advisory-page-header fade-in"><div class="header-content"><h1 class="advisory-page-title">Advisory Class Dashboard</h1> <div class="header-controls"><div class="advisory-class-info"><div class="class-detail"><span class="material-symbols-outlined">school</span> <span> </span></div> <div class="class-detail"><span class="material-symbols-outlined">meeting_room</span> <span> </span></div></div> <div class="quarter-selector-container"><div><button type="button" id="quarter-select"><!> <span class="material-symbols-outlined quarter-dropdown-arrow">expand_more</span></button> <div class="quarter-dropdown-menu"></div></div></div></div></div></div> <div class="advisory-stats-section"><div class="advisory-stats-grid"></div></div> <div class="students-section"><div class="section-header"><button class="refresh-btn"><span class="material-symbols-outlined">refresh</span> Refresh</button> <div class="bulk-controls"><button class="verify-all-btn"><span class="material-symbols-outlined">verified</span> Verify All Grades</button></div></div> <div class="advisory-students-grid"><!></div></div></div>');function r2(s,t){qa(t,!0);const[a,r]=xs(),n=()=>Ja(gs,"$authStore",a);function l(B){if(!B)return null;const te=new Date(B),ue=String(te.getMonth()+1).padStart(2,"0"),G=String(te.getDate()).padStart(2,"0"),z=te.getFullYear();return`${ue}-${G}-${z}`}let c=pt(!0),d=pt(null),f=pt(Xs({averageGrade:null})),p=pt(Xs([])),h=pt(Xs(new Set)),g=pt(2),b=pt("2nd Quarter");async function y(){try{v(c,!0),v(d,null);const B=await la.get(`/api/teacher-advisory?teacher_id=${n().userData.id}&quarter=${e(g)}`);B.success?(v(f,{...e(f),...B.data.advisoryData},!0),B.data.students&&v(p,B.data.students.map(te=>({id:te.id.toString(),name:te.name,full_name:te.name,studentNumber:te.student_number,gradeLevel:te.grade_level,gradesVerified:te.grades_verified,finalGrades:te.subjects.map(ue=>({id:`${te.id}_${ue.subject_id}`,subjectName:ue.subject_name,subjectCode:ue.subject_code,teacherName:ue.teacher_name,finalGrade:ue.averages.final_grade,verified:ue.verified,verifiedAt:ue.verified_at,submittedToAdviser:ue.submitted_to_adviser})),grades:te.subjects.map(ue=>({subject:ue.subject_name,teacher:ue.teacher_name,grade:ue.averages.final_grade,quarter:e(b),verified:ue.verified,submittedDate:ue.submitted_at?l(ue.submitted_at):null,submittedToAdviser:ue.submitted_to_adviser,gradeItems:[]}))})),!0)):v(d,B.error||"Failed to fetch advisory data",!0)}catch(B){console.error("Error fetching advisory data:",B),v(d,"Failed to load advisory data. Please try again.")}finally{v(c,!1)}}async function k(){try{const te=await(await fetch("/api/current-quarter")).json();te.success&&te.data?(v(g,te.data.currentQuarter,!0),v(b,te.data.quarterName,!0),console.log(`Current quarter set to: ${e(b)} (Quarter ${e(g)})`)):(v(g,1),v(b,"1st Quarter"),console.warn("Failed to fetch current quarter, defaulting to 1st Quarter"))}catch(B){console.error("Error fetching current quarter:",B),v(g,1),v(b,"1st Quarter")}}Ya(async()=>{n().userData?.id&&(await k(),await y())});const A=aa(()=>e(p).map(B=>{if(!B.finalGrades||B.finalGrades.length===0)return{...B,average:0,verifiedGradesCount:0,pendingGradesCount:B.grades?.length||0};const ue=B.finalGrades.reduce((z,le)=>z+(le.finalGrade||0),0)/B.finalGrades.length,G=B.finalGrades?.filter(z=>z.verified)||[];return{...B,average:Math.round(ue*10)/10,verifiedGradesCount:G.length,pendingGradesCount:(B.finalGrades?.length||0)-G.length}}));Es(()=>{if(e(f)&&e(A).length>0){const B=e(A).map(te=>te.average).filter(te=>te!==null&&te>0);B.length>0?e(f).averageGrade=Math.round(B.reduce((te,ue)=>te+ue,0)/B.length*10)/10:e(f).averageGrade=null}else e(f)&&(e(f).averageGrade=null)});async function D(B){if(!B||e(h).has(B))return;const[te,ue]=B.split("_"),G=e(p).find(q=>q.id===te),z=G?.finalGrades?.find(q=>q.id===B),le=z?.subjectName||"Unknown Subject",Z=G?.full_name||"Unknown Student";if(z?.finalGrade===null||z?.finalGrade==="N/A"||z?.finalGrade===""){Te.error(`Cannot verify ${le} grade for ${Z} - grade is N/A`);return}cs.confirm("Verify Grade",`Are you sure you want to verify the ${le} grade for ${Z}?`,async()=>{e(h).add(B),v(h,new Set(e(h)),!0);try{const q=await la.post("/api/teacher-advisory",{action:"verify_student_grades",student_id:te,section_id:e(f).section_id,teacher_id:n().userData.id,quarter:e(g),verified:!0});q.success?(v(p,e(p).map(U=>{const $={...U,finalGrades:U.finalGrades?.map(H=>H.id===B?{...H,verified:!0}:H)||[]},I=$.finalGrades?.every(H=>H.verified)||!1;return $.gradesVerified=I,$}),!0),Te.success(`${le} grade verified for ${Z}`),e(h).delete(B),v(h,new Set(e(h)),!0)):(console.error("Failed to verify grade:",q.error),Te.error(q.error||"Failed to verify grade. Please try again."),e(h).delete(B),v(h,new Set(e(h)),!0))}catch(q){console.error("Error verifying grade:",q),Te.error("Failed to verify grade. Please try again."),e(h).delete(B),v(h,new Set(e(h)),!0)}},()=>{})}async function T(B){const te=e(p).find(z=>z.id===B),ue=te?.full_name||"Unknown Student";if(te?.finalGrades?.some(z=>z.finalGrade===null||z.finalGrade==="N/A"||z.finalGrade==="")){Te.error(`Cannot verify all grades for ${ue} - some grades are N/A`);return}cs.confirm("Verify All Grades",`Are you sure you want to verify all grades for ${ue}?`,async()=>{try{const z=await la.post("/api/teacher-advisory",{action:"verify_student_grades",student_id:B,section_id:e(f).section_id,teacher_id:n().userData.id,quarter:e(g),verified:!0});z.success?(v(p,e(p).map(le=>le.id===B?{...le,gradesVerified:!0,finalGrades:le.finalGrades?.map(Z=>({...Z,verified:!0}))||[]}:le),!0),Te.success(`All grades verified for ${ue}`)):(console.error("Failed to verify student grades:",z.error),Te.error(z.error||"Failed to verify student grades. Please try again."))}catch(z){console.error("Error verifying student grades:",z),Te.error("Failed to verify student grades. Please try again.")}},()=>{})}const C=["border-blue","border-green","border-orange","border-purple"];function S(B){return C[B%C.length]}const M=aa(()=>()=>{const B=e(A).filter(G=>G.average>0);if(B.length===0)return 0;const te=B.filter(G=>G.average>=75).length;return Math.round(te/B.length*100)});let F=[{id:"students",label:"Total Students",getValue:()=>e(f)?.totalStudents||0,icon:"people",color:"var(--school-primary)",showAsNumber:!0},{id:"subjects",label:"Subjects Tracked",getValue:()=>e(f)?.subjectsCount||0,icon:"book",color:"var(--school-secondary)",showAsNumber:!0},{id:"average",label:"Class Average",getValue:()=>e(f)&&e(f).averageGrade!==null?e(f).averageGrade:0,icon:"grade",color:"var(--school-accent)",showAsNumber:!0},{id:"passRate",label:"Pass Rate",getValue:()=>e(M)(),icon:"trending_up",color:"var(--success)",showAsNumber:!0,suffix:"%"}],j=pt(null),P=pt(!1);function Y(B){v(j,e(j)?.id===B.id?null:B,!0)}function W(B){return B>=90?"var(--success)":B>=80?"var(--school-accent)":B>=75?"var(--warning)":"var(--error)"}const N=[{id:1,name:"1st Quarter",icon:"looks_one"},{id:2,name:"2nd Quarter",icon:"looks_two"},{id:3,name:"3rd Quarter",icon:"looks_3"},{id:4,name:"4th Quarter",icon:"looks_4"}];async function L(B){B.id!==e(g)?(v(g,B.id,!0),v(b,B.name,!0),v(P,!1),await y()):v(P,!1)}function X(B){B.target.closest(".quarter-dropdown")||v(P,!1)}const ae=aa(()=>N.find(B=>B.id===e(g)));var V=s2();Se("click",Zs,X);var ie=o(V),he=o(ie),Ge=u(o(he),2),ce=o(Ge),se=o(ce),Re=u(o(se),2),Je=o(Re,!0);i(Re),i(se);var it=u(se,2),Le=u(o(it),2),ke=o(Le,!0);i(Le),i(it),i(ce);var Ke=u(ce,2),lt=o(Ke);let He;var et=o(lt);let Ne;et.__click=[M1,P];var ne=o(et);{var oe=B=>{var te=I1(),ue=o(te),G=o(ue,!0);i(ue);var z=u(ue,2),le=o(z),Z=o(le,!0);i(le),i(z),i(te),O(()=>{w(G,e(ae).icon),w(Z,e(ae).name)}),m(B,te)},_e=B=>{var te=R1();m(B,te)};E(ne,B=>{e(ae)?B(oe):B(_e,!1)})}Ht(2),i(et);var Me=u(et,2);Dt(Me,21,()=>N,B=>B.id,(B,te)=>{var ue=j1();let G;ue.__click=[O1,L,te];var z=o(ue),le=o(z,!0);i(z);var Z=u(z,2),q=o(Z),U=o(q,!0);i(q),i(Z),i(ue),O($=>{G=we(ue,1,"quarter-dropdown-option",null,G,$),w(le,e(te).icon),w(U,e(te).name)},[()=>({selected:e(g)===e(te).id})]),m(B,ue)}),i(Me),i(lt),i(Ke),i(Ge),i(he),i(ie);var ze=u(ie,2),Ee=o(ze);Dt(Ee,23,()=>F,B=>B.id,(B,te,ue)=>{var G=z1(),z=o(G),le=o(z),Z=o(le,!0);i(le);var q=u(le,2),U=o(q),$=o(U,!0);i(U),i(q),i(z);var I=u(z,2),H=o(I),fe=o(H);Rs(fe,()=>e(te).getValue(),Ce=>{{let Be=aa(()=>e(te).getValue()),Ue=aa(()=>e(te).id==="average"?1:0);Kr(Ce,{get value(){return e(Be)},get decimals(){return e(Ue)},duration:2})}});var ve=u(fe,2);{var Fe=Ce=>{var Be=q1(),Ue=o(Be,!0);i(Be),O(()=>w(Ue,e(te).suffix)),m(Ce,Be)};E(ve,Ce=>{e(te).suffix&&Ce(Fe)})}i(H),i(I),i(G),O(Ce=>{we(G,1,`advisory-stat-card ${Ce??""} stagger-item`),Wa(G,`--stagger-index: ${e(ue)??""}`),w(Z,e(te).label),w($,e(te).icon)},[()=>S(e(ue))]),m(B,G)}),i(Ee),i(ze);var pe=u(ze,2),qe=o(pe),Ae=o(qe);Ae.__click=y;var Ie=u(Ae,2),ut=o(Ie);ut.__click=[P1,p,f,n,g],i(Ie),i(qe);var me=u(qe,2),J=o(me);{var xe=B=>{var te=G1();m(B,te)},$e=B=>{var te=mt(),ue=tt(te);{var G=le=>{var Z=V1(),q=u(o(Z),2),U=o(q);i(q),i(Z),O(()=>w(U,`Error loading students: ${e(d)??""}`)),m(le,Z)},z=le=>{var Z=mt(),q=tt(Z);{var U=I=>{var H=B1();m(I,H)},$=I=>{var H=mt(),fe=tt(H);Dt(fe,19,()=>e(A),ve=>ve.id,(ve,Fe,Ce)=>{var Be=a2();let Ue;var Pe=o(Be);Pe.__click=[W1,Y,Fe];var Ve=o(Pe),st=o(Ve),nt=o(st),vt=o(nt);i(nt),i(st);var St=u(st,2),At=o(St),Wt=u(o(At),2),Nt=o(Wt,!0);i(Wt),i(At);var It=u(At,2),Gt=o(It),Ot=o(Gt,!0);i(Gt);var sa=u(Gt,2),Qt=o(sa,!0);i(sa),i(It);var Pt=u(It,2),Yt=u(o(Pt),2),ca=o(Yt);i(Yt),i(Pt),i(St),i(Ve);var ye=u(Ve,2),Xe=o(ye),ot=o(Xe,!0);i(Xe),i(ye);var be=u(ye,2),je=o(be),rt=o(je,!0);i(je),i(be),i(Pe);var Ft=u(Pe,2);{var Vt=at=>{var va=t2(),Ca=o(va),gt=o(Ca),_t=o(gt);i(gt);var de=u(gt,2),ee=o(de);ee.__click=[H1,T,Fe],i(de),i(Ca);var Q=u(Ca,2);Dt(Q,23,()=>e(Fe).grades,Ye=>Ye.subject,(Ye,Qe,dt)=>{const yt=aa(()=>e(Fe).finalGrades?.find(De=>De.subjectName===e(Qe).subject));var zt=e2();let ga;zt.__click=[U1,yt,D];var bt=o(zt),Oe=o(bt),ft=o(Oe);{var $t=De=>{var Ze=Y1();Ht(2),m(De,Ze)},jt=De=>{var Ze=Q1();Ht(2),m(De,Ze)};E(ft,De=>{e(h).has(e(yt)?.id)?De($t):De(jt,!1)})}i(Oe),i(bt);var Kt=u(bt,2),oa=o(Kt),Jt=o(oa),Ta=o(Jt,!0);i(Jt);var Aa=u(Jt,2),ya=o(Aa);i(Aa);var ma=u(Aa,2);{var ha=De=>{var Ze=K1(),wt=o(Ze);i(Ze),O(()=>w(wt,`Submitted: ${e(Qe).submittedDate||"N/A"}`)),m(De,Ze)},Fa=De=>{var Ze=J1();m(De,Ze)};E(ma,De=>{e(yt)&&e(yt).submittedToAdviser&&e(yt).finalGrade!==null?De(ha):De(Fa,!1)})}i(oa);var La=u(oa,2),da=o(La);{var fa=De=>{var Ze=X1(),wt=o(Ze,!0);i(Ze),O((qt,Tt)=>{Wa(Ze,`color: ${qt??""}`),w(wt,Tt)},[()=>W(e(yt).finalGrade),()=>Math.round(e(yt).finalGrade*10)/10]),m(De,Ze)},K=De=>{var Ze=Z1();m(De,Ze)};E(da,De=>{e(yt)&&e(yt).submittedToAdviser&&e(yt).finalGrade!==null?De(fa):De(K,!1)})}i(La),i(Kt),i(zt),O((De,Ze)=>{ga=we(zt,1,`grade-item ${e(yt)?.verified?"verified":"unverified"} stagger-grade-item`,null,ga,De),zt.disabled=Ze,Wa(zt,`--stagger-index: ${e(dt)??""}`),w(Ta,e(Qe).subject),w(ya,`by ${e(Qe).teacher??""}`)},[()=>({loading:e(h).has(e(yt)?.id)}),()=>e(h).has(e(yt)?.id)||e(yt)?.verified]),m(Ye,zt)}),i(Q),i(va),O(()=>w(_t,`Subject Grades (${e(b)??""})`)),m(at,va)};E(Ft,at=>{e(j)?.id===e(Fe).id&&at(Vt)})}i(Be),O((at,va)=>{Ue=we(Be,1,`advisory-student-card ${e(Fe).gradesVerified?"verified":"pending"} stagger-item`,null,Ue,at),Wa(Be,`--stagger-index: ${e(Ce)??""}`),w(vt,`${e(Fe).name??""}  Grade ${e(Fe).gradeLevel||"7"}`),w(Nt,e(Fe).studentNumber),w(Ot,e(Fe).gradesVerified?"verified":"pending"),w(Qt,e(Fe).gradesVerified?"Verified":"Pending"),w(ca,`${e(Fe).verifiedGradesCount??""} Verified, ${e(Fe).pendingGradesCount??""} Pending`),Wa(Xe,`color: ${va??""}`),w(ot,e(Fe).average!==null?e(Fe).average:"N/A"),w(rt,e(j)?.id===e(Fe).id?"expand_less":"expand_more")},[()=>({selected:e(j)?.id===e(Fe).id}),()=>e(Fe).average!==null?W(e(Fe).average):"#666"]),m(ve,Be)}),m(I,H)};E(q,I=>{e(A).length===0?I(U):I($,!1)},!0)}m(le,Z)};E(ue,le=>{e(d)?le(G):le(z,!1)},!0)}m(B,te)};E(J,B=>{e(c)?B(xe):B($e,!1)})}i(me),i(pe),i(V),O((B,te)=>{w(Je,e(f)?.sectionName||"Loading..."),w(ke,e(f)?.roomName||"Loading..."),He=we(lt,1,"quarter-dropdown",null,He,B),Ne=we(et,1,"quarter-select-button",null,Ne,te)},[()=>({open:e(P)}),()=>({selected:e(g)})]),m(s,V),za(),r()}Ps(["click"]);function i2(s,t){v(t,!e(t))}function n2(s,t,a){v(t,!e(t)),a()}var o2=_('<img alt="Profile" class="avatar-image"/>'),l2=_('<div class="avatar-placeholder"> </div>'),c2=(s,t,a)=>{t(),a.onNavigateToSettings()},d2=async(s,t,a)=>{t(),await a.onlogout(),qr("Logged out successfully. See you next time!")},u2=_('<div class="user-dropdown-menu"><button class="dropdown-item"><span class="material-symbols-outlined">settings</span> Settings</button> <button class="dropdown-item"><span class="material-symbols-outlined">logout</span> Logout</button></div>'),v2=_('<nav class="admin-navbar"><div class="navbar-container"><div class="navbar-left"><button class="icon-button hamburger-menu" aria-label="Toggle navigation menu"><span class="material-symbols-outlined">menu</span></button> <div class="logo-section"><span class="material-symbols-outlined logo-icon">admin_panel_settings</span> <span class="app-title"> </span></div></div> <div class="navbar-right"><button class="icon-button dark-mode-toggle" aria-label="Toggle dark mode"><span class="material-symbols-outlined"> </span></button> <div class="user-profile-container"><button class="user-profile"><div class="user-info"><span class="user-name"> </span> <span class="user-id"> </span></div> <div class="user-avatar"><!></div></button> <!></div></div></div></nav>');function f2(s,t){qa(t,!0);let a=Ma(t,"adminName",3,"Admin User"),r=Ma(t,"firstName",3,"Admin"),n=Ma(t,"gender",3,"male"),l=Ma(t,"accountNumber",3,"ADM-2025-0001"),c=Ma(t,"profileImage",3,null);function d(Le){return Le==="female"?"Ms.":"Mr."}let f=aa(()=>`${d(n())} ${r()}`),p=pt(!0),h=pt(!1);function g(){v(h,!1)}function b(Le){e(h)&&!Le.target.closest(".user-profile-container")&&g()}Ya(()=>{const Le=localStorage.getItem("theme");return v(p,Le!=="light"),y(),document.addEventListener("click",b),()=>{document.removeEventListener("click",b)}});function y(){e(p)?(document.documentElement.setAttribute("data-theme","dark"),localStorage.setItem("theme","dark")):(document.documentElement.setAttribute("data-theme","light"),localStorage.setItem("theme","light"))}function k(Le){return Le.split(" ").map(ke=>ke.charAt(0)).join("").toUpperCase().slice(0,2)}var A=v2(),D=o(A),T=o(D),C=o(T);C.__click=function(...Le){t.onToggleNavRail?.apply(this,Le)};var S=u(C,2),M=u(o(S),2),F=o(M);i(M),i(S),i(T);var j=u(T,2),P=o(j);P.__click=[n2,p,y];var Y=o(P),W=o(Y,!0);i(Y),i(P);var N=u(P,2),L=o(N);L.__click=[i2,h];var X=o(L),ae=o(X),V=o(ae,!0);i(ae);var ie=u(ae,2),he=o(ie);i(ie),i(X);var Ge=u(X,2),ce=o(Ge);{var se=Le=>{var ke=o2();O(()=>Mt(ke,"src",c())),m(Le,ke)},Re=Le=>{var ke=l2(),Ke=o(ke,!0);i(ke),O(lt=>w(Ke,lt),[()=>k(r())]),m(Le,ke)};E(ce,Le=>{c()?Le(se):Le(Re,!1)})}i(Ge),i(L);var Je=u(L,2);{var it=Le=>{var ke=u2(),Ke=o(ke);Ke.__click=[c2,g,t];var lt=u(Ke,2);lt.__click=[d2,g,t],i(ke),m(Le,ke)};E(Je,Le=>{e(h)&&Le(it)})}i(N),i(j),i(D),i(A),O(()=>{w(F,`Welcome, ${e(f)??""}`),w(W,e(p)?"light_mode":"dark_mode"),w(V,a()),w(he,`Account: ${l()??""}`)}),m(s,A),za()}Ps(["click"]);var p2=(s,t,a)=>t(e(a).id),m2=(s,t,a)=>t(e(a).id),h2=_('<button><div class="admin-menu-rail-icon-container"><span class="material-symbols-outlined admin-menu-rail-icon"> </span></div> <span class="admin-menu-rail-label"> </span></button>'),g2=_('<div class="admin-menu-folder-contents"></div>'),_2=_('<button><div class="admin-menu-rail-icon-container"><span class="material-symbols-outlined admin-menu-rail-icon"> </span></div> <span class="admin-menu-rail-label"> </span></button> <!>',1),b2=(s,t,a)=>t(e(a).id),y2=_('<button><div class="admin-menu-rail-icon-container"><span class="material-symbols-outlined admin-menu-rail-icon"> </span></div> <span class="admin-menu-rail-label"> </span></button>'),w2=(s,t,a)=>t(e(a).id),x2=_('<button><div class="admin-menu-nav-icon-container"><span class="material-symbols-outlined admin-menu-nav-icon"> </span></div></button>'),S2=(s,t,a)=>t(e(a).id),k2=_('<button><div class="admin-menu-nav-icon-container"><span class="material-symbols-outlined admin-menu-nav-icon"> </span></div></button>'),A2=(s,t)=>t("management-folder"),D2=(s,t)=>s.key==="Enter"||s.key===" "?t("management-folder"):null,C2=s=>s.stopPropagation(),T2=s=>s.stopPropagation(),E2=(s,t)=>t("management-folder"),F2=(s,t,a,r)=>{t(e(a).id),r("management-folder")},N2=_('<button><span class="material-symbols-outlined"> </span> <span> </span></button>'),$2=_('<div class="admin-menu-mobile-folder-overlay" role="button" tabindex="0" aria-label="Close management folder"><div class="admin-menu-mobile-folder-content" role="dialog" aria-label="Management folder menu" tabindex="-1"><div class="admin-menu-mobile-folder-header"><h3>Management</h3> <button class="admin-menu-close-folder"><span class="material-symbols-outlined">close</span></button></div> <div class="admin-menu-mobile-folder-items"></div></div></div>'),L2=_('<nav aria-label="Admin portal navigation"><div class="admin-menu-rail-container"></div></nav> <nav class="admin-menu-bottom-navigation" aria-label="Admin portal navigation"><div class="admin-menu-nav-container"><!> <!></div></nav>',1);function P2(s,t){qa(t,!0);let a=Ma(t,"adminActiveSection",15,"dashboard"),r=Ma(t,"adminNavRailVisible",3,!0),n=pt(!1);const l=[{id:"dashboard",label:"Dashboard",icon:"dashboard",type:"item"},{id:"management-folder",label:"Management",icon:"folder",type:"folder",items:[{id:"schedule-management",label:"Schedule",icon:"schedule"},{id:"department-management",label:"Department",icon:"corporate_fare"},{id:"subjects-and-activities",label:"Subjects & Activities",icon:"school"}]},{id:"account-creation",label:"Account Creation",icon:"person_add",type:"item"},{id:"document-requests",label:"Document Requests",icon:"description",type:"item"},{id:"student-masterlist",label:"Student Masterlist",icon:"groups",type:"item"},{id:"teacher-masterlist",label:"Teacher Masterlist",icon:"school",type:"item"},{id:"student-grades-list",label:"Student Grades List",icon:"grade",type:"item"},{id:"archived-accounts",label:"Archived Accounts",icon:"archive",type:"item"}];function c(C){a(C),t.onnavigate&&t.onnavigate({detail:{section:C}})}function d(C){C==="management-folder"&&v(n,!e(n))}function f(C){return C.items?.some(S=>S.id===a())||!1}var p=L2(),h=tt(p);let g;var b=o(h);Dt(b,21,()=>l,C=>C.id,(C,S)=>{var M=mt(),F=tt(M);{var j=Y=>{var W=_2(),N=tt(W);let L;N.__click=[p2,d,S];var X=o(N),ae=o(X),V=o(ae,!0);i(ae),i(X);var ie=u(X,2),he=o(ie,!0);i(ie),i(N);var Ge=u(N,2);{var ce=se=>{var Re=g2();Dt(Re,21,()=>e(S).items,Je=>Je.id,(Je,it)=>{var Le=h2();let ke;Le.__click=[m2,c,it];var Ke=o(Le),lt=o(Ke),He=o(lt,!0);i(lt),i(Ke);var et=u(Ke,2),Ne=o(et,!0);i(et),i(Le),O(ne=>{ke=we(Le,1,"admin-menu-rail-item admin-menu-sub-item",null,ke,ne),Mt(Le,"aria-label",e(it).label),Mt(Le,"aria-current",e(it).id===a()?"page":void 0),w(He,e(it).icon),w(Ne,e(it).label)},[()=>({active:e(it).id===a()})]),m(Je,Le)}),i(Re),m(se,Re)};E(Ge,se=>{e(n)&&se(ce)})}O(se=>{L=we(N,1,"admin-menu-rail-item admin-menu-folder",null,L,se),Mt(N,"aria-label",e(S).label),Mt(N,"aria-expanded",e(n)),w(V,e(n)?"folder_open":"folder"),w(he,e(S).label)},[()=>({active:f(e(S)),expanded:e(n)})]),m(Y,W)},P=Y=>{var W=y2();let N;W.__click=[b2,c,S];var L=o(W),X=o(L),ae=o(X,!0);i(X),i(L);var V=u(L,2),ie=o(V,!0);i(V),i(W),O(he=>{N=we(W,1,"admin-menu-rail-item",null,N,he),Mt(W,"aria-label",e(S).label),Mt(W,"aria-current",e(S).id===a()?"page":void 0),w(ae,e(S).icon),w(ie,e(S).label)},[()=>({active:e(S).id===a()})]),m(Y,W)};E(F,Y=>{e(S).type==="folder"?Y(j):Y(P,!1)})}m(C,M)}),i(b),i(h);var y=u(h,2),k=o(y),A=o(k);Dt(A,17,()=>l,C=>C.id,(C,S)=>{var M=mt(),F=tt(M);{var j=Y=>{var W=x2();let N;W.__click=[w2,d,S];var L=o(W),X=o(L),ae=o(X,!0);i(X),i(L),i(W),O(V=>{N=we(W,1,"admin-menu-nav-item admin-menu-folder",null,N,V),Mt(W,"aria-label",e(S).label),Mt(W,"aria-expanded",e(n)),w(ae,e(n)?"folder_open":"folder")},[()=>({active:f(e(S))})]),m(Y,W)},P=Y=>{var W=k2();let N;W.__click=[S2,c,S];var L=o(W),X=o(L),ae=o(X,!0);i(X),i(L),i(W),O(V=>{N=we(W,1,"admin-menu-nav-item",null,N,V),Mt(W,"aria-label",e(S).label),Mt(W,"aria-current",e(S).id===a()?"page":void 0),w(ae,e(S).icon)},[()=>({active:e(S).id===a()})]),m(Y,W)};E(F,Y=>{e(S).type==="folder"?Y(j):Y(P,!1)})}m(C,M)});var D=u(A,2);{var T=C=>{var S=$2();S.__click=[A2,d],S.__keydown=[D2,d];var M=o(S);M.__click=[C2],M.__keydown=[T2];var F=o(M),j=u(o(F),2);j.__click=[E2,d],i(F);var P=u(F,2);Dt(P,21,()=>l.find(Y=>Y.id==="management-folder")?.items||[],Y=>Y.id,(Y,W)=>{var N=N2();let L;N.__click=[F2,c,W,d];var X=o(N),ae=o(X,!0);i(X);var V=u(X,2),ie=o(V,!0);i(V),i(N),O(he=>{L=we(N,1,"admin-menu-mobile-folder-item",null,L,he),w(ae,e(W).icon),w(ie,e(W).label)},[()=>({active:e(W).id===a()})]),m(Y,N)}),i(P),i(M),i(S),m(C,S)};E(D,C=>{e(n)&&C(T)})}i(k),i(y),O(C=>g=we(h,1,"admin-menu-navigation-rail",null,g,C),[()=>({collapsed:!r()})]),m(s,p),za()}Ps(["click","keydown"]);function M2(){const{subscribe:s,set:t,update:a}=Ws({data:[{id:"students",label:"Total Students",value:0,icon:"school",color:"blue"},{id:"teachers",label:"Total Teachers",value:0,icon:"person",color:"green"},{id:"sections",label:"Total Sections",value:0,icon:"class",color:"orange"},{id:"rooms",label:"Total Rooms",value:0,icon:"meeting_room",color:"purple"}],isLoading:!1,error:null,lastUpdated:null,isInitialized:!1,charts:{studentsPerGrade:{data:null,isLoading:!1,error:null,lastUpdated:null},sectionsPerGrade:{data:null,isLoading:!1,error:null,lastUpdated:null}}});return{subscribe:s,init:r=>{r&&a(n=>({...n,data:r,isInitialized:!0,isLoading:!1}))},setLoading:r=>{a(n=>({...n,isLoading:r&&!n.isInitialized}))},updateData:r=>{a(n=>({...n,data:r,isLoading:!1,error:null,lastUpdated:new Date,isInitialized:!0}));try{localStorage.setItem("dashboard-stats-cache",JSON.stringify({data:r,timestamp:Date.now()}))}catch(n){console.warn("Failed to cache dashboard data:",n)}},setError:r=>{a(n=>({...n,error:r,isLoading:!1}))},getCachedData:()=>{try{const r=localStorage.getItem("dashboard-stats-cache");if(r){const{data:n,timestamp:l}=JSON.parse(r);if(Date.now()-l<300*1e3)return n}}catch(r){console.warn("Failed to retrieve cached dashboard data:",r)}return null},clearCache:()=>{try{localStorage.removeItem("dashboard-stats-cache"),localStorage.removeItem("dashboard-charts-cache")}catch(r){console.warn("Failed to clear dashboard cache:",r)}},initChartData:(r,n)=>{n&&a(l=>({...l,charts:{...l.charts,[r]:{...l.charts[r],data:n,isLoading:!1}}}))},setChartLoading:(r,n)=>{a(l=>({...l,charts:{...l.charts,[r]:{...l.charts[r],isLoading:n}}}))},updateChartData:(r,n)=>{a(l=>({...l,charts:{...l.charts,[r]:{data:n,isLoading:!1,error:null,lastUpdated:new Date}}}));try{const l=`dashboard-chart-${r}-cache`;localStorage.setItem(l,JSON.stringify({data:n,timestamp:Date.now()}))}catch(l){console.warn(`Failed to cache ${r} data:`,l)}},setChartError:(r,n)=>{a(l=>({...l,charts:{...l.charts,[r]:{...l.charts[r],error:n,isLoading:!1}}}))},getCachedChartData:r=>{try{const n=`dashboard-chart-${r}-cache`,l=localStorage.getItem(n);if(l){const{data:c,timestamp:d}=JSON.parse(l);if(Date.now()-d<300*1e3)return c}}catch(n){console.warn(`Failed to retrieve cached ${r} data:`,n)}return null}}}const Is=M2();var I2=(s,t)=>t("students"),R2=(s,t)=>t("teachers"),O2=_('<div class="chart-loading svelte-y4xb3t"><div class="chart-loader svelte-y4xb3t"></div> <p class="svelte-y4xb3t">Loading chart data...</p></div>'),j2=_('<div class="chart-error svelte-y4xb3t"><span class="material-symbols-outlined svelte-y4xb3t">error</span> <p class="svelte-y4xb3t"> </p></div>'),q2=_('<div class="legend-item svelte-y4xb3t"><div class="legend-circle svelte-y4xb3t"></div> <span class="legend-text svelte-y4xb3t"> </span></div>'),z2=_('<canvas class="svelte-y4xb3t"></canvas> <div class="graph-label svelte-y4xb3t"></div>',1),G2=_('<div class="chart-container svelte-y4xb3t"><div class="chart-header svelte-y4xb3t"><h3 class="chart-title svelte-y4xb3t"> </h3> <div class="toggle-buttons svelte-y4xb3t"><button><span class="material-symbols-outlined svelte-y4xb3t">school</span> Students</button> <button><span class="material-symbols-outlined svelte-y4xb3t">person</span> Teachers</button></div></div> <!></div>');function V2(s,t){qa(t,!0);const[a,r]=xs(),n=()=>Ja(Is,"$dashboardStore",a);cr.register(Op,eh,Qi,Ui,Yi);let l=pt(void 0),c,d=pt("students"),f=pt(Xs([])),p=pt(!1),h=pt(null),g=aa(()=>n().charts.studentsPerGrade),b=aa(()=>e(g).isLoading),y=aa(()=>e(g).error),k=aa(()=>e(g).data);const A=["7","8","9","10"],D=["rgb(0, 114, 178)","rgb(230, 159, 0)","rgb(86, 180, 233)","rgb(102, 102, 102)"],T=["rgb(244, 67, 54)","rgb(33, 150, 243)","rgb(76, 175, 80)","rgb(255, 152, 0)","rgb(156, 39, 176)","rgb(0, 188, 212)","rgb(255, 235, 59)","rgb(121, 85, 72)"],C="rgb(158, 158, 158)";async function S(){try{v(p,!0),v(h,null);const[ke,Ke]=await Promise.all([la.get("/api/departments?action=departments"),la.get("/api/departments?action=teachers")]);if(ke.success&&Ke.success){const lt=ke.data.filter(ne=>ne.teacher_count>0),He=ke.data.reduce((ne,oe)=>ne+(oe.teacher_count||0),0),Ne=Ke.data.length-He;v(f,[...lt],!0),Ne>0&&e(f).push({name:"Not Assigned",teacher_count:Ne,isNotAssigned:!0})}else throw new Error(ke.error||Ke.error||"Failed to fetch teachers data")}catch(ke){console.error("Error fetching teachers data:",ke),v(h,ke.message,!0)}finally{v(p,!1)}}Es(()=>{e(l)&&(e(d)==="students"&&e(k)&&!e(b)?setTimeout(()=>{M(e(k))},0):e(d)==="teachers"&&e(f).length>0&&!e(p)&&setTimeout(()=>{F(e(f))},0))});function M(ke){if(!e(l)){console.warn("Canvas not yet available");return}c&&c.destroy();const Ke=A.map(He=>{const et=ke.find(Ne=>Ne.grade_level===He);return et?et.count:0}),lt=e(l).getContext("2d");c=new cr(lt,{type:"doughnut",data:{labels:A.map(He=>`Grade ${He}`),datasets:[{label:"Students",data:Ke,backgroundColor:D,borderWidth:5,borderRadius:2,borderColor:getComputedStyle(document.documentElement).getPropertyValue("--md-sys-color-surface-container").trim(),hoverBorderWidth:1,hoverBorderColor:getComputedStyle(document.documentElement).getPropertyValue("--md-sys-color-surface-container").trim()}]},options:{responsive:!0,maintainAspectRatio:!1,cutout:"60%",plugins:{legend:{display:!1},title:{display:!1},tooltip:{callbacks:{label(He){const et=He.label||"",Ne=He.parsed||0,ne=He.dataset.data.reduce((_e,Me)=>_e+Me,0),oe=ne>0?(Ne/ne*100).toFixed(1):0;return`${et}: ${Ne} students (${oe}%)`}}}}},plugins:[{id:"centerText",beforeDraw(He){const{ctx:et,chartArea:{width:Ne,height:ne}}=He,_e=He.data.datasets[0].data.reduce((Ie,ut)=>Ie+ut,0),Me=getComputedStyle(document.documentElement).getPropertyValue("--md-sys-color-on-surface").trim(),ze=32,Ee=14,pe=5;et.save(),et.textAlign="center",et.textBaseline="middle",et.fillStyle=Me;const qe=Ne/2,Ae=ne/2;et.font=`bold ${ze}px sans-serif`,et.fillText(_e,qe,Ae-Ee/1.5+pe),et.font=`400 ${Ee}px sans-serif`,et.fillText("Total Students",qe,Ae+ze/1.8+pe),et.restore()}}]})}function F(ke){if(!e(l)){console.warn("Canvas not yet available");return}c&&c.destroy();const Ke=ke.map(Ne=>Ne.name.replace(" Department","")),lt=ke.map(Ne=>Ne.teacher_count),He=ke.map((Ne,ne)=>Ne.isNotAssigned?C:T[ne%T.length]),et=e(l).getContext("2d");c=new cr(et,{type:"doughnut",data:{labels:Ke,datasets:[{label:"Teachers",data:lt,backgroundColor:He,borderWidth:5,borderRadius:2,borderColor:getComputedStyle(document.documentElement).getPropertyValue("--md-sys-color-surface-container").trim(),hoverBorderWidth:1,hoverBorderColor:getComputedStyle(document.documentElement).getPropertyValue("--md-sys-color-surface-container").trim()}]},options:{responsive:!0,maintainAspectRatio:!1,cutout:"60%",plugins:{legend:{display:!1},title:{display:!1},tooltip:{callbacks:{label(Ne){const ne=Ne.label||"",oe=Ne.parsed||0,_e=Ne.dataset.data.reduce((ze,Ee)=>ze+Ee,0),Me=_e>0?(oe/_e*100).toFixed(1):0;return`${ne}: ${oe} teachers (${Me}%)`}}}}},plugins:[{id:"centerText",beforeDraw(Ne){const{ctx:ne,chartArea:{width:oe,height:_e}}=Ne,ze=Ne.data.datasets[0].data.reduce((me,J)=>me+J,0),Ee=getComputedStyle(document.documentElement).getPropertyValue("--md-sys-color-on-surface").trim(),pe=32,qe=14,Ae=5;ne.save(),ne.textAlign="center",ne.textBaseline="middle",ne.fillStyle=Ee;const Ie=oe/2,ut=_e/2;ne.font=`bold ${pe}px sans-serif`,ne.fillText(ze,Ie,ut-qe/1.5+Ae),ne.font=`400 ${qe}px sans-serif`,ne.fillText("Total Teachers",Ie,ut+pe/1.8+Ae),ne.restore()}}]})}function j(ke){v(d,ke,!0),ke==="teachers"&&e(f).length===0&&!e(p)&&S()}function P(){c&&(e(d)==="students"&&e(k)?M(e(k)):e(d)==="teachers"&&e(f).length>0&&F(e(f)))}Ya(()=>{const ke=new MutationObserver(Ke=>{Ke.forEach(lt=>{lt.type==="attributes"&&lt.attributeName==="data-theme"&&P()})});return ke.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>{ke.disconnect()}}),ti(()=>{c&&c.destroy()});let Y=aa(()=>e(d)==="students"?e(b):e(p)),W=aa(()=>e(d)==="students"?e(y):e(h)),N=aa(()=>e(d)==="students"?"Students per Grade Level":"Teachers per Department"),L=aa(()=>e(d)==="students"?A.map((ke,Ke)=>({label:`Grade ${ke}`,color:D[Ke]})):e(f).map((ke,Ke)=>({label:ke.name.replace(" Department",""),color:ke.isNotAssigned?C:T[Ke%T.length]})));var X=G2(),ae=o(X),V=o(ae),ie=o(V,!0);i(V);var he=u(V,2),Ge=o(he);let ce;Ge.__click=[I2,j];var se=u(Ge,2);let Re;se.__click=[R2,j],i(he),i(ae);var Je=u(ae,2);{var it=ke=>{var Ke=O2();m(ke,Ke)},Le=ke=>{var Ke=mt(),lt=tt(Ke);{var He=Ne=>{var ne=j2(),oe=u(o(ne),2),_e=o(oe,!0);i(oe),i(ne),O(()=>w(_e,e(W))),m(Ne,ne)},et=Ne=>{var ne=z2(),oe=tt(ne);Hs(oe,Me=>v(l,Me),()=>e(l));var _e=u(oe,2);Dt(_e,21,()=>e(L),Ua,(Me,ze)=>{var Ee=q2(),pe=o(Ee),qe=u(pe,2),Ae=o(qe,!0);i(qe),i(Ee),O(()=>{Wa(pe,`background-color: ${e(ze).color??""};`),w(Ae,e(ze).label)}),m(Me,Ee)}),i(_e),m(Ne,ne)};E(lt,Ne=>{e(W)?Ne(He):Ne(et,!1)},!0)}m(ke,Ke)};E(Je,ke=>{e(Y)?ke(it):ke(Le,!1)})}i(X),O((ke,Ke)=>{w(ie,e(N)),ce=we(Ge,1,"toggle-btn svelte-y4xb3t",null,ce,ke),Re=we(se,1,"toggle-btn svelte-y4xb3t",null,Re,Ke)},[()=>({active:e(d)==="students"}),()=>({active:e(d)==="teachers"})]),m(s,X),za(),r()}Ps(["click"]);var B2=_('<div class="chart-loading svelte-1bi57z4"><div class="chart-loader svelte-1bi57z4"></div> <p class="svelte-1bi57z4">Loading chart data...</p></div>'),W2=_('<div class="chart-error svelte-1bi57z4"><span class="material-symbols-outlined svelte-1bi57z4">error</span> <p class="svelte-1bi57z4"> </p></div>'),H2=_('<canvas class="svelte-1bi57z4"></canvas>'),U2=_('<div class="chart-container svelte-1bi57z4"><!></div>');function Y2(s,t){qa(t,!0);const[a,r]=xs(),n=()=>Ja(Is,"$dashboardStore",a);cr.register(Rn,jn,qn,zn,Qi,Ui,Yi);let l=pt(void 0),c,d=aa(()=>n().charts.sectionsPerGrade),f=aa(()=>e(d).isLoading),p=aa(()=>e(d).error),h=aa(()=>e(d).data);const g=["7","8","9","10"];Es(()=>{e(h)&&!e(f)&&e(l)&&setTimeout(()=>{b(e(h))},0)});function b(C){if(!e(l)){console.warn("Canvas not yet available");return}c&&c.destroy();const S=g.map(F=>{const j=C.find(P=>P.grade_level===F);return j?j.section_count:0}),M=e(l).getContext("2d");c=new cr(M,{type:"bar",data:{labels:g.map(F=>`Grade ${F}`),datasets:[{label:"Number of Sections",data:S,backgroundColor:["rgba(54, 162, 235, 0.6)","rgba(75, 192, 192, 0.6)","rgba(153, 102, 255, 0.6)","rgba(255, 159, 64, 0.6)"],borderColor:["rgb(54, 162, 235)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(255, 159, 64)"],borderWidth:2,borderRadius:8,borderSkipped:!1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,suggestedMax:Math.max(...S)+2,ticks:{stepSize:1,callback(F){return Math.floor(F)},color:getComputedStyle(document.documentElement).getPropertyValue("--md-sys-color-on-surface-variant").trim()},grid:{color:getComputedStyle(document.documentElement).getPropertyValue("--md-sys-color-outline-variant").trim()},title:{display:!0,text:"Number of Sections",color:getComputedStyle(document.documentElement).getPropertyValue("--md-sys-color-on-surface").trim(),font:{size:12,weight:"bold"}}},x:{ticks:{color:getComputedStyle(document.documentElement).getPropertyValue("--md-sys-color-on-surface-variant").trim()},grid:{display:!1}}},plugins:{legend:{display:!1},title:{display:!0,text:"Sections per Grade Level",font:{size:16,weight:"bold"},color:getComputedStyle(document.documentElement).getPropertyValue("--md-sys-color-on-surface").trim(),padding:{top:10,bottom:20}},tooltip:{callbacks:{label(F){return`Sections: ${F.parsed.y||0}`}}}}}})}function y(){c&&e(h)&&b(e(h))}Ya(()=>{const C=new MutationObserver(S=>{S.forEach(M=>{M.type==="attributes"&&M.attributeName==="data-theme"&&y()})});return C.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>{C.disconnect()}}),ti(()=>{c&&c.destroy()});var k=U2(),A=o(k);{var D=C=>{var S=B2();m(C,S)},T=C=>{var S=mt(),M=tt(S);{var F=P=>{var Y=W2(),W=u(o(Y),2),N=o(W,!0);i(W),i(Y),O(()=>w(N,e(p))),m(P,Y)},j=P=>{var Y=H2();Hs(Y,W=>v(l,W),()=>e(l)),m(P,Y)};E(M,P=>{e(p)?P(F):P(j,!1)},!0)}m(C,S)};E(A,C=>{e(f)?C(D):C(T,!1)})}i(k),m(s,k),za(),r()}var Q2=_('<div class="stats-error"><span class="material-symbols-outlined">error</span> <p> </p> <button class="retry-button"><span class="material-symbols-outlined">refresh</span> Retry</button></div>'),K2=_('<div><div class="stat-card-header"><p class="stat-label"> </p> <div class="dashboard-stat-icon"><span class="material-symbols-outlined"> </span></div></div> <div class="stat-card-content"><h3 class="stat-card-value"><!></h3></div></div>'),J2=_('<div class="stats-grid"></div>'),X2=_('<div class="activities-loading"><div class="system-loader"></div> <p>Loading recent activities...</p></div>'),Z2=_('<div class="activities-error"><span class="material-symbols-outlined error-icon">error</span> <p> </p></div>'),e0=_('<div class="activities-empty"><span class="material-symbols-outlined">inbox</span> <p>No recent activities found</p></div>'),t0=_('<p class="activity-user"> </p>'),a0=_('<div class="activity-item"><div class="activity-icon"><span class="material-symbols-outlined"> </span></div> <div class="activity-content"><p class="activity-message"> </p> <!></div> <span class="activity-timestamp"> </span></div>'),s0=_('<div class="dashboard-container"><div class="dashboard-header"><div class="header-content"><h1 class="page-title">Admin Dashboard</h1> <p class="page-subtitle">Overview of school management system statistics</p></div></div> <div class="stats-section"><!></div> <div class="graph-row"><div class="accounts-stats-container"><!></div> <div class="average-grades-stats-container"><!></div></div> <div class="activities-section"><div class="section-header"><h2 class="section-title">Activity Logs</h2> <button class="refresh-button" title="Refresh activity logs"><span class="material-symbols-outlined">refresh</span> Refresh</button></div> <div class="activities-list"><!></div></div></div>');function r0(s,t){qa(t,!1);const[a,r]=xs(),n=()=>Ja(Is,"$dashboardStore",a),l=R(),c=R(),d=R();let f=R([]),p=R(!1),h=R(null);const g=["border-blue","border-green","border-orange","border-purple"];function b(ce){return g[ce%g.length]}async function y(ce=!1){try{ce||Is.setLoading(!0);const se=await la.get("/api/dashboard");if(se.success){const Re=[{id:"students",label:"Total Students",value:se.data.students.toLocaleString(),icon:"school",color:"primary"},{id:"teachers",label:"Total Teachers",value:se.data.teachers.toLocaleString(),icon:"person",color:"primary"},{id:"sections",label:"Total Sections",value:se.data.sections.toLocaleString(),icon:"class",color:"primary"},{id:"rooms",label:"Total Rooms",value:se.data.rooms.toLocaleString(),icon:"meeting_room",color:"primary"}];Is.updateData(Re)}else throw new Error(se.error||"Failed to fetch dashboard statistics")}catch(se){console.error("Error fetching dashboard statistics:",se),Is.setError(se.message)}}async function k(ce=!1){try{ce||Is.setChartLoading("studentsPerGrade",!0);const se=await la.get("/api/dashboard/students-per-grade");if(se.success)Is.updateChartData("studentsPerGrade",se.data);else throw new Error(se.error||"Failed to fetch students per grade data")}catch(se){console.error("Error fetching students per grade:",se),Is.setChartError("studentsPerGrade",se.message)}}async function A(ce=!1){try{ce||Is.setChartLoading("sectionsPerGrade",!0);const se=await la.get("/api/dashboard/sections-per-grade");if(se.success)Is.updateChartData("sectionsPerGrade",se.data);else throw new Error(se.error||"Failed to fetch sections per grade data")}catch(se){console.error("Error fetching sections per grade:",se),Is.setChartError("sectionsPerGrade",se.message)}}async function D(ce=!1){try{ce||(v(p,!0),v(h,null));const se=await la.get("/api/activity-logs");if(se.success)v(f,se.activities);else throw new Error(se.error||"Failed to fetch activities")}catch(se){console.error("Error fetching activities:",se),v(h,se.message)}finally{v(p,!1)}}Ya(()=>{const ce=Is.getCachedData();ce&&Is.init(ce);const se=Is.getCachedChartData("studentsPerGrade");se&&Is.initChartData("studentsPerGrade",se);const Re=Is.getCachedChartData("sectionsPerGrade");Re&&Is.initChartData("sectionsPerGrade",Re),y(!!ce),k(!!se),A(!!Re),D(!1);const Je=setInterval(()=>{y(!0),k(!0),A(!0),D(!0)},3e4);return()=>{clearInterval(Je)}}),ht(()=>(e(l),e(c),e(d),n()),()=>{(ce=>{v(l,ce.data),v(c,ce.isLoading),v(d,ce.error)})(n())}),Ms(),Fs();var T=s0(),C=u(o(T),2),S=o(C);{var M=ce=>{var se=Q2(),Re=u(o(se),2),Je=o(Re);i(Re);var it=u(Re,2);i(se),O(()=>w(Je,`Error loading statistics: ${e(d)??""}`)),Se("click",it,()=>y(!1)),m(ce,se)},F=ce=>{var se=J2();Dt(se,7,()=>e(l),Re=>Re.id,(Re,Je,it)=>{var Le=K2(),ke=o(Le),Ke=o(ke),lt=o(Ke,!0);i(Ke);var He=u(Ke,2),et=o(He),Ne=o(et,!0);i(et),i(He),i(ke);var ne=u(ke,2),oe=o(ne),_e=o(oe);{var Me=Ee=>{var pe=ba("Loading...");m(Ee,pe)},ze=Ee=>{var pe=ba();O(()=>w(pe,(e(Je),x(()=>e(Je).value)))),m(Ee,pe)};E(_e,Ee=>{e(c)?Ee(Me):Ee(ze,!1)})}i(oe),i(ne),i(Le),O(Ee=>{we(Le,1,`stat-card ${Ee??""}`),w(lt,(e(Je),x(()=>e(Je).label))),w(Ne,(e(Je),x(()=>e(Je).icon)))},[()=>(Ss(e(it)),x(()=>b(e(it))))]),m(Re,Le)}),i(se),m(ce,se)};E(S,ce=>{e(d)?ce(M):ce(F,!1)})}i(C);var j=u(C,2),P=o(j),Y=o(P);V2(Y,{}),i(P);var W=u(P,2),N=o(W);Y2(N,{}),i(W),i(j);var L=u(j,2),X=o(L),ae=u(o(X),2);i(X);var V=u(X,2),ie=o(V);{var he=ce=>{var se=X2();m(ce,se)},Ge=ce=>{var se=mt(),Re=tt(se);{var Je=Le=>{var ke=Z2(),Ke=u(o(ke),2),lt=o(Ke);i(Ke),i(ke),O(()=>w(lt,`Error loading activities: ${e(h)??""}`)),m(Le,ke)},it=Le=>{var ke=mt(),Ke=tt(ke);{var lt=et=>{var Ne=e0();m(et,Ne)},He=et=>{var Ne=mt(),ne=tt(Ne);Dt(ne,1,()=>e(f),oe=>oe.id,(oe,_e)=>{var Me=a0(),ze=o(Me),Ee=o(ze),pe=o(Ee,!0);i(Ee),i(ze);var qe=u(ze,2),Ae=o(qe),Ie=o(Ae,!0);i(Ae);var ut=u(Ae,2);{var me=$e=>{var B=t0(),te=o(B,!0);i(B),O(()=>w(te,(e(_e),x(()=>e(_e).performed_by)))),m($e,B)};E(ut,$e=>{e(_e),x(()=>e(_e).performed_by&&e(_e).performed_by!=="System")&&$e(me)})}i(qe);var J=u(qe,2),xe=o(J,!0);i(J),i(Me),O(()=>{w(pe,(e(_e),x(()=>e(_e).icon))),w(Ie,(e(_e),x(()=>e(_e).message))),w(xe,(e(_e),x(()=>e(_e).timestamp)))}),m(oe,Me)}),m(et,Ne)};E(Ke,et=>{e(f),x(()=>e(f).length===0)?et(lt):et(He,!1)},!0)}m(Le,ke)};E(Re,Le=>{e(h)?Le(Je):Le(it,!1)},!0)}m(ce,se)};E(ie,ce=>{e(p)?ce(he):ce(Ge,!1)})}i(V),i(L),i(T),O(()=>ae.disabled=e(p)),Se("click",ae,()=>D(!1)),m(s,T),za(),r()}var i0=_('<div class="selected-option"><span class="material-symbols-outlined option-icon"> </span> <div class="option-content"><span class="option-name"> </span> <span class="option-description"> </span></div></div>'),n0=_('<span class="placeholder">Select account type</span>'),o0=_('<button type="button"><span class="material-symbols-outlined option-icon"> </span> <div class="option-content"><span class="option-name"> </span> <span class="option-description"> </span></div></button>'),l0=_('<div class="selected-option"><span class="material-symbols-outlined option-icon"> </span> <div class="option-content"><span class="option-name"> </span></div></div>'),c0=_('<span class="placeholder">Select gender</span>'),d0=_('<button type="button"><span class="material-symbols-outlined option-icon"> </span> <div class="option-content"><span class="option-name"> </span></div></button>'),u0=_('<div class="selected-option"><span class="material-symbols-outlined option-icon"> </span> <div class="option-content"><span class="option-name"> </span></div></div>'),v0=_('<span class="placeholder">Select grade level</span>'),f0=_('<button type="button"><span class="material-symbols-outlined option-icon"> </span> <div class="option-content"><span class="option-name"> </span></div></button>'),p0=_('<div class="form-group"><label class="form-label" for="grade-level">Grade Level *</label> <div><button type="button" id="grade-level"><!> <span class="material-symbols-outlined dropdown-arrow">expand_more</span></button> <div class="dropdown-menu"></div></div></div>'),m0=_('<span class="email-status checking"><span class="material-symbols-outlined spinning">progress_activity</span></span>'),h0=_('<span class="email-status valid"><span class="material-symbols-outlined">check_circle</span></span>'),g0=_('<span class="email-status error"><span class="material-symbols-outlined">error</span></span>'),_0=_('<p class="form-error"> </p>'),b0=_('<p class="form-success">Email is available</p>'),y0=_('<div class="form-group"><label class="form-label" for="email">Email Address *</label> <div class="email-input-wrapper"><input type="email" id="email" placeholder="Enter email address" required/> <!></div> <!></div>'),w0=_(`<div class="additional-info-section"><h3 class="section-subtitle">Additional Information</h3> <p class="section-description">Required information for student accounts</p> <div class="form-row"><div class="form-group"><label class="form-label" for="birthdate">Birthdate *</label> <input type="date" id="birthdate" class="form-input" required/></div> <div class="form-group"><label class="form-label" for="age">Age</label> <input type="number" id="age" class="form-input age-display" readonly="" placeholder="Auto-calculated"/></div></div> <div class="form-group"><label class="form-label" for="address">Address *</label> <textarea id="address" class="form-input form-textarea" placeholder="Enter complete address" rows="3" required></textarea></div> <div class="form-row"><div class="form-group"><label class="form-label" for="guardian">Guardian/Parent Name *</label> <input type="text" id="guardian" class="form-input" placeholder="Enter guardian/parent name" required/></div> <div class="form-group"><label class="form-label" for="contact-number">Guardian's Contact Number *</label> <input type="tel" id="contact-number" class="form-input" placeholder="09xxxxxxxxxx" maxlength="11" required/></div></div></div>`),x0=_('<span class="auto-label">Loading preview...</span>'),S0=_('<span class="auto-number"> </span> <span class="auto-label">(Preview - will use lowest available)</span>',1),k0=_('<span class="auto-label">Will be auto-assigned (lowest available number)</span>'),A0=_('<span class="placeholder-number">Select account type first</span>'),D0=_('<span class="material-symbols-outlined">person_add</span> Create Account',1),C0=_('<button type="button" class="account-clear-search-button"><span class="material-symbols-outlined">close</span></button>'),T0=_('<div class="account-filter-selected-option"><span class="material-symbols-outlined account-filter-option-icon"> </span> <div class="account-filter-option-content"><span class="account-filter-option-name"> </span></div></div>'),E0=_('<span class="account-filter-placeholder">Filter by type</span>'),F0=_('<button type="button"><span class="material-symbols-outlined account-filter-option-icon"> </span> <div class="account-filter-option-content"><span class="account-filter-option-name"> </span></div></button>'),N0=_('<div class="loading-container"><span class="account-loader"></span> <p class="loading-text">Loading accounts...</p></div>'),$0=_("<p>No accounts created yet.</p>"),L0=_("<p>No accounts found matching your search or filter.</p>"),P0=_('<div class="no-results"><span class="material-symbols-outlined no-results-icon">group_off</span> <!></div>'),M0=_('<div class="account-detail-item"><span class="material-symbols-outlined">class</span> <span> </span></div>'),I0=_('<div class="account-detail-item"><span class="material-symbols-outlined">school</span> <span> </span></div>'),R0=_('<div class="account-detail-item"><span class="material-symbols-outlined">cake</span> <span> </span></div>'),O0=_('<div class="account-detail-item"><span class="material-symbols-outlined">family_restroom</span> <span> </span></div>'),j0=_('<div class="account-detail-item"><span class="material-symbols-outlined">phone</span> <span> </span></div>'),q0=_('<div class="selected-option"><span class="material-symbols-outlined option-icon"> </span> <div class="option-content"><span class="option-name"> </span></div></div>'),z0=_('<span class="placeholder">Select grade level</span>'),G0=_('<button type="button"><span class="material-symbols-outlined option-icon"> </span> <div class="option-content"><span class="option-name"> </span></div></button>'),V0=_(`<div class="form-group"><label class="form-label">Grade Level</label> <div><button type="button"><!> <span class="material-symbols-outlined dropdown-arrow">expand_more</span></button> <div class="dropdown-menu"></div></div></div> <div class="additional-info-section"><h4 class="section-subtitle">Additional Information</h4> <p class="section-description">Update student additional information</p> <div class="form-row"><div class="form-group"><label class="form-label">Birthdate *</label> <input type="date" class="form-input" required/></div> <div class="form-group"><label class="form-label">Age</label> <input type="number" class="form-input age-display" readonly="" placeholder="Auto-calculated"/></div></div> <div class="form-group"><label class="form-label">Address *</label> <textarea class="form-input form-textarea" placeholder="Enter complete address" rows="3" required></textarea></div> <div class="form-row"><div class="form-group"><label class="form-label">Guardian/Parent Name *</label> <input type="text" class="form-input" placeholder="Enter guardian/parent name" required/></div> <div class="form-group"><label class="form-label">Guardian's Contact Number *</label> <input type="tel" class="form-input" placeholder="09xxxxxxxxxx" maxlength="11" required/></div></div></div>`,1),B0=_('<div class="edit-form-section"><div class="edit-form-container"><div class="edit-form-header"><h4 class="edit-form-title">Edit Account Information</h4> <p class="edit-form-subtitle">Update the name information for this account</p></div> <form class="edit-form-content"><div class="edit-name-fields-row"><div class="form-group"><label class="form-label">Last Name *</label> <input type="text" class="form-input" placeholder="Enter last name" required/></div> <div class="form-group"><label class="form-label">First Name *</label> <input type="text" class="form-input" placeholder="Enter first name" required/></div> <div class="form-group"><label class="form-label">M.I.</label> <input type="text" class="form-input" placeholder="M" maxlength="1"/></div></div> <!> <div class="edit-form-actions"><a><button type="button" class="account-cancel-button">Cancel</button></a> <button type="submit"><!></button></div></form></div></div>'),W0=_('<div class="account-card"><div class="account-card-header"><div class="account-title"><h3 class="account-name"> </h3></div> <div class="account-action-buttons"><a><button type="button" class="account-edit-button"><span class="material-symbols-outlined"> </span></button></a> <button type="button" class="account-remove-button" title="Remove Account"><span class="material-symbols-outlined">delete</span></button></div></div> <div class="account-details"><div class="account-detail-item"><span class="material-symbols-outlined"> </span> <span> </span></div> <div class="account-detail-item"><span class="material-symbols-outlined">badge</span> <span> </span></div> <!> <!> <!> <!> <!> <div class="account-detail-item"><span class="material-symbols-outlined">calendar_today</span> <span> </span></div> <div class="account-detail-item"><span class="material-symbols-outlined">update</span> <span> </span></div></div> <!></div>'),H0=_(`<div class="account-creation-container"><div class="account-header"><div class="header-content"><h1 class="page-title">Account Creation</h1> <p class="page-subtitle">Create new student, teacher, and admin accounts for the system</p></div></div> <div class="creation-form-section"><div class="account-section-header"><h2 class="section-title">Create New Account</h2> <p class="section-subtitle">Fill in the details below to create a new account</p></div> <div class="form-container"><form><div class="account-type-gender-row"><div class="form-group"><label class="form-label" for="account-type">Account Type *</label> <div><button type="button" id="account-type"><!> <span class="material-symbols-outlined dropdown-arrow">expand_more</span></button> <div class="dropdown-menu"></div></div></div> <div class="form-group"><label class="form-label" for="gender">Gender *</label> <div><button type="button" id="gender"><!> <span class="material-symbols-outlined dropdown-arrow">expand_more</span></button> <div class="dropdown-menu"></div></div></div> <!></div> <div class="name-fields-row"><div class="form-group"><label class="form-label" for="last-name">Last Name *</label> <input type="text" id="last-name" class="form-input" placeholder="Enter last name" required/></div> <div class="form-group"><label class="form-label" for="first-name">First Name *</label> <input type="text" id="first-name" class="form-input" placeholder="Enter first name" required/></div> <div class="form-group"><label class="form-label" for="middle-initial">M.I.</label> <input type="text" id="middle-initial" class="form-input" placeholder="M" maxlength="1"/></div></div> <!> <!> <div class="form-group"><div class="form-label"> </div> <div class="number-display"><!></div> <p class="form-help">Account number will be automatically assigned using the lowest available number.
						Password will be set to the same as the account number.</p></div> <div class="form-actions"><button type="submit"><!></button></div></form></div></div> <div class="recent-accounts-section"><div class="account-section-header"><div class="section-header-content"><div class="section-title-group"><h2 class="section-title">All Account Creations</h2> <p class="account-creation-section-subtitle">All accounts in the system</p></div> <div class="account-search-filter-container"><div class="account-search-container"><div class="account-search-input-wrapper"><span class="material-symbols-outlined account-search-icon">search</span> <input type="text" placeholder="Search by name, account number, or account type..." class="account-search-input"/> <!></div></div> <div class="account-filter-container"><div><button type="button"><!> <span class="material-symbols-outlined account-filter-dropdown-arrow">expand_more</span></button> <div class="account-filter-dropdown-menu"></div></div></div></div></div></div> <div class="accounts-grid"><!></div></div></div>`);function U0(s,t){qa(t,!1);const[a,r]=xs(),n=()=>Ja(gs,"$authStore",a),l=R(),c=R(),d=R(),f=R(),p=R(),h=R(),g=R();let b=R(!1),y=R(""),k=R(""),A=R(""),D=R(""),T=R(""),C=R(""),S=R(""),M=R(""),F=R(!1),j=null;const P=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;let Y=R(""),W=R(""),N=R(""),L=R(""),X=R(0),ae=R(!1),V=R(!1),ie=R(!1),he=R(null),Ge=R(""),ce=R(""),se=R(""),Re=R(""),Je=R(!1),it=R(!1),Le=R(""),ke=R(""),Ke=R(""),lt=R(""),He=R(0);function et(){const re=new Date;return re.setDate(re.getDate()-1),re.toISOString().split("T")[0]}function Ne(re){return re&&re.split(" ").map(ge=>ge.charAt(0).toUpperCase()+ge.slice(1).toLowerCase()).join(" ")}function ne(re,ge,ct=!1){const Et=re.target.value,Ct=ge==="middleInitial"?Et.toUpperCase():Ne(Et);ct?ge==="firstName"?v(Ge,Ct):ge==="lastName"?v(ce,Ct):ge==="middleInitial"&&v(se,Ct):ge==="firstName"?v(D,Ct):ge==="lastName"?v(T,Ct):ge==="middleInitial"&&v(C,Ct),re.target.value=Ct}function oe(re){if(!re)return!1;const ge=re.replace(/\D/g,"");return ge.startsWith("09")&&ge.length===11}function _e(re){return re.replace(/\D/g,"").slice(0,11)}function Me(re,ge=!1){const ct=_e(re.target.value);ge?v(lt,ct):v(L,ct),re.target.value=ct}async function ze(re){if(v(M,""),!(!re||re.trim()==="")){if(!P.test(re)){v(M,"Invalid email format");return}v(F,!0);try{const ge=await la.get(`/api/accounts/check-email?email=${encodeURIComponent(re)}`);ge.valid?ge.exists?v(M,"This email is already registered"):v(M,""):v(M,ge.error||"Invalid email format")}catch(ge){console.error("Error checking email:",ge)}finally{v(F,!1)}}}function Ee(re){const ge=re.target.value.trim().toLowerCase();v(S,ge),j&&clearTimeout(j),ge?j=setTimeout(()=>{ze(ge)},500):v(M,"")}function pe(re){if(!re||re.length<10)return!0;const ge=new Date(re),ct=ge.getFullYear(),Et=new Date,Ct=Et.getFullYear();if(isNaN(ge.getTime())||ct<1900||ct>Ct)return!1;const Lt=new Date(Et.getFullYear(),Et.getMonth(),Et.getDate());return!(new Date(ge.getFullYear(),ge.getMonth(),ge.getDate())>=Lt)}const qe=[{id:"student",name:"Student Account",description:"Create a new student account",icon:"school"},{id:"teacher",name:"Teacher Account",description:"Create a new teacher account",icon:"person"},{id:"admin",name:"Admin Account",description:"Create a new admin account",icon:"admin_panel_settings"}],Ae=[{id:"male",name:"Male",icon:"male"},{id:"female",name:"Female",icon:"female"}],Ie=[{id:"7",name:"Grade 7",icon:"looks_one"},{id:"8",name:"Grade 8",icon:"looks_two"},{id:"9",name:"Grade 9",icon:"looks_3"},{id:"10",name:"Grade 10",icon:"looks_4"}];let ut=R([]),me=R(!1),J=R(""),xe=R("all"),$e=R(!1);const B=[{id:"all",name:"All Accounts",icon:"group"},{id:"student",name:"Student Accounts",icon:"school"},{id:"teacher",name:"Teacher Accounts",icon:"person"},{id:"admin",name:"Admin Accounts",icon:"admin_panel_settings"}];function te(re){!re.target.closest(".custom-dropdown")&&!re.target.closest(".account-filter-dropdown")&&(v(ae,!1),v(V,!1),v(ie,!1),v(Je,!1),v($e,!1))}async function ue(re){const ge=n().userData;if(ge&&ge.accountNumber===re.number){Te.error("You cannot delete your own account while logged in.");return}cs.confirm("Remove Account",`<p>Are you sure you want to remove the account for <strong>"${re.name}"</strong>?</p>`,async()=>{try{const ct=await la.delete("/api/accounts",{id:re.id});if(!ct.success)throw new Error(ct.message||"Failed to delete account");v(ut,e(ut).filter(Et=>Et.id!==re.id)),Te.success(`Account for "${re.name}" has been removed successfully`)}catch(ct){console.error("Error deleting account:",ct),Te.error(`Failed to delete account: ${ct.message}`)}},()=>{},{size:"small"})}function G(re){if(e(he)===re.id)v(he,null),v(Ge,""),v(ce,""),v(se,""),v(Re,""),v(Le,""),v(ke,""),v(Ke,""),v(lt,""),v(He,0),v(Je,!1);else if(v(he,re.id),re.firstName&&re.lastName){if(v(Ge,re.firstName),v(ce,re.lastName),v(se,re.middleInitial||""),v(Re,re.gradeLevel||""),re.birthdate){const ge=new Date(re.birthdate),ct=ge.getFullYear(),Et=String(ge.getMonth()+1).padStart(2,"0"),Ct=String(ge.getDate()).padStart(2,"0");v(Le,`${ct}-${Et}-${Ct}`)}else v(Le,"");v(ke,re.address||""),v(Ke,re.guardian||""),v(lt,re.contactNumber||"")}else{const ge=re.name.split(", ");if(ge.length>=2){v(ce,ge[0]);const Et=ge[1].split(" ");v(Ge,Et[0]),Et.length>1&&Et[1].endsWith(".")?v(se,Et[1].replace(".","")):v(se,"")}if(v(Re,re.gradeLevel||""),re.birthdate){const ct=new Date(re.birthdate),Et=ct.getFullYear(),Ct=String(ct.getMonth()+1).padStart(2,"0"),Lt=String(ct.getDate()).padStart(2,"0");v(Le,`${Et}-${Ct}-${Lt}`)}else v(Le,"");v(ke,re.address||""),v(Ke,re.guardian||""),v(lt,re.contactNumber||"")}}async function z(){if(!e(Ge)||!e(ce)){Te.error("Please fill in all required fields.");return}if(e(l)&&e(l).type.toLowerCase()==="student"){if(!e(Le)||!e(ke)||!e(Ke)||!e(lt)){Te.error("Please fill in all required student information fields.");return}if(!oe(e(lt))){Te.error("Invalid contact number.");return}}v(it,!0);try{const re={id:e(he),firstName:e(Ge).trim(),lastName:e(ce).trim(),middleInitial:e(se)?e(se).trim():null};e(l)&&e(l).type.toLowerCase()==="student"&&(re.gradeLevel=e(Re)||null,re.birthdate=e(Le)||null,re.address=e(ke)?e(ke).trim():null,re.guardian=e(Ke)?e(Ke).trim():null,re.contactNumber=e(lt)?e(lt).trim():null);const ge=await la.put("/api/accounts",re);ge.success?(v(ut,e(ut).map(ct=>ct.id===e(he)?ge.account:ct)),Te.success(ge.message),v(he,null),v(Ge,""),v(ce,""),v(se,""),v(Re,""),v(Le,""),v(ke,""),v(Ke,""),v(lt,""),v(He,0)):Te.error(ge.error||"Failed to update account")}catch(re){console.error("Error updating account:",re),Te.error("Failed to update account. Please try again.")}finally{v(it,!1)}}function le(){v(ae,!e(ae))}function Z(re){v(y,re.id),v(ae,!1),re.id!=="student"&&v(A,"")}function q(){v(V,!e(V))}function U(re){v(k,re.id),v(V,!1)}function $(){v(ie,!e(ie))}function I(re){v(A,re.id),v(ie,!1)}function H(){v(Je,!e(Je))}function fe(re){v(Re,re.id),v(Je,!1)}async function ve(){if(!e(y)||!e(k)||!e(D)||!e(T)){Te.error("Please fill in all required fields.");return}if((e(y)==="student"||e(y)==="teacher")&&!e(S)){Te.error("Please enter an email address.");return}if(e(M)){Te.error(e(M));return}if(e(F)){Te.error("Please wait while we verify the email address.");return}if(e(y)==="student"&&!e(A)){Te.error("Please select a grade level for the student account.");return}if(e(y)==="student"){if(!e(Y)||!e(W)||!e(N)||!e(L)){Te.error("Please fill in all additional information fields for the student account.");return}if(!oe(e(L))){Te.error("Invalid contact number.");return}}const re=e(y)==="student"?"Student":e(y)==="teacher"?"Teacher":"Admin",ge=`${e(D)} ${e(C)?e(C)+". ":""}${e(T)}`;cs.confirm("Confirm Account Creation",`<p>Are you sure you want to create a <strong>${re}</strong> account for <strong>"${ge}"</strong>?</p>`,async()=>{await Fe()},()=>{},{size:"small"})}async function Fe(){v(b,!0);try{const re=n().userData,ge=await la.post("/api/accounts",{accountType:e(y),gender:e(k),gradeLevel:e(A),firstName:e(D),lastName:e(T),middleInitial:e(C),email:e(S),birthdate:e(y)==="student"?e(Y):null,address:e(y)==="student"?e(W):null,guardian:e(y)==="student"?e(N):null,contactNumber:e(y)==="student"?e(L):null,createdBy:re?re.id:null});if(!ge.success)throw new Error(ge.message||"Failed to create account");v(ut,[ge.account,...e(ut)]);const ct=e(y)==="student"?"Student":e(y)==="teacher"?"Teacher":"Admin";Te.success(`${ct} account created successfully for ${ge.account.name}! Password is the same as account number: ${ge.account.number}`),v(y,""),v(k,""),v(A,""),v(D,""),v(T,""),v(C,""),v(S,""),v(M,""),v(Y,""),v(W,""),v(N,""),v(L,""),v(X,0)}catch(re){console.error("Error creating account:",re),Te.error(re.message||"Failed to create account. Please try again.")}finally{v(b,!1)}}function Ce(){v($e,!e($e))}function Be(re){v(xe,re.id),v($e,!1)}function Ue(){v(J,"")}let Pe=R(""),Ve=R(!1);async function st(re){if(!re){v(Pe,"");return}v(Ve,!0);try{const ge=await la.get(`/api/accounts/next-number?type=${re}`);v(Pe,ge.accountNumber)}catch(ge){console.error("Error fetching next account number:",ge),v(Pe,"Error loading preview")}finally{v(Ve,!1)}}async function nt(){v(me,!0);try{const re=await la.get("/api/accounts");if(!re.success)throw new Error("Failed to load accounts");v(ut,re.accounts)}catch(re){console.error("Error loading accounts:",re),Te.error("Failed to load existing accounts")}finally{v(me,!1)}}Ya(()=>{nt()}),ht(()=>(e(he),e(ut)),()=>{v(l,e(he)?e(ut).find(re=>re.id===e(he)):null)}),ht(()=>e(y),()=>{v(c,qe.find(re=>re.id===e(y)))}),ht(()=>e(k),()=>{v(d,Ae.find(re=>re.id===e(k)))}),ht(()=>e(A),()=>{v(f,Ie.find(re=>re.id===e(A)))}),ht(()=>e(Re),()=>{v(p,Ie.find(re=>re.id===e(Re)))}),ht(()=>e(Y),()=>{if(e(Y)){const re=new Date(e(Y)),ge=new Date;let ct=ge.getFullYear()-re.getFullYear();const Et=ge.getMonth()-re.getMonth();(Et<0||Et===0&&ge.getDate()<re.getDate())&&ct--,v(X,ct>=0?ct:0)}else v(X,0)}),ht(()=>e(Le),()=>{if(e(Le)){const re=new Date(e(Le)),ge=new Date;let ct=ge.getFullYear()-re.getFullYear();const Et=ge.getMonth()-re.getMonth();(Et<0||Et===0&&ge.getDate()<re.getDate())&&ct--,v(He,ct>=0?ct:0)}else v(He,0)}),ht(()=>e(xe),()=>{v(h,B.find(re=>re.id===e(xe)))}),ht(()=>(e(ut),e(xe),e(J)),()=>{v(g,e(ut).filter(re=>{const ge=e(xe)==="all"||re.type.toLowerCase()===e(xe).toLowerCase(),ct=!e(J)||re.name?.toLowerCase().includes(e(J).toLowerCase())||re.number?.toString().toLowerCase().includes(e(J).toLowerCase())||re.type?.toLowerCase().includes(e(J).toLowerCase());return ge&&ct}))}),ht(()=>e(y),()=>{e(y)&&st(e(y))}),Ms(),Fs();var vt=H0();Se("click",Zs,te);var St=u(o(vt),2),At=u(o(St),2),Wt=o(At),Nt=o(Wt),It=o(Nt),Gt=u(o(It),2);let Ot;var sa=o(Gt);let Qt;var Pt=o(sa);{var Yt=re=>{var ge=i0(),ct=o(ge),Et=o(ct,!0);i(ct);var Ct=u(ct,2),Lt=o(Ct),ra=o(Lt,!0);i(Lt);var Da=u(Lt,2),Bt=o(Da,!0);i(Da),i(Ct),i(ge),O(()=>{w(Et,(e(c),x(()=>e(c).icon))),w(ra,(e(c),x(()=>e(c).name))),w(Bt,(e(c),x(()=>e(c).description)))}),m(re,ge)},ca=re=>{var ge=n0();m(re,ge)};E(Pt,re=>{e(c)?re(Yt):re(ca,!1)})}Ht(2),i(sa);var ye=u(sa,2);Dt(ye,5,()=>qe,re=>re.id,(re,ge)=>{var ct=o0();let Et;var Ct=o(ct),Lt=o(Ct,!0);i(Ct);var ra=u(Ct,2),Da=o(ra),Bt=o(Da,!0);i(Da);var We=u(Da,2),Zt=o(We,!0);i(We),i(ra),i(ct),O(xt=>{Et=we(ct,1,"dropdown-option",null,Et,xt),w(Lt,(e(ge),x(()=>e(ge).icon))),w(Bt,(e(ge),x(()=>e(ge).name))),w(Zt,(e(ge),x(()=>e(ge).description)))},[()=>({selected:e(y)===e(ge).id})]),Se("click",ct,()=>Z(e(ge))),m(re,ct)}),i(ye),i(Gt),i(It);var Xe=u(It,2),ot=u(o(Xe),2);let be;var je=o(ot);let rt;var Ft=o(je);{var Vt=re=>{var ge=l0(),ct=o(ge),Et=o(ct,!0);i(ct);var Ct=u(ct,2),Lt=o(Ct),ra=o(Lt,!0);i(Lt),i(Ct),i(ge),O(()=>{w(Et,(e(d),x(()=>e(d).icon))),w(ra,(e(d),x(()=>e(d).name)))}),m(re,ge)},at=re=>{var ge=c0();m(re,ge)};E(Ft,re=>{e(d)?re(Vt):re(at,!1)})}Ht(2),i(je);var va=u(je,2);Dt(va,5,()=>Ae,re=>re.id,(re,ge)=>{var ct=d0();let Et;var Ct=o(ct),Lt=o(Ct,!0);i(Ct);var ra=u(Ct,2),Da=o(ra),Bt=o(Da,!0);i(Da),i(ra),i(ct),O(We=>{Et=we(ct,1,"dropdown-option",null,Et,We),w(Lt,(e(ge),x(()=>e(ge).icon))),w(Bt,(e(ge),x(()=>e(ge).name)))},[()=>({selected:e(k)===e(ge).id})]),Se("click",ct,()=>U(e(ge))),m(re,ct)}),i(va),i(ot),i(Xe);var Ca=u(Xe,2);{var gt=re=>{var ge=p0(),ct=u(o(ge),2);let Et;var Ct=o(ct);let Lt;var ra=o(Ct);{var Da=Zt=>{var xt=u0(),Rt=o(xt),ea=o(Rt,!0);i(Rt);var na=u(Rt,2),ja=o(na),$a=o(ja,!0);i(ja),i(na),i(xt),O(()=>{w(ea,(e(f),x(()=>e(f).icon))),w($a,(e(f),x(()=>e(f).name)))}),m(Zt,xt)},Bt=Zt=>{var xt=v0();m(Zt,xt)};E(ra,Zt=>{e(f)?Zt(Da):Zt(Bt,!1)})}Ht(2),i(Ct);var We=u(Ct,2);Dt(We,5,()=>Ie,Zt=>Zt.id,(Zt,xt)=>{var Rt=f0();let ea;var na=o(Rt),ja=o(na,!0);i(na);var $a=u(na,2),Ra=o($a),Ba=o(Ra,!0);i(Ra),i($a),i(Rt),O(ts=>{ea=we(Rt,1,"dropdown-option",null,ea,ts),w(ja,(e(xt),x(()=>e(xt).icon))),w(Ba,(e(xt),x(()=>e(xt).name)))},[()=>({selected:e(A)===e(xt).id})]),Se("click",Rt,()=>I(e(xt))),m(Zt,Rt)}),i(We),i(ct),i(ge),O((Zt,xt)=>{Et=we(ct,1,"custom-dropdown",null,Et,Zt),Lt=we(Ct,1,"dropdown-trigger",null,Lt,xt)},[()=>({open:e(ie)}),()=>({selected:e(A)})]),Se("click",Ct,$),m(re,ge)};E(Ca,re=>{e(y)==="student"&&re(gt)})}i(Nt);var _t=u(Nt,2),de=o(_t),ee=u(o(de),2);ta(ee),i(de);var Q=u(de,2),Ye=u(o(Q),2);ta(Ye),i(Q);var Qe=u(Q,2),dt=u(o(Qe),2);ta(dt),i(Qe),i(_t);var yt=u(_t,2);{var zt=re=>{var ge=y0(),ct=u(o(ge),2),Et=o(ct);ta(Et);let Ct;var Lt=u(Et,2);{var ra=xt=>{var Rt=m0();m(xt,Rt)},Da=xt=>{var Rt=mt(),ea=tt(Rt);{var na=$a=>{var Ra=h0();m($a,Ra)},ja=$a=>{var Ra=mt(),Ba=tt(Ra);{var ts=_s=>{var Ga=g0();m(_s,Ga)};E(Ba,_s=>{e(M)&&_s(ts)},!0)}m($a,Ra)};E(ea,$a=>{e(S)&&!e(M)?$a(na):$a(ja,!1)},!0)}m(xt,Rt)};E(Lt,xt=>{e(F)?xt(ra):xt(Da,!1)})}i(ct);var Bt=u(ct,2);{var We=xt=>{var Rt=_0(),ea=o(Rt,!0);i(Rt),O(()=>w(ea,e(M))),m(xt,Rt)},Zt=xt=>{var Rt=mt(),ea=tt(Rt);{var na=ja=>{var $a=b0();m(ja,$a)};E(ea,ja=>{e(S)&&!e(F)&&ja(na)},!0)}m(xt,Rt)};E(Bt,xt=>{e(M)?xt(We):xt(Zt,!1)})}i(ge),O(xt=>Ct=we(Et,1,"form-input",null,Ct,xt),[()=>({error:e(M),valid:e(S)&&!e(M)&&!e(F)})]),ia(Et,()=>e(S),xt=>v(S,xt)),Se("input",Et,Ee),m(re,ge)};E(yt,re=>{(e(y)==="student"||e(y)==="teacher")&&re(zt)})}var ga=u(yt,2);{var bt=re=>{var ge=w0(),ct=u(o(ge),4),Et=o(ct),Ct=u(o(Et),2);ta(Ct),i(Et);var Lt=u(Et,2),ra=u(o(Lt),2);ta(ra),i(Lt),i(ct);var Da=u(ct,2),Bt=u(o(Da),2);kn(Bt),i(Da);var We=u(Da,2),Zt=o(We),xt=u(o(Zt),2);ta(xt),i(Zt);var Rt=u(Zt,2),ea=u(o(Rt),2);ta(ea),i(Rt),i(We),i(ge),O(na=>{Mt(Ct,"max",na),Ri(ra,e(X))},[()=>x(et)]),ia(Ct,()=>e(Y),na=>v(Y,na)),Se("blur",Ct,na=>{e(Y)&&!pe(e(Y))&&(Te.error("Invalid date. Please enter a valid date."),v(Y,""),na.target.value="")}),ia(Bt,()=>e(W),na=>v(W,na)),ia(xt,()=>e(N),na=>v(N,na)),ia(ea,()=>e(L),na=>v(L,na)),Se("input",ea,na=>Me(na,!1)),m(re,ge)};E(ga,re=>{e(y)==="student"&&re(bt)})}var Oe=u(ga,2),ft=o(Oe),$t=o(ft,!0);i(ft);var jt=u(ft,2),Kt=o(jt);{var oa=re=>{var ge=mt(),ct=tt(ge);{var Et=Lt=>{var ra=x0();m(Lt,ra)},Ct=Lt=>{var ra=mt(),Da=tt(ra);{var Bt=Zt=>{var xt=S0(),Rt=tt(xt),ea=o(Rt,!0);i(Rt),Ht(2),O(()=>w(ea,e(Pe))),m(Zt,xt)},We=Zt=>{var xt=k0();m(Zt,xt)};E(Da,Zt=>{e(Pe)?Zt(Bt):Zt(We,!1)},!0)}m(Lt,ra)};E(ct,Lt=>{e(Ve)?Lt(Et):Lt(Ct,!1)})}m(re,ge)},Jt=re=>{var ge=A0();m(re,ge)};E(Kt,re=>{e(y)?re(oa):re(Jt,!1)})}i(jt),Ht(2),i(Oe);var Ta=u(Oe,2),Aa=o(Ta);let ya;var ma=o(Aa);{var ha=re=>{var ge=ba("Creating Account...");m(re,ge)},Fa=re=>{var ge=D0();Ht(),m(re,ge)};E(ma,re=>{e(b)?re(ha):re(Fa,!1)})}i(Aa),i(Ta),i(Wt),i(At),i(St);var La=u(St,2),da=o(La),fa=o(da),K=u(o(fa),2),De=o(K),Ze=o(De),wt=u(o(Ze),2);ta(wt);var qt=u(wt,2);{var Tt=re=>{var ge=C0();Se("click",ge,Ue),m(re,ge)};E(qt,re=>{e(J)&&re(Tt)})}i(Ze),i(De);var kt=u(De,2),Ea=o(kt);let _a;var ua=o(Ea);let Sa;var Ut=o(ua);{var Xt=re=>{var ge=T0(),ct=o(ge),Et=o(ct,!0);i(ct);var Ct=u(ct,2),Lt=o(Ct),ra=o(Lt,!0);i(Lt),i(Ct),i(ge),O(()=>{w(Et,(e(h),x(()=>e(h).icon))),w(ra,(e(h),x(()=>e(h).name)))}),m(re,ge)},ka=re=>{var ge=E0();m(re,ge)};E(Ut,re=>{e(h)?re(Xt):re(ka,!1)})}Ht(2),i(ua);var wa=u(ua,2);Dt(wa,5,()=>B,re=>re.id,(re,ge)=>{var ct=F0();let Et;var Ct=o(ct),Lt=o(Ct,!0);i(Ct);var ra=u(Ct,2),Da=o(ra),Bt=o(Da,!0);i(Da),i(ra),i(ct),O(We=>{Et=we(ct,1,"account-filter-dropdown-option",null,Et,We),w(Lt,(e(ge),x(()=>e(ge).icon))),w(Bt,(e(ge),x(()=>e(ge).name)))},[()=>({selected:e(xe)===e(ge).id})]),Se("click",ct,()=>Be(e(ge))),m(re,ct)}),i(wa),i(Ea),i(kt),i(K),i(fa),i(da);var Na=u(da,2),pa=o(Na);{var xa=re=>{var ge=N0();m(re,ge)},Ia=re=>{var ge=mt(),ct=tt(ge);{var Et=Lt=>{var ra=P0(),Da=u(o(ra),2);{var Bt=Zt=>{var xt=$0();m(Zt,xt)},We=Zt=>{var xt=L0();m(Zt,xt)};E(Da,Zt=>{e(ut),x(()=>e(ut).length===0)?Zt(Bt):Zt(We,!1)})}i(ra),m(Lt,ra)},Ct=Lt=>{var ra=mt(),Da=tt(ra);Dt(Da,1,()=>e(g),Bt=>Bt.id,(Bt,We)=>{var Zt=W0(),xt=o(Zt),Rt=o(xt),ea=o(Rt),na=o(ea);i(ea),i(Rt);var ja=u(Rt,2),$a=o(ja),Ra=o($a),Ba=o(Ra),ts=o(Ba,!0);i(Ba),i(Ra),i($a);var _s=u($a,2);i(ja),i(xt);var Ga=u(xt,2),ss=o(Ga),Pa=o(ss),Ha=o(Pa,!0);i(Pa);var vs=u(Pa,2),es=o(vs,!0);i(vs),i(ss);var Za=u(ss,2),rs=u(o(Za),2),is=o(rs);i(rs),i(Za);var bs=u(Za,2);{var ys=fs=>{var ds=M0(),Cs=u(o(ds),2),Os=o(Cs,!0);i(Cs),i(ds),O(()=>w(Os,(e(We),x(()=>e(We).advisorySection||"No advisory section assigned")))),m(fs,ds)};E(bs,fs=>{e(We),x(()=>e(We).type==="Teacher")&&fs(ys)})}var As=u(bs,2);{var Ds=fs=>{var ds=I0(),Cs=u(o(ds),2),Os=o(Cs);i(Cs),i(ds),O(()=>w(Os,`Grade ${e(We),x(()=>e(We).gradeLevel)??""}`)),m(fs,ds)};E(As,fs=>{e(We),x(()=>e(We).type==="Student"&&e(We).gradeLevel)&&fs(Ds)})}var Us=u(As,2);{var ar=fs=>{var ds=R0(),Cs=u(o(ds),2),Os=o(Cs);i(Cs),i(ds),O(()=>w(Os,`Age: ${e(We),x(()=>e(We).age)??""}`)),m(fs,ds)};E(Us,fs=>{e(We),x(()=>e(We).type==="Student"&&e(We).age)&&fs(ar)})}var sr=u(Us,2);{var Gr=fs=>{var ds=O0(),Cs=u(o(ds),2),Os=o(Cs);i(Cs),i(ds),O(()=>w(Os,`Guardian: ${e(We),x(()=>e(We).guardian)??""}`)),m(fs,ds)};E(sr,fs=>{e(We),x(()=>e(We).type==="Student"&&e(We).guardian)&&fs(Gr)})}var pr=u(sr,2);{var gi=fs=>{var ds=j0(),Cs=u(o(ds),2),Os=o(Cs);i(Cs),i(ds),O(()=>w(Os,`Contact: ${e(We),x(()=>e(We).contactNumber)??""}`)),m(fs,ds)};E(pr,fs=>{e(We),x(()=>e(We).type==="Student"&&e(We).contactNumber)&&fs(gi)})}var _i=u(pr,2),si=u(o(_i),2),bi=o(si);i(si),i(_i);var Ki=u(_i,2),Ji=u(o(Ki),2),Xi=o(Ji);i(Ji),i(Ki),i(Ga);var Zi=u(Ga,2);{var Vn=fs=>{var ds=B0(),Cs=o(ds),Os=u(o(Cs),2),yi=o(Os),wi=o(yi),en=o(wi),Oa=u(en,2);ta(Oa),i(wi);var Va=u(wi,2),ws=o(Va),js=u(ws,2);ta(js),i(Va);var er=u(Va,2),rr=o(er),mr=u(rr,2);ta(mr),i(er),i(yi);var Nr=u(yi,2);{var xi=ms=>{var $r=V0(),Bn=tt($r),qo=o(Bn),Wn=u(qo,2);let zo;var ni=o(Wn);let Go;var xd=o(ni);{var Sd=hs=>{var Ys=q0(),vr=o(Ys),an=o(vr,!0);i(vr);var oi=u(vr,2),sn=o(oi),rn=o(sn,!0);i(sn),i(oi),i(Ys),O(()=>{w(an,(e(p),x(()=>e(p).icon))),w(rn,(e(p),x(()=>e(p).name)))}),m(hs,Ys)},kd=hs=>{var Ys=z0();m(hs,Ys)};E(xd,hs=>{e(p)?hs(Sd):hs(kd,!1)})}Ht(2),i(ni);var Vo=u(ni,2);Dt(Vo,5,()=>Ie,hs=>hs.id,(hs,Ys)=>{var vr=G0();let an;var oi=o(vr),sn=o(oi,!0);i(oi);var rn=u(oi,2),Zo=o(rn),Ad=o(Zo,!0);i(Zo),i(rn),i(vr),O(Dd=>{an=we(vr,1,"dropdown-option",null,an,Dd),w(sn,(e(Ys),x(()=>e(Ys).icon))),w(Ad,(e(Ys),x(()=>e(Ys).name)))},[()=>({selected:e(Re)===e(Ys).id})]),Se("click",vr,()=>fe(e(Ys))),m(hs,vr)}),i(Vo),i(Wn),i(Bn);var Bo=u(Bn,2),Hn=u(o(Bo),4),Un=o(Hn),Wo=o(Un),Si=u(Wo,2);ta(Si),i(Un);var Ho=u(Un,2),Uo=o(Ho),Yn=u(Uo,2);ta(Yn),i(Ho),i(Hn);var Qn=u(Hn,2),Yo=o(Qn),Kn=u(Yo,2);kn(Kn),i(Qn);var Qo=u(Qn,2),Jn=o(Qo),Ko=o(Jn),Xn=u(Ko,2);ta(Xn),i(Jn);var Jo=u(Jn,2),Xo=o(Jo),tn=u(Xo,2);ta(tn),i(Jo),i(Qo),i(Bo),O((hs,Ys,vr)=>{Mt(qo,"for",`edit-grade-level-${e(We),x(()=>e(We).id)??""}`),zo=we(Wn,1,"custom-dropdown",null,zo,hs),Go=we(ni,1,"dropdown-trigger",null,Go,Ys),Mt(ni,"id",`edit-grade-level-${e(We),x(()=>e(We).id)??""}`),Mt(Wo,"for",`edit-birthdate-${e(We),x(()=>e(We).id)??""}`),Mt(Si,"id",`edit-birthdate-${e(We),x(()=>e(We).id)??""}`),Mt(Si,"max",vr),Mt(Uo,"for",`edit-age-${e(We),x(()=>e(We).id)??""}`),Mt(Yn,"id",`edit-age-${e(We),x(()=>e(We).id)??""}`),Ri(Yn,e(He)),Mt(Yo,"for",`edit-address-${e(We),x(()=>e(We).id)??""}`),Mt(Kn,"id",`edit-address-${e(We),x(()=>e(We).id)??""}`),Mt(Ko,"for",`edit-guardian-${e(We),x(()=>e(We).id)??""}`),Mt(Xn,"id",`edit-guardian-${e(We),x(()=>e(We).id)??""}`),Mt(Xo,"for",`edit-contact-number-${e(We),x(()=>e(We).id)??""}`),Mt(tn,"id",`edit-contact-number-${e(We),x(()=>e(We).id)??""}`)},[()=>({open:e(Je)}),()=>({selected:e(Re)}),()=>x(et)]),Se("click",ni,H),ia(Si,()=>e(Le),hs=>v(Le,hs)),Se("blur",Si,hs=>{e(Le)&&!pe(e(Le))&&(Te.error("Invalid date. Please enter a valid date."),v(Le,""),hs.target.value="")}),ia(Kn,()=>e(ke),hs=>v(ke,hs)),ia(Xn,()=>e(Ke),hs=>v(Ke,hs)),ia(tn,()=>e(lt),hs=>v(lt,hs)),Se("input",tn,hs=>Me(hs,!0)),m(ms,$r)};E(Nr,ms=>{e(We),x(()=>e(We).type.toLowerCase()==="student")&&ms(xi)})}var Vr=u(Nr,2),ri=o(Vr),Br=o(ri);i(ri);var ii=u(ri,2);let jo;var bd=o(ii);{var yd=ms=>{var $r=ba("Updating...");m(ms,$r)},wd=ms=>{var $r=ba("Update Account");m(ms,$r)};E(bd,ms=>{e(it)?ms(yd):ms(wd,!1)})}i(ii),i(Vr),i(Os),i(Cs),i(ds),O((ms,$r)=>{Mt(en,"for",`edit-last-name-${e(We),x(()=>e(We).id)??""}`),Mt(Oa,"id",`edit-last-name-${e(We),x(()=>e(We).id)??""}`),Mt(ws,"for",`edit-first-name-${e(We),x(()=>e(We).id)??""}`),Mt(js,"id",`edit-first-name-${e(We),x(()=>e(We).id)??""}`),Mt(rr,"for",`edit-middle-initial-${e(We),x(()=>e(We).id)??""}`),Mt(mr,"id",`edit-middle-initial-${e(We),x(()=>e(We).id)??""}`),Mt(ri,"href",`#account-card-${e(We),x(()=>e(We).id)??""}`),jo=we(ii,1,"account-submit-button",null,jo,ms),ii.disabled=$r},[()=>({loading:e(it)}),()=>(e(it),e(Ge),e(ce),e(l),e(Le),e(ke),e(Ke),e(lt),x(()=>e(it)||!e(Ge)||!e(ce)||e(l)&&e(l).type.toLowerCase()==="student"&&(!e(Le)||!e(ke)||!e(Ke)||!e(lt))))]),ia(Oa,()=>e(ce),ms=>v(ce,ms)),Se("input",Oa,ms=>ne(ms,"lastName",!0)),ia(js,()=>e(Ge),ms=>v(Ge,ms)),Se("input",js,ms=>ne(ms,"firstName",!0)),ia(mr,()=>e(se),ms=>v(se,ms)),Se("input",mr,ms=>ne(ms,"middleInitial",!0)),Se("click",Br,()=>G(e(We))),Se("submit",Os,tr(z)),m(fs,ds)};E(Zi,fs=>{e(he),e(We),x(()=>e(he)===e(We).id)&&fs(Vn)})}i(Zt),O(()=>{Mt(Zt,"id",`account-card-${e(We),x(()=>e(We).id)??""}`),w(na,`${e(We),x(()=>e(We).name)??""}  ${e(We),x(()=>e(We).type)??""}`),Mt($a,"href",`#account-card-${e(We),x(()=>e(We).id)??""}`),Mt(Ra,"title",(e(he),e(We),x(()=>e(he)===e(We).id?"Cancel Edit":"Edit Account"))),w(ts,(e(he),e(We),x(()=>e(he)===e(We).id?"close":"edit"))),w(Ha,(e(We),x(()=>e(We).type==="Student"?"school":e(We).type==="Teacher"?"person":"admin_panel_settings"))),w(es,(e(We),x(()=>e(We).number))),w(is,`${e(We),x(()=>e(We).type)??""} Account`),w(bi,`Created: ${e(We),x(()=>e(We).createdDate)??""}`),w(Xi,`Updated: ${e(We),x(()=>e(We).updatedDate)??""}`)}),Se("click",Ra,()=>G(e(We))),Se("click",_s,()=>ue(e(We))),m(Bt,Zt)}),m(Lt,ra)};E(ct,Lt=>{e(g),x(()=>e(g).length===0)?Lt(Et):Lt(Ct,!1)},!0)}m(re,ge)};E(pa,re=>{e(me)?re(xa):re(Ia,!1)})}i(Na),i(La),i(vt),O((re,ge,ct,Et,Ct,Lt,ra)=>{Ot=we(Gt,1,"custom-dropdown",null,Ot,re),Qt=we(sa,1,"dropdown-trigger",null,Qt,ge),be=we(ot,1,"custom-dropdown",null,be,ct),rt=we(je,1,"dropdown-trigger",null,rt,Et),w($t,e(y)==="student"?"Student Number":e(y)==="teacher"?"Teacher Number":e(y)==="admin"?"Admin Number":"Account Number"),ya=we(Aa,1,"account-create-button",null,ya,Ct),Aa.disabled=e(b)||!e(y)||!e(k)||!e(D)||!e(T)||(e(y)==="student"||e(y)==="teacher")&&(!e(S)||e(M)||e(F))||e(y)==="student"&&(!e(Y)||!e(W)||!e(N)||!e(L)),_a=we(Ea,1,"account-filter-dropdown",null,_a,Lt),Sa=we(ua,1,"account-filter-trigger",null,Sa,ra)},[()=>({open:e(ae)}),()=>({selected:e(y)}),()=>({open:e(V)}),()=>({selected:e(k)}),()=>({loading:e(b)}),()=>({open:e($e)}),()=>({selected:e(xe)!=="all"})]),Se("click",sa,le),Se("click",je,q),ia(ee,()=>e(T),re=>v(T,re)),Se("input",ee,re=>ne(re,"lastName")),ia(Ye,()=>e(D),re=>v(D,re)),Se("input",Ye,re=>ne(re,"firstName")),ia(dt,()=>e(C),re=>v(C,re)),Se("input",dt,re=>ne(re,"middleInitial")),Se("submit",Wt,tr(ve)),ia(wt,()=>e(J),re=>v(J,re)),Se("click",ua,Ce),m(s,vt),za(),r()}function Y0(){const{subscribe:s,set:t,update:a}=Ws({students:[],sections:[],isLoading:!1,error:null,lastUpdated:null,isInitialized:!1});return{subscribe:s,init:r=>{r&&a(n=>({...n,students:r.students||[],sections:r.sections||[],isInitialized:!0,isLoading:!1}))},setLoading:r=>{a(n=>({...n,isLoading:r&&!n.isInitialized}))},updateStudents:r=>{a(n=>{const l={...n,students:r,isLoading:!1,error:null,lastUpdated:new Date,isInitialized:!0};try{localStorage.setItem("student-masterlist-cache",JSON.stringify({students:r,sections:n.sections,timestamp:Date.now()}))}catch(c){console.warn("Failed to cache student masterlist data:",c)}return l})},updateSections:r=>{a(n=>{const l={...n,sections:r};try{localStorage.setItem("student-masterlist-cache",JSON.stringify({students:n.students,sections:r,timestamp:Date.now()}))}catch(c){console.warn("Failed to cache sections data:",c)}return l})},setError:r=>{a(n=>({...n,error:r,isLoading:!1}))},getCachedData:()=>{try{const r=localStorage.getItem("student-masterlist-cache");if(r){const{students:n,sections:l,timestamp:c}=JSON.parse(r);if(Date.now()-c<300*1e3)return{students:n,sections:l}}}catch(r){console.warn("Failed to retrieve cached student masterlist data:",r)}return null},clearCache:()=>{try{localStorage.removeItem("student-masterlist-cache")}catch(r){console.warn("Failed to clear student masterlist cache:",r)}},refresh:async(r,n)=>{a(l=>({...l,isLoading:!0})),await Promise.all([r(),n()])}}}const Pr=Y0();var Q0=_('<button type="button" class="clear-search-button"><span class="material-symbols-outlined">close</span></button>'),K0=_('<div class="selected-option"><span class="material-symbols-outlined option-icon"> </span> <span class="option-name"> </span></div>'),J0=_('<span class="placeholder">All Grade Levels</span>'),X0=_('<button type="button"><span class="material-symbols-outlined option-icon"> </span> <div class="option-content"><span class="option-name"> </span></div></button>'),Z0=_('<div class="selected-option"><span class="option-name"> </span></div>'),ew=_('<span class="placeholder">All Sections</span>'),tw=_('<button type="button"><div class="option-content"><span class="option-name"> </span></div></button>'),aw=_('<button type="button" class="clear-filters-button"><span class="material-symbols-outlined">filter_alt_off</span></button>'),sw=_('<div class="masterlist-loading-container"><span class="student-loader"></span> <p class="masterlist-loading-text">Loading students...</p></div>'),rw=_('<div class="account-detail-item"><span class="material-symbols-outlined">email</span> <span> </span></div>'),iw=_('<div class="account-detail-item"><span class="material-symbols-outlined">school</span> <span> </span></div>'),nw=_('<div class="account-detail-item"><span class="material-symbols-outlined">class</span> <span> </span></div>'),ow=_('<div class="account-detail-item"><span class="material-symbols-outlined">cake</span> <span> </span></div>'),lw=_('<div class="account-detail-item"><span class="material-symbols-outlined">family_restroom</span> <span> </span></div>'),cw=_('<div class="account-detail-item"><span class="material-symbols-outlined">phone</span> <span> </span></div>'),dw=_('<div class="account-detail-item"><span class="material-symbols-outlined">home</span> <span> </span></div>'),uw=_('<div class="account-detail-item"><span class="material-symbols-outlined">calendar_today</span> <span> </span></div>'),vw=_('<div class="account-card"><div class="account-card-header"><div class="account-title"><h3 class="account-name"><!> </h3></div> <div class="action-buttons"><button type="button" class="archive-button" title="Archive Student"><span class="material-symbols-outlined">archive</span></button></div></div> <div class="master-account-details"><!> <!> <!> <!> <!> <!> <!> <!></div></div>'),fw=_('<div class="students-grid"></div>'),pw=_('<div class="no-results"><span class="material-symbols-outlined no-results-icon"> </span> <p><!></p></div>'),mw=_('<div class="student-masterlist-container"><div class="admin-student-header"><div class="header-content"><h1 class="page-title">Student Masterlist</h1> <p class="page-subtitle">View and manage all student records in the system</p></div></div> <div class="filters-section"><div class="studmaster-search-filter-container"><div class="search-container"><div class="search-input-wrapper"><span class="material-symbols-outlined search-icon">search</span> <input type="text" class="search-input" placeholder="Search students by name, email, or ID..."/> <!></div></div> <div class="studmaster-filter-container"><div class="filter-group"><label class="filter-label" for="grade-level-dropdown">Grade Level</label> <div><button type="button" id="grade-level-dropdown" class="dropdown-trigger filter-trigger"><!> <span class="material-symbols-outlined dropdown-arrow">expand_more</span></button> <div class="dropdown-menu"></div></div></div> <div class="filter-group"><label class="filter-label" for="section-dropdown">Section</label> <div><button type="button" id="section-dropdown" class="dropdown-trigger filter-trigger"><!> <span class="material-symbols-outlined dropdown-arrow">expand_more</span></button> <div class="dropdown-menu"></div></div></div> <!></div></div></div> <div class="students-list-section"><!></div></div>');function hw(s,t){qa(t,!1);const[a,r]=xs(),n=()=>Ja(Pr,"$studentMasterlistStore",a),l=R(),c=R(),d=R(),f=R(),p=R(),h=R();let g=R([]),b=R(""),y=R(""),k=R(""),A=R(!1),D=R(!1);const T=[{id:"",name:"All Grade Levels",icon:"school"},{id:"7",name:"Grade 7",icon:"looks_one"},{id:"8",name:"Grade 8",icon:"looks_two"},{id:"9",name:"Grade 9",icon:"looks_3"},{id:"10",name:"Grade 10",icon:"looks_4"}];async function C(B=!1){try{B||Pr.setLoading(!0);const te=await la.get("/api/accounts?type=student");if(!te.success)throw new Error("Failed to load students");const ue=te.accounts.map(G=>({id:G.id,name:G.name,number:G.number,email:G.email,gradeLevel:G.gradeLevel||"Not specified",section:G.section||"Not specified",birthdate:G.birthdate||"Not specified",address:G.address||"Not specified",guardian:G.guardian||"Not specified",contactNumber:G.contactNumber||"Not specified",status:G.status||"active"}));Pr.updateStudents(ue)}catch(te){console.error("Error loading students:",te),Pr.setError(te.message),B||Te.error("Failed to load students. Please try again.")}}async function S(){try{const B=await la.get("/api/sections");if(B.success&&B.data){const te=B.data.map(G=>({id:G.name,name:G.name})),ue=[{id:"",name:"All Sections"},...te];Pr.updateSections(ue)}}catch(B){console.error("Error loading sections:",B),Pr.updateSections([{id:"",name:"All Sections"}])}}function M(){v(g,e(l).filter(B=>{const te=!e(b)||B.name.toLowerCase().includes(e(b).toLowerCase())||B.email.toLowerCase().includes(e(b).toLowerCase())||B.number&&B.number.toLowerCase().includes(e(b).toLowerCase()),ue=!e(y)||B.gradeLevel===e(y),G=!e(k)||B.section===e(k);return te&&ue&&G}))}function F(){v(A,!e(A)),v(D,!1)}function j(){v(D,!e(D)),v(A,!1)}function P(B){v(y,B.id),v(A,!1),M()}function Y(B){v(k,B.id),v(D,!1),M()}function W(B){if(!B)return"N/A";const te=new Date,ue=new Date(B);let G=te.getFullYear()-ue.getFullYear();const z=te.getMonth()-ue.getMonth();return(z<0||z===0&&te.getDate()<ue.getDate())&&G--,G}function N(B){return B?new Date(B).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"N/A"}function L(){v(b,""),v(y,""),v(k,""),M()}function X(B){B.target.closest(".custom-dropdown")||(v(A,!1),v(D,!1))}async function ae(B,te){cs.confirm("Archive Student",`Are you sure you want to archive ${te}? This action will move the student to the archived list.`,async()=>{try{const ue=await la.patch("/api/accounts",{id:B,action:"archive"});ue.success?(Te.success(ue.message),await C()):Te.error(ue.message||"Failed to archive student")}catch(ue){console.error("Error archiving student:",ue),Te.error("Failed to archive student. Please try again.")}},()=>{},{variant:"danger"})}Ya(()=>{const B=Pr.getCachedData();B&&Pr.init(B),S(),C(!!B);const te=setInterval(()=>{C(!0)},3e4);return document.addEventListener("click",X),()=>{clearInterval(te),document.removeEventListener("click",X)}}),ht(()=>(e(l),e(c),e(d),e(f),n()),()=>{(B=>{v(l,B.students),v(c,B.sections),v(d,B.isLoading),v(f,B.error)})(n())}),ht(()=>e(y),()=>{v(p,T.find(B=>B.id===e(y)))}),ht(()=>(e(c),e(k)),()=>{v(h,e(c).find(B=>B.id===e(k)))}),ht(()=>e(l),()=>{e(l)&&M()}),ht(()=>e(b),()=>{e(b)!==void 0&&M()}),Ms(),Fs();var V=mw(),ie=u(o(V),2),he=o(ie),Ge=o(he),ce=o(Ge),se=u(o(ce),2);ta(se);var Re=u(se,2);{var Je=B=>{var te=Q0();Se("click",te,()=>v(b,"")),m(B,te)};E(Re,B=>{e(b)&&B(Je)})}i(ce),i(Ge);var it=u(Ge,2),Le=o(it),ke=u(o(Le),2);let Ke;var lt=o(ke),He=o(lt);{var et=B=>{var te=K0(),ue=o(te),G=o(ue,!0);i(ue);var z=u(ue,2),le=o(z,!0);i(z),i(te),O(()=>{w(G,(e(p),x(()=>e(p).icon))),w(le,(e(p),x(()=>e(p).name)))}),m(B,te)},Ne=B=>{var te=J0();m(B,te)};E(He,B=>{e(p)&&e(y)?B(et):B(Ne,!1)})}Ht(2),i(lt);var ne=u(lt,2);Dt(ne,5,()=>T,B=>B.id,(B,te)=>{var ue=X0();let G;var z=o(ue),le=o(z,!0);i(z);var Z=u(z,2),q=o(Z),U=o(q,!0);i(q),i(Z),i(ue),O($=>{G=we(ue,1,"dropdown-option",null,G,$),w(le,(e(te),x(()=>e(te).icon))),w(U,(e(te),x(()=>e(te).name)))},[()=>({selected:e(y)===e(te).id})]),Se("click",ue,()=>P(e(te))),m(B,ue)}),i(ne),i(ke),i(Le);var oe=u(Le,2),_e=u(o(oe),2);let Me;var ze=o(_e),Ee=o(ze);{var pe=B=>{var te=Z0(),ue=o(te),G=o(ue,!0);i(ue),i(te),O(()=>w(G,(e(h),x(()=>e(h).name)))),m(B,te)},qe=B=>{var te=ew();m(B,te)};E(Ee,B=>{e(h)&&e(k)?B(pe):B(qe,!1)})}Ht(2),i(ze);var Ae=u(ze,2);Dt(Ae,5,()=>e(c),B=>B.id,(B,te)=>{var ue=tw();let G;var z=o(ue),le=o(z),Z=o(le,!0);i(le),i(z),i(ue),O(q=>{G=we(ue,1,"dropdown-option",null,G,q),w(Z,(e(te),x(()=>e(te).name)))},[()=>({selected:e(k)===e(te).id})]),Se("click",ue,()=>Y(e(te))),m(B,ue)}),i(Ae),i(_e),i(oe);var Ie=u(oe,2);{var ut=B=>{var te=aw();Se("click",te,L),m(B,te)};E(Ie,B=>{(e(b)||e(y)||e(k))&&B(ut)})}i(it),i(he),i(ie);var me=u(ie,2),J=o(me);{var xe=B=>{var te=sw();m(B,te)},$e=B=>{var te=mt(),ue=tt(te);{var G=le=>{var Z=fw();Dt(Z,5,()=>e(g),q=>q.id,(q,U)=>{var $=vw(),I=o($),H=o(I),fe=o(H),ve=o(fe);{var Fe=ye=>{var Xe=ba();O(()=>w(Xe,(e(U),x(()=>e(U).number)))),m(ye,Xe)};E(ve,ye=>{e(U),x(()=>e(U).number)&&ye(Fe)})}var Ce=u(ve);i(fe),i(H);var Be=u(H,2),Ue=o(Be);i(Be),i(I);var Pe=u(I,2),Ve=o(Pe);{var st=ye=>{var Xe=rw(),ot=u(o(Xe),2),be=o(ot,!0);i(ot),i(Xe),O(()=>w(be,(e(U),x(()=>e(U).email)))),m(ye,Xe)};E(Ve,ye=>{e(U),x(()=>e(U).email)&&ye(st)})}var nt=u(Ve,2);{var vt=ye=>{var Xe=iw(),ot=u(o(Xe),2),be=o(ot,!0);i(ot),i(Xe),O(je=>w(be,je),[()=>(e(U),x(()=>T.find(je=>je.id===e(U).gradeLevel)?.name||e(U).gradeLevel))]),m(ye,Xe)};E(nt,ye=>{e(U),x(()=>e(U).gradeLevel&&e(U).gradeLevel!=="Not specified")&&ye(vt)})}var St=u(nt,2);{var At=ye=>{var Xe=nw(),ot=u(o(Xe),2),be=o(ot);i(ot),i(Xe),O(je=>w(be,`Section: ${je??""}`),[()=>(e(c),e(U),x(()=>e(c).find(je=>je.id===e(U).section)?.name||e(U).section))]),m(ye,Xe)};E(St,ye=>{e(U),x(()=>e(U).section&&e(U).section!=="Not specified")&&ye(At)})}var Wt=u(St,2);{var Nt=ye=>{var Xe=ow(),ot=u(o(Xe),2),be=o(ot);i(ot),i(Xe),O(je=>w(be,`Age: ${je??""} years old`),[()=>(e(U),x(()=>W(e(U).birthdate)))]),m(ye,Xe)};E(Wt,ye=>{e(U),x(()=>e(U).birthdate&&e(U).birthdate!=="Not specified")&&ye(Nt)})}var It=u(Wt,2);{var Gt=ye=>{var Xe=lw(),ot=u(o(Xe),2),be=o(ot);i(ot),i(Xe),O(()=>w(be,`Guardian: ${e(U),x(()=>e(U).guardian)??""}`)),m(ye,Xe)};E(It,ye=>{e(U),x(()=>e(U).guardian&&e(U).guardian!=="Not specified")&&ye(Gt)})}var Ot=u(It,2);{var sa=ye=>{var Xe=cw(),ot=u(o(Xe),2),be=o(ot);i(ot),i(Xe),O(()=>w(be,`Contact: ${e(U),x(()=>e(U).contactNumber)??""}`)),m(ye,Xe)};E(Ot,ye=>{e(U),x(()=>e(U).contactNumber&&e(U).contactNumber!=="Not specified")&&ye(sa)})}var Qt=u(Ot,2);{var Pt=ye=>{var Xe=dw(),ot=u(o(Xe),2),be=o(ot);i(ot),i(Xe),O(()=>w(be,`Address: ${e(U),x(()=>e(U).address)??""}`)),m(ye,Xe)};E(Qt,ye=>{e(U),x(()=>e(U).address&&e(U).address!=="Not specified")&&ye(Pt)})}var Yt=u(Qt,2);{var ca=ye=>{var Xe=uw(),ot=u(o(Xe),2),be=o(ot);i(ot),i(Xe),O(je=>w(be,`Birthdate: ${je??""}`),[()=>(e(U),x(()=>N(e(U).birthdate)))]),m(ye,Xe)};E(Yt,ye=>{e(U),x(()=>e(U).birthdate&&e(U).birthdate!=="Not specified")&&ye(ca)})}i(Pe),i($),O(()=>w(Ce,`  ${e(U),x(()=>e(U).name)??""}`)),Se("click",Ue,()=>ae(e(U).id,e(U).name)),m(q,$)}),i(Z),m(le,Z)},z=le=>{var Z=pw(),q=o(Z),U=o(q,!0);i(q);var $=u(q,2),I=o($);{var H=ve=>{var Fe=ba("No students found matching your search criteria.");m(ve,Fe)},fe=ve=>{var Fe=ba("No students found in the system.");m(ve,Fe)};E(I,ve=>{e(b)||e(y)||e(k)?ve(H):ve(fe,!1)})}i($),i(Z),O(()=>w(U,e(b)||e(y)||e(k)?"search_off":"school")),m(le,Z)};E(ue,le=>{e(g),x(()=>e(g).length>0)?le(G):le(z,!1)},!0)}m(B,te)};E(J,B=>{e(d)?B(xe):B($e,!1)})}i(me),i(V),O((B,te)=>{Ke=we(ke,1,"custom-dropdown",null,Ke,B),Me=we(_e,1,"custom-dropdown",null,Me,te)},[()=>({open:e(A)}),()=>({open:e(D)})]),ia(se,()=>e(b),B=>v(b,B)),Se("click",lt,F),Se("click",ze,j),m(s,V),za(),r()}function gw(){const{subscribe:s,set:t,update:a}=Ws({teachers:[],departments:[],isLoading:!1,error:null,lastUpdated:null,isInitialized:!1});return{subscribe:s,init:r=>{r&&a(n=>({...n,teachers:r.teachers||[],departments:r.departments||[],isInitialized:!0,isLoading:!1}))},setLoading:r=>{a(n=>({...n,isLoading:r&&!n.isInitialized}))},updateTeachers:r=>{a(n=>{const l={...n,teachers:r,isLoading:!1,error:null,lastUpdated:new Date,isInitialized:!0};try{localStorage.setItem("teacher-masterlist-cache",JSON.stringify({teachers:r,departments:n.departments,timestamp:Date.now()}))}catch(c){console.warn("Failed to cache teacher masterlist data:",c)}return l})},updateDepartments:r=>{a(n=>{const l={...n,departments:r};try{localStorage.setItem("teacher-masterlist-cache",JSON.stringify({teachers:n.teachers,departments:r,timestamp:Date.now()}))}catch(c){console.warn("Failed to cache departments data:",c)}return l})},setError:r=>{a(n=>({...n,error:r,isLoading:!1}))},getCachedData:()=>{try{const r=localStorage.getItem("teacher-masterlist-cache");if(r){const{teachers:n,departments:l,timestamp:c}=JSON.parse(r);if(Date.now()-c<300*1e3)return{teachers:n,departments:l}}}catch(r){console.warn("Failed to retrieve cached teacher masterlist data:",r)}return null},clearCache:()=>{try{localStorage.removeItem("teacher-masterlist-cache")}catch(r){console.warn("Failed to clear teacher masterlist cache:",r)}},refresh:async(r,n)=>{a(l=>({...l,isLoading:!0})),await Promise.all([r(),n()])}}}const _r=gw();var _w=_('<button type="button" class="clear-search-button"><span class="material-symbols-outlined">close</span></button>'),bw=_('<div class="selected-option"><span class="option-name"> </span></div>'),yw=_('<span class="placeholder">All Departments</span>'),ww=_('<button type="button"><div class="option-content"><span class="option-name"> </span></div></button>'),xw=_('<button type="button" class="clear-filters-button"><span class="material-symbols-outlined">filter_alt_off</span></button>'),Sw=_('<div class="masterlist-loading-container"><span class="teacher-loader"></span> <p class="masterlist-loading-text">Loading teachers...</p></div>'),kw=_('<div class="account-detail-item"><span class="material-symbols-outlined">email</span> <span> </span></div>'),Aw=_('<div class="account-detail-item"><span class="material-symbols-outlined">corporate_fare</span> <span> </span></div>'),Dw=_('<div class="account-detail-item"><span class="material-symbols-outlined">menu_book</span> <span> </span></div>'),Cw=_('<div class="account-detail-item"><span class="material-symbols-outlined">cake</span> <span> </span></div>'),Tw=_('<div class="account-detail-item"><span class="material-symbols-outlined">phone</span> <span> </span></div>'),Ew=_('<div class="account-detail-item"><span class="material-symbols-outlined">home</span> <span> </span></div>'),Fw=_('<div class="account-detail-item"><span class="material-symbols-outlined">calendar_today</span> <span> </span></div>'),Nw=_('<div class="account-card"><div class="account-card-header"><div class="account-title"><h3 class="account-name"><!> </h3></div> <div class="action-buttons"><button type="button" class="archive-button" title="Archive Teacher"><span class="material-symbols-outlined">archive</span></button></div></div> <div class="master-account-details"><!> <!> <!> <!> <!> <!> <!></div></div>'),$w=_('<div class="teachers-grid"></div>'),Lw=_('<div class="no-results"><span class="material-symbols-outlined no-results-icon"> </span> <p><!></p></div>'),Pw=_('<div class="teacher-masterlist-container"><div class="admin-teacher-header"><div class="header-content"><h1 class="page-title">Teacher Masterlist</h1> <p class="page-subtitle">View and manage all teacher records in the system</p></div></div> <div class="filters-section"><div class="teachmaster-search-filter-container"><div class="search-container"><div class="search-input-wrapper"><span class="material-symbols-outlined search-icon">search</span> <input type="text" class="search-input" placeholder="Search teachers by name, email, or ID..."/> <!></div></div> <div class="teachmaster-filter-container"><div class="filter-group"><label class="filter-label" for="department-dropdown">Department</label> <div><button type="button" id="department-dropdown" class="dropdown-trigger filter-trigger"><!> <span class="material-symbols-outlined dropdown-arrow">expand_more</span></button> <div class="dropdown-menu"></div></div></div> <!></div></div></div> <div class="teachers-list-section"><!></div></div>');function Mw(s,t){qa(t,!1);const[a,r]=xs(),n=()=>Ja(_r,"$teacherMasterlistStore",a),l=R(),c=R(),d=R(),f=R(),p=R();let h=R([]),g=R(""),b=R(""),y=R(!1);async function k(oe=!1){try{oe||_r.setLoading(!0);const _e=await la.get("/api/accounts?type=teacher");if(console.log("Teacher data received:",_e),!_e.success)throw new Error("Failed to load teachers");const Me=_e.accounts.map(ze=>({id:ze.id,name:ze.name,number:ze.number,email:ze.email,department:ze.department||"Not specified",birthdate:ze.birthdate||"Not specified",address:ze.address||"Not specified",contactNumber:ze.contactNumber||"Not specified",status:ze.status||"active",subjects:ze.subjects||[]}));console.log("Transformed teachers:",Me),_r.updateTeachers(Me)}catch(_e){console.error("Error loading teachers:",_e),_r.setError(_e.message),oe||Te.error("Failed to load teachers. Please try again.")}}async function A(){try{const oe=await la.get("/api/departments");if(oe.success&&oe.data){const _e=oe.data.map(ze=>({id:ze.name,name:ze.name})),Me=[{id:"",name:"All Departments"},..._e];_r.updateDepartments(Me)}}catch(oe){console.error("Error loading departments:",oe),_r.updateDepartments([{id:"",name:"All Departments"}])}}function D(){v(h,e(l).filter(oe=>{const _e=!e(g)||oe.name.toLowerCase().includes(e(g).toLowerCase())||oe.email.toLowerCase().includes(e(g).toLowerCase())||oe.number&&oe.number.toLowerCase().includes(e(g).toLowerCase()),Me=!e(b)||oe.department===e(b);return _e&&Me})),console.log("Filtered teachers:",e(h).length,"out of",e(l).length)}function T(){v(y,!e(y))}function C(oe){v(b,oe.id),v(y,!1),D()}function S(oe){if(!oe)return"N/A";const _e=new Date,Me=new Date(oe);let ze=_e.getFullYear()-Me.getFullYear();const Ee=_e.getMonth()-Me.getMonth();return(Ee<0||Ee===0&&_e.getDate()<Me.getDate())&&ze--,ze}function M(oe){return oe?new Date(oe).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"N/A"}function F(){v(g,""),v(b,""),D()}function j(oe){oe.target.closest(".custom-dropdown")||v(y,!1)}async function P(oe,_e){cs.confirm("Archive Teacher",`Are you sure you want to archive ${_e}? This action will move the teacher to the archived list.`,async()=>{try{const Me=await la.patch("/api/accounts",{id:oe,action:"archive"});Me.success?(Te.success(Me.message),await k()):Te.error(Me.message||"Failed to archive teacher")}catch(Me){console.error("Error archiving teacher:",Me),Te.error("Failed to archive teacher. Please try again.")}},()=>{},{variant:"danger"})}Ya(()=>{const oe=_r.getCachedData();oe&&_r.init(oe),A(),k(!!oe);const _e=setInterval(()=>{k(!0)},3e4);return document.addEventListener("click",j),()=>{clearInterval(_e),document.removeEventListener("click",j)}}),ht(()=>(e(l),e(c),e(d),e(f),n()),()=>{(oe=>{v(l,oe.teachers),v(c,oe.departments),v(d,oe.isLoading),v(f,oe.error)})(n())}),ht(()=>(e(c),_r),()=>{(!e(c)||e(c).length===0)&&_r.updateDepartments([{id:"",name:"All Departments"}])}),ht(()=>(e(c),e(b)),()=>{v(p,e(c).find(oe=>oe.id===e(b)))}),ht(()=>e(l),()=>{e(l)&&D()}),ht(()=>e(g),()=>{e(g)!==void 0&&D()}),Ms(),Fs();var Y=Pw(),W=u(o(Y),2),N=o(W),L=o(N),X=o(L),ae=u(o(X),2);ta(ae);var V=u(ae,2);{var ie=oe=>{var _e=_w();Se("click",_e,()=>v(g,"")),m(oe,_e)};E(V,oe=>{e(g)&&oe(ie)})}i(X),i(L);var he=u(L,2),Ge=o(he),ce=u(o(Ge),2);let se;var Re=o(ce),Je=o(Re);{var it=oe=>{var _e=bw(),Me=o(_e),ze=o(Me,!0);i(Me),i(_e),O(()=>w(ze,(e(p),x(()=>e(p).name)))),m(oe,_e)},Le=oe=>{var _e=yw();m(oe,_e)};E(Je,oe=>{e(p)&&e(b)?oe(it):oe(Le,!1)})}Ht(2),i(Re);var ke=u(Re,2);Dt(ke,5,()=>e(c),oe=>oe.id,(oe,_e)=>{var Me=ww();let ze;var Ee=o(Me),pe=o(Ee),qe=o(pe,!0);i(pe),i(Ee),i(Me),O(Ae=>{ze=we(Me,1,"dropdown-option",null,ze,Ae),w(qe,(e(_e),x(()=>e(_e).name)))},[()=>({selected:e(b)===e(_e).id})]),Se("click",Me,()=>C(e(_e))),m(oe,Me)}),i(ke),i(ce),i(Ge);var Ke=u(Ge,2);{var lt=oe=>{var _e=xw();Se("click",_e,F),m(oe,_e)};E(Ke,oe=>{(e(g)||e(b))&&oe(lt)})}i(he),i(N),i(W);var He=u(W,2),et=o(He);{var Ne=oe=>{var _e=Sw();m(oe,_e)},ne=oe=>{var _e=mt(),Me=tt(_e);{var ze=pe=>{var qe=$w();Dt(qe,5,()=>e(h),Ae=>Ae.id,(Ae,Ie)=>{var ut=Nw(),me=o(ut),J=o(me),xe=o(J),$e=o(xe);{var B=Ve=>{var st=ba();O(()=>w(st,`${e(Ie),x(()=>e(Ie).number)??""} `)),m(Ve,st)};E($e,Ve=>{e(Ie),x(()=>e(Ie).number)&&Ve(B)})}var te=u($e);i(xe),i(J);var ue=u(J,2),G=o(ue);i(ue),i(me);var z=u(me,2),le=o(z);{var Z=Ve=>{var st=kw(),nt=u(o(st),2),vt=o(nt,!0);i(nt),i(st),O(()=>w(vt,(e(Ie),x(()=>e(Ie).email)))),m(Ve,st)};E(le,Ve=>{e(Ie),x(()=>e(Ie).email)&&Ve(Z)})}var q=u(le,2);{var U=Ve=>{var st=Aw(),nt=u(o(st),2),vt=o(nt,!0);i(nt),i(st),O(()=>w(vt,(e(Ie),x(()=>e(Ie).department)))),m(Ve,st)};E(q,Ve=>{e(Ie),x(()=>e(Ie).department&&e(Ie).department!=="Not specified")&&Ve(U)})}var $=u(q,2);{var I=Ve=>{var st=Dw(),nt=u(o(st),2),vt=o(nt);i(nt),i(st),O(St=>w(vt,`Subjects: ${St??""}`),[()=>(e(Ie),x(()=>e(Ie).subjects.join(", ")))]),m(Ve,st)};E($,Ve=>{e(Ie),x(()=>e(Ie).subjects&&e(Ie).subjects.length>0)&&Ve(I)})}var H=u($,2);{var fe=Ve=>{var st=Cw(),nt=u(o(st),2),vt=o(nt);i(nt),i(st),O(St=>w(vt,`Age: ${St??""} years old`),[()=>(e(Ie),x(()=>S(e(Ie).birthdate)))]),m(Ve,st)};E(H,Ve=>{e(Ie),x(()=>e(Ie).birthdate&&e(Ie).birthdate!=="Not specified")&&Ve(fe)})}var ve=u(H,2);{var Fe=Ve=>{var st=Tw(),nt=u(o(st),2),vt=o(nt);i(nt),i(st),O(()=>w(vt,`Contact: ${e(Ie),x(()=>e(Ie).contactNumber)??""}`)),m(Ve,st)};E(ve,Ve=>{e(Ie),x(()=>e(Ie).contactNumber&&e(Ie).contactNumber!=="Not specified")&&Ve(Fe)})}var Ce=u(ve,2);{var Be=Ve=>{var st=Ew(),nt=u(o(st),2),vt=o(nt);i(nt),i(st),O(()=>w(vt,`Address: ${e(Ie),x(()=>e(Ie).address)??""}`)),m(Ve,st)};E(Ce,Ve=>{e(Ie),x(()=>e(Ie).address&&e(Ie).address!=="Not specified")&&Ve(Be)})}var Ue=u(Ce,2);{var Pe=Ve=>{var st=Fw(),nt=u(o(st),2),vt=o(nt);i(nt),i(st),O(St=>w(vt,`Birthdate: ${St??""}`),[()=>(e(Ie),x(()=>M(e(Ie).birthdate)))]),m(Ve,st)};E(Ue,Ve=>{e(Ie),x(()=>e(Ie).birthdate&&e(Ie).birthdate!=="Not specified")&&Ve(Pe)})}i(z),i(ut),O(()=>w(te,` ${e(Ie),x(()=>e(Ie).name)??""}`)),Se("click",G,()=>P(e(Ie).id,e(Ie).name)),m(Ae,ut)}),i(qe),m(pe,qe)},Ee=pe=>{var qe=Lw(),Ae=o(qe),Ie=o(Ae,!0);i(Ae);var ut=u(Ae,2),me=o(ut);{var J=$e=>{var B=ba("No teachers found matching your search criteria.");m($e,B)},xe=$e=>{var B=ba("No teachers found in the system.");m($e,B)};E(me,$e=>{e(g)||e(b)?$e(J):$e(xe,!1)})}i(ut),i(qe),O(()=>w(Ie,e(g)||e(b)?"search_off":"school")),m(pe,qe)};E(Me,pe=>{e(h),x(()=>e(h).length>0)?pe(ze):pe(Ee,!1)},!0)}m(oe,_e)};E(et,oe=>{e(d)?oe(Ne):oe(ne,!1)})}i(He),i(Y),O(oe=>se=we(ce,1,"custom-dropdown",null,se,oe),[()=>({open:e(y)})]),ia(ae,()=>e(g),oe=>v(g,oe)),Se("click",Re,T),m(s,Y),za(),r()}var Iw=_('<button type="button" class="clear-search-button"><span class="material-symbols-outlined">close</span></button>'),Rw=_('<div class="aas-selected-option"><span class="material-symbols-outlined aas-option-icon"> </span> <span class="aas-option-name"> </span></div>'),Ow=_('<span class="aas-placeholder">All Accounts</span>'),jw=_('<button type="button"><span class="material-symbols-outlined aas-option-icon"> </span> <div class="aas-option-content"><span class="aas-option-name"> </span></div></button>'),qw=_('<div class="aas-selected-option"><span class="material-symbols-outlined aas-option-icon"> </span> <span class="aas-option-name"> </span></div>'),zw=_('<span class="aas-placeholder">All Grade Levels</span>'),Gw=_('<button type="button"><span class="material-symbols-outlined aas-option-icon"> </span> <div class="aas-option-content"><span class="aas-option-name"> </span></div></button>'),Vw=_('<button type="button" class="clear-filters-button"><span class="material-symbols-outlined">filter_alt_off</span></button>'),Bw=_('<div class="aas-loading-container"><span class="aas-student-loader"></span> <p class="aas-loading-text">Loading archived accounts...</p></div>'),Ww=_('<div class="aas-account-detail-item"><span class="material-symbols-outlined">email</span> <span> </span></div>'),Hw=_('<div class="aas-account-detail-item"><span class="material-symbols-outlined">school</span> <span> </span></div>'),Uw=_('<div class="aas-account-detail-item"><span class="material-symbols-outlined">family_restroom</span> <span> </span></div>'),Yw=_("<!> <!>",1),Qw=_('<div class="aas-account-detail-item"><span class="material-symbols-outlined">corporate_fare</span> <span> </span></div>'),Kw=_('<div class="aas-account-detail-item"><span class="material-symbols-outlined">cake</span> <span> </span></div>'),Jw=_('<div class="aas-account-detail-item"><span class="material-symbols-outlined">phone</span> <span> </span></div>'),Xw=_('<div class="aas-account-detail-item"><span class="material-symbols-outlined">home</span> <span> </span></div>'),Zw=_('<div class="aas-account-detail-item"><span class="material-symbols-outlined">calendar_today</span> <span> </span></div>'),ex=_('<div class="aas-account-card"><div class="aas-account-card-header"><div class="aas-account-title"><h3 class="aas-account-name"><!> </h3> <div class="aas-archived-badge"><span class="material-symbols-outlined">archive</span> <span> </span></div></div> <div class="aas-action-buttons"><button type="button" class="aas-restore-button"><span class="material-symbols-outlined">unarchive</span></button></div></div> <div class="aas-account-details"><div class="aas-account-detail-item"><span class="material-symbols-outlined"> </span> <span class="account-type-badge"> </span></div> <!> <!> <!> <!> <!> <!> <!></div></div>'),tx=_('<div class="aas-students-grid"></div>'),ax=_('<button type="button" class="aas-clear-search-button-inline">Clear</button>'),sx=_('<div class="aas-no-results"><span class="material-symbols-outlined aas-no-results-icon"> </span> <p><!></p> <!></div>'),rx=_('<div class="aas-archived-students-container"><div class="aas-admin-student-header"><div class="aas-header-content"><h1 class="aas-page-title">Archived Accounts</h1> <p class="aas-page-subtitle">View and manage archived student and teacher records</p></div></div> <div class="filters-section"><div class="studmaster-search-filter-container"><div class="search-container"><div class="search-input-wrapper"><span class="material-symbols-outlined search-icon">search</span> <input type="text" class="search-input" placeholder="Search archived accounts by name, email, or ID..."/> <!></div></div> <div class="studmaster-filter-container"><div class="filter-group"><label class="filter-label" for="archived-account-type-dropdown">Account Type</label> <div><button type="button" id="archived-account-type-dropdown" class="aas-dropdown-trigger aas-filter-trigger"><!> <span class="material-symbols-outlined aas-dropdown-arrow">expand_more</span></button> <div class="aas-dropdown-menu"></div></div></div> <div class="filter-group"><label class="filter-label" for="archived-grade-level-dropdown">Grade Level</label> <div><button type="button" id="archived-grade-level-dropdown" class="aas-dropdown-trigger aas-filter-trigger"><!> <span class="material-symbols-outlined aas-dropdown-arrow">expand_more</span></button> <div class="aas-dropdown-menu"></div></div></div> <!></div></div></div> <div class="aas-students-list-section"><!></div></div>');function ix(s,t){qa(t,!1);const a=R(),r=R();let n=[],l=R([]),c=R(!0),d=R(""),f=R(""),p=R(""),h=R(!1),g=R(!1);const b=[{id:"",name:"All Accounts",icon:"group"},{id:"student",name:"Students",icon:"school"},{id:"teacher",name:"Teachers",icon:"person"}],y=[{id:"",name:"All Grade Levels",icon:"school"},{id:"7",name:"Grade 7",icon:"looks_one"},{id:"8",name:"Grade 8",icon:"looks_two"},{id:"9",name:"Grade 9",icon:"looks_3"},{id:"10",name:"Grade 10",icon:"looks_4"}];async function k(){v(c,!0);try{const me=await la.get("/api/archived-accounts");if(!me.accounts)throw new Error("No accounts data received");n=me.accounts.map(J=>({id:J.id,name:J.name,number:J.number,email:J.email,accountType:J.accountType,gradeLevel:J.gradeLevel||"Not specified",department:J.department||"Not specified",birthdate:J.birthdate||"Not specified",address:J.address||"Not specified",guardian:J.guardian||"Not specified",contactNumber:J.contactNumber||"Not specified",archivedDate:J.archivedDate||"Not specified"})),A()}catch(me){console.error("Error loading archived accounts:",me),Te.error("Failed to load archived accounts. Please try again."),n=[]}finally{v(c,!1)}}function A(){v(l,n.filter(me=>{const J=!e(d)||me.name.toLowerCase().includes(e(d).toLowerCase())||me.email.toLowerCase().includes(e(d).toLowerCase())||me.number&&me.number.toLowerCase().includes(e(d).toLowerCase()),xe=!e(p)||me.accountType===e(p),$e=!e(f)||me.gradeLevel===e(f);return J&&xe&&$e}))}function D(){v(g,!e(g)),v(h,!1)}function T(){v(h,!e(h)),v(g,!1)}function C(me){v(p,me.id),v(g,!1),A()}function S(me){v(f,me.id),v(h,!1),A()}function M(me){if(!me)return"N/A";const J=new Date,xe=new Date(me);let $e=J.getFullYear()-xe.getFullYear();const B=J.getMonth()-xe.getMonth();return(B<0||B===0&&J.getDate()<xe.getDate())&&$e--,$e}function F(me){return me?new Date(me).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"N/A"}function j(me){return me?new Date(me).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A"}async function P(me,J,xe){const $e=xe==="student"?"Student":"Teacher";cs.confirm(`Restore ${$e}`,`Are you sure you want to restore ${J}? This action will move the ${$e.toLowerCase()} back to the active list.`,async()=>{try{const B=await la.put("/api/archived-accounts",{id:me});Te.success(B.message||`${$e} restored successfully`),await k()}catch(B){console.error(`Error restoring ${$e.toLowerCase()}:`,B),Te.error(B.message||`Failed to restore ${$e.toLowerCase()}. Please try again.`)}},()=>{})}function Y(){v(d,""),v(p,""),v(f,""),A()}function W(me){me.target.closest(".aas-custom-dropdown")||(v(g,!1),v(h,!1))}Ya(()=>(k(),document.addEventListener("click",W),()=>{document.removeEventListener("click",W)})),ht(()=>e(p),()=>{v(a,b.find(me=>me.id===e(p)))}),ht(()=>e(f),()=>{v(r,y.find(me=>me.id===e(f)))}),ht(()=>e(d),()=>{e(d)!==void 0&&A()}),Ms(),Fs();var N=rx(),L=u(o(N),2),X=o(L),ae=o(X),V=o(ae),ie=u(o(V),2);ta(ie);var he=u(ie,2);{var Ge=me=>{var J=Iw();Se("click",J,()=>v(d,"")),m(me,J)};E(he,me=>{e(d)&&me(Ge)})}i(V),i(ae);var ce=u(ae,2),se=o(ce),Re=u(o(se),2);let Je;var it=o(Re),Le=o(it);{var ke=me=>{var J=Rw(),xe=o(J),$e=o(xe,!0);i(xe);var B=u(xe,2),te=o(B,!0);i(B),i(J),O(()=>{w($e,(e(a),x(()=>e(a).icon))),w(te,(e(a),x(()=>e(a).name)))}),m(me,J)},Ke=me=>{var J=Ow();m(me,J)};E(Le,me=>{e(a)&&e(p)?me(ke):me(Ke,!1)})}Ht(2),i(it);var lt=u(it,2);Dt(lt,5,()=>b,me=>me.id,(me,J)=>{var xe=jw();let $e;var B=o(xe),te=o(B,!0);i(B);var ue=u(B,2),G=o(ue),z=o(G,!0);i(G),i(ue),i(xe),O(le=>{$e=we(xe,1,"aas-dropdown-option",null,$e,le),w(te,(e(J),x(()=>e(J).icon))),w(z,(e(J),x(()=>e(J).name)))},[()=>({selected:e(p)===e(J).id})]),Se("click",xe,()=>C(e(J))),m(me,xe)}),i(lt),i(Re),i(se);var He=u(se,2),et=u(o(He),2);let Ne;var ne=o(et),oe=o(ne);{var _e=me=>{var J=qw(),xe=o(J),$e=o(xe,!0);i(xe);var B=u(xe,2),te=o(B,!0);i(B),i(J),O(()=>{w($e,(e(r),x(()=>e(r).icon))),w(te,(e(r),x(()=>e(r).name)))}),m(me,J)},Me=me=>{var J=zw();m(me,J)};E(oe,me=>{e(r)&&e(f)?me(_e):me(Me,!1)})}Ht(2),i(ne);var ze=u(ne,2);Dt(ze,5,()=>y,me=>me.id,(me,J)=>{var xe=Gw();let $e;var B=o(xe),te=o(B,!0);i(B);var ue=u(B,2),G=o(ue),z=o(G,!0);i(G),i(ue),i(xe),O(le=>{$e=we(xe,1,"aas-dropdown-option",null,$e,le),w(te,(e(J),x(()=>e(J).icon))),w(z,(e(J),x(()=>e(J).name)))},[()=>({selected:e(f)===e(J).id})]),Se("click",xe,()=>S(e(J))),m(me,xe)}),i(ze),i(et),i(He);var Ee=u(He,2);{var pe=me=>{var J=Vw();Se("click",J,Y),m(me,J)};E(Ee,me=>{(e(d)||e(p)||e(f))&&me(pe)})}i(ce),i(X),i(L);var qe=u(L,2),Ae=o(qe);{var Ie=me=>{var J=Bw();m(me,J)},ut=me=>{var J=mt(),xe=tt(J);{var $e=te=>{var ue=tx();Dt(ue,5,()=>e(l),G=>G.id,(G,z)=>{var le=ex(),Z=o(le),q=o(Z),U=o(q),$=o(U);{var I=ot=>{var be=ba();O(()=>w(be,(e(z),x(()=>e(z).number)))),m(ot,be)};E($,ot=>{e(z),x(()=>e(z).number)&&ot(I)})}var H=u($);i(U);var fe=u(U,2),ve=u(o(fe),2),Fe=o(ve);i(ve),i(fe),i(q);var Ce=u(q,2),Be=o(Ce);i(Ce),i(Z);var Ue=u(Z,2),Pe=o(Ue),Ve=o(Pe),st=o(Ve,!0);i(Ve);var nt=u(Ve,2),vt=o(nt,!0);i(nt),i(Pe);var St=u(Pe,2);{var At=ot=>{var be=Ww(),je=u(o(be),2),rt=o(je,!0);i(je),i(be),O(()=>w(rt,(e(z),x(()=>e(z).email)))),m(ot,be)};E(St,ot=>{e(z),x(()=>e(z).email)&&ot(At)})}var Wt=u(St,2);{var Nt=ot=>{var be=Yw(),je=tt(be);{var rt=at=>{var va=Hw(),Ca=u(o(va),2),gt=o(Ca,!0);i(Ca),i(va),O(_t=>w(gt,_t),[()=>(e(z),x(()=>y.find(_t=>_t.id===e(z).gradeLevel)?.name||e(z).gradeLevel))]),m(at,va)};E(je,at=>{e(z),x(()=>e(z).gradeLevel&&e(z).gradeLevel!=="Not specified")&&at(rt)})}var Ft=u(je,2);{var Vt=at=>{var va=Uw(),Ca=u(o(va),2),gt=o(Ca);i(Ca),i(va),O(()=>w(gt,`Guardian: ${e(z),x(()=>e(z).guardian)??""}`)),m(at,va)};E(Ft,at=>{e(z),x(()=>e(z).guardian&&e(z).guardian!=="Not specified")&&at(Vt)})}m(ot,be)};E(Wt,ot=>{e(z),x(()=>e(z).accountType==="student")&&ot(Nt)})}var It=u(Wt,2);{var Gt=ot=>{var be=mt(),je=tt(be);{var rt=Ft=>{var Vt=Qw(),at=u(o(Vt),2),va=o(at);i(at),i(Vt),O(()=>w(va,`Department: ${e(z),x(()=>e(z).department)??""}`)),m(Ft,Vt)};E(je,Ft=>{e(z),x(()=>e(z).department&&e(z).department!=="Not specified")&&Ft(rt)})}m(ot,be)};E(It,ot=>{e(z),x(()=>e(z).accountType==="teacher")&&ot(Gt)})}var Ot=u(It,2);{var sa=ot=>{var be=Kw(),je=u(o(be),2),rt=o(je);i(je),i(be),O(Ft=>w(rt,`Age: ${Ft??""} years old`),[()=>(e(z),x(()=>M(e(z).birthdate)))]),m(ot,be)};E(Ot,ot=>{e(z),x(()=>e(z).birthdate&&e(z).birthdate!=="Not specified")&&ot(sa)})}var Qt=u(Ot,2);{var Pt=ot=>{var be=Jw(),je=u(o(be),2),rt=o(je);i(je),i(be),O(()=>w(rt,`Contact: ${e(z),x(()=>e(z).contactNumber)??""}`)),m(ot,be)};E(Qt,ot=>{e(z),x(()=>e(z).contactNumber&&e(z).contactNumber!=="Not specified")&&ot(Pt)})}var Yt=u(Qt,2);{var ca=ot=>{var be=Xw(),je=u(o(be),2),rt=o(je);i(je),i(be),O(()=>w(rt,`Address: ${e(z),x(()=>e(z).address)??""}`)),m(ot,be)};E(Yt,ot=>{e(z),x(()=>e(z).address&&e(z).address!=="Not specified")&&ot(ca)})}var ye=u(Yt,2);{var Xe=ot=>{var be=Zw(),je=u(o(be),2),rt=o(je);i(je),i(be),O(Ft=>w(rt,`Birthdate: ${Ft??""}`),[()=>(e(z),x(()=>F(e(z).birthdate)))]),m(ot,be)};E(ye,ot=>{e(z),x(()=>e(z).birthdate&&e(z).birthdate!=="Not specified")&&ot(Xe)})}i(Ue),i(le),O(ot=>{w(H,`  ${e(z),x(()=>e(z).name)??""}`),w(Fe,`Archived ${ot??""}`),Mt(Be,"title",`Restore ${e(z),x(()=>e(z).accountType==="student"?"Student":"Teacher")??""}`),w(st,(e(z),x(()=>e(z).accountType==="student"?"school":"person"))),w(vt,(e(z),x(()=>e(z).accountType==="student"?"Student":"Teacher")))},[()=>(e(z),x(()=>j(e(z).archivedDate)))]),Se("click",Be,()=>P(e(z).id,e(z).name,e(z).accountType)),m(G,le)}),i(ue),m(te,ue)},B=te=>{var ue=sx(),G=o(ue),z=o(G,!0);i(G);var le=u(G,2),Z=o(le);{var q=H=>{var fe=ba("No archived accounts found matching your search criteria.");m(H,fe)},U=H=>{var fe=ba("No archived accounts found in the system.");m(H,fe)};E(Z,H=>{e(d)||e(p)||e(f)?H(q):H(U,!1)})}i(le);var $=u(le,2);{var I=H=>{var fe=ax();Se("click",fe,Y),m(H,fe)};E($,H=>{(e(d)||e(p)||e(f))&&H(I)})}i(ue),O(()=>w(z,e(d)||e(p)||e(f)?"search_off":"archive")),m(te,ue)};E(xe,te=>{e(l),x(()=>e(l).length>0)?te($e):te(B,!1)},!0)}m(me,J)};E(Ae,me=>{e(c)?me(Ie):me(ut,!1)})}i(qe),i(N),O((me,J)=>{Je=we(Re,1,"aas-custom-dropdown",null,Je,me),Ne=we(et,1,"aas-custom-dropdown",null,Ne,J)},[()=>({open:e(g)}),()=>({open:e(h)})]),ia(ie,()=>e(d),me=>v(d,me)),Se("click",it,D),Se("click",ne,T),m(s,N),za()}var nx=_('<button type="button" class="sgl-clear-search-button"><span class="material-symbols-outlined">close</span></button>'),ox=_('<div class="sgl-selected-option"><span class="material-symbols-outlined sgl-option-icon"> </span> <span class="sgl-option-name"> </span></div>'),lx=_('<span class="sgl-placeholder">Current Quarter</span>'),cx=_('<button type="button"><span class="material-symbols-outlined sgl-option-icon"> </span> <div class="sgl-option-content"><span class="sgl-option-name"> </span></div></button>'),dx=_('<div class="sgl-selected-option"><span class="material-symbols-outlined sgl-option-icon"> </span> <span class="sgl-option-name"> </span></div>'),ux=_('<span class="sgl-placeholder">All Grade Levels</span>'),vx=_('<button type="button"><span class="material-symbols-outlined sgl-option-icon"> </span> <div class="sgl-option-content"><span class="sgl-option-name"> </span></div></button>'),fx=_('<div class="sgl-selected-option"><span class="sgl-option-name"> </span></div>'),px=_('<span class="sgl-placeholder">All Sections</span>'),mx=_('<button type="button"><div class="sgl-option-content"><span class="sgl-option-name"> </span></div></button>'),hx=_('<button type="button" class="sgl-clear-filters-button"><span class="material-symbols-outlined">filter_alt_off</span></button>'),gx=_('<div class="sgl-masterlist-loading-container"><span class="sgl-student-loader"></span> <p class="sgl-masterlist-loading-text">Loading student grades...</p></div>'),_x=_('<div class="sgl-empty-state"><span class="material-symbols-outlined sgl-empty-icon">search_off</span> <h3 class="sgl-empty-title">No students found</h3> <p class="sgl-empty-description"><!></p></div>'),bx=_('<tr><td class="sgl-student-id"> </td><td class="sgl-student-name"> </td><td class="sgl-year-level"> </td><td class="sgl-section"> </td><td class="sgl-gwa"> </td></tr>'),yx=_('<div class="sgl-results-header"><p class="sgl-results-count"> </p></div> <div class="sgl-table-container"><table class="sgl-students-table"><thead><tr><th>Student ID</th><th>Name</th><th>Grade Level</th><th>Section</th><th>GWA</th></tr></thead><tbody></tbody></table></div>',1),wx=_('<div class="sgl-student-grades-container"><div class="sgl-admin-student-header"><div class="sgl-header-content"><h1 class="sgl-page-title">Student Grades List</h1> <p class="sgl-page-subtitle">View and manage student academic performance records</p></div></div> <div class="sgl-filters-section"><div class="sgl-search-filter-container"><div class="sgl-search-container"><div class="sgl-search-input-wrapper"><span class="material-symbols-outlined sgl-search-icon">search</span> <input type="text" class="sgl-search-input" placeholder="Search students by name, email, or ID..."/> <!></div></div> <div class="sgl-filter-container"><div class="sgl-filter-group"><label class="sgl-filter-label" for="quarter-dropdown">Quarter</label> <div><button type="button" id="quarter-dropdown" class="sgl-dropdown-trigger sgl-filter-trigger"><!> <span class="material-symbols-outlined sgl-dropdown-arrow">expand_more</span></button> <div class="sgl-dropdown-menu"></div></div></div> <div class="sgl-filter-group"><label class="sgl-filter-label" for="grades-grade-level-dropdown">Grade Level</label> <div><button type="button" id="grades-grade-level-dropdown" class="sgl-dropdown-trigger sgl-filter-trigger"><!> <span class="material-symbols-outlined sgl-dropdown-arrow">expand_more</span></button> <div class="sgl-dropdown-menu"></div></div></div> <div class="sgl-filter-group"><label class="sgl-filter-label" for="grades-section-dropdown">Section</label> <div><button type="button" id="grades-section-dropdown" class="sgl-dropdown-trigger sgl-filter-trigger"><!> <span class="material-symbols-outlined sgl-dropdown-arrow">expand_more</span></button> <div class="sgl-dropdown-menu"></div></div></div> <!></div></div></div> <div class="sgl-results-section"><!></div></div>');function xx(s,t){qa(t,!1);const a=R(),r=R(),n=R();let l=R([]),c=R([]),d=[],f=R(!0),p=R(""),h=R(""),g=R(""),b=R(""),y=R(!1),k=R(!1),A=R(!1);const D=[{id:"",name:"All Grade Levels",icon:"school"},{id:"7",name:"Grade 7",icon:"looks_one"},{id:"8",name:"Grade 8",icon:"looks_two"},{id:"9",name:"Grade 9",icon:"looks_3"},{id:"10",name:"Grade 10",icon:"looks_4"}],T=[{id:"",name:"Current Quarter",icon:"event"},{id:"all",name:"Overall (All Quarters)",icon:"summarize"},{id:"1",name:"1st Quarter",icon:"filter_1"},{id:"2",name:"2nd Quarter",icon:"filter_2"},{id:"3",name:"3rd Quarter",icon:"filter_3"},{id:"4",name:"4th Quarter",icon:"filter_4"}];let C=R([{id:"",name:"All Sections"}]);async function S(){try{const I=await la.get("/api/sections");if(I.success){d=I.data||[];const H=d.filter(fe=>fe.status==="active");v(C,[{id:"",name:"All Sections"},...H.map(fe=>({id:fe.name,name:`Grade ${fe.grade_level}  ${fe.name}`}))])}}catch(I){console.error("Error loading sections:",I),Te.error("Failed to load sections")}}async function M(){v(f,!0);try{const I=new URLSearchParams;e(b)&&I.append("quarter",e(b));const H=`/api/students-bulk${I.toString()?"?"+I.toString():""}`,fe=await la.get(H);if(!fe.success)throw new Error(fe.error||"Failed to load students");v(l,fe.students||[]),F()}catch(I){console.error("Error loading students:",I),Te.error("Failed to load students. Please try again."),v(l,[])}finally{v(f,!1)}}function F(){v(c,e(l).filter(I=>{const H=!e(p)||I.name.toLowerCase().includes(e(p).toLowerCase())||I.id.toString().toLowerCase().includes(e(p).toLowerCase()),fe=!e(h)||I.gradeLevel===e(h),ve=!e(g)||I.section===e(g);return H&&fe&&ve}))}function j(){v(y,!e(y)),v(k,!1),v(A,!1)}function P(){v(k,!e(k)),v(y,!1),v(A,!1)}function Y(){v(A,!e(A)),v(y,!1),v(k,!1)}function W(I){v(h,I.id),v(y,!1),F()}function N(I){v(g,I.id),v(k,!1),F()}function L(I){v(b,I.id),v(A,!1),M()}function X(){F()}function ae(){v(p,""),v(h,""),v(g,""),v(b,""),M()}function V(I){return{7:"Grade 7",8:"Grade 8",9:"Grade 9",10:"Grade 10"}[I]||I}function ie(I){I.target.closest(".sgl-custom-dropdown")||(v(y,!1),v(k,!1),v(A,!1))}Ya(async()=>(await S(),await M(),document.addEventListener("click",ie),()=>{document.removeEventListener("click",ie)})),ht(()=>e(h),()=>{v(a,D.find(I=>I.id===e(h)))}),ht(()=>(e(C),e(g)),()=>{v(r,e(C).find(I=>I.id===e(g)))}),ht(()=>e(b),()=>{v(n,T.find(I=>I.id===e(b)))}),ht(()=>e(p),()=>{e(p)!==void 0&&X()}),Ms(),Fs();var he=wx(),Ge=u(o(he),2),ce=o(Ge),se=o(ce),Re=o(se),Je=u(o(Re),2);ta(Je);var it=u(Je,2);{var Le=I=>{var H=nx();Se("click",H,()=>v(p,"")),m(I,H)};E(it,I=>{e(p)&&I(Le)})}i(Re),i(se);var ke=u(se,2),Ke=o(ke),lt=u(o(Ke),2);let He;var et=o(lt),Ne=o(et);{var ne=I=>{var H=ox(),fe=o(H),ve=o(fe,!0);i(fe);var Fe=u(fe,2),Ce=o(Fe,!0);i(Fe),i(H),O(()=>{w(ve,(e(n),x(()=>e(n).icon))),w(Ce,(e(n),x(()=>e(n).name)))}),m(I,H)},oe=I=>{var H=lx();m(I,H)};E(Ne,I=>{e(n)?I(ne):I(oe,!1)})}Ht(2),i(et);var _e=u(et,2);Dt(_e,5,()=>T,I=>I.id,(I,H)=>{var fe=cx();let ve;var Fe=o(fe),Ce=o(Fe,!0);i(Fe);var Be=u(Fe,2),Ue=o(Be),Pe=o(Ue,!0);i(Ue),i(Be),i(fe),O(Ve=>{ve=we(fe,1,"sgl-dropdown-option",null,ve,Ve),w(Ce,(e(H),x(()=>e(H).icon))),w(Pe,(e(H),x(()=>e(H).name)))},[()=>({selected:e(b)===e(H).id})]),Se("click",fe,()=>L(e(H))),m(I,fe)}),i(_e),i(lt),i(Ke);var Me=u(Ke,2),ze=u(o(Me),2);let Ee;var pe=o(ze),qe=o(pe);{var Ae=I=>{var H=dx(),fe=o(H),ve=o(fe,!0);i(fe);var Fe=u(fe,2),Ce=o(Fe,!0);i(Fe),i(H),O(()=>{w(ve,(e(a),x(()=>e(a).icon))),w(Ce,(e(a),x(()=>e(a).name)))}),m(I,H)},Ie=I=>{var H=ux();m(I,H)};E(qe,I=>{e(a)&&e(h)?I(Ae):I(Ie,!1)})}Ht(2),i(pe);var ut=u(pe,2);Dt(ut,5,()=>D,I=>I.id,(I,H)=>{var fe=vx();let ve;var Fe=o(fe),Ce=o(Fe,!0);i(Fe);var Be=u(Fe,2),Ue=o(Be),Pe=o(Ue,!0);i(Ue),i(Be),i(fe),O(Ve=>{ve=we(fe,1,"sgl-dropdown-option",null,ve,Ve),w(Ce,(e(H),x(()=>e(H).icon))),w(Pe,(e(H),x(()=>e(H).name)))},[()=>({selected:e(h)===e(H).id})]),Se("click",fe,()=>W(e(H))),m(I,fe)}),i(ut),i(ze),i(Me);var me=u(Me,2),J=u(o(me),2);let xe;var $e=o(J),B=o($e);{var te=I=>{var H=fx(),fe=o(H),ve=o(fe,!0);i(fe),i(H),O(()=>w(ve,(e(r),x(()=>e(r).name)))),m(I,H)},ue=I=>{var H=px();m(I,H)};E(B,I=>{e(r)&&e(g)?I(te):I(ue,!1)})}Ht(2),i($e);var G=u($e,2);Dt(G,5,()=>e(C),I=>I.id,(I,H)=>{var fe=mx();let ve;var Fe=o(fe),Ce=o(Fe),Be=o(Ce,!0);i(Ce),i(Fe),i(fe),O(Ue=>{ve=we(fe,1,"sgl-dropdown-option",null,ve,Ue),w(Be,(e(H),x(()=>e(H).name)))},[()=>({selected:e(g)===e(H).id})]),Se("click",fe,()=>N(e(H))),m(I,fe)}),i(G),i(J),i(me);var z=u(me,2);{var le=I=>{var H=hx();Se("click",H,ae),m(I,H)};E(z,I=>{(e(p)||e(h)||e(g)||e(b))&&I(le)})}i(ke),i(ce),i(Ge);var Z=u(Ge,2),q=o(Z);{var U=I=>{var H=gx();m(I,H)},$=I=>{var H=mt(),fe=tt(H);{var ve=Ce=>{var Be=_x(),Ue=u(o(Be),4),Pe=o(Ue);{var Ve=nt=>{var vt=ba("Try adjusting your search criteria or filters.");m(nt,vt)},st=nt=>{var vt=ba("No student records are available at the moment.");m(nt,vt)};E(Pe,nt=>{e(p)||e(h)||e(g)?nt(Ve):nt(st,!1)})}i(Ue),i(Be),m(Ce,Be)},Fe=Ce=>{var Be=yx(),Ue=tt(Be),Pe=o(Ue),Ve=o(Pe);i(Pe),i(Ue);var st=u(Ue,2),nt=o(st),vt=u(o(nt));Dt(vt,5,()=>e(c),St=>St.id,(St,At)=>{var Wt=bx();let Nt;var It=o(Wt),Gt=o(It,!0);i(It);var Ot=u(It),sa=o(Ot,!0);i(Ot);var Qt=u(Ot),Pt=o(Qt,!0);i(Qt);var Yt=u(Qt),ca=o(Yt,!0);i(Yt);var ye=u(Yt),Xe=o(ye,!0);i(ye),i(Wt),O((ot,be)=>{Nt=we(Wt,1,"sgl-student-row",null,Nt,ot),w(Gt,(e(At),x(()=>e(At).id))),w(sa,(e(At),x(()=>e(At).name))),w(Pt,be),w(ca,(e(At),x(()=>e(At).section))),w(Xe,(e(At),x(()=>e(At).gwa)))},[()=>({"low-gwa":e(At).gwa<75}),()=>(e(At),x(()=>V(e(At).gradeLevel)))]),m(St,Wt)}),i(vt),i(nt),i(st),O(()=>w(Ve,`Showing ${e(c),x(()=>e(c).length)??""} of ${e(l),x(()=>e(l).length)??""} students`)),m(Ce,Be)};E(fe,Ce=>{e(c),x(()=>e(c).length===0)?Ce(ve):Ce(Fe,!1)},!0)}m(I,H)};E(q,I=>{e(f)?I(U):I($,!1)})}i(Z),i(he),O((I,H,fe)=>{He=we(lt,1,"sgl-custom-dropdown",null,He,I),Ee=we(ze,1,"sgl-custom-dropdown",null,Ee,H),xe=we(J,1,"sgl-custom-dropdown",null,xe,fe)},[()=>({open:e(A)}),()=>({open:e(y)}),()=>({open:e(k)})]),ia(Je,()=>e(p),I=>v(p,I)),Se("click",et,Y),Se("click",pe,j),Se("click",$e,P),m(s,he),za()}var Sx=_('<label class="time-input-label svelte-rxn8x9"> </label>'),kx=_('<span class="time-display svelte-rxn8x9"> </span>'),Ax=_('<span class="time-placeholder svelte-rxn8x9"> </span>'),Dx=_('<button type="button"> </button>'),Cx=_('<button type="button"> </button>'),Tx=_('<button type="button"> </button>'),Ex=_('<div class="time-dropdown-menu svelte-rxn8x9"><div class="time-section svelte-rxn8x9"><div class="time-section-header svelte-rxn8x9">Hour</div> <div class="time-options svelte-rxn8x9"></div></div> <div class="time-section svelte-rxn8x9"><div class="time-section-header svelte-rxn8x9">Minute</div> <div class="time-options svelte-rxn8x9"></div></div> <div class="time-section svelte-rxn8x9"><div class="time-section-header svelte-rxn8x9">Period</div> <div class="time-options svelte-rxn8x9"></div></div></div>'),Fx=_('<div class="time-input-container svelte-rxn8x9"><!> <button type="button"><!> <span class="material-symbols-outlined time-dropdown-arrow svelte-rxn8x9">expand_more</span></button> <!></div>');function Tc(s,t){qa(t,!1);const a=R();let r=Ma(t,"value",8,""),n=Ma(t,"placeholder",8,"Select time"),l=Ma(t,"disabled",8,!1),c=Ma(t,"label",8,""),d=Ma(t,"isOpen",12,!1);const f=Jd(),p=`time-input-${Math.random().toString(36).substr(2,9)}`;let h=R(""),g=R(""),b=R("AM");const y=Array.from({length:12},(ce,se)=>{const Re=se+1;return{value:Re.toString().padStart(2,"0"),label:Re.toString()}}),k=[{value:"00",label:"00"},{value:"15",label:"15"},{value:"30",label:"30"},{value:"45",label:"45"}],A=[{value:"AM",label:"AM"},{value:"PM",label:"PM"}];function D(ce){if(!ce){v(h,""),v(g,""),v(b,"AM");return}const se=ce.split(":");let Re=parseInt(se[0]);const Je=se[1]||"00";Re===0?(v(h,"12"),v(b,"AM")):Re<12?(v(h,Re.toString().padStart(2,"0")),v(b,"AM")):Re===12?(v(h,"12"),v(b,"PM")):(v(h,(Re-12).toString().padStart(2,"0")),v(b,"PM")),v(g,Je)}function T(){if(!e(h)||!e(g))return"";let ce=parseInt(e(h));return e(b)==="AM"&&ce===12?ce=0:e(b)==="PM"&&ce!==12&&(ce+=12),`${ce.toString().padStart(2,"0")}:${e(g)}`}function C(){const ce=T();ce!==r()&&f("change",{value:ce})}function S(ce){v(h,ce),C()}function M(ce){v(g,ce),C()}function F(ce){v(b,ce),C()}function j(){l()||(d(!d()),d()&&f("open"))}function P(ce){ce.target.closest(".time-input-container")||d(!1)}ht(()=>Ss(r()),()=>{r()&&r()!==T()&&D(r())}),ht(()=>(e(h),e(g),e(b)),()=>{v(a,e(h)&&e(g)?`${e(h)}:${e(g)} ${e(b)}`:"")}),Ms(),Fs();var Y=Fx();Se("click",Zs,P);var W=o(Y);{var N=ce=>{var se=Sx(),Re=o(se,!0);i(se),O(()=>{Mt(se,"for",p),w(Re,c())}),m(ce,se)};E(W,ce=>{c()&&ce(N)})}var L=u(W,2);let X;var ae=o(L);{var V=ce=>{var se=kx(),Re=o(se,!0);i(se),O(()=>w(Re,e(a))),m(ce,se)},ie=ce=>{var se=Ax(),Re=o(se,!0);i(se),O(()=>w(Re,n())),m(ce,se)};E(ae,ce=>{e(a)?ce(V):ce(ie,!1)})}Ht(2),i(L);var he=u(L,2);{var Ge=ce=>{var se=Ex(),Re=o(se),Je=u(o(Re),2);Dt(Je,5,()=>y,Ua,(lt,He)=>{var et=Dx();let Ne;var ne=o(et,!0);i(et),O(oe=>{Ne=we(et,1,"time-option svelte-rxn8x9",null,Ne,oe),w(ne,(e(He),x(()=>e(He).label)))},[()=>({selected:e(h)===e(He).value})]),Se("click",et,()=>S(e(He).value)),m(lt,et)}),i(Je),i(Re);var it=u(Re,2),Le=u(o(it),2);Dt(Le,5,()=>k,Ua,(lt,He)=>{var et=Cx();let Ne;var ne=o(et,!0);i(et),O(oe=>{Ne=we(et,1,"time-option svelte-rxn8x9",null,Ne,oe),w(ne,(e(He),x(()=>e(He).label)))},[()=>({selected:e(g)===e(He).value})]),Se("click",et,()=>M(e(He).value)),m(lt,et)}),i(Le),i(it);var ke=u(it,2),Ke=u(o(ke),2);Dt(Ke,5,()=>A,Ua,(lt,He)=>{var et=Tx();let Ne;var ne=o(et,!0);i(et),O(oe=>{Ne=we(et,1,"time-option svelte-rxn8x9",null,Ne,oe),w(ne,(e(He),x(()=>e(He).label)))},[()=>({selected:e(b)===e(He).value})]),Se("click",et,()=>F(e(He).value)),m(lt,et)}),i(Ke),i(ke),i(se),m(ce,se)};E(he,ce=>{d()&&ce(Ge)})}i(Y),O(ce=>{Mt(L,"id",p),X=we(L,1,"time-input-trigger svelte-rxn8x9",null,X,ce),L.disabled=l()},[()=>({open:d(),selected:e(a),disabled:l()})]),Se("click",L,j),m(s,Y),za()}var Nx=_('<div class="scheduleassign-selected-option"><span class="material-symbols-outlined option-icon">school</span> <div class="option-content"><span class="option-name"> </span></div></div>'),$x=_('<span class="placeholder">Select year level</span>'),Lx=_('<button type="button"><span class="material-symbols-outlined option-icon">school</span> <div class="option-content"><span class="option-name"> </span> <span class="option-description"> </span></div></button>'),Px=_('<div class="scheduleassign-selected-option"><span class="material-symbols-outlined option-icon">class</span> <div class="option-content"><span class="option-name"> </span></div></div>'),Mx=_('<span class="placeholder"> </span>'),Ix=_('<div class="admin-section-loading"><span class="section-loader"></span> <span>Loading sections...</span></div>'),Rx=_('<button type="button"><span class="material-symbols-outlined option-icon">class</span> <div class="option-content"><span class="option-name"> </span> <span class="option-description"> </span></div></button>'),Ox=_('<div class="scheduleassign-empty-state"><span class="material-symbols-outlined empty-icon">inbox</span> <span class="empty-text">No sections available</span></div>'),jx=_('<div class="scheduleassign-selected-option"><span class="material-symbols-outlined scheduleassign-option-icon"> </span> <div class="scheduleassign-option-content"><span class="scheduleassign-option-name"> </span></div></div>'),qx=_('<span class="scheduleassign-placeholder">Select Schedule Type</span>'),zx=_('<div class="scheduleassign-selected-option"><span class="material-symbols-outlined scheduleassign-option-icon">book</span> <div class="scheduleassign-option-content"><span class="scheduleassign-option-name"> </span></div></div>'),Gx=_('<span class="scheduleassign-placeholder">Select Subject</span>'),Vx=_('<div class="scheduleassign-loading"><span class="scheduleassign-loader"></span> <span>Loading subjects...</span></div>'),Bx=_('<button type="button"><span class="material-symbols-outlined scheduleassign-option-icon">book</span> <div class="scheduleassign-option-content"><span class="scheduleassign-option-name"> </span></div></button>'),Wx=_('<div class="scheduleassign-empty-state"><span class="material-symbols-outlined scheduleassign-empty-icon">inbox</span> <span class="scheduleassign-empty-text"> </span></div>'),Hx=_('<div class="scheduleassign-input-group"><label class="scheduleassign-input-label" for="scheduleassign-subject-dropdown">Subject</label> <div class="scheduleassign-custom-dropdown"><button type="button" id="scheduleassign-subject-dropdown"><!> <span class="material-symbols-outlined scheduleassign-dropdown-arrow">expand_more</span></button> <div><div class="scheduleassign-search-container"><input type="text" class="scheduleassign-search-input" placeholder="Search subjects..."/> <span class="material-icons scheduleassign-search-icon">search</span></div> <!></div></div></div>'),Ux=_('<div class="scheduleassign-selected-option"><span class="material-symbols-outlined scheduleassign-option-icon">sports</span> <div class="scheduleassign-option-content"><span class="scheduleassign-option-name"> </span></div></div>'),Yx=_('<span class="scheduleassign-placeholder">Select Activity Type</span>'),Qx=_('<div class="scheduleassign-loading"><span class="scheduleassign-loader"></span> <span>Loading activity types...</span></div>'),Kx=_('<button type="button"><span class="material-symbols-outlined scheduleassign-option-icon">sports</span> <div class="scheduleassign-option-content"><span class="scheduleassign-option-name"> </span></div></button>'),Jx=_('<div class="scheduleassign-empty-state"><span class="material-symbols-outlined scheduleassign-empty-icon">inbox</span> <span class="scheduleassign-empty-text">No activity types available</span></div>'),Xx=_('<div class="scheduleassign-input-group"><label class="scheduleassign-input-label" for="scheduleassign-activity-dropdown">Activity Type</label> <div class="scheduleassign-custom-dropdown"><button type="button" id="scheduleassign-activity-dropdown"><!> <span class="material-symbols-outlined scheduleassign-dropdown-arrow">expand_more</span></button> <div><!></div></div></div>'),Zx=_('<div class="scheduleassign-selected-option"><span class="material-symbols-outlined scheduleassign-option-icon">person</span> <div class="scheduleassign-option-content"><span class="scheduleassign-option-name"> </span></div></div>'),eS=_('<span class="scheduleassign-placeholder">Select Teacher</span>'),tS=_('<div class="scheduleassign-loading"><span class="scheduleassign-loader"></span> <span>Loading teachers...</span></div>'),aS=_('<button type="button"><span class="material-symbols-outlined scheduleassign-option-icon">person</span> <div class="scheduleassign-option-content"><span class="scheduleassign-option-name"> </span></div></button>'),sS=_('<div class="scheduleassign-empty-state"><span class="material-symbols-outlined scheduleassign-empty-icon">inbox</span> <span class="scheduleassign-empty-text"> </span></div>'),rS=_('<div class="scheduleassign-input-group"><label class="scheduleassign-input-label" for="scheduleassign-teacher-dropdown">Teacher</label> <div class="scheduleassign-custom-dropdown"><button type="button" id="scheduleassign-teacher-dropdown"><!> <span class="material-symbols-outlined scheduleassign-dropdown-arrow">expand_more</span></button> <div><div class="scheduleassign-search-container"><input type="text" class="scheduleassign-search-input" placeholder="Search teachers..."/> <span class="material-icons scheduleassign-search-icon">search</span></div> <!></div></div></div>'),iS=_('<div class="scheduleassign-time-error"><span class="material-symbols-outlined">error</span> <span> </span></div>'),nS=_('<div class="scheduleassign-time-duration"><span class="material-symbols-outlined">schedule</span> <span> </span></div>'),oS=_('<label class="scheduleassign-day-checkbox"><input type="checkbox"/> <span class="scheduleassign-checkbox-label"> </span></label>'),lS=_('<div class="scheduleassign-add-form" id="addScheduleForm"><h4 class="scheduleassign-form-title">Add New Schedule</h4> <div class="scheduleassign-form-inputs"><div class="scheduleassign-type-subject-row"><div class="scheduleassign-input-group"><label class="scheduleassign-input-label" for="scheduleassign-schedule-type-dropdown">Schedule Type</label> <div class="scheduleassign-custom-dropdown"><button type="button" id="scheduleassign-schedule-type-dropdown"><!> <span class="material-symbols-outlined scheduleassign-dropdown-arrow">expand_more</span></button> <div><button type="button"><span class="material-symbols-outlined scheduleassign-option-icon">book</span> <div class="scheduleassign-option-content"><span class="scheduleassign-option-name">Subject</span></div></button> <button type="button"><span class="material-symbols-outlined scheduleassign-option-icon">sports</span> <div class="scheduleassign-option-content"><span class="scheduleassign-option-name">Activity</span></div></button></div></div></div> <!> <!></div> <div class="scheduleassign-time-section"><div class="scheduleassign-time-row"><div class="scheduleassign-input-group"><!></div> <div class="scheduleassign-input-group"><!></div></div> <div class="scheduleassign-time-info-container"><!></div> <div class="scheduleassign-day-selection-section"><div class="scheduleassign-day-checkboxes"></div></div></div></div> <div class="scheduleassign-form-actions"><button type="button"><span class="material-symbols-outlined"> </span> <!></button></div></div>'),cS=_('<div class="scheduleassign-detail-item"><span class="material-symbols-outlined scheduleassign-detail-icon">person</span> <span class="scheduleassign-detail-text"> </span></div>'),dS=_('<div class="scheduleassign-detail-item"><span class="material-symbols-outlined scheduleassign-detail-icon">schedule</span> <span class="scheduleassign-detail-text"> </span></div>'),uS=_('<span class="scheduleassign-room-details"> </span>'),vS=_('<div class="scheduleassign-detail-item"><span class="material-symbols-outlined scheduleassign-detail-icon">location_on</span> <span class="scheduleassign-detail-text"> <!></span></div>'),fS=_('<div class="scheduleassign-assignment-card"><div class="scheduleassign-assignment-header"><div class="scheduleassign-assignment-info"><h4 class="scheduleassign-assignment-title"> </h4> <p class="scheduleassign-assignment-subtitle"> </p></div> <div class="scheduleassign-assignment-actions"><button type="button" class="scheduleassign-delete-button" title="Delete assignment"><span class="material-symbols-outlined">delete</span></button></div></div> <div class="scheduleassign-assignment-details"><!> <!> <!></div></div>'),pS=_('<div class="scheduleassign-empty-day"><span class="material-symbols-outlined empty-icon">event_available</span> <span class="empty-text">No schedules</span></div>'),mS=_('<div class="scheduleassign-day-column"><div class="scheduleassign-day-header"><span class="day-name"> </span></div> <div class="scheduleassign-day-schedules"><!></div></div>'),hS=_('<div class="scheduleassign-schedule-grid"><div class="scheduleassign-schedule-actions"><a href="#addScheduleForm" class="scheduleassign-add-schedule-link"><button type="button"><span class="material-symbols-outlined"> </span> </button></a></div> <!> <div class="scheduleassign-days-grid"></div></div>'),gS=_('<div class="scheduleassign-empty-state-main"><span class="material-symbols-outlined empty-icon">calendar_month</span> <h3>Select Year Level and Section</h3> <p>Choose a year level and section to view the weekly schedule.</p></div>'),_S=_('<div class="scheduleassign-form-section"><div class="scheduleassign-section-header"><h2 class="admin-section-title">Schedule Management</h2> <p class="scheduleassign-form-instruction">Select year level and section to view all schedule assignments.</p></div> <form><div class="scheduleassign-hierarchical-form"><div class="scheduleassign-selection-row"><div class="scheduleassign-form-group"><label class="scheduleassign-form-label" for="form-year">Year Level *</label> <div><button type="button" id="form-year"><!> <span class="material-symbols-outlined scheduleassign-dropdown-arrow">expand_more</span></button> <div class="scheduleassign-dropdown-menu"></div></div></div> <div class="scheduleassign-form-group"><label class="scheduleassign-form-label" for="form-section">Section *</label> <div><button type="button" id="form-section"><!> <span class="material-symbols-outlined scheduleassign-dropdown-arrow">expand_more</span></button> <div class="scheduleassign-dropdown-menu"><div class="scheduleassign-search-container"><input type="text" class="scheduleassign-search-input" placeholder="Search sections..."/> <span class="material-icons scheduleassign-search-icon">search</span></div> <!></div></div></div></div> <!></div></form></div>');function bS(s,t){qa(t,!1);const a=R(),r=R(),n=R(),l=R(),c=R(),d=R(),f=R(),p=R(),h=R(),g=[];let b=R(""),y=R(""),k=R(!1),A=R(!1),D=R(""),T=R(""),C=R(""),S=R(!1);const M=[{id:"grade-7",name:"Grade 7",description:"Junior High School - First Year"},{id:"grade-8",name:"Grade 8",description:"Junior High School - Second Year"},{id:"grade-9",name:"Grade 9",description:"Junior High School - Third Year"},{id:"grade-10",name:"Grade 10",description:"Junior High School - Fourth Year"}],F=[{id:"monday",name:"Monday"},{id:"tuesday",name:"Tuesday"},{id:"wednesday",name:"Wednesday"},{id:"thursday",name:"Thursday"},{id:"friday",name:"Friday"}];let j=R([]),P="2024-2025";async function Y(){try{const ee=await(await fetch("/api/current-quarter")).json();ee.success&&ee.data?(P=ee.data.currentSchoolYear,console.log(`School year set to: ${P}`)):console.warn("Failed to fetch current school year, using default: 2024-2025")}catch(de){console.error("Error fetching current school year:",de)}}async function W(){v(S,!0);try{const ee=await(await ns("/api/sections?action=available-sections")).json();ee.success&&v(j,ee.data.map(Q=>({id:Q._id,name:Q.name,grade:`Grade ${Q.grade_level}`,year:`grade-${Q.grade_level}`,grade_level:Q.grade_level,school_year:Q.school_year,status:Q.status})))}catch(de){console.error("Error loading sections:",de)}finally{v(S,!1)}}let N=R([]),L=R(!1),X=R(!1),ae=R([]),V=R({startTime:"",endTime:"",scheduleType:"subject",subjectId:"",activityTypeId:"",teacherId:""}),ie=R([]),he=R([]),Ge=R([]),ce=R(!1),se=R(!1),Re=R(!1),Je=R(!1),it=R(!1),Le=R(!1),ke=R(!1),Ke=R(!1),lt=R(!1),He=R(""),et=R(""),Ne=R(""),ne=R(!1),oe=R([]);function _e(){const de=e(V).startTime,ee=e(V).endTime;if(!de||!ee){v(He,""),v(et,"");return}const Q=Me(de),Ye=Me(ee);if(Ye<=Q)v(He,"End time must be after start time"),v(et,"");else{v(He,"");const Qe=Ye-Q,dt=Math.floor(Qe/60),yt=Qe%60;dt>0&&yt>0?v(et,`${dt} hour${dt>1?"s":""} and ${yt} minute${yt>1?"s":""}`):dt>0?v(et,`${dt} hour${dt>1?"s":""}`):v(et,`${yt} minute${yt>1?"s":""}`)}}function Me(de){const[ee,Q]=de.split(":").map(Number);return ee*60+Q}let ze;function Ee(de,ee){clearTimeout(ze),ze=setTimeout(de,ee)}async function pe(){Ee(async()=>{if(!(!e(y)||!e(V).startTime||!e(V).endTime||e(ae).length===0)){v(ne,!1),v(oe,[]),v(Ne,"");try{const de=e(ae).map(async Qe=>{const dt=F.find(bt=>bt.id===Qe)?.name.toLowerCase(),yt=new URLSearchParams({action:"check-conflicts",sectionId:e(y),dayOfWeek:dt,startTime:e(V).startTime,endTime:e(V).endTime,schoolYear:P});e(V).teacherId&&e(V).scheduleType==="subject"&&yt.append("teacherId",e(V).teacherId);const ga=await(await ns(`/api/schedules?${yt}`)).json();return{day:dt,dayDisplay:F.find(bt=>bt.id===Qe)?.name,...ga}}),ee=await Promise.all(de),Q=[],Ye=[];if(ee.forEach(Qe=>{Qe.hasConflicts&&(Ye.push(Qe.dayDisplay),Qe.conflicts.forEach(dt=>{Q.push({...dt,day:Qe.dayDisplay})}))}),Q.length>0){v(ne,!0),v(oe,Q);const Qe=Q.filter(zt=>zt.type==="teacher_conflict"),dt=Q.filter(zt=>zt.type==="section_conflict");if(Qe.length===1)Te.error(Qe[0].message,6e3);else if(Qe.length>1){const zt=[...new Set(Qe.map(bt=>bt.day))],ga=Qe[0].details?.teacher_name||"Selected teacher";Te.error(`${ga} has schedule conflicts on ${zt.join(", ")}. Please choose different times or another teacher.`,8e3)}if(dt.length===1)Te.error(dt[0].message,6e3);else if(dt.length>1){const zt=[...new Set(dt.map(ga=>ga.day))];Te.error(`Time conflicts detected for this section on ${zt.join(", ")}. Please choose different time slots.`,6e3)}let yt=[];Qe.length>0&&yt.push(`Teacher conflicts detected on ${[...new Set(Qe.map(zt=>zt.day))].join(", ")}`),dt.length>0&&yt.push(`Section time conflicts detected on ${[...new Set(dt.map(zt=>zt.day))].join(", ")}`),v(Ne,yt.join(". "))}else v(ne,!1),v(Ne,"")}catch(de){console.error("Error checking conflicts:",de),Te.error("Error checking for conflicts. Please try again."),v(ne,!1)}finally{}}},500)}function qe(de){if(!de)return 0;const[ee,Q]=de.split(" "),[Ye,Qe]=ee.split(":").map(Number);let dt=Qe;return Q==="PM"&&Ye!==12?dt+=(Ye+12)*60:Q==="AM"&&Ye===12?dt+=0:dt+=Ye*60,dt}function Ae(de){de.target.closest(".scheduleassign-custom-dropdown")||(v(k,!1),v(A,!1),v(Je,!1),v(it,!1),v(Le,!1),v(ke,!1)),de.target.closest(".time-input-container")||(v(Ke,!1),v(lt,!1))}function Ie(){v(k,!e(k))}function ut(){e(b)&&v(A,!e(A))}function me(de){v(b,de?de.id:""),v(y,""),v(k,!1)}function J(de){v(y,de?de.id:""),v(A,!1),v(ie,[]),Ns(V,e(V).subjectId="")}function xe(de){if(!de)return"";const ee=de.split(":");let Q=parseInt(ee[0]);const Ye=ee[1],Qe=Q>=12?"PM":"AM";Q=Q%12,Q=Q||12;const dt=Ye.startsWith("0")&&Ye!=="00"?Ye.substring(1):Ye;return dt==="00"?`${Q}:00 ${Qe}`:`${Q}:${dt} ${Qe}`}async function $e(){try{const ee=await(await ns("/api/schedules")).json();ee.success?v(N,ee.data.map(Q=>({id:Q.id,year:`grade-${Q.grade_level}`,grade:`Grade ${Q.grade_level}`,section:Q.section_name,day:Q.day_of_week.charAt(0).toUpperCase()+Q.day_of_week.slice(1),time:`${xe(Q.start_time)} - ${xe(Q.end_time)}`,subject:Q.subject_name||Q.activity_type_name,teacher:Q.teacher_name,type:Q.schedule_type,startTime:xe(Q.start_time),endTime:xe(Q.end_time),subjectId:Q.subject_id,activityTypeId:Q.activity_type_id,teacherId:Q.teacher_id,sectionId:Q.section_id,schoolYear:Q.school_year,roomId:Q.room_id,roomName:Q.room_name,roomBuilding:Q.room_building,roomFloor:Q.room_floor}))):console.error("Failed to load schedules:",ee.error)}catch(de){console.error("Error loading schedules:",de)}}async function B(de){cs.confirm("Delete Assignment","<p>Are you sure you want to delete this schedule assignment?</p>",async()=>{try{const ee=await la.delete(`/api/schedules?id=${de.id}`);ee.success?(v(N,e(N).filter(Q=>Q.id!==de.id)),v(N,[...e(N)]),setTimeout(()=>Ue(),0),Te.success(`Assignment for ${de.subject} has been deleted successfully`)):Te.error(ee.error||"Failed to delete assignment")}catch(ee){console.error("Error deleting assignment:",ee),Te.error("Failed to delete assignment. Please try again.")}},()=>{})}function te(){v(L,!e(L)),e(L)||ue()}function ue(){v(ae,[]),v(V,{startTime:"",endTime:"",scheduleType:"subject",subjectId:"",activityTypeId:"",teacherId:""})}function G(){v(Je,!e(Je))}function z(){v(it,!e(it))}function le(){v(Le,!e(Le))}function Z(){v(ke,!e(ke))}function q(){v(Ke,!0),v(lt,!1)}function U(){v(lt,!0),v(Ke,!1)}function $(de){const ee=e(V).subjectId;if(Ns(V,e(V).subjectId=de.id),v(Je,!1),v(T,""),ee!==de.id&&e(V).teacherId){const Q=e(Ge).find(Ye=>Ye.id===e(V).teacherId);Q&&(!Q.department_ids||!Q.department_ids.includes(de.department_id))&&Ns(V,e(V).teacherId="")}}function I(de){Ns(V,e(V).activityTypeId=de.id),v(it,!1)}function H(de){Ns(V,e(V).teacherId=de.id),v(Le,!1),v(C,"")}function fe(de){Ns(V,e(V).scheduleType=de),v(ke,!1),de==="subject"?Ns(V,e(V).activityTypeId=null):Ns(V,e(V).subjectId=null)}async function ve(){if(!(e(ie).length>0)){v(ce,!0);try{const de=e(j).find(dt=>dt.id===e(y)),ee=de?de.grade_level:"",Q=ee?`/api/subjects?action=available-subjects&grade_level=${ee}`:"/api/subjects?action=available-subjects",Qe=await(await ns(Q)).json();Qe.success&&v(ie,Qe.data)}catch(de){console.error("Error loading subjects:",de)}finally{v(ce,!1)}}}async function Fe(){if(!(e(he).length>0)){v(se,!0);try{const ee=await(await ns("/api/activity-types?action=available-activity-types")).json();ee.success&&v(he,ee.data)}catch(de){console.error("Error loading activity types:",de)}finally{v(se,!1)}}}async function Ce(){if(!(e(Ge).length>0)){v(Re,!0);try{const ee=await(await ns("/api/users?action=teachers")).json();ee.success&&v(Ge,ee.data)}catch(de){console.error("Error loading teachers:",de)}finally{v(Re,!1)}}}async function Be(){if(!e(y)||e(ae).length===0){Te.error("Please select a section and at least one day");return}if(!e(V).startTime||!e(V).endTime){Te.error("Please enter start and end times");return}if(e(V).scheduleType==="subject"&&!e(V).subjectId){Te.error("Please select a subject");return}if(e(V).scheduleType==="activity"&&!e(V).activityTypeId){Te.error("Please select an activity type");return}v(X,!0);try{const de=e(ae).map(async Qe=>{const dt=F.find(yt=>yt.id===Qe)?.name.toLowerCase();try{const yt=await ns("/api/schedules",{method:"POST",body:JSON.stringify({sectionId:e(y),dayOfWeek:dt,startTime:e(V).startTime,endTime:e(V).endTime,scheduleType:e(V).scheduleType,subjectId:e(V).scheduleType==="subject"?e(V).subjectId:null,activityTypeId:e(V).scheduleType==="activity"?e(V).activityTypeId:null,teacherId:e(V).teacherId||null,schoolYear:P})}),zt=await yt.json();return yt.ok?zt:{success:!1,error:zt.error||"Failed to create schedule",conflictType:zt.conflictType,conflictingSchedule:zt.conflictingSchedule}}catch(yt){return console.error("API Error:",yt),{success:!1,error:yt.message||"Failed to create schedule"}}}),ee=await Promise.all(de),Q=ee.filter(Qe=>!Qe.success),Ye=ee.filter(Qe=>Qe.success);if(Ye.length>0&&await $e(),Q.length===0)Te.success(`Schedule added successfully for ${e(ae).length} day(s)`),ue(),v(L,!1);else{Ye.length>0&&Te.success(`Schedule added successfully for ${Ye.length} day(s)`);const Qe=Q.filter(yt=>yt.conflictType==="teacher_conflict"),dt=Q.filter(yt=>yt.conflictType!=="teacher_conflict");Qe.length>0&&Qe.forEach(yt=>{Te.error(yt.error,8e3)}),dt.length>0&&Te.error(`Failed to add schedule for ${dt.length} day(s) due to time conflicts`),Q.length>Qe.length+dt.length&&Te.error(`Failed to add schedule for ${Q.length-Qe.length-dt.length} day(s)`)}}catch(de){console.error("Error submitting schedule:",de),Te.error("Failed to add schedule. Please try again.")}finally{v(X,!1)}}Ya(async()=>{await Y(),W(),$e()}),Xd(()=>{Ue()});function Ue(){if(!e(b)||!e(y))return;const de=document.querySelectorAll(".scheduleassign-day-column");if(de.length===0)return;let ee=0;de.forEach(Q=>{const Ye=Q.querySelector(".scheduleassign-day-schedules");if(Ye){const Qe=Ye.scrollHeight;ee=Math.max(ee,Qe)}}),de.forEach(Q=>{const Ye=Q.querySelector(".scheduleassign-empty-day"),Qe=Q.querySelector(".scheduleassign-day-schedules");Ye&&Qe&&(Qe.children.length>1||Qe.children.length===1&&!Qe.querySelector(".scheduleassign-empty-day")||(Ye.style.minHeight=`${ee}px`))})}ht(()=>e(V),()=>{e(V).startTime&&e(V).endTime?_e():(v(He,""),v(et,""))}),ht(()=>(e(y),e(V),e(ae)),()=>{e(y)&&e(V).startTime&&e(V).endTime&&e(ae).length>0?pe():(v(Ne,""),v(ne,!1),v(oe,[]))}),ht(()=>(e(b),e(j)),()=>{v(a,e(b)?e(j).filter(de=>de.year===e(b)):[])}),ht(()=>(e(a),e(D)),()=>{v(r,e(a).filter(de=>de.name.toLowerCase().includes(e(D).toLowerCase())||de.grade.toLowerCase().includes(e(D).toLowerCase())))}),ht(()=>(e(ie),e(T)),()=>{v(n,e(ie).filter(de=>de.name?.toLowerCase().includes(e(T).toLowerCase())||de.description?.toLowerCase().includes(e(T).toLowerCase())))}),ht(()=>(e(Ge),e(V),e(ie),e(C)),()=>{v(l,e(Ge).filter(de=>{if(e(V).subjectId){const yt=e(ie).find(zt=>zt.id===e(V).subjectId);if(yt&&yt.department_id&&(!de.department_ids||!de.department_ids.includes(yt.department_id)))return!1}const ee=e(C).toLowerCase(),Q=de.full_name?.toLowerCase()||"",Ye=de.first_name?.toLowerCase()||"",Qe=de.last_name?.toLowerCase()||"",dt=de.email?.toLowerCase()||"";return Q.includes(ee)||Ye.includes(ee)||Qe.includes(ee)||dt.includes(ee)}))}),ht(()=>e(b),()=>{v(c,M.find(de=>de.id===e(b)))}),ht(()=>(e(j),e(y)),()=>{v(d,e(j).find(de=>de.id===e(y)))}),ht(()=>(e(N),e(b),e(y),e(d)),()=>{v(f,F.reduce((de,ee)=>(de[ee.id]=e(N).filter(Q=>{if(!e(b)||!e(y))return!1;const Ye=Q.year===e(b),Qe=Q.section===e(d)?.name,dt=Q.day===ee.name;return Ye&&Qe&&dt}).sort((Q,Ye)=>{const Qe=qe(Q.startTime),dt=qe(Ye.startTime);return Qe-dt}),de),{}))}),ht(()=>e(b),()=>{v(p,!!e(b))}),ht(()=>e(y),()=>{v(h,!!e(y))}),ht(()=>e(L),()=>{e(L)&&(ve(),Fe(),Ce())}),Ms(),Fs();var Pe=_S();Se("click",Zs,Ae);var Ve=u(o(Pe),2),st=o(Ve),nt=o(st),vt=o(nt),St=u(o(vt),2);let At;var Wt=o(St);let Nt;var It=o(Wt);{var Gt=de=>{var ee=Nx(),Q=u(o(ee),2),Ye=o(Q),Qe=o(Ye,!0);i(Ye),i(Q),i(ee),O(()=>w(Qe,(e(c),x(()=>e(c).name)))),m(de,ee)},Ot=de=>{var ee=$x();m(de,ee)};E(It,de=>{e(c)?de(Gt):de(Ot,!1)})}Ht(2),i(Wt);var sa=u(Wt,2);Dt(sa,5,()=>M,de=>de.id,(de,ee)=>{var Q=Lx();let Ye;var Qe=u(o(Q),2),dt=o(Qe),yt=o(dt,!0);i(dt);var zt=u(dt,2),ga=o(zt,!0);i(zt),i(Qe),i(Q),O(bt=>{Ye=we(Q,1,"scheduleassign-dropdown-item",null,Ye,bt),w(yt,(e(ee),x(()=>e(ee).name))),w(ga,(e(ee),x(()=>e(ee).description)))},[()=>({selected:e(b)===e(ee).id})]),Se("click",Q,()=>me(e(ee))),m(de,Q)}),i(sa),i(St),i(vt);var Qt=u(vt,2),Pt=u(o(Qt),2);let Yt;var ca=o(Pt);let ye;var Xe=o(ca);{var ot=de=>{var ee=Px(),Q=u(o(ee),2),Ye=o(Q),Qe=o(Ye);i(Ye),i(Q),i(ee),O(()=>w(Qe,`${e(d),x(()=>e(d).grade)??""}  ${e(d),x(()=>e(d).name)??""}`)),m(de,ee)},be=de=>{var ee=Mx(),Q=o(ee,!0);i(ee),O(()=>w(Q,e(b)?"Select section":"Select year level first")),m(de,ee)};E(Xe,de=>{e(d)?de(ot):de(be,!1)})}Ht(2),i(ca);var je=u(ca,2),rt=o(je),Ft=o(rt);ta(Ft),Ht(2),i(rt);var Vt=u(rt,2);{var at=de=>{var ee=Ix();m(de,ee)},va=de=>{var ee=mt(),Q=tt(ee);{var Ye=dt=>{var yt=mt(),zt=tt(yt);Dt(zt,1,()=>e(r),ga=>ga.id,(ga,bt)=>{var Oe=Rx();let ft;var $t=u(o(Oe),2),jt=o($t),Kt=o(jt);i(jt);var oa=u(jt,2),Jt=o(oa);i(oa),i($t),i(Oe),O(Ta=>{ft=we(Oe,1,"scheduleassign-dropdown-item",null,ft,Ta),w(Kt,`${e(bt),x(()=>e(bt).grade)??""}  ${e(bt),x(()=>e(bt).name)??""}`),w(Jt,`${e(bt),x(()=>e(bt).grade)??""} Section`)},[()=>({selected:e(y)===e(bt).id})]),Se("click",Oe,()=>J(e(bt))),m(ga,Oe)}),m(dt,yt)},Qe=dt=>{var yt=Ox();m(dt,yt)};E(Q,dt=>{e(r),x(()=>e(r).length>0)?dt(Ye):dt(Qe,!1)},!0)}m(de,ee)};E(Vt,de=>{e(S)?de(at):de(va,!1)})}i(je),i(Pt),i(Qt),i(nt);var Ca=u(nt,2);{var gt=de=>{var ee=hS(),Q=o(ee),Ye=o(Q),Qe=o(Ye);let dt;var yt=o(Qe),zt=o(yt,!0);i(yt);var ga=u(yt);i(Qe),i(Ye),i(Q);var bt=u(Q,2);{var Oe=$t=>{var jt=lS(),Kt=u(o(jt),2),oa=o(Kt),Jt=o(oa),Ta=u(o(Jt),2),Aa=o(Ta);let ya;var ma=o(Aa);{var ha=Bt=>{var We=jx(),Zt=o(We),xt=o(Zt,!0);i(Zt);var Rt=u(Zt,2),ea=o(Rt),na=o(ea,!0);i(ea),i(Rt),i(We),O(()=>{w(xt,(e(V),x(()=>e(V).scheduleType==="subject"?"book":"sports"))),w(na,(e(V),x(()=>e(V).scheduleType==="subject"?"Subject":"Activity")))}),m(Bt,We)},Fa=Bt=>{var We=qx();m(Bt,We)};E(ma,Bt=>{e(V),x(()=>e(V).scheduleType)?Bt(ha):Bt(Fa,!1)})}Ht(2),i(Aa);var La=u(Aa,2);let da;var fa=o(La);let K;var De=u(fa,2);let Ze;i(La),i(Ta),i(Jt);var wt=u(Jt,2);{var qt=Bt=>{var We=Hx(),Zt=u(o(We),2),xt=o(Zt);let Rt;var ea=o(xt);{var na=Pa=>{const Ha=fr(()=>(e(ie),e(V),x(()=>e(ie).find(is=>is.id===e(V).subjectId))));var vs=zx(),es=u(o(vs),2),Za=o(es),rs=o(Za,!0);i(Za),i(es),i(vs),O(()=>w(rs,(Ss(e(Ha)),x(()=>e(Ha)?.name)))),m(Pa,vs)},ja=Pa=>{var Ha=Gx();m(Pa,Ha)};E(ea,Pa=>{e(V),x(()=>e(V).subjectId)?Pa(na):Pa(ja,!1)})}Ht(2),i(xt);var $a=u(xt,2);let Ra;var Ba=o($a),ts=o(Ba);ta(ts),Ht(2),i(Ba);var _s=u(Ba,2);{var Ga=Pa=>{var Ha=Vx();m(Pa,Ha)},ss=Pa=>{var Ha=mt(),vs=tt(Ha);{var es=rs=>{var is=mt(),bs=tt(is);Dt(bs,1,()=>e(n),ys=>ys.id,(ys,As)=>{var Ds=Bx();let Us;var ar=u(o(Ds),2),sr=o(ar),Gr=o(sr,!0);i(sr),i(ar),i(Ds),O(pr=>{Us=we(Ds,1,"scheduleassign-dropdown-option",null,Us,pr),w(Gr,(e(As),x(()=>e(As).name)))},[()=>({selected:e(V).subjectId===e(As).id})]),Se("click",Ds,()=>$(e(As))),m(ys,Ds)}),m(rs,is)},Za=rs=>{var is=Wx(),bs=u(o(is),2),ys=o(bs,!0);i(bs),i(is),O(()=>w(ys,e(T)?"No subjects found":"No subjects available")),m(rs,is)};E(vs,rs=>{e(n),x(()=>e(n).length>0)?rs(es):rs(Za,!1)},!0)}m(Pa,Ha)};E(_s,Pa=>{e(ce)?Pa(Ga):Pa(ss,!1)})}i($a),i(Zt),i(We),O((Pa,Ha)=>{Rt=we(xt,1,"scheduleassign-dropdown-trigger",null,Rt,Pa),xt.disabled=e(ce),Ra=we($a,1,"scheduleassign-dropdown-menu",null,Ra,Ha)},[()=>({open:e(Je),selected:e(V).subjectId}),()=>({open:e(Je)})]),Se("click",xt,G),ia(ts,()=>e(T),Pa=>v(T,Pa)),m(Bt,We)},Tt=Bt=>{var We=Xx(),Zt=u(o(We),2),xt=o(Zt);let Rt;var ea=o(xt);{var na=Ga=>{const ss=fr(()=>(e(he),e(V),x(()=>e(he).find(Za=>Za.id===e(V).activityTypeId))));var Pa=Ux(),Ha=u(o(Pa),2),vs=o(Ha),es=o(vs,!0);i(vs),i(Ha),i(Pa),O(()=>w(es,(Ss(e(ss)),x(()=>e(ss)?.name)))),m(Ga,Pa)},ja=Ga=>{var ss=Yx();m(Ga,ss)};E(ea,Ga=>{e(V),x(()=>e(V).activityTypeId)?Ga(na):Ga(ja,!1)})}Ht(2),i(xt);var $a=u(xt,2);let Ra;var Ba=o($a);{var ts=Ga=>{var ss=Qx();m(Ga,ss)},_s=Ga=>{var ss=mt(),Pa=tt(ss);{var Ha=es=>{var Za=mt(),rs=tt(Za);Dt(rs,1,()=>e(he),is=>is.id,(is,bs)=>{var ys=Kx();let As;var Ds=u(o(ys),2),Us=o(Ds),ar=o(Us,!0);i(Us),i(Ds),i(ys),O(sr=>{As=we(ys,1,"scheduleassign-dropdown-option",null,As,sr),w(ar,(e(bs),x(()=>e(bs).name)))},[()=>({selected:e(V).activityTypeId===e(bs).id})]),Se("click",ys,()=>I(e(bs))),m(is,ys)}),m(es,Za)},vs=es=>{var Za=Jx();m(es,Za)};E(Pa,es=>{e(he),x(()=>e(he).length>0)?es(Ha):es(vs,!1)},!0)}m(Ga,ss)};E(Ba,Ga=>{e(se)?Ga(ts):Ga(_s,!1)})}i($a),i(Zt),i(We),O((Ga,ss)=>{Rt=we(xt,1,"scheduleassign-dropdown-trigger",null,Rt,Ga),xt.disabled=e(se),Ra=we($a,1,"scheduleassign-dropdown-menu",null,Ra,ss)},[()=>({open:e(it),selected:e(V).activityTypeId}),()=>({open:e(it)})]),Se("click",xt,z),m(Bt,We)};E(wt,Bt=>{e(V),x(()=>e(V).scheduleType==="subject")?Bt(qt):Bt(Tt,!1)})}var kt=u(wt,2);{var Ea=Bt=>{var We=rS(),Zt=u(o(We),2),xt=o(Zt);let Rt;var ea=o(xt);{var na=Pa=>{const Ha=fr(()=>(e(Ge),e(V),x(()=>e(Ge).find(is=>is.id===e(V).teacherId))));var vs=Zx(),es=u(o(vs),2),Za=o(es),rs=o(Za);i(Za),i(es),i(vs),O(()=>w(rs,`${Ss(e(Ha)),x(()=>e(Ha)?.first_name)??""} ${Ss(e(Ha)),x(()=>e(Ha)?.last_name)??""}`)),m(Pa,vs)},ja=Pa=>{var Ha=eS();m(Pa,Ha)};E(ea,Pa=>{e(V),x(()=>e(V).teacherId)?Pa(na):Pa(ja,!1)})}Ht(2),i(xt);var $a=u(xt,2);let Ra;var Ba=o($a),ts=o(Ba);ta(ts),Ht(2),i(Ba);var _s=u(Ba,2);{var Ga=Pa=>{var Ha=tS();m(Pa,Ha)},ss=Pa=>{var Ha=mt(),vs=tt(Ha);{var es=rs=>{var is=mt(),bs=tt(is);Dt(bs,1,()=>e(l),ys=>ys.id,(ys,As)=>{var Ds=aS();let Us;var ar=u(o(Ds),2),sr=o(ar),Gr=o(sr);i(sr),i(ar),i(Ds),O(pr=>{Us=we(Ds,1,"scheduleassign-dropdown-option",null,Us,pr),w(Gr,`${e(As),x(()=>e(As).first_name)??""} ${e(As),x(()=>e(As).last_name)??""}`)},[()=>({selected:e(V).teacherId===e(As).id})]),Se("click",Ds,()=>H(e(As))),m(ys,Ds)}),m(rs,is)},Za=rs=>{var is=sS(),bs=u(o(is),2),ys=o(bs,!0);i(bs),i(is),O(()=>w(ys,e(C)?"No teachers found":"No teachers available")),m(rs,is)};E(vs,rs=>{e(l),x(()=>e(l).length>0)?rs(es):rs(Za,!1)},!0)}m(Pa,Ha)};E(_s,Pa=>{e(Re)?Pa(Ga):Pa(ss,!1)})}i($a),i(Zt),i(We),O((Pa,Ha)=>{Rt=we(xt,1,"scheduleassign-dropdown-trigger",null,Rt,Pa),xt.disabled=e(Re),Ra=we($a,1,"scheduleassign-dropdown-menu",null,Ra,Ha)},[()=>({open:e(Le),selected:e(V).teacherId}),()=>({open:e(Le)})]),Se("click",xt,le),ia(ts,()=>e(C),Pa=>v(C,Pa)),m(Bt,We)};E(kt,Bt=>{e(V),x(()=>e(V).scheduleType==="subject")&&Bt(Ea)})}i(oa);var _a=u(oa,2),ua=o(_a),Sa=o(ua),Ut=o(Sa);Tc(Ut,{label:"Start Time",placeholder:"Select start time",get value(){return e(V).startTime},set value(Bt){Ns(V,e(V).startTime=Bt)},get isOpen(){return e(Ke)},set isOpen(Bt){v(Ke,Bt)},$$events:{change:Bt=>Ns(V,e(V).startTime=Bt.detail.value),open:q},$$legacy:!0}),i(Sa);var Xt=u(Sa,2),ka=o(Xt);Tc(ka,{label:"End Time",placeholder:"Select end time",get value(){return e(V).endTime},set value(Bt){Ns(V,e(V).endTime=Bt)},get isOpen(){return e(lt)},set isOpen(Bt){v(lt,Bt)},$$events:{change:Bt=>Ns(V,e(V).endTime=Bt.detail.value),open:U},$$legacy:!0}),i(Xt),i(ua);var wa=u(ua,2),Na=o(wa);{var pa=Bt=>{var We=mt(),Zt=tt(We);{var xt=ea=>{var na=iS(),ja=u(o(na),2),$a=o(ja,!0);i(ja),i(na),O(()=>w($a,e(He))),m(ea,na)},Rt=ea=>{var na=mt(),ja=tt(na);{var $a=Ra=>{var Ba=nS(),ts=u(o(Ba),2),_s=o(ts);i(ts),i(Ba),O(()=>w(_s,`Duration: ${e(et)??""}`)),m(Ra,Ba)};E(ja,Ra=>{e(et)&&Ra($a)},!0)}m(ea,na)};E(Zt,ea=>{e(He)?ea(xt):ea(Rt,!1)})}m(Bt,We)};E(Na,Bt=>{e(V),x(()=>e(V).startTime&&e(V).endTime)&&Bt(pa)})}i(wa);var xa=u(wa,2),Ia=o(xa);Dt(Ia,5,()=>F,Ua,(Bt,We)=>{var Zt=oS(),xt=o(Zt);ta(xt);var Rt,ea=u(xt,2),na=o(ea,!0);i(ea),i(Zt),O(()=>{Rt!==(Rt=(e(We),x(()=>e(We).id)))&&(xt.value=(xt.__value=(e(We),x(()=>e(We).id)))??""),w(na,(e(We),x(()=>e(We).name)))}),iu(g,[],xt,()=>(e(We),x(()=>e(We).id),e(ae)),ja=>v(ae,ja)),m(Bt,Zt)}),i(Ia),i(xa),i(_a),i(Kt);var re=u(Kt,2),ge=o(re);let ct;var Et=o(ge),Ct=o(Et,!0);i(Et);var Lt=u(Et,2);{var ra=Bt=>{var We=ba("Cannot Save - Conflicts Detected");m(Bt,We)},Da=Bt=>{var We=mt(),Zt=tt(We);{var xt=ea=>{var na=ba("Saving...");m(ea,na)},Rt=ea=>{var na=ba("Save Schedule");m(ea,na)};E(Zt,ea=>{e(X)?ea(xt):ea(Rt,!1)},!0)}m(Bt,We)};E(Lt,Bt=>{e(ne)?Bt(ra):Bt(Da,!1)})}i(ge),i(re),i(jt),O((Bt,We,Zt,xt,Rt)=>{ya=we(Aa,1,"scheduleassign-dropdown-trigger",null,ya,Bt),da=we(La,1,"scheduleassign-dropdown-menu",null,da,We),K=we(fa,1,"scheduleassign-dropdown-option",null,K,Zt),Ze=we(De,1,"scheduleassign-dropdown-option",null,Ze,xt),ct=we(ge,1,"scheduleassign-save-schedule-btn",null,ct,Rt),ge.disabled=(e(X),e(ae),e(ne),e(He),x(()=>e(X)||e(ae).length===0||e(ne)||e(He))),w(Ct,e(ne)?"block":"save")},[()=>({open:e(ke),selected:e(V).scheduleType}),()=>({open:e(ke)}),()=>({selected:e(V).scheduleType==="subject"}),()=>({selected:e(V).scheduleType==="activity"}),()=>({"has-conflicts":e(ne)})]),Se("click",Aa,Z),Se("click",fa,()=>fe("subject")),Se("click",De,()=>fe("activity")),Se("click",ge,Be),m($t,jt)};E(bt,$t=>{e(L)&&$t(Oe)})}var ft=u(bt,2);Dt(ft,5,()=>F,$t=>$t.id,($t,jt)=>{var Kt=mS(),oa=o(Kt),Jt=o(oa),Ta=o(Jt,!0);i(Jt),i(oa);var Aa=u(oa,2),ya=o(Aa);{var ma=Fa=>{var La=mt(),da=tt(La);Dt(da,1,()=>(e(f),e(jt),x(()=>e(f)[e(jt).id])),fa=>fa.id,(fa,K)=>{var De=fS(),Ze=o(De),wt=o(Ze),qt=o(wt),Tt=o(qt,!0);i(qt);var kt=u(qt,2),Ea=o(kt);i(kt),i(wt);var _a=u(wt,2),ua=o(_a);i(_a),i(Ze);var Sa=u(Ze,2),Ut=o(Sa);{var Xt=xa=>{var Ia=cS(),re=u(o(Ia),2),ge=o(re,!0);i(re),i(Ia),O(()=>w(ge,(e(K),x(()=>e(K).teacher)))),m(xa,Ia)};E(Ut,xa=>{e(K),x(()=>e(K).teacher)&&xa(Xt)})}var ka=u(Ut,2);{var wa=xa=>{var Ia=dS(),re=u(o(Ia),2),ge=o(re);i(re),i(Ia),O(()=>w(ge,`${e(K),x(()=>e(K).startTime)??""} - ${e(K),x(()=>e(K).endTime)??""}`)),m(xa,Ia)};E(ka,xa=>{e(K),x(()=>e(K).startTime&&e(K).endTime)&&xa(wa)})}var Na=u(ka,2);{var pa=xa=>{var Ia=vS(),re=u(o(Ia),2),ge=o(re),ct=u(ge);{var Et=Ct=>{var Lt=uS(),ra=o(Lt);i(Lt),O(()=>w(ra,`(${e(K),x(()=>e(K).roomBuilding)??""}${e(K),x(()=>e(K).roomFloor?`, Floor ${e(K).roomFloor}`:"")??""})`)),m(Ct,Lt)};E(ct,Ct=>{e(K),x(()=>e(K).roomBuilding||e(K).roomFloor)&&Ct(Et)})}i(re),i(Ia),O(()=>w(ge,`${e(K),x(()=>e(K).roomName)??""} `)),m(xa,Ia)};E(Na,xa=>{e(K),x(()=>e(K).type==="subject"&&e(K).roomName)&&xa(pa)})}i(Sa),i(De),O(()=>{w(Tt,(e(K),x(()=>e(K).subject))),w(Ea,`${e(K),x(()=>e(K).grade)??""} - ${e(K),x(()=>e(K).section)??""}`)}),Se("click",ua,()=>B(e(K))),m(fa,De)}),m(Fa,La)},ha=Fa=>{var La=pS();m(Fa,La)};E(ya,Fa=>{e(f),e(jt),x(()=>e(f)[e(jt).id]&&e(f)[e(jt).id].length>0)?Fa(ma):Fa(ha,!1)})}i(Aa),i(Kt),O(()=>w(Ta,(e(jt),x(()=>e(jt).name)))),m($t,Kt)}),i(ft),i(ee),O($t=>{dt=we(Qe,1,"scheduleassign-add-schedule-card",null,dt,$t),w(zt,e(L)?"close":"add"),w(ga,` ${e(L)?"Cancel Schedule":"Add Schedule"}`)},[()=>({"cancel-mode":e(L)})]),Se("click",Qe,te),m(de,ee)},_t=de=>{var ee=gS();m(de,ee)};E(Ca,de=>{e(b)&&e(y)?de(gt):de(_t,!1)})}i(st),i(Ve),i(Pe),O((de,ee,Q,Ye)=>{At=we(St,1,"scheduleassign-custom-dropdown",null,At,de),Nt=we(Wt,1,"scheduleassign-dropdown-button",null,Nt,ee),Yt=we(Pt,1,"scheduleassign-custom-dropdown",null,Yt,Q),ye=we(ca,1,"scheduleassign-dropdown-button",null,ye,Ye),ca.disabled=!e(b)},[()=>({open:e(k)}),()=>({selected:e(b)}),()=>({open:e(A),disabled:!e(b)}),()=>({selected:e(y),disabled:!e(b)})]),Se("click",Wt,Ie),Se("click",ca,ut),ia(Ft,()=>e(D),de=>v(D,de)),m(s,Pe),za()}const di="roomManagementData",vo="availableSectionsData",Ec=300*1e3;function yS(){const{subscribe:s,set:t,update:a}=Ws({rooms:[],availableSections:[],isLoading:!1,error:null,lastUpdated:null});return{subscribe:s,init:r=>{r&&r.rooms&&t({rooms:r.rooms,availableSections:r.availableSections||[],isLoading:!1,error:null,lastUpdated:r.lastUpdated})},setLoading:r=>{a(n=>({...n,isLoading:r,error:r?null:n.error}))},updateRooms:r=>{const n=Date.now(),l={rooms:r,lastUpdated:n,isLoading:!1,error:null};a(c=>({...c,...l}));try{localStorage.setItem(di,JSON.stringify({rooms:r,lastUpdated:n}))}catch(c){console.warn("Failed to cache rooms data:",c)}},updateSections:r=>{const n=Date.now();a(l=>({...l,availableSections:r,lastUpdated:n}));try{localStorage.setItem(vo,JSON.stringify({sections:r,lastUpdated:n}))}catch(l){console.warn("Failed to cache sections data:",l)}},setError:r=>{a(n=>({...n,error:r,isLoading:!1}))},getCachedData:()=>{try{const r=localStorage.getItem(di),n=localStorage.getItem(vo);if(!r)return null;const l=JSON.parse(r),c=n?JSON.parse(n):{sections:[]},d=Date.now(),f=d-(l.lastUpdated||0),p=d-(c.lastUpdated||0);return f<Ec?{rooms:l.rooms||[],availableSections:p<Ec?c.sections||[]:[],lastUpdated:l.lastUpdated}:null}catch(r){return console.warn("Failed to retrieve cached room data:",r),null}},clearCache:()=>{try{localStorage.removeItem(di),localStorage.removeItem(vo)}catch(r){console.warn("Failed to clear room cache:",r)}},addRoom:r=>{a(n=>{const l=[r,...n.rooms];try{localStorage.setItem(di,JSON.stringify({rooms:l,lastUpdated:Date.now()}))}catch(c){console.warn("Failed to update cache after adding room:",c)}return{...n,rooms:l}})},removeRoom:r=>{a(n=>{const l=n.rooms.filter(c=>c.id!==r);try{localStorage.setItem(di,JSON.stringify({rooms:l,lastUpdated:Date.now()}))}catch(c){console.warn("Failed to update cache after removing room:",c)}return{...n,rooms:l}})},updateRoom:(r,n)=>{a(l=>{const c=l.rooms.map(d=>d.id===r?{...d,...n}:d);try{localStorage.setItem(di,JSON.stringify({rooms:c,lastUpdated:Date.now()}))}catch(d){console.warn("Failed to update cache after updating room:",d)}return{...l,rooms:c}})}}}const br=yS();var wS=_('<span class="material-symbols-outlined">add_ad</span> Create Room',1),xS=_('<button type="button" class="adminroom-clear-search-button"><span class="material-symbols-outlined">close</span></button>'),SS=_('<div class="admin-room-loading"><span class="room-loader"></span> <p>Loading rooms...</p></div>'),kS=_("<p>No rooms found. Create your first room using the form above.</p>"),AS=_("<p>No rooms found matching your search.</p>"),DS=_('<div class="admin-room-empty-state"><span class="material-symbols-outlined">meeting_room</span> <!></div>'),CS=_('<button type="button" class="admin-room-unassign-button" title="Unassign Room"><span class="material-symbols-outlined">remove_circle</span></button>'),TS=_('<a><button type="button" class="admin-room-assign-button"><span class="material-symbols-outlined"> </span></button></a>'),ES=_('<div class="admin-room-room-assignment"><span class="material-symbols-outlined">group</span> <span> </span></div>'),FS=_('<div class="admin-room-room-assignment"><span class="material-symbols-outlined">check_circle</span> <span>Available</span></div>'),NS=_('<div class="admin-room-room-updated"><span class="material-symbols-outlined">update</span> <span> </span></div>'),$S=_('<div class="admin-room-edit-form-section"><div class="admin-room-edit-form-container"><div class="admin-room-edit-form-header"><h2 class="admin-room-edit-form-title">Edit Room</h2> <p class="admin-room-edit-form-subtitle">Update room information</p></div> <form class="admin-room-edit-form-content"><div class="admin-room-edit-info-row"><div class="admin-room-form-group"><label class="admin-room-form-label" for="edit-room-name">Room Name *</label> <input type="text" id="edit-room-name" class="admin-room-form-input" placeholder="Enter room name" required/></div> <div class="admin-room-form-group"><label class="admin-room-form-label" for="edit-building">Building *</label> <input type="text" id="edit-building" class="admin-room-form-input" placeholder="Enter building name" required/></div> <div class="admin-room-form-group"><label class="admin-room-form-label" for="edit-floor">Floor *</label> <input type="text" id="edit-floor" class="admin-room-form-input" placeholder="e.g., 1st Floor" required/></div></div> <div class="admin-room-edit-form-actions"><button type="button" class="admin-room-cancel-button">Cancel</button> <button type="submit" class="admin-room-update-button"><!></button></div></form></div></div>'),LS=_('<div class="selected-option"><span class="material-symbols-outlined option-icon">group</span> <div class="option-content"><span class="option-name"> </span> <span class="option-description"> </span></div></div>'),PS=_('<span class="placeholder">Select a section</span>'),MS=_('<button type="button"><span class="material-symbols-outlined option-icon">group</span> <div class="option-content"><span class="option-name"> </span> <span class="option-description"> </span></div></button>'),IS=_('<div class="dropdown-empty-state"><span class="material-symbols-outlined empty-icon">inbox</span> <span class="empty-text"> </span></div>'),RS=_('<div class="admin-room-assign-form-section"><div class="admin-room-assign-form-container"><div class="admin-room-assign-form-header"><h2 class="admin-room-assign-form-title">Assign Room</h2> <p class="admin-room-assign-form-subtitle">Select a section to assign this room to</p></div> <form class="admin-room-assign-form-content"><div class="admin-room-assign-info-row"><div class="admin-room-form-group"><label class="admin-room-form-label" for="assign-section-select">Select Section *</label> <div><button type="button" id="assign-section-select"><!> <span class="material-symbols-outlined dropdown-arrow">expand_more</span></button> <div class="room-dropdown-menu"><div class="dropdown-search-container"><input type="text" class="dropdown-search-input" placeholder="Search sections..."/> <span class="material-icons dropdown-search-icon">search</span></div> <!></div></div></div></div> <div class="admin-room-assign-form-actions"><button type="button" class="admin-room-cancel-button">Cancel</button> <button type="submit" class="admin-room-assign-submit-button"><!></button></div></form></div></div>'),OS=_('<div><div class="admin-room-room-header"><div class="admin-room-room-title"><h3 class="admin-room-room-name"> </h3></div> <div class="admin-room-action-buttons"><!> <a><button type="button" class="admin-room-edit-button"><span class="material-symbols-outlined"> </span></button></a> <button type="button" class="admin-room-remove-button" title="Remove Room"><span class="material-symbols-outlined">delete</span></button></div></div> <div class="admin-room-room-details"><div class="admin-room-room-location"><span class="material-symbols-outlined">location_on</span> <span> </span></div> <!> <div class="admin-room-room-created"><span class="material-symbols-outlined">schedule</span> <span> </span></div> <!></div> <!> <!></div>'),jS=_('<div class="admin-room-rooms-grid"></div>'),qS=_('<div class="admin-room-creation-form-container"><div class="admin-room-creation-form-section"><div class="admin-room-section-header"><h2 class="admin-room-section-title">Create New Room</h2> <p class="admin-room-section-subtitle">Fill in the details below to create a new room</p></div> <div class="admin-room-form-container"><form><div class="admin-room-form-row"><div class="admin-room-form-group"><label class="admin-room-form-label" for="room-name">Room Name *</label> <input type="text" id="room-name" class="admin-room-form-input" placeholder="Enter room name" required/></div> <div class="admin-room-form-group"><label class="admin-room-form-label" for="building">Building *</label> <input type="text" id="building" class="admin-room-form-input" placeholder="Enter building name" required/></div> <div class="admin-room-form-group"><label class="admin-room-form-label" for="floor">Floor *</label> <input type="text" id="floor" class="admin-room-form-input" placeholder="e.g., 1st Floor" required/></div></div> <div class="admin-room-form-actions"><button type="submit" class="admin-room-create-button"><!></button></div></form></div></div> <div class="admin-room-rooms-list-section"><div class="admin-room-section-header"><div class="section-header-content"><div class="section-title-group"><h2 class="admin-room-section-title">All Rooms</h2> <p class="admin-room-section-subtitle">All rooms in the system</p></div> <div class="adminroom-filters-container"><div class="adminroom-search-container"><div class="adminroom-search-input-wrapper"><span class="material-symbols-outlined adminroom-search-icon">search</span> <input type="text" placeholder="Search by room name, building, or floor..." class="adminroom-search-input"/> <!></div></div></div></div></div> <!></div></div>');function zS(s,t){qa(t,!1);const[a,r]=xs(),n=()=>Ja(br,"$roomManagementStore",a),l=R(),c=R(),d=R(),f=R(),p=R(),h=R();let g=R(!1),b=R(""),y=R(""),k=R(""),A=R(""),D=R(null),T=R(""),C=R(""),S=R(""),M=R(!1),F=R(null),j=R(""),P=R(!1),Y=R(!1),W=R("");async function N(q=!1){try{q||br.setLoading(!0);const U=await la.get("/api/rooms");if(U.success)br.updateRooms(U.data||[]);else throw new Error(U.message||"Failed to load rooms")}catch(U){console.error("Error loading rooms:",U),br.setError("Failed to load rooms. Please try again."),Te.error("Failed to load rooms. Please try again.")}}async function L(q=!1){try{const U=await la.get("/api/sections?action=available-sections");if(U.success)br.updateSections(U.data||[]);else throw new Error(U.message||"Failed to load sections")}catch(U){console.error("Error loading sections:",U),q||Te.error("Failed to load sections. Please try again.")}}const X=q=>{cs.confirm("Remove Room",`Are you sure you want to remove room ${q.name}? This action cannot be undone.`,async()=>{try{const U=await la.delete("/api/rooms",{id:q.id});if(U.success)br.removeRoom(q.id),Te.success(U.message);else throw new Error(U.message||"Failed to remove room")}catch(U){console.error("Error removing room:",U),Te.error("Failed to remove room. Please try again.")}},()=>{})};async function ae(){if(!e(y)||!e(k)||!e(A)){Te.warning("Please fill in all required fields.");return}v(g,!0);try{const q=await la.post("/api/rooms",{name:e(y),building:e(k),floor:e(A)});if(q.success)br.addRoom(q.data),Te.success(q.message),he();else throw new Error(q.message||"Failed to create room")}catch(q){console.error("Error creating room:",q),Te.error("Failed to create room. Please try again.")}finally{v(g,!1)}}async function V(q){const U=e(l).find($=>$.id===q);U&&cs.confirm("Unassign Room",`Are you sure you want to unassign room "${U.name}"? This will remove all section assignments from this room.`,async()=>{await ie(q)},()=>{})}async function ie(q){try{if(!e(l).find(I=>I.id===q))return;const $=await la.patch("/api/rooms",{roomId:q,action:"unassign"});if($.success)await N(),await L(),Te.success($.message);else throw new Error($.message||"Failed to unassign room")}catch(U){console.error("Error unassigning room:",U),Te.error("Failed to unassign room. Please try again.")}}function he(){v(y,""),v(k,""),v(A,"")}function Ge(q){q.target.closest(".custom-dropdown")||v(Y,!1)}function ce(q){e(D)===q.id?(v(D,null),v(T,""),v(C,""),v(S,"")):(e(F)===q.id&&(v(F,null),v(j,""),v(Y,!1)),v(D,q.id),v(T,q.name),v(C,q.building),v(S,q.floor))}async function se(){if(!e(T)||!e(C)||!e(S)){Te.warning("Please fill in all required fields.");return}v(M,!0);try{const q=e(l).find($=>$.id===e(D)),U=await la.put("/api/rooms",{id:e(D),name:e(T),building:e(C),floor:e(S),status:q.status,assignedTo:q.assignedTo});if(U.success)br.updateRoom(e(D),U.data),Te.success(U.message),v(D,null),v(T,""),v(C,""),v(S,"");else throw new Error(U.message||"Failed to update room")}catch(q){console.error("Error updating room:",q),Te.error("Failed to update room. Please try again.")}finally{v(M,!1)}}function Re(q){e(F)===q.id?(v(F,null),v(j,""),v(Y,!1)):(e(D)===q.id&&(v(D,null),v(T,""),v(C,""),v(S,"")),v(F,q.id),v(j,""),v(Y,!1))}function Je(){v(Y,!e(Y))}function it(q){v(j,q.id||q._id?.toString()),v(Y,!1),v(W,"")}async function Le(){if(!e(j)){Te.warning("Please select a section.");return}v(P,!0);try{const q=await la.patch("/api/rooms",{roomId:e(F),sectionIds:[e(j)],action:"assign"});if(q.success)await N(),await L(),Te.success(q.message),v(F,null),v(j,"");else throw new Error(q.message||"Failed to assign room")}catch(q){console.error("Error assigning room:",q),Te.error("Failed to assign room. Please try again.")}finally{v(P,!1)}}Ya(()=>{const q=br.getCachedData();q&&br.init(q),N(!!q),L(!!q);const U=setInterval(()=>{N(!0),L(!0)},3e4);return()=>{clearInterval(U)}}),ht(()=>(e(l),e(c),e(d),e(f),n()),()=>{(q=>{v(l,q.rooms),v(c,q.availableSections),v(d,q.isLoading),v(f,q.error)})(n())}),ht(()=>(e(l),e(b)),()=>{v(p,e(l).filter(q=>q.name.toLowerCase().includes(e(b).toLowerCase())||q.building.toLowerCase().includes(e(b).toLowerCase())||q.floor.toLowerCase().includes(e(b).toLowerCase())))}),ht(()=>(e(c),e(W)),()=>{v(h,e(c).filter(q=>q.name.toLowerCase().includes(e(W).toLowerCase())||`Grade ${q.grade_level}`.toLowerCase().includes(e(W).toLowerCase())))}),Ms(),Fs();var ke=qS();Se("click",Zs,Ge);var Ke=o(ke),lt=u(o(Ke),2),He=o(lt),et=o(He),Ne=o(et),ne=u(o(Ne),2);ta(ne),i(Ne);var oe=u(Ne,2),_e=u(o(oe),2);ta(_e),i(oe);var Me=u(oe,2),ze=u(o(Me),2);ta(ze),i(Me),i(et);var Ee=u(et,2),pe=o(Ee),qe=o(pe);{var Ae=q=>{var U=ba("Creating...");m(q,U)},Ie=q=>{var U=wS();Ht(),m(q,U)};E(qe,q=>{e(g)?q(Ae):q(Ie,!1)})}i(pe),i(Ee),i(He),i(lt),i(Ke);var ut=u(Ke,2),me=o(ut),J=o(me),xe=u(o(J),2),$e=o(xe),B=o($e),te=u(o(B),2);ta(te);var ue=u(te,2);{var G=q=>{var U=xS();Se("click",U,()=>v(b,"")),m(q,U)};E(ue,q=>{e(b)&&q(G)})}i(B),i($e),i(xe),i(J),i(me);var z=u(me,2);{var le=q=>{var U=SS();m(q,U)},Z=q=>{var U=mt(),$=tt(U);{var I=fe=>{var ve=DS(),Fe=u(o(ve),2);{var Ce=Ue=>{var Pe=kS();m(Ue,Pe)},Be=Ue=>{var Pe=AS();m(Ue,Pe)};E(Fe,Ue=>{e(l),x(()=>e(l).length===0)?Ue(Ce):Ue(Be,!1)})}i(ve),m(fe,ve)},H=fe=>{var ve=jS();Dt(ve,5,()=>e(p),Fe=>Fe.id,(Fe,Ce)=>{var Be=OS();let Ue;var Pe=o(Be),Ve=o(Pe),st=o(Ve),nt=o(st,!0);i(st),i(Ve);var vt=u(Ve,2),St=o(vt);{var At=_t=>{var de=CS();Se("click",de,()=>V(e(Ce).id)),m(_t,de)},Wt=_t=>{var de=TS(),ee=o(de),Q=o(ee),Ye=o(Q,!0);i(Q),i(ee),i(de),O(()=>{Mt(de,"href",`#admin-room-room-card-${e(Ce),x(()=>e(Ce).id)??""}`),Mt(ee,"title",(e(F),e(Ce),x(()=>e(F)===e(Ce).id?"Cancel Assign":"Assign Room"))),w(Ye,(e(F),e(Ce),x(()=>e(F)===e(Ce).id?"close":"add_circle")))}),Se("click",ee,()=>Re(e(Ce))),m(_t,de)};E(St,_t=>{e(Ce),x(()=>e(Ce).assignedSections&&e(Ce).assignedSections.length>0)?_t(At):_t(Wt,!1)})}var Nt=u(St,2),It=o(Nt),Gt=o(It),Ot=o(Gt,!0);i(Gt),i(It),i(Nt);var sa=u(Nt,2);i(vt),i(Pe);var Qt=u(Pe,2),Pt=o(Qt),Yt=u(o(Pt),2),ca=o(Yt);i(Yt),i(Pt);var ye=u(Pt,2);{var Xe=_t=>{var de=ES(),ee=u(o(de),2),Q=o(ee);i(ee),i(de),O(Ye=>w(Q,`Assigned to: ${Ye??""}`),[()=>(e(Ce),x(()=>e(Ce).assignedSections.map(Ye=>Ye.name).join(", ")))]),m(_t,de)},ot=_t=>{var de=FS();m(_t,de)};E(ye,_t=>{e(Ce),x(()=>e(Ce).assignedSections&&e(Ce).assignedSections.length>0)?_t(Xe):_t(ot,!1)})}var be=u(ye,2),je=u(o(be),2),rt=o(je);i(je),i(be);var Ft=u(be,2);{var Vt=_t=>{var de=NS(),ee=u(o(de),2),Q=o(ee);i(ee),i(de),O(()=>w(Q,`Updated: ${e(Ce),x(()=>e(Ce).updatedDate)??""}`)),m(_t,de)};E(Ft,_t=>{e(Ce),x(()=>e(Ce).updatedDate&&e(Ce).updatedDate!==e(Ce).createdDate)&&_t(Vt)})}i(Qt);var at=u(Qt,2);{var va=_t=>{var de=$S(),ee=o(de),Q=u(o(ee),2),Ye=o(Q),Qe=o(Ye),dt=u(o(Qe),2);ta(dt),i(Qe);var yt=u(Qe,2),zt=u(o(yt),2);ta(zt),i(yt);var ga=u(yt,2),bt=u(o(ga),2);ta(bt),i(ga),i(Ye);var Oe=u(Ye,2),ft=o(Oe),$t=u(ft,2),jt=o($t);{var Kt=Jt=>{var Ta=ba("Updating...");m(Jt,Ta)},oa=Jt=>{var Ta=ba("Update");m(Jt,Ta)};E(jt,Jt=>{e(M)?Jt(Kt):Jt(oa,!1)})}i($t),i(Oe),i(Q),i(ee),i(de),O(()=>$t.disabled=e(M)||!e(T)||!e(C)||!e(S)),ia(dt,()=>e(T),Jt=>v(T,Jt)),ia(zt,()=>e(C),Jt=>v(C,Jt)),ia(bt,()=>e(S),Jt=>v(S,Jt)),Se("click",ft,()=>ce(e(Ce))),Se("submit",Q,tr(se)),m(_t,de)};E(at,_t=>{e(D),e(Ce),x(()=>e(D)===e(Ce).id)&&_t(va)})}var Ca=u(at,2);{var gt=_t=>{var de=RS(),ee=o(de),Q=u(o(ee),2),Ye=o(Q),Qe=o(Ye),dt=u(o(Qe),2);let yt;var zt=o(dt);let ga;var bt=o(zt);{var Oe=da=>{const fa=fr(()=>(e(c),e(j),x(()=>e(c).find(wt=>(wt.id||wt._id?.toString())===e(j)))));var K=mt(),De=tt(K);{var Ze=wt=>{var qt=LS(),Tt=u(o(qt),2),kt=o(Tt),Ea=o(kt,!0);i(kt);var _a=u(kt,2),ua=o(_a);i(_a),i(Tt),i(qt),O(()=>{w(Ea,(Ss(e(fa)),x(()=>e(fa).name))),w(ua,`Grade ${Ss(e(fa)),x(()=>e(fa).grade_level)??""} Section`)}),m(wt,qt)};E(De,wt=>{e(fa)&&wt(Ze)})}m(da,K)},ft=da=>{var fa=PS();m(da,fa)};E(bt,da=>{e(j)?da(Oe):da(ft,!1)})}Ht(2),i(zt);var $t=u(zt,2),jt=o($t),Kt=o(jt);ta(Kt),Ht(2),i(jt);var oa=u(jt,2);{var Jt=da=>{var fa=mt(),K=tt(fa);Dt(K,1,()=>e(h),De=>De.id||De._id,(De,Ze)=>{var wt=MS();let qt;var Tt=u(o(wt),2),kt=o(Tt),Ea=o(kt,!0);i(kt);var _a=u(kt,2),ua=o(_a);i(_a),i(Tt),i(wt),O(Sa=>{qt=we(wt,1,"dropdown-option",null,qt,Sa),w(Ea,(e(Ze),x(()=>e(Ze).name))),w(ua,`Grade ${e(Ze),x(()=>e(Ze).grade_level)??""} Section`)},[()=>({selected:e(j)===(e(Ze).id||e(Ze)._id?.toString())})]),Se("click",wt,po(()=>it(e(Ze)))),m(De,wt)}),m(da,fa)},Ta=da=>{var fa=IS(),K=u(o(fa),2),De=o(K,!0);i(K),i(fa),O(()=>w(De,e(W)?"No sections found":"No sections available")),m(da,fa)};E(oa,da=>{e(h),x(()=>e(h).length>0)?da(Jt):da(Ta,!1)})}i($t),i(dt),i(Qe),i(Ye);var Aa=u(Ye,2),ya=o(Aa),ma=u(ya,2),ha=o(ma);{var Fa=da=>{var fa=ba("Assigning");m(da,fa)},La=da=>{var fa=ba("Assign");m(da,fa)};E(ha,da=>{e(P)?da(Fa):da(La,!1)})}i(ma),i(Aa),i(Q),i(ee),i(de),O((da,fa)=>{yt=we(dt,1,"custom-dropdown",null,yt,da),ga=we(zt,1,"dropdown-trigger",null,ga,fa),ma.disabled=e(P)||!e(j)},[()=>({open:e(Y)}),()=>({selected:e(j)})]),Se("click",zt,po(Je)),ia(Kt,()=>e(W),da=>v(W,da)),Se("click",ya,()=>Re(e(Ce))),Se("submit",Q,tr(Le)),m(_t,de)};E(Ca,_t=>{e(F),e(Ce),x(()=>e(F)===e(Ce).id)&&_t(gt)})}i(Be),O(_t=>{Ue=we(Be,1,"admin-room-room-card",null,Ue,_t),Mt(Be,"id",`admin-room-room-card-${e(Ce),x(()=>e(Ce).id)??""}`),w(nt,(e(Ce),x(()=>e(Ce).name))),Mt(Nt,"href",`#admin-room-room-card-${e(Ce),x(()=>e(Ce).id)??""}`),Mt(It,"title",(e(D),e(Ce),x(()=>e(D)===e(Ce).id?"Cancel Edit":"Edit Room"))),w(Ot,(e(D),e(Ce),x(()=>e(D)===e(Ce).id?"close":"edit"))),w(ca,`${e(Ce),x(()=>e(Ce).building)??""}, ${e(Ce),x(()=>e(Ce).floor)??""}`),w(rt,`Created: ${e(Ce),x(()=>e(Ce).createdDate)??""}`)},[()=>({editing:e(D)===e(Ce).id,assigning:e(F)===e(Ce).id})]),Se("click",It,()=>ce(e(Ce))),Se("click",sa,()=>X(e(Ce))),m(Fe,Be)}),i(ve),m(fe,ve)};E($,fe=>{e(p),x(()=>e(p).length===0)?fe(I):fe(H,!1)},!0)}m(q,U)};E(z,q=>{e(d)?q(le):q(Z,!1)})}i(ut),i(ke),O(()=>pe.disabled=e(g)||!e(y)||!e(k)||!e(A)),ia(ne,()=>e(y),q=>v(y,q)),ia(_e,()=>e(k),q=>v(k,q)),ia(ze,()=>e(A),q=>v(A,q)),Se("submit",He,tr(ae)),ia(te,()=>e(b),q=>v(b,q)),m(s,ke),za(),r()}const Li="sectionsCache",GS=180*1e3,nr=(()=>{const s=Ws([]),t=Ws(!1),a=Ws(null),r=()=>{try{const k=localStorage.getItem(Li);if(!k)return null;const A=JSON.parse(k);return Date.now()-A.timestamp>GS?(localStorage.removeItem(Li),null):A.sections}catch(k){return console.error("Error reading sections cache:",k),localStorage.removeItem(Li),null}},n=k=>{try{const A={sections:k,timestamp:Date.now()};localStorage.setItem(Li,JSON.stringify(A))}catch(A){console.error("Error setting sections cache:",A)}},l=()=>{try{localStorage.removeItem(Li)}catch(k){console.error("Error clearing sections cache:",k)}},c=()=>{const k=r();return k?(s.set(k),!0):!1},d=(k,A=!1)=>{s.set(k),a.set(null),A||t.set(!1),n(k)},f=(k,A=!1)=>{A||t.set(k)},p=k=>{a.set(k),t.set(!1)},h=async(k=!1,A="")=>{try{f(!0,k);let D="/api/sections";A&&A.trim()&&(D+=`?search=${encodeURIComponent(A.trim())}`);const T=await ns(D);if(!T.ok)throw new Error(`HTTP error! status: ${T.status}`);const C=await T.json();if(!C.success||!C.data)throw new Error("Invalid API response structure");const S=C.data.map(M=>({...M,students:M.students||[],adviser:M.adviser||null}));d(S,k)}catch(D){console.error("Error loading sections:",D),p(D.message)}finally{f(!1,!1)}},g=k=>{s.update(A=>{const D=[...A,k];return n(D),D})},b=(k,A)=>{s.update(D=>{const T=D.map(C=>C.id===k?{...C,...A}:C);return n(T),T})},y=k=>{s.update(A=>{const D=A.filter(T=>T.id!==k);return n(D),D})};return{sections:{subscribe:s.subscribe},isLoadingSections:{subscribe:t.subscribe},sectionsError:{subscribe:a.subscribe},initSections:c,loadSections:h,updateSections:d,setLoadingSections:f,setSectionsError:p,addSection:g,updateSection:b,removeSection:y,clearSectionsCache:l}})();var VS=_('<div class="sectionmgmt-selected-option"><span class="material-symbols-outlined sectionmgmt-option-icon">school</span> <div class="sectionmgmt-option-content"><span class="sectionmgmt-option-name"> </span></div></div>'),BS=_('<span class="sectionmgmt-placeholder">Select grade level</span>'),WS=_('<button type="button"><span class="material-symbols-outlined sectionmgmt-option-icon">school</span> <div class="sectionmgmt-option-content"><span class="sectionmgmt-option-name"> </span> <span class="sectionmgmt-option-description"> </span></div></button>'),HS=_('<div class="sectionmgmt-selected-option"><span class="material-symbols-outlined sectionmgmt-option-icon">person</span> <div class="sectionmgmt-option-content"><span class="sectionmgmt-option-name"> </span></div></div>'),US=_('<span class="sectionmgmt-placeholder">Select advisory teacher</span>'),YS=_('<span class="sectionmgmt-placeholder">Select grade level first</span>'),QS=_('<div class="admin-section-loading"><span class="section-loader"></span> <p>Loading teachers...</p></div>'),KS=_('<div class="sectionmgmt-no-results"><span class="material-symbols-outlined">person_off</span> <span>No available teachers found</span></div>'),JS=_('<button type="button"><span class="material-symbols-outlined sectionmgmt-option-icon">person</span> <div class="sectionmgmt-option-content"><span class="sectionmgmt-option-name"> </span> <span class="sectionmgmt-option-description"> </span></div></button>'),XS=_('<button type="button" class="sectionmgmt-select-all-button"><span class="material-symbols-outlined"> </span></button>'),ZS=_('<div class="admin-section-loading"><span class="section-loader"></span> <p>Loading students...</p></div>'),ek=_('<div class="sectionmgmt-no-results"><span class="material-symbols-outlined">person_off</span> <span>No available students found for this grade level</span></div>'),tk=_('<button type="button"><div class="sectionmgmt-option-content"><span class="material-symbols-outlined sectionmgmt-option-icon">school</span> <span class="sectionmgmt-option-name"> </span> <span class="sectionmgmt-option-description"> </span></div> <div class="sectionmgmt-student-checkbox"><span class="material-symbols-outlined"> </span></div></button>'),ak=_('<div class="sectionmgmt-student-controls"><input type="text" class="sectionmgmt-form-input" placeholder="Search students by name or ID..." id="students"/> <!></div> <div class="sectionmgmt-student-list"><!></div>',1),sk=_('<div class="sectionmgmt-placeholder-message"><span class="material-symbols-outlined">info</span> <span>Please select a grade level first to view available students.</span></div>'),rk=_('<span class="material-symbols-outlined">groups</span> Create Section',1),ik=_('<button type="button" class="adminform-clear-search-button"><span class="material-symbols-outlined">close</span></button>'),nk=_('<div class="adminform-selected-option"><span class="material-symbols-outlined adminform-option-icon"> </span> <div class="adminform-option-content"><span class="adminform-option-name"> </span></div></div>'),ok=_('<span class="adminform-placeholder">Filter by grade</span>'),lk=_('<button type="button"><span class="material-symbols-outlined adminform-option-icon"> </span> <div class="adminform-option-content"><span class="adminform-option-name"> </span></div></button>'),ck=_('<div class="admin-section-loading"><span class="section-loader"></span> <p>Loading sections...</p></div>'),dk=_('<div class="sectionmgmt-section-updated"><span class="material-symbols-outlined">update</span> <span> </span></div>'),uk=_('<div class="sectionmgmt-selected-option"><span class="material-symbols-outlined sectionmgmt-option-icon">person</span> <div class="sectionmgmt-option-content"><span class="sectionmgmt-option-name"> </span></div></div>'),vk=_('<span class="sectionmgmt-placeholder">Select section adviser</span>'),fk=_('<button type="button"><span class="material-symbols-outlined sectionmgmt-option-icon">person</span> <div class="sectionmgmt-option-content"><span class="sectionmgmt-option-name"> </span> <span class="sectionmgmt-option-description"> </span></div></button>'),pk=_('<div class="sectionmgmt-no-results"><span class="material-symbols-outlined">person_off</span> <span>No available advisers found</span></div>'),mk=_('<button type="button" class="sectionmgmt-select-all-button"><span class="material-symbols-outlined"> </span></button>'),hk=_('<button type="button"><div class="sectionmgmt-option-content"><span class="material-symbols-outlined sectionmgmt-option-icon">school</span> <span class="sectionmgmt-option-name"> </span> <span class="sectionmgmt-option-description"> </span></div> <span class="material-symbols-outlined sectionmgmt-option-icon"> </span></button>'),gk=_('<div class="sectionmgmt-no-results"><span class="material-symbols-outlined">person_off</span> <span>No available students found</span></div>'),_k=_('<div class="sectionmgmt-edit-form-section"><div class="sectionmgmt-edit-form-container" id="section-edit-form-container"><div class="sectionmgmt-edit-form-header"><h2 class="sectionmgmt-edit-form-title">Edit Section</h2> <p class="sectionmgmt-edit-form-subtitle">Update section information and manage students</p></div> <form class="sectionmgmt-edit-form-content"><div class="sectionmgmt-edit-info-row"><div class="sectionmgmt-form-group"><label class="sectionmgmt-form-label" for="edit-section-name">Section Name</label> <input type="text" id="edit-section-name" class="sectionmgmt-form-input" placeholder="Enter section name (e.g., Mabini, Rizal, Bonifacio)" required/></div> <div class="sectionmgmt-form-group"><label class="sectionmgmt-form-label" for="edit-section-adviser">Section Adviser</label> <div><button type="button" id="edit-section-adviser"><!> <span class="material-symbols-outlined sectionmgmt-dropdown-arrow">expand_more</span></button> <div class="sectionmgmt-dropdown-menu"><div class="sectionmgmt-search-container"><input type="text" class="sectionmgmt-search-input" placeholder="Search advisers..."/> <span class="material-symbols-outlined sectionmgmt-search-icon">search</span></div> <!> <!></div></div></div></div> <div class="sectionmgmt-form-group"><label class="sectionmgmt-form-label" for="edit-students"> </label> <div class="sectionmgmt-student-controls"><input type="text" class="sectionmgmt-form-input" placeholder="Search students by name or ID..." id="edit-students"/> <!></div> <div class="sectionmgmt-student-list"><!> <!></div></div> <div class="sectionmgmt-edit-form-actions"><button type="button" class="sectionmgmt-cancel-button">Cancel</button> <button type="submit" class="sectionmgmt-submit-button"><!></button></div></form></div></div>'),bk=_('<div><div class="sectionmgmt-section-header-card"><div class="sectionmgmt-section-title"><h3 class="sectionmgmt-section-name"> </h3></div> <div class="sectionmgmt-action-buttons"><a><button type="button" class="sectionmgmt-edit-button"><span class="material-symbols-outlined"> </span></button></a> <button type="button" class="sectionmgmt-remove-button" title="Remove Section"><span class="material-symbols-outlined">delete</span></button></div></div> <div class="sectionmgmt-section-details"><div class="sectionmgmt-section-adviser"><span class="material-symbols-outlined">person_book</span> <span> </span></div> <div class="sectionmgmt-section-students"><span class="material-symbols-outlined">group</span> <span> </span></div> <div class="sectionmgmt-section-room"><span class="material-symbols-outlined">location_on</span> <span> </span></div> <div class="sectionmgmt-section-created"><span class="material-symbols-outlined">calendar_today</span> <span> </span></div> <!></div> <!></div>'),yk=_("<p>No sections found</p>"),wk=_("<p>No sections found matching your search.</p>"),xk=_('<div class="sectionmgmt-sections-empty"><span class="material-symbols-outlined">school</span> <!></div>'),Sk=_("<!> <!>",1),kk=_(`<div class="sectionmgmt-form-container"><div class="sectionmgmt-creation-form-section"><div class="sectionmgmt-section-header"><h2 class="sectionmgmt-section-title">Create New Section</h2> <p class="sectionmgmt-section-subtitle">Fill in the details below to create a new class section</p></div> <div class="sectionmgmt-form-container"><form><div class="sectionmgmt-basic-info-row"><div class="sectionmgmt-form-group"><label class="sectionmgmt-form-label" for="section-name">Section Name *</label> <input type="text" id="section-name" class="sectionmgmt-form-input" placeholder="Enter section name (e.g., Mabini, Rizal, Bonifacio)" required/></div> <div class="sectionmgmt-form-group"><label class="sectionmgmt-form-label" for="school-year">School Year</label> <input type="text" id="school-year" class="sectionmgmt-form-input" readonly=""/></div></div> <div class="sectionmgmt-create-info-row"><div class="sectionmgmt-form-group"><label class="sectionmgmt-form-label" for="grade-level">Grade Level *</label> <div><button type="button" id="grade-level"><!> <span class="material-symbols-outlined sectionmgmt-dropdown-arrow">expand_more</span></button> <div class="sectionmgmt-dropdown-menu"></div></div></div> <div class="sectionmgmt-form-group"><label class="sectionmgmt-form-label" for="adviser">Advisory Teacher (Optional)</label> <div><button type="button" id="adviser"><!> <span class="material-symbols-outlined sectionmgmt-dropdown-arrow">expand_more</span></button> <div class="sectionmgmt-dropdown-menu"><div class="sectionmgmt-search-container"><input type="text" class="sectionmgmt-search-input" placeholder="Search teachers..."/> <span class="material-symbols-outlined sectionmgmt-search-icon">search</span></div> <!></div></div> <p class="sectionmgmt-form-help">Only teachers without assigned sections are shown. Each teacher can only advise one
							section.</p></div></div> <div class="sectionmgmt-form-group"><label class="sectionmgmt-form-label" for="students">Students (Optional)</label> <!></div> <div class="sectionmgmt-form-actions"><button type="submit"><!></button></div></form></div></div> <div class="sectionmgmt-recent-sections-section"><div class="sectionmgmt-section-header"><div class="section-header-content"><div class="section-title-group"><h2 class="sectionmgmt-section-title">All Sections</h2> <p class="sectionmgmt-section-subtitle">All sections in the system</p></div> <div class="adminform-search-filter-container"><div class="adminform-search-container"><div class="adminform-search-input-wrapper"><span class="material-symbols-outlined adminform-search-icon">search</span> <input type="text" placeholder="Search by section name, grade level, student account number, or student name..." class="adminform-search-input"/> <!></div></div> <div class="adminform-filter-container"><div><button type="button"><!> <span class="material-symbols-outlined adminform-dropdown-arrow">expand_more</span></button> <div class="adminform-dropdown-menu"></div></div></div></div></div></div> <div class="sectionmgmt-sections-grid"><!></div></div></div>`);function Ak(s,t){qa(t,!1);const[a,r]=xs(),n=()=>Ja(e(d),"$isLoadingSections",a),l=()=>Ja(e(c),"$sections",a),c=R(),d=R(),f=R(),p=R(),h=R(),g=R(),b=R(),y=R(),k=R(),A=R(),D=R(),T=R();let C=R(!1),S=R(""),M=R(""),F=R(""),j=R(null),P=R([]),Y=R(!1),W=R(!1),N=R(!1),L=R(""),X=R(""),ae=R(""),V,ie=R("all"),he=R(null),Ge=R(""),ce=R(null),se=R([]),Re=R(!1),Je=R(!1),it=R(""),Le=R(""),ke=R([]),Ke=R([]),lt=R(!1),He=R(!1);async function et(){try{const De=await(await ns("/api/current-quarter")).json();De.success&&De.data?.currentSchoolYear&&v(F,De.data.currentSchoolYear)}catch(K){console.error("Error fetching current school year:",K)}}Ya(async()=>{await et();const K=nr.initSections();await nr.loadSections(K),await Ne()});async function Ne(K=null){try{v(lt,!0);const De=K?`&teacherGradeLevel=${K}`:"",Ze=await la.get(`/api/sections?action=available-teachers&schoolYear=${e(F)}${De}`);if(Ze.success&&(v(ke,Ze.data.map(wt=>{const qt=e(h)&&e(h).length>0?e(h).some(Tt=>Tt.adviser_id===wt.id):!1;return{id:wt.id,name:wt.full_name,employeeId:wt.account_number,subject:wt.subject_code||"No Subject",subject_grade_level:wt.subject_grade_level,hasSection:qt}})),e(h)&&e(h).length>0))for(const wt of e(h))wt.adviser_id&&!e(ke).find(qt=>qt.id===wt.adviser_id)&&e(ke).push({id:wt.adviser_id,name:wt.adviser_name,employeeId:wt.adviser_account_number||"N/A",subject:wt.adviser_subject||"No Subject",subject_grade_level:wt.grade_level,hasSection:!0})}catch(De){console.error("Error loading teachers:",De),Te.error("Failed to load available teachers")}finally{v(lt,!1)}}async function ne(K){try{v(He,!0);const De=await la.get(`/api/sections?action=available-students&gradeLevel=${K}&schoolYear=${e(F)}`);De.success&&v(Ke,De.data.map(Ze=>({id:Ze.id,name:Ze.full_name,studentId:Ze.account_number,grade:Ze.grade_level,hasSection:!1})))}catch(De){console.error("Error loading students:",De),Te.error("Failed to load available students")}finally{v(He,!1)}}async function oe(K){try{const De=await la.get(`/api/sections?action=section-students&sectionId=${K}`);return De.success?De.data.map(Ze=>({id:Ze.id,name:Ze.full_name,studentId:Ze.account_number,grade:Ze.grade_level})):[]}catch(De){return console.error("Error loading section students:",De),[]}}function _e(K){e(se).findIndex(Ze=>Ze.id===K.id)>-1?v(se,e(se).filter(Ze=>Ze.id!==K.id)):v(se,[...e(se),K])}function Me(){if(e(se).length===e(T).length&&e(T).every(K=>e(se).some(De=>De.id===K.id)))v(se,e(se).filter(K=>!e(T).some(De=>De.id===K.id)));else{const K=e(T).filter(De=>!e(se).some(Ze=>Ze.id===De.id));v(se,[...e(se),...K])}}const ze=[{id:"7",name:"Grade 7",description:"First Year Junior High School"},{id:"8",name:"Grade 8",description:"Second Year Junior High School"},{id:"9",name:"Grade 9",description:"Third Year Junior High School"},{id:"10",name:"Grade 10",description:"Fourth Year Junior High School"}],Ee=[{id:"all",name:"All Sections",icon:"group"},{id:"7",name:"Grade 7",icon:"school"},{id:"8",name:"Grade 8",icon:"school"},{id:"9",name:"Grade 9",icon:"school"},{id:"10",name:"Grade 10",icon:"school"}];function pe(){v(Y,!e(Y)),v(W,!1)}function qe(){v(W,!e(W)),v(Y,!1)}function Ae(){v(N,!e(N))}function Ie(K){v(M,K.id),v(Y,!1),v(P,[]),ne(K.id),Ne(K.id)}function ut(K){v(j,K),v(W,!1),v(L,"")}function me(K){v(ie,K.id),v(N,!1)}function J(K){e(P).findIndex(Ze=>Ze.id===K.id)>-1?v(P,e(P).filter(Ze=>Ze.id!==K.id)):v(P,[...e(P),K])}function xe(){if(e(P).length===e(k).length&&e(k).every(K=>e(P).some(De=>De.id===K.id)))v(P,e(P).filter(K=>!e(k).some(De=>De.id===K.id)));else{const K=e(k).filter(De=>!e(P).some(Ze=>Ze.id===De.id));v(P,[...e(P),...K])}}function $e(){clearTimeout(V),V=setTimeout(async()=>{await nr.loadSections(!1,e(ae))},500)}function B(){v(ae,""),nr.loadSections(!1,"")}async function te(){if(!e(S)||!e(M)){Te.error("Please fill in section name and grade level.");return}v(C,!0);try{const K=await la.post("/api/sections",{sectionName:e(S),gradeLevel:parseInt(e(M)),schoolYear:e(F),adviserId:e(j)?.id||null,studentIds:e(P).map(De=>De.id),roomId:null});K.success?(Te.success(K.message),v(S,""),v(M,""),v(j,null),v(P,[]),v(L,""),v(X,""),v(Ke,[]),nr.addSection(K.data),await Ne()):Te.error(K.error||"Failed to create section")}catch(K){console.error("Error creating section:",K),Te.error("Failed to create section. Please try again.")}finally{v(C,!1)}}async function ue(K){e(he)===K.id?(v(he,null),v(Ge,""),v(ce,null),v(se,[]),v(it,""),v(Le,""),v(Je,!1)):(v(he,K.id),v(Ge,K.name),v(ce,e(ke).find(De=>De.id===K.adviser_id)),!e(ce)&&K.adviser_id&&(v(ce,{id:K.adviser_id,name:"Loading...",employeeId:"",subject:"",hasSection:!0}),await Ne(K.grade_level),v(ce,e(ke).find(De=>De.id===K.adviser_id)||e(ce))),v(se,await oe(K.id)),v(U,[...e(se)]),v(Le,""),await ne(K.grade_level))}async function G(){if(!e(Ge)){Te.error("Please fill in section name.");return}v(Re,!0);try{const K={sectionId:e(he),sectionName:e(Ge),adviserId:e(ce)?.id||null,studentIds:e(se).map(Ze=>Ze.id||Ze._id),roomId:null},De=await la.put("/api/sections",K);De.success?(Te.success(De.message),v(he,null),v(Ge,""),v(ce,null),v(se,[]),v(it,""),v(Le,""),v(Je,!1),nr.updateSection(e(he),De.data),await nr.loadSections(!0),await Ne()):Te.error(De.error||"Failed to update section")}catch(K){console.error("Error updating section:",K),Te.error("Failed to update section. Please try again.")}finally{v(Re,!1)}}function z(){v(Je,!e(Je))}async function le(K){const De=K.id;v(ce,K),v(Je,!1),v(it,""),await Ne(),v(ce,e(ke).find(Ze=>Ze.id===De)||K)}function Z(K){cs.confirm("Delete Section",`<p>Are you sure you want to permanently delete section <strong>"${K.name}"</strong> (Grade ${K.grade_level})?</p>
			<p class="sectionmgmt-warning">This action will:</p>
			<ul class="sectionmgmt-warning-list">
				<li>Permanently delete the section and all its data</li>
				<li>Remove all students from this section</li>
				<li>Free up the advisory teacher for other sections</li>
				<li>This action cannot be undone</li>
			</ul>`,()=>q(K),null,{size:"medium"})}async function q(K){try{const De=await la.delete(`/api/sections?sectionId=${K._id}`);De.success?(Te.success("Section deleted successfully"),nr.removeSection(K._id)):Te.error(De.error||"Failed to delete section")}catch(De){console.error("Error deleting section:",De),Te.error("An error occurred while deleting the section")}}let U=R([]);ht(()=>(e(c),e(d),e(f),nr),()=>{el(v(c,nr.sections),"$sections",a),el(v(d,nr.isLoadingSections),"$isLoadingSections",a),v(f,nr.sectionsError)}),ht(()=>n(),()=>{v(p,n())}),ht(()=>l(),()=>{v(h,l())}),ht(()=>e(ae),()=>{e(ae)!==void 0&&$e()}),ht(()=>e(M),()=>{v(g,ze.find(K=>K.id===e(M)))}),ht(()=>e(ie),()=>{v(b,Ee.find(K=>K.id===e(ie)))}),ht(()=>(e(ke),e(L)),()=>{v(y,e(ke).filter(K=>!K.hasSection&&K.name.toLowerCase().includes(e(L).toLowerCase())))}),ht(()=>(e(M),e(P),e(j)),()=>{e(M)&&(v(P,e(P).filter(K=>K.grade===e(M))),e(j)&&e(j).subject_grade_level&&e(j).subject_grade_level!==parseInt(e(M))&&v(j,null))}),ht(()=>(e(Ke),e(M),e(X),e(P)),()=>{v(k,e(Ke).filter(K=>{const De=K.grade===e(M),Ze=K.name.toLowerCase().includes(e(X).toLowerCase()),wt=!K.hasSection,qt=!e(P).some(Tt=>Tt.id===K.id);return De&&Ze&&(wt||!qt)}).sort((K,De)=>{const Ze=e(P).some(qt=>qt.id===K.id),wt=e(P).some(qt=>qt.id===De.id);return Ze&&!wt?-1:!Ze&&wt?1:K.name.localeCompare(De.name)}))}),ht(()=>e(h),()=>{v(A,e(h))}),ht(()=>(e(ke),e(he),e(h),e(it)),()=>{v(D,e(ke).filter(K=>{const De=e(he)&&e(h).find(kt=>kt.id===e(he))?.adviser_id,Ze=!K.hasSection||K.id===De,qt=(e(he)&&e(h).find(kt=>kt.id===e(he)))?.grade_level,Tt=!qt||!K.subject_grade_level||K.subject_grade_level===qt;return Ze&&Tt&&K.name.toLowerCase().includes(e(it).toLowerCase())}))}),ht(()=>(e(h),e(he),e(Ke),e(U),e(Le),e(se)),()=>{v(T,(()=>{e(h).find(De=>De.id===e(he));const K=[...e(Ke)];return e(U).forEach(De=>{K.some(Ze=>Ze.id===De.id)||K.push({...De,hasSection:!0})}),K.filter(De=>{const Ze=De.name.toLowerCase().includes(e(Le).toLowerCase()),wt=e(se).some(kt=>kt.id===De.id),qt=e(U).some(kt=>kt.id===De.id),Tt=!De.hasSection||wt||qt;return Ze&&Tt}).sort((De,Ze)=>{const wt=e(se).some(Tt=>Tt.id===De.id),qt=e(se).some(Tt=>Tt.id===Ze.id);return wt&&!qt?-1:!wt&&qt?1:De.name.localeCompare(Ze.name)})})())}),Ms(),Fs();var $=kk(),I=o($),H=u(o(I),2),fe=o(H),ve=o(fe),Fe=o(ve),Ce=u(o(Fe),2);ta(Ce),i(Fe);var Be=u(Fe,2),Ue=u(o(Be),2);ta(Ue),i(Be),i(ve);var Pe=u(ve,2),Ve=o(Pe),st=u(o(Ve),2);let nt;var vt=o(st);let St;var At=o(vt);{var Wt=K=>{var De=VS(),Ze=u(o(De),2),wt=o(Ze),qt=o(wt,!0);i(wt),i(Ze),i(De),O(()=>w(qt,(e(g),x(()=>e(g).name)))),m(K,De)},Nt=K=>{var De=BS();m(K,De)};E(At,K=>{e(g)?K(Wt):K(Nt,!1)})}Ht(2),i(vt);var It=u(vt,2);Dt(It,5,()=>ze,K=>K.id,(K,De)=>{var Ze=WS();let wt;var qt=u(o(Ze),2),Tt=o(qt),kt=o(Tt,!0);i(Tt);var Ea=u(Tt,2),_a=o(Ea,!0);i(Ea),i(qt),i(Ze),O(ua=>{wt=we(Ze,1,"sectionmgmt-dropdown-option",null,wt,ua),w(kt,(e(De),x(()=>e(De).name))),w(_a,(e(De),x(()=>e(De).description)))},[()=>({selected:e(M)===e(De).id})]),Se("click",Ze,()=>Ie(e(De))),m(K,Ze)}),i(It),i(st),i(Ve);var Gt=u(Ve,2),Ot=u(o(Gt),2);let sa;var Qt=o(Ot);let Pt;var Yt=o(Qt);{var ca=K=>{var De=HS(),Ze=u(o(De),2),wt=o(Ze),qt=o(wt,!0);i(wt),i(Ze),i(De),O(()=>w(qt,(e(j),x(()=>e(j).name)))),m(K,De)},ye=K=>{var De=mt(),Ze=tt(De);{var wt=Tt=>{var kt=US();m(Tt,kt)},qt=Tt=>{var kt=YS();m(Tt,kt)};E(Ze,Tt=>{e(M)?Tt(wt):Tt(qt,!1)},!0)}m(K,De)};E(Yt,K=>{e(j)?K(ca):K(ye,!1)})}Ht(2),i(Qt);var Xe=u(Qt,2),ot=o(Xe),be=o(ot);ta(be),Ht(2),i(ot);var je=u(ot,2);{var rt=K=>{var De=QS();m(K,De)},Ft=K=>{var De=mt(),Ze=tt(De);{var wt=Tt=>{var kt=KS();m(Tt,kt)},qt=Tt=>{var kt=mt(),Ea=tt(kt);Dt(Ea,1,()=>e(y),_a=>_a.id,(_a,ua)=>{var Sa=JS();let Ut;var Xt=u(o(Sa),2),ka=o(Xt),wa=o(ka,!0);i(ka);var Na=u(ka,2),pa=o(Na,!0);i(Na),i(Xt),i(Sa),O(xa=>{Ut=we(Sa,1,"sectionmgmt-dropdown-option",null,Ut,xa),w(wa,(e(ua),x(()=>e(ua).name))),w(pa,(e(ua),x(()=>e(ua).employeeId)))},[()=>({selected:e(j)?.id===e(ua).id})]),Se("click",Sa,()=>ut(e(ua))),m(_a,Sa)}),m(Tt,kt)};E(Ze,Tt=>{e(y),x(()=>e(y).length===0)?Tt(wt):Tt(qt,!1)},!0)}m(K,De)};E(je,K=>{e(lt)?K(rt):K(Ft,!1)})}i(Xe),i(Ot),Ht(2),i(Gt),i(Pe);var Vt=u(Pe,2),at=u(o(Vt),2);{var va=K=>{var De=ak(),Ze=tt(De),wt=o(Ze);ta(wt);var qt=u(wt,2);{var Tt=Sa=>{const Ut=fr(()=>(e(k),e(P),x(()=>e(k).every(Na=>e(P).some(pa=>pa.id===Na.id)))));var Xt=XS(),ka=o(Xt),wa=o(ka,!0);i(ka),i(Xt),O(()=>{Mt(Xt,"title",`${e(Ut)?"Deselect All":"Select All"} (${e(k),x(()=>e(k).length)??""})`),w(wa,e(Ut)?"deselect":"select_all")}),Se("click",Xt,xe),m(Sa,Xt)};E(qt,Sa=>{e(k),x(()=>e(k).length>0)&&Sa(Tt)})}i(Ze);var kt=u(Ze,2),Ea=o(kt);{var _a=Sa=>{var Ut=ZS();m(Sa,Ut)},ua=Sa=>{var Ut=mt(),Xt=tt(Ut);{var ka=Na=>{var pa=ek();m(Na,pa)},wa=Na=>{var pa=mt(),xa=tt(pa);Dt(xa,1,()=>e(k),Ia=>Ia.id,(Ia,re)=>{var ge=tk();let ct;var Et=o(ge),Ct=u(o(Et),2),Lt=o(Ct);i(Ct);var ra=u(Ct,2),Da=o(ra);i(ra),i(Et);var Bt=u(Et,2),We=o(Bt),Zt=o(We,!0);i(We),i(Bt),i(ge),O((xt,Rt)=>{ct=we(ge,1,"sectionmgmt-student-item",null,ct,xt),w(Lt,`Grade ${e(re),x(()=>e(re).grade)??""} |`),w(Da,`${e(re),x(()=>e(re).name)??""}  ${e(re),x(()=>e(re).studentId)??""}`),w(Zt,Rt)},[()=>({selected:e(P).some(xt=>xt.id===e(re).id)}),()=>(e(P),e(re),x(()=>e(P).some(xt=>xt.id===e(re).id)?"check_box":"check_box_outline_blank"))]),Se("click",ge,()=>J(e(re))),m(Ia,ge)}),m(Na,pa)};E(Xt,Na=>{e(k),x(()=>e(k).length===0)?Na(ka):Na(wa,!1)},!0)}m(Sa,Ut)};E(Ea,Sa=>{e(He)?Sa(_a):Sa(ua,!1)})}i(kt),ia(wt,()=>e(X),Sa=>v(X,Sa)),m(K,De)},Ca=K=>{var De=sk();m(K,De)};E(at,K=>{e(M)?K(va):K(Ca,!1)})}i(Vt);var gt=u(Vt,2),_t=o(gt);let de;var ee=o(_t);{var Q=K=>{var De=ba("Creating...");m(K,De)},Ye=K=>{var De=rk();Ht(),m(K,De)};E(ee,K=>{e(C)?K(Q):K(Ye,!1)})}i(_t),i(gt),i(fe),i(H),i(I);var Qe=u(I,2),dt=o(Qe),yt=o(dt),zt=u(o(yt),2),ga=o(zt),bt=o(ga),Oe=u(o(bt),2);ta(Oe);var ft=u(Oe,2);{var $t=K=>{var De=ik();Se("click",De,B),m(K,De)};E(ft,K=>{e(ae)&&K($t)})}i(bt),i(ga);var jt=u(ga,2),Kt=o(jt);let oa;var Jt=o(Kt);let Ta;var Aa=o(Jt);{var ya=K=>{var De=nk(),Ze=o(De),wt=o(Ze,!0);i(Ze);var qt=u(Ze,2),Tt=o(qt),kt=o(Tt,!0);i(Tt),i(qt),i(De),O(()=>{w(wt,(e(b),x(()=>e(b).icon))),w(kt,(e(b),x(()=>e(b).name)))}),m(K,De)},ma=K=>{var De=ok();m(K,De)};E(Aa,K=>{e(b)?K(ya):K(ma,!1)})}Ht(2),i(Jt);var ha=u(Jt,2);Dt(ha,5,()=>Ee,K=>K.id,(K,De)=>{var Ze=lk();let wt;var qt=o(Ze),Tt=o(qt,!0);i(qt);var kt=u(qt,2),Ea=o(kt),_a=o(Ea,!0);i(Ea),i(kt),i(Ze),O(ua=>{wt=we(Ze,1,"adminform-dropdown-option",null,wt,ua),w(Tt,(e(De),x(()=>e(De).icon))),w(_a,(e(De),x(()=>e(De).name)))},[()=>({selected:e(ie)===e(De).id})]),Se("click",Ze,()=>me(e(De))),m(K,Ze)}),i(ha),i(Kt),i(jt),i(zt),i(yt),i(dt);var Fa=u(dt,2),La=o(Fa);{var da=K=>{var De=ck();m(K,De)},fa=K=>{var De=Sk(),Ze=tt(De);Dt(Ze,1,()=>e(A),Tt=>Tt.id,(Tt,kt)=>{var Ea=bk();let _a;var ua=o(Ea),Sa=o(ua),Ut=o(Sa),Xt=o(Ut);i(Ut),i(Sa);var ka=u(Sa,2),wa=o(ka),Na=o(wa),pa=o(Na),xa=o(pa,!0);i(pa),i(Na),i(wa);var Ia=u(wa,2);i(ka),i(ua);var re=u(ua,2),ge=o(re),ct=u(o(ge),2),Et=o(ct,!0);i(ct),i(ge);var Ct=u(ge,2),Lt=u(o(Ct),2),ra=o(Lt);i(Lt),i(Ct);var Da=u(Ct,2),Bt=u(o(Da),2),We=o(Bt,!0);i(Bt),i(Da);var Zt=u(Da,2),xt=u(o(Zt),2),Rt=o(xt);i(xt),i(Zt);var ea=u(Zt,2);{var na=Ra=>{var Ba=dk(),ts=u(o(Ba),2),_s=o(ts);i(ts),i(Ba),O(Ga=>w(_s,`Updated: ${Ga??""}`),[()=>(e(kt),x(()=>new Date(e(kt).updated_at).toLocaleDateString()))]),m(Ra,Ba)};E(ea,Ra=>{e(kt),x(()=>e(kt).updated_at&&e(kt).updated_at!==e(kt).created_at)&&Ra(na)})}i(re);var ja=u(re,2);{var $a=Ra=>{var Ba=_k(),ts=o(Ba),_s=u(o(ts),2),Ga=o(_s),ss=o(Ga),Pa=u(o(ss),2);ta(Pa),i(ss);var Ha=u(ss,2),vs=u(o(Ha),2);let es;var Za=o(vs);let rs;var is=o(Za);{var bs=Oa=>{var Va=uk(),ws=u(o(Va),2),js=o(ws),er=o(js,!0);i(js),i(ws),i(Va),O(()=>w(er,(e(ce),x(()=>e(ce).name)))),m(Oa,Va)},ys=Oa=>{var Va=vk();m(Oa,Va)};E(is,Oa=>{e(ce)?Oa(bs):Oa(ys,!1)})}Ht(2),i(Za);var As=u(Za,2),Ds=o(As),Us=o(Ds);ta(Us),Ht(2),i(Ds);var ar=u(Ds,2);Dt(ar,1,()=>e(D),Oa=>Oa.id,(Oa,Va)=>{var ws=fk();let js;var er=u(o(ws),2),rr=o(er),mr=o(rr,!0);i(rr);var Nr=u(rr,2),xi=o(Nr,!0);i(Nr),i(er),i(ws),O(Vr=>{js=we(ws,1,"sectionmgmt-dropdown-option",null,js,Vr),w(mr,(e(Va),x(()=>e(Va).name))),w(xi,(e(Va),x(()=>e(Va).employeeId)))},[()=>({selected:e(ce)?.id===e(Va).id})]),Se("click",ws,()=>le(e(Va))),m(Oa,ws)});var sr=u(ar,2);{var Gr=Oa=>{var Va=pk();m(Oa,Va)};E(sr,Oa=>{e(D),x(()=>e(D).length===0)&&Oa(Gr)})}i(As),i(vs),i(Ha),i(Ga);var pr=u(Ga,2),gi=o(pr),_i=o(gi);i(gi);var si=u(gi,2),bi=o(si);ta(bi);var Ki=u(bi,2);{var Ji=Oa=>{const Va=fr(()=>(e(T),e(se),x(()=>e(T).every(rr=>e(se).some(mr=>mr.id===rr.id)))));var ws=mk(),js=o(ws),er=o(js,!0);i(js),i(ws),O(()=>{Mt(ws,"title",`${e(Va)?"Deselect All":"Select All"} (${e(T),x(()=>e(T).length)??""})`),w(er,e(Va)?"deselect":"select_all")}),Se("click",ws,Me),m(Oa,ws)};E(Ki,Oa=>{e(T),x(()=>e(T).length>0)&&Oa(Ji)})}i(si);var Xi=u(si,2),Zi=o(Xi);Dt(Zi,1,()=>e(T),Oa=>Oa.id,(Oa,Va)=>{var ws=hk();let js;var er=o(ws),rr=u(o(er),2),mr=o(rr,!0);i(rr);var Nr=u(rr,2),xi=o(Nr);i(Nr),i(er);var Vr=u(er,2),ri=o(Vr,!0);i(Vr),i(ws),O((Br,ii)=>{js=we(ws,1,"sectionmgmt-student-item",null,js,Br),w(mr,(e(Va),x(()=>e(Va).name))),w(xi,`${e(Va),x(()=>e(Va).studentId)??""}  Grade ${e(Va),x(()=>e(Va).grade)??""}`),w(ri,ii)},[()=>({selected:e(se).some(Br=>Br.id===e(Va).id)}),()=>(e(se),e(Va),x(()=>e(se).some(Br=>Br.id===e(Va).id)?"check_box":"check_box_outline_blank"))]),Se("click",ws,()=>_e(e(Va))),m(Oa,ws)});var Vn=u(Zi,2);{var fs=Oa=>{var Va=gk();m(Oa,Va)};E(Vn,Oa=>{e(T),x(()=>e(T).length===0)&&Oa(fs)})}i(Xi),i(pr);var ds=u(pr,2),Cs=o(ds),Os=u(Cs,2),yi=o(Os);{var wi=Oa=>{var Va=ba("Updating...");m(Oa,Va)},en=Oa=>{var Va=ba("Update");m(Oa,Va)};E(yi,Oa=>{e(Re)?Oa(wi):Oa(en,!1)})}i(Os),i(ds),i(_s),i(ts),i(Ba),O((Oa,Va)=>{es=we(vs,1,"sectionmgmt-custom-dropdown",null,es,Oa),rs=we(Za,1,"sectionmgmt-dropdown-trigger",null,rs,Va),w(_i,`Students (${e(se),x(()=>e(se).length)??""} selected)`),Os.disabled=e(Re)||!e(Ge)},[()=>({open:e(Je)}),()=>({selected:e(ce)})]),ia(Pa,()=>e(Ge),Oa=>v(Ge,Oa)),Se("click",Za,z),ia(Us,()=>e(it),Oa=>v(it,Oa)),ia(bi,()=>e(Le),Oa=>v(Le,Oa)),Se("click",Cs,()=>ue(e(kt))),Se("submit",_s,tr(G)),m(Ra,Ba)};E(ja,Ra=>{e(he),e(kt),x(()=>e(he)===e(kt).id)&&Ra($a)})}i(Ea),O((Ra,Ba)=>{_a=we(Ea,1,"sectionmgmt-section-card",null,_a,Ra),Mt(Ea,"id",`sectionmgmt-section-card-${e(kt),x(()=>e(kt).id)??""}`),w(Xt,`${e(kt),x(()=>e(kt).name)??""}  Grade ${e(kt),x(()=>e(kt).grade_level)??""}`),Mt(wa,"href",`#sectionmgmt-section-card-${e(kt),x(()=>e(kt).id)??""}`),Mt(Na,"title",(e(he),e(kt),x(()=>e(he)===e(kt).id?"Cancel Edit":"Edit Section"))),w(xa,(e(he),e(kt),x(()=>e(he)===e(kt).id?"close":"edit"))),w(Et,(e(kt),x(()=>e(kt).adviser_name||"No adviser"))),w(ra,`${e(kt),x(()=>e(kt).student_count)??""} students`),w(We,(e(kt),x(()=>e(kt).room_name?`${e(kt).room_name} (${e(kt).room_building}, ${e(kt).room_floor})`:"No room assigned"))),w(Rt,`Created: ${Ba??""}`)},[()=>({editing:e(he)===e(kt).id}),()=>(e(kt),x(()=>new Date(e(kt).created_at).toLocaleDateString()))]),Se("click",Na,()=>ue(e(kt))),Se("click",Ia,()=>Z(e(kt))),m(Tt,Ea)});var wt=u(Ze,2);{var qt=Tt=>{var kt=xk(),Ea=u(o(kt),2);{var _a=Sa=>{var Ut=yk();m(Sa,Ut)},ua=Sa=>{var Ut=wk();m(Sa,Ut)};E(Ea,Sa=>{e(h),x(()=>e(h).length===0)?Sa(_a):Sa(ua,!1)})}i(kt),m(Tt,kt)};E(wt,Tt=>{e(A),x(()=>e(A).length===0)&&Tt(qt)})}m(K,De)};E(La,K=>{e(p)?K(da):K(fa,!1)})}i(Fa),i(Qe),i($),O((K,De,Ze,wt,qt,Tt,kt)=>{nt=we(st,1,"sectionmgmt-custom-dropdown",null,nt,K),St=we(vt,1,"sectionmgmt-dropdown-trigger",null,St,De),sa=we(Ot,1,"sectionmgmt-custom-dropdown",null,sa,Ze),Pt=we(Qt,1,"sectionmgmt-dropdown-trigger",null,Pt,wt),Qt.disabled=!e(M),de=we(_t,1,"sectionmgmt-create-button",null,de,qt),_t.disabled=e(C)||!e(S)||!e(M),oa=we(Kt,1,"adminform-custom-dropdown",null,oa,Tt),Ta=we(Jt,1,"adminform-dropdown-trigger adminform-filter-trigger",null,Ta,kt)},[()=>({open:e(Y)}),()=>({selected:e(M)}),()=>({open:e(W)}),()=>({selected:e(j)}),()=>({loading:e(C)}),()=>({open:e(N)}),()=>({selected:e(ie)!=="all"})]),ia(Ce,()=>e(S),K=>v(S,K)),ia(Ue,()=>e(F),K=>v(F,K)),Se("click",vt,pe),Se("click",Qt,qe),ia(be,()=>e(L),K=>v(L,K)),Se("submit",fe,tr(te)),ia(Oe,()=>e(ae),K=>v(ae,K)),Se("click",Jt,Ae),m(s,$),za(),r()}var Dk=_('<div class="scheduleassign-container"><div class="scheduleassign-header"><div class="scheduleassign-header-content"><h1 class="scheduleassign-page-title">Schedule Management</h1> <p class="scheduleassign-page-subtitle">Assign subjects and teachers to sections with specific time periods</p></div> <div class="admin-tab-navigation"><button><span class="material-icons">schedule</span> Schedule</button> <button><span class="material-icons">groups</span> Section</button> <button><span class="material-icons">meeting_room</span> Room</button></div></div> <div class="schedule-content-container"><!> <!> <!></div></div>');function Ck(s){let t=R("schedule");function a(S){v(t,S)}var r=Dk(),n=o(r),l=u(o(n),2),c=o(l);let d;var f=u(c,2);let p;var h=u(f,2);let g;i(l),i(n);var b=u(n,2),y=o(b);{var k=S=>{bS(S,{})};E(y,S=>{e(t)==="schedule"&&S(k)})}var A=u(y,2);{var D=S=>{Ak(S,{})};E(A,S=>{e(t)==="section"&&S(D)})}var T=u(A,2);{var C=S=>{zS(S,{})};E(T,S=>{e(t)==="room"&&S(C)})}i(b),i(r),O((S,M,F)=>{d=we(c,1,"admin-tab-button",null,d,S),p=we(f,1,"admin-tab-button",null,p,M),g=we(h,1,"admin-tab-button",null,g,F)},[()=>({active:e(t)==="schedule"}),()=>({active:e(t)==="section"}),()=>({active:e(t)==="room"})]),Se("click",c,()=>a("schedule")),Se("click",f,()=>a("section")),Se("click",h,()=>a("room")),m(s,r)}var Tk=_('<div class="adminsubject-selected-option"><span class="material-symbols-outlined adminsubject-option-icon">school</span> <div class="adminsubject-option-content"><span class="adminsubject-option-name"> </span></div></div>'),Ek=_('<span class="adminsubject-placeholder">Select grade level</span>'),Fk=_('<button type="button"><span class="material-symbols-outlined adminsubject-option-icon">school</span> <div class="adminsubject-option-content"><span class="adminsubject-option-name"> </span> <span class="adminsubject-option-description"> </span></div></button>'),Nk=_('<span class="material-symbols-outlined">add_circle</span> Create Subject',1),$k=_('<button type="button" class="adminsubject-clear-search-button"><span class="material-symbols-outlined">close</span></button>'),Lk=_('<div class="adminsubject-loading-container"><span class="subject-loader"></span> <p class="adminsubject-loading-text">Loading subjects...</p></div>'),Pk=_('<div class="adminsubject-selected-option"><span class="material-symbols-outlined adminsubject-option-icon">school</span> <div class="adminsubject-option-content"><span class="adminsubject-option-name"> </span></div></div>'),Mk=_('<span class="adminsubject-placeholder">Select grade level</span>'),Ik=_('<button type="button"><span class="material-symbols-outlined adminsubject-option-icon">school</span> <div class="adminsubject-option-content"><span class="adminsubject-option-name"> </span> <span class="adminsubject-option-description"> </span></div></button>'),Rk=_('<div class="adminsubject-edit-form-section"><div class="adminsubject-edit-form-container" id="adminsubject-edit-form-container"><div class="adminsubject-edit-form-header"><h2 class="adminsubject-edit-form-title">Edit Subject</h2> <p class="adminsubject-edit-form-subtitle">Update subject information</p></div> <form class="adminsubject-edit-form-content"><div class="adminsubject-edit-form-row"><div class="adminsubject-form-group adminsubject-form-group-third"><label class="adminsubject-form-label" for="edit-grade-level">Grade Level *</label> <div><button type="button" id="edit-grade-level"><!> <span class="material-symbols-outlined adminsubject-dropdown-arrow">expand_more</span></button> <div class="adminsubject-dropdown-menu"></div></div></div> <div class="adminsubject-form-group adminsubject-form-group-third"><label for="editSubjectName" class="adminsubject-form-label">Subject Name *</label> <input id="editSubjectName" type="text" class="adminsubject-form-input" placeholder="e.g., Mathematics, English" required/></div> <div class="adminsubject-form-group adminsubject-form-group-third"><label for="editSubjectCode" class="adminsubject-form-label">Subject Code *</label> <input id="editSubjectCode" type="text" class="adminsubject-form-input" placeholder="e.g., MATH-7, ENG-8" required/></div></div> <div class="adminsubject-edit-form-actions"><button type="button" class="adminsubject-cancel-button">Cancel</button> <button type="submit" class="adminsubject-submit-button"><!></button></div></form></div></div>'),Ok=_('<div class="adminsubject-subject-card"><div class="adminsubject-subject-header"><div class="adminsubject-subject-title"><h3 class="adminsubject-subject-name"> </h3></div> <div class="adminsubject-action-buttons"><a><button type="button" class="adminsubject-edit-button"><span class="material-symbols-outlined"> </span></button></a> <button type="button" class="adminsubject-remove-button" title="Remove Subject"><span class="material-symbols-outlined">delete</span></button></div></div> <div class="adminsubject-subject-details"><div class="adminsubject-subject-item-detail"><span class="material-symbols-outlined">qr_code_2</span> <span> </span></div> <div class="adminsubject-subject-item-detail"><span class="material-symbols-outlined">calendar_today</span> <span> </span></div> <div class="adminsubject-subject-item-detail"><span class="material-symbols-outlined">update</span> <span> </span></div></div> <!></div>'),jk=_('<div class="adminsubject-no-results"><span class="material-symbols-outlined adminsubject-no-results-icon">search_off</span> <p>No subjects found matching your search.</p></div>'),qk=_('<div class="admin-creation-layout"><div class="admin-creation-form-section"><div class="admin-section-header"><h2 class="admin-section-title">Create New Subject</h2> <p class="admin-section-subtitle">Fill in the details below to create a new subject</p></div> <div class="admin-form-container"><form><div class="admin-form-row"><div class="admin-form-group admin-form-group-third"><label class="admin-form-label" for="grade-level">Grade Level *</label> <div><button type="button" id="grade-level"><!> <span class="material-symbols-outlined adminsubject-dropdown-arrow">expand_more</span></button> <div class="adminsubject-dropdown-menu"></div></div></div> <div class="admin-form-group admin-form-group-third"><label for="subjectName" class="admin-form-label">Subject Name *</label> <input id="subjectName" type="text" class="admin-form-input" placeholder="e.g., Mathematics, English" required/></div> <div class="admin-form-group admin-form-group-third"><label for="subjectCode" class="admin-form-label">Subject Code *</label> <input id="subjectCode" type="text" class="admin-form-input" placeholder="e.g., MATH-7, ENG-8" required/></div></div> <div class="admin-form-actions"><button type="submit"><!></button></div></form></div></div> <div class="admin-recent-subjects-section"><div class="admin-section-header"><div class="section-header-content"><div class="section-title-group"><h2 class="admin-section-title">All Subjects</h2> <p class="admin-section-subtitle">All subjects in the system</p></div> <div class="adminsubject-search-container"><div class="adminsubject-search-input-wrapper"><span class="material-symbols-outlined adminsubject-search-icon">search</span> <input type="text" placeholder="Search by subject name or code..." class="adminsubject-search-input"/> <!></div></div></div></div> <div class="adminsubject-subjects-grid"><!></div></div></div>'),zk=_('<div class="adminsubject-selected-option"><span class="material-symbols-outlined adminsubject-option-icon"> </span> <div class="adminsubject-option-content"><span class="adminsubject-option-name"> </span></div></div>'),Gk=_('<span class="adminsubject-placeholder">Select icon</span>'),Vk=_('<button type="button"><span class="material-symbols-outlined adminsubject-option-icon"> </span> <div class="adminsubject-option-content"><span class="adminsubject-option-name"> </span></div></button>'),Bk=_('<span class="material-symbols-outlined">add_circle</span> Create Activity Type',1),Wk=_('<button type="button" class="adminactivity-clear-search-button"><span class="material-symbols-outlined">close</span></button>'),Hk=_('<div class="adminsubject-selected-option"><span class="material-symbols-outlined adminsubject-option-icon"> </span> <div class="adminsubject-option-content"><span class="adminsubject-option-name"> </span></div></div>'),Uk=_('<span class="adminsubject-placeholder">Select icon</span>'),Yk=_('<button type="button"><span class="material-symbols-outlined adminsubject-option-icon"> </span> <div class="adminsubject-option-content"><span class="adminsubject-option-name"> </span></div></button>'),Qk=_('<div class="adminsubject-edit-form-section"><div class="adminsubject-edit-form-container"><div class="adminsubject-edit-form-header"><h2 class="adminsubject-edit-form-title">Edit Activity Type</h2> <p class="adminsubject-edit-form-subtitle">Update activity type information</p></div> <form class="adminsubject-edit-form-content"><div class="adminsubject-edit-form-row"><div class="adminsubject-form-group adminsubject-form-group-third"><label class="adminsubject-form-label" for="edit-activity-name">Activity Name *</label> <input type="text" class="adminsubject-form-input" id="edit-activity-name" placeholder="e.g., Flag Ceremony" required/></div> <div class="adminsubject-form-group adminsubject-form-group-third"><label class="adminsubject-form-label" for="edit-activity-code">Activity Code *</label> <input type="text" class="adminsubject-form-input" id="edit-activity-code" placeholder="e.g., FLAG" required/></div> <div class="adminsubject-form-group adminsubject-form-group-third"><label class="adminsubject-form-label" for="edit-activity-icon">Icon</label> <div><button type="button" id="edit-activity-icon"><!> <span class="material-symbols-outlined adminsubject-dropdown-arrow">expand_more</span></button> <div class="adminsubject-dropdown-menu"></div></div></div></div> <div class="adminsubject-edit-form-actions"><a><button type="button" class="adminsubject-cancel-button">Cancel</button></a> <button type="submit"><!></button></div></form></div></div>'),Kk=_('<div class="adminactivity-activity-card"><div class="adminactivity-activity-header"><div class="adminactivity-activity-title"><h3 class="adminactivity-activity-name"> </h3></div> <div class="adminactivity-action-buttons"><a><button type="button" class="adminactivity-edit-button"><span class="material-symbols-outlined"> </span></button></a> <button type="button" class="adminactivity-remove-button" title="Remove Activity Type"><span class="material-symbols-outlined">delete</span></button></div></div> <div class="adminactivity-activity-details"><div class="adminactivity-activity-item-detail"><span class="material-symbols-outlined">qr_code_2</span> <span> </span></div> <div class="adminactivity-activity-item-detail"><span class="material-symbols-outlined"> </span> <span> </span></div> <div class="adminactivity-activity-item-detail"><span class="material-symbols-outlined">palette</span> <span> </span></div> <div class="adminactivity-activity-item-detail"><span class="material-symbols-outlined">calendar_today</span> <span> </span></div></div> <!></div>'),Jk=_("<p>No activity types created yet.</p>"),Xk=_("<p>No activity types found matching your search.</p>"),Zk=_('<div class="adminsubject-no-results"><span class="material-symbols-outlined adminsubject-no-results-icon">event_note</span> <!></div>'),eA=_('<div class="admin-creation-layout"><div class="admin-creation-form-section"><div class="admin-section-header"><h2 class="admin-section-title">Create New Activity Type</h2> <p class="admin-section-subtitle">Fill in the details below to create a new activity type</p></div> <div class="admin-form-container"><form><div class="admin-form-row"><div class="admin-form-group admin-form-group-third"><label class="admin-form-label" for="activity-name">Activity Name *</label> <input id="activity-name" type="text" class="admin-form-input" placeholder="e.g., Flag Ceremony, Break Time" required/></div> <div class="admin-form-group admin-form-group-third"><label class="admin-form-label" for="activity-code">Activity Code *</label> <input id="activity-code" type="text" class="admin-form-input" placeholder="e.g., FLAG, BREAK" required/></div> <div class="admin-form-group admin-form-group-third"><label class="admin-form-label" for="activity-icon">Icon</label> <div><button type="button" id="activity-icon"><!> <span class="material-symbols-outlined adminsubject-dropdown-arrow">expand_more</span></button> <div class="adminsubject-dropdown-menu"></div></div></div></div> <div class="admin-form-actions"><button type="submit"><!></button></div></form></div></div> <div class="admin-recent-subjects-section"><div class="admin-section-header"><div class="section-header-content"><div class="section-title-group"><h2 class="admin-section-title">All Activities</h2> <p class="admin-section-subtitle">All activity types in the system</p></div> <div class="adminactivity-search-container"><div class="adminactivity-search-input-wrapper"><span class="material-symbols-outlined adminactivity-search-icon">search</span> <input type="text" placeholder="Search by activity name or code..." class="adminactivity-search-input"/> <!></div></div></div></div> <div class="adminactivity-activities-grid"><!></div></div></div>'),tA=_('<div class="admin-subject-creation-container"><div class="admin-subject-header"><div class="admin-header-content"><h1 class="admin-page-title">Subjects & Activities</h1> <p class="admin-page-subtitle">Manage subjects and activity types for the curriculum</p></div> <div class="admin-tab-navigation"><button><span class="material-icons">subject</span> Subjects</button> <button><span class="material-icons">event</span> Activity Types</button></div></div> <!> <!></div>');function aA(s,t){qa(t,!1);const a=R(),r=R(),n=R(),l=R();let c=R(!1),d=R(""),f=R(""),p=R(""),h=R(!1),g=R(""),b=R(""),y=R("");function k(){v(g,"")}function A(){v(y,"")}let D=R(null),T=R(""),C=R(""),S=R(""),M=R(!1),F=R(!1),j=R("subjects"),P=R([]),Y=R(!1),W=R(""),N=R(""),L=R("event"),X=R(!1),ae=R(null),V=R(""),ie=R(""),he=R("event"),Ge=R(!1),ce=R(!1),se=R(!1),Re=R([]);const Je=[{value:7,label:"Grade 7",description:"Junior High School - First Year"},{value:8,label:"Grade 8",description:"Junior High School - Second Year"},{value:9,label:"Grade 9",description:"Junior High School - Third Year"},{value:10,label:"Grade 10",description:"Junior High School - Fourth Year"}],it=[{value:"event",name:"Event"},{value:"flag",name:"Flag"},{value:"coffee",name:"Coffee"},{value:"restaurant",name:"Restaurant"},{value:"groups",name:"Groups"},{value:"home",name:"Home"},{value:"book",name:"Book"},{value:"group_work",name:"Group Work"},{value:"schedule",name:"Schedule"}];async function Le(){v(se,!0);try{const $=await la.get("/api/subjects");$.success?v(Re,$.data):Te.error("Failed to load subjects: "+$.message)}catch($){console.error("Error loading subjects:",$),Te.error("Failed to load subjects. Please try again.")}finally{v(se,!1)}}async function ke(){try{const $=await la.get("/api/activity-types");$.success?v(P,$.data):Te.error("Failed to load activity types: "+$.message)}catch($){console.error("Error loading activity types:",$),Te.error("Failed to load activity types. Please try again.")}}Ya(()=>{Le(),ke()});async function Ke(){if(!e(d)||!e(f).trim()||!e(p).trim()){Te.error("Please fill in all required fields");return}v(c,!0);try{const $=await la.post("/api/subjects",{name:e(f).trim(),code:e(p).trim(),gradeLevel:e(d)});$.success?(v(Re,[$.data,...e(Re)]),v(d,""),v(f,""),v(p,""),Te.success($.message)):Te.error($.message)}catch($){console.error("Error creating subject:",$),Te.error("Failed to create subject. Please try again.")}finally{v(c,!1)}}async function lt($){cs.confirm("Remove Subject",`<p>Are you sure you want to remove the subject <strong>"${$.name}"</strong>?</p>`,async()=>{try{const I=await la.delete("/api/subjects",{id:$.id});I.success?(v(Re,e(Re).filter(H=>H.id!==$.id)),Te.success(I.message)):Te.error(I.message)}catch(I){console.error("Error removing subject:",I),Te.error("Failed to remove subject. Please try again.")}},null,{size:"small"})}function He(){v(F,!e(F))}function et($){v(S,$.value),v(F,!1)}function Ne(){v(h,!e(h))}function ne($){v(d,$.value),v(h,!1)}function oe($){$.target.closest(".adminsubject-custom-dropdown")||(v(h,!1),v(F,!1),v(X,!1),v(ce,!1))}function _e(){v(X,!e(X))}function Me($){v(L,$),v(X,!1)}function ze($){const I=it.find(H=>H.value===$);return I?I.name:$}function Ee($){e(D)===$.id?(v(D,null),v(T,""),v(C,""),v(S,""),v(F,!1)):(v(D,$.id),v(T,$.name),v(C,$.code),v(S,parseInt($.gradeLevel.replace("Grade ",""))))}async function pe(){if(!e(T).trim()||!e(C).trim()||!e(S)){Te.error("Please fill in all required fields");return}v(M,!0);try{const $=await la.put("/api/subjects",{id:e(D),name:e(T).trim(),code:e(C).trim(),gradeLevel:e(S)});$.success?(v(Re,e(Re).map(I=>I.id===e(D)?$.data:I)),Te.success($.message),v(D,null),v(T,""),v(C,""),v(S,""),v(F,!1)):Te.error($.message)}catch($){console.error("Error updating subject:",$),Te.error("Failed to update subject. Please try again.")}finally{v(M,!1)}}function qe($){e(ae)===$.id?(v(ae,null),v(V,""),v(ie,""),v(he,"event"),v(ce,!1)):(v(ae,$.id),v(V,$.name),v(ie,$.code),v(he,$.icon))}async function Ae(){if(!e(V).trim()||!e(ie).trim()){Te.error("Please fill in all required fields");return}v(Ge,!0);try{const $=await la.put("/api/activity-types",{id:e(ae),name:e(V).trim(),code:e(ie).trim(),icon:e(he)});$.success?(recentActivityTypes=recentActivityTypes.map(I=>I.id===e(ae)?$.data:I),Te.success($.message),v(ae,null),v(V,""),v(ie,""),v(he,"event"),v(ce,!1)):Te.error($.message)}catch($){console.error("Error updating activity type:",$),Te.error("Failed to update activity type. Please try again.")}finally{v(Ge,!1)}}function Ie(){v(ce,!e(ce))}function ut($){v(he,$),v(ce,!1)}async function me(){if(!e(W).trim()||!e(N).trim()){Te.error("Please fill in all required fields");return}v(Y,!0);try{const $=await la.post("/api/activity-types",{name:e(W).trim(),code:e(N).trim(),icon:e(L)});$.success?(v(P,[$.data,...e(P)]),v(W,""),v(N,""),v(L,"event"),Te.success("Activity type created successfully")):Te.error($.message)}catch($){console.error("Error creating activity type:",$),Te.error("Failed to create activity type. Please try again.")}finally{v(Y,!1)}}async function J($){cs.confirm("Remove Activity Type",`<p>Are you sure you want to remove the activity type <strong>"${$.name}"</strong>?</p>`,async()=>{try{const I=await la.delete("/api/activity-types",{id:$.id});I.success?(v(P,e(P).filter(H=>H.id!==$.id)),Te.success(I.message)):Te.error(I.message)}catch(I){console.error("Error removing activity type:",I),Te.error("Failed to remove activity type. Please try again.")}},null,{size:"small"})}ht(()=>e(d),()=>{v(a,Je.find($=>$.value===e(d)))}),ht(()=>(e(Re),e(g),e(b)),()=>{v(r,e(Re).filter($=>{const I=$.name.toLowerCase().includes(e(g).toLowerCase())||$.code.toLowerCase().includes(e(g).toLowerCase()),H=e(b)?$.gradeLevel===`Grade ${e(b)}`:!0;return I&&H}))}),ht(()=>(e(P),e(y)),()=>{v(n,e(P).filter($=>$.name.toLowerCase().includes(e(y).toLowerCase())||$.code.toLowerCase().includes(e(y).toLowerCase())))}),ht(()=>e(S),()=>{v(l,Je.find($=>$.value===e(S)))}),Ms(),Fs();var xe=tA();Se("click",Zs,oe);var $e=o(xe),B=u(o($e),2),te=o(B);let ue;var G=u(te,2);let z;i(B),i($e);var le=u($e,2);{var Z=$=>{var I=qk(),H=o(I),fe=u(o(H),2),ve=o(fe),Fe=o(ve),Ce=o(Fe),Be=u(o(Ce),2);let Ue;var Pe=o(Be);let Ve;var st=o(Pe);{var nt=gt=>{var _t=Tk(),de=u(o(_t),2),ee=o(de),Q=o(ee,!0);i(ee),i(de),i(_t),O(()=>w(Q,(e(a),x(()=>e(a).label)))),m(gt,_t)},vt=gt=>{var _t=Ek();m(gt,_t)};E(st,gt=>{e(a)?gt(nt):gt(vt,!1)})}Ht(2),i(Pe);var St=u(Pe,2);Dt(St,5,()=>Je,gt=>gt.value,(gt,_t)=>{var de=Fk();let ee;var Q=u(o(de),2),Ye=o(Q),Qe=o(Ye,!0);i(Ye);var dt=u(Ye,2),yt=o(dt,!0);i(dt),i(Q),i(de),O(zt=>{ee=we(de,1,"adminsubject-dropdown-option",null,ee,zt),w(Qe,(e(_t),x(()=>e(_t).label))),w(yt,(e(_t),x(()=>e(_t).description)))},[()=>({selected:e(d)===e(_t).value})]),Se("click",de,()=>ne(e(_t))),m(gt,de)}),i(St),i(Be),i(Ce);var At=u(Ce,2),Wt=u(o(At),2);ta(Wt),i(At);var Nt=u(At,2),It=u(o(Nt),2);ta(It),i(Nt),i(Fe);var Gt=u(Fe,2),Ot=o(Gt);let sa;var Qt=o(Ot);{var Pt=gt=>{var _t=ba("Creating...");m(gt,_t)},Yt=gt=>{var _t=Nk();Ht(),m(gt,_t)};E(Qt,gt=>{e(c)?gt(Pt):gt(Yt,!1)})}i(Ot),i(Gt),i(ve),i(fe),i(H);var ca=u(H,2),ye=o(ca),Xe=o(ye),ot=u(o(Xe),2),be=o(ot),je=u(o(be),2);ta(je);var rt=u(je,2);{var Ft=gt=>{var _t=$k();Se("click",_t,k),m(gt,_t)};E(rt,gt=>{e(g)&&gt(Ft)})}i(be),i(ot),i(Xe),i(ye);var Vt=u(ye,2),at=o(Vt);{var va=gt=>{var _t=Lk();m(gt,_t)},Ca=gt=>{var _t=mt(),de=tt(_t);Dt(de,1,()=>e(r),ee=>ee.id,(ee,Q)=>{var Ye=Ok(),Qe=o(Ye),dt=o(Qe),yt=o(dt),zt=o(yt);i(yt),i(dt);var ga=u(dt,2),bt=o(ga),Oe=o(bt),ft=o(Oe),$t=o(ft,!0);i(ft),i(Oe),i(bt);var jt=u(bt,2);i(ga),i(Qe);var Kt=u(Qe,2),oa=o(Kt),Jt=u(o(oa),2),Ta=o(Jt,!0);i(Jt),i(oa);var Aa=u(oa,2),ya=u(o(Aa),2),ma=o(ya);i(ya),i(Aa);var ha=u(Aa,2),Fa=u(o(ha),2),La=o(Fa);i(Fa),i(ha),i(Kt);var da=u(Kt,2);{var fa=K=>{var De=Rk(),Ze=o(De),wt=u(o(Ze),2),qt=o(wt),Tt=o(qt),kt=u(o(Tt),2);let Ea;var _a=o(kt);let ua;var Sa=o(_a);{var Ut=Lt=>{var ra=Pk(),Da=u(o(ra),2),Bt=o(Da),We=o(Bt,!0);i(Bt),i(Da),i(ra),O(()=>w(We,(e(l),x(()=>e(l).label)))),m(Lt,ra)},Xt=Lt=>{var ra=Mk();m(Lt,ra)};E(Sa,Lt=>{e(l)?Lt(Ut):Lt(Xt,!1)})}Ht(2),i(_a);var ka=u(_a,2);Dt(ka,5,()=>Je,Lt=>Lt.value,(Lt,ra)=>{var Da=Ik();let Bt;var We=u(o(Da),2),Zt=o(We),xt=o(Zt,!0);i(Zt);var Rt=u(Zt,2),ea=o(Rt,!0);i(Rt),i(We),i(Da),O(na=>{Bt=we(Da,1,"adminsubject-dropdown-option",null,Bt,na),w(xt,(e(ra),x(()=>e(ra).label))),w(ea,(e(ra),x(()=>e(ra).description)))},[()=>({selected:e(S)===e(ra).value})]),Se("click",Da,()=>et(e(ra))),m(Lt,Da)}),i(ka),i(kt),i(Tt);var wa=u(Tt,2),Na=u(o(wa),2);ta(Na),i(wa);var pa=u(wa,2),xa=u(o(pa),2);ta(xa),i(pa),i(qt);var Ia=u(qt,2),re=o(Ia),ge=u(re,2),ct=o(ge);{var Et=Lt=>{var ra=ba("Updating...");m(Lt,ra)},Ct=Lt=>{var ra=ba("Update Subject");m(Lt,ra)};E(ct,Lt=>{e(M)?Lt(Et):Lt(Ct,!1)})}i(ge),i(Ia),i(wt),i(Ze),i(De),O((Lt,ra,Da)=>{Ea=we(kt,1,"adminsubject-custom-dropdown",null,Ea,Lt),ua=we(_a,1,"adminsubject-dropdown-trigger",null,ua,ra),ge.disabled=Da},[()=>({open:e(F)}),()=>({selected:e(S)}),()=>(e(M),e(T),e(C),e(S),x(()=>e(M)||!e(T).trim()||!e(C).trim()||!e(S)))]),Se("click",_a,He),ia(Na,()=>e(T),Lt=>v(T,Lt)),ia(xa,()=>e(C),Lt=>v(C,Lt)),Se("click",re,()=>Ee(e(Q))),Se("submit",wt,tr(pe)),m(K,De)};E(da,K=>{e(D),e(Q),x(()=>e(D)===e(Q).id)&&K(fa)})}i(Ye),O(()=>{Mt(Ye,"id",`adminsubject-subject-card-${e(Q),x(()=>e(Q).id)??""}`),w(zt,`${e(Q),x(()=>e(Q).name)??""}  ${e(Q),x(()=>e(Q).gradeLevel)??""}`),Mt(bt,"href",`#adminsubject-subject-card-${e(Q),x(()=>e(Q).id)??""}`),Mt(Oe,"title",(e(D),e(Q),x(()=>e(D)===e(Q).id?"Cancel Edit":"Edit Subject"))),w($t,(e(D),e(Q),x(()=>e(D)===e(Q).id?"close":"edit"))),w(Ta,(e(Q),x(()=>e(Q).code))),w(ma,`Created: ${e(Q),x(()=>e(Q).createdDate)??""}`),w(La,`Updated: ${e(Q),x(()=>e(Q).updatedDate)??""}`)}),Se("click",Oe,()=>Ee(e(Q))),Se("click",jt,()=>lt(e(Q))),m(ee,Ye)},ee=>{var Q=jk();m(ee,Q)}),m(gt,_t)};E(at,gt=>{e(se)?gt(va):gt(Ca,!1)})}i(Vt),i(ca),i(I),O((gt,_t,de,ee)=>{Ue=we(Be,1,"adminsubject-custom-dropdown",null,Ue,gt),Ve=we(Pe,1,"adminsubject-dropdown-trigger",null,Ve,_t),Wt.disabled=!e(d),sa=we(Ot,1,"admin-create-button",null,sa,de),Ot.disabled=ee},[()=>({open:e(h)}),()=>({selected:e(d)}),()=>({loading:e(c)}),()=>(e(c),e(d),e(f),x(()=>e(c)||!e(d)||!e(f).trim()))]),Se("click",Pe,Ne),ia(Wt,()=>e(f),gt=>v(f,gt)),ia(It,()=>e(p),gt=>v(p,gt)),Se("submit",ve,tr(Ke)),ia(je,()=>e(g),gt=>v(g,gt)),m($,I)};E(le,$=>{e(j)==="subjects"&&$(Z)})}var q=u(le,2);{var U=$=>{var I=eA(),H=o(I),fe=u(o(H),2),ve=o(fe),Fe=o(ve),Ce=o(Fe),Be=u(o(Ce),2);ta(Be),i(Ce);var Ue=u(Ce,2),Pe=u(o(Ue),2);ta(Pe),i(Ue);var Ve=u(Ue,2),st=u(o(Ve),2);let nt;var vt=o(st);let St;var At=o(vt);{var Wt=gt=>{var _t=zk(),de=o(_t),ee=o(de,!0);i(de);var Q=u(de,2),Ye=o(Q),Qe=o(Ye,!0);i(Ye),i(Q),i(_t),O(dt=>{w(ee,e(L)),w(Qe,dt)},[()=>(e(L),x(()=>ze(e(L))))]),m(gt,_t)},Nt=gt=>{var _t=Gk();m(gt,_t)};E(At,gt=>{e(L)?gt(Wt):gt(Nt,!1)})}Ht(2),i(vt);var It=u(vt,2);Dt(It,5,()=>it,gt=>gt.value,(gt,_t)=>{var de=Vk();let ee;var Q=o(de),Ye=o(Q,!0);i(Q);var Qe=u(Q,2),dt=o(Qe),yt=o(dt,!0);i(dt),i(Qe),i(de),O(zt=>{ee=we(de,1,"adminsubject-dropdown-option",null,ee,zt),w(Ye,(e(_t),x(()=>e(_t).value))),w(yt,(e(_t),x(()=>e(_t).name)))},[()=>({selected:e(L)===e(_t).value})]),Se("click",de,()=>Me(e(_t).value)),m(gt,de)}),i(It),i(st),i(Ve),i(Fe);var Gt=u(Fe,2),Ot=o(Gt);let sa;var Qt=o(Ot);{var Pt=gt=>{var _t=ba("Creating...");m(gt,_t)},Yt=gt=>{var _t=Bk();Ht(),m(gt,_t)};E(Qt,gt=>{e(Y)?gt(Pt):gt(Yt,!1)})}i(Ot),i(Gt),i(ve),i(fe),i(H);var ca=u(H,2),ye=o(ca),Xe=o(ye),ot=u(o(Xe),2),be=o(ot),je=u(o(be),2);ta(je);var rt=u(je,2);{var Ft=gt=>{var _t=Wk();Se("click",_t,A),m(gt,_t)};E(rt,gt=>{e(y)&&gt(Ft)})}i(be),i(ot),i(Xe),i(ye);var Vt=u(ye,2),at=o(Vt);{var va=gt=>{var _t=mt(),de=tt(_t);Dt(de,1,()=>e(n),ee=>ee.id,(ee,Q)=>{var Ye=Kk(),Qe=o(Ye),dt=o(Qe),yt=o(dt),zt=o(yt,!0);i(yt),i(dt);var ga=u(dt,2),bt=o(ga),Oe=o(bt),ft=o(Oe),$t=o(ft,!0);i(ft),i(Oe),i(bt);var jt=u(bt,2);i(ga),i(Qe);var Kt=u(Qe,2),oa=o(Kt),Jt=u(o(oa),2),Ta=o(Jt,!0);i(Jt),i(oa);var Aa=u(oa,2),ya=o(Aa),ma=o(ya,!0);i(ya);var ha=u(ya,2),Fa=o(ha);i(ha),i(Aa);var La=u(Aa,2),da=u(o(La),2),fa=o(da);i(da),i(La);var K=u(La,2),De=u(o(K),2),Ze=o(De);i(De),i(K),i(Kt);var wt=u(Kt,2);{var qt=Tt=>{var kt=Qk(),Ea=o(kt),_a=u(o(Ea),2),ua=o(_a),Sa=o(ua),Ut=u(o(Sa),2);ta(Ut),i(Sa);var Xt=u(Sa,2),ka=u(o(Xt),2);ta(ka),i(Xt);var wa=u(Xt,2),Na=u(o(wa),2);let pa;var xa=o(Na);let Ia;var re=o(xa);{var ge=Rt=>{var ea=Hk(),na=o(ea),ja=o(na,!0);i(na);var $a=u(na,2),Ra=o($a),Ba=o(Ra,!0);i(Ra),i($a),i(ea),O(ts=>{w(ja,e(he)),w(Ba,ts)},[()=>(e(he),x(()=>ze(e(he))))]),m(Rt,ea)},ct=Rt=>{var ea=Uk();m(Rt,ea)};E(re,Rt=>{e(he)?Rt(ge):Rt(ct,!1)})}Ht(2),i(xa);var Et=u(xa,2);Dt(Et,5,()=>it,Rt=>Rt.value,(Rt,ea)=>{var na=Yk();let ja;var $a=o(na),Ra=o($a,!0);i($a);var Ba=u($a,2),ts=o(Ba),_s=o(ts,!0);i(ts),i(Ba),i(na),O(Ga=>{ja=we(na,1,"adminsubject-dropdown-option",null,ja,Ga),w(Ra,(e(ea),x(()=>e(ea).value))),w(_s,(e(ea),x(()=>e(ea).name)))},[()=>({selected:e(he)===e(ea).value})]),Se("click",na,()=>ut(e(ea).value)),m(Rt,na)}),i(Et),i(Na),i(wa),i(ua);var Ct=u(ua,2),Lt=o(Ct),ra=o(Lt);i(Lt);var Da=u(Lt,2);let Bt;var We=o(Da);{var Zt=Rt=>{var ea=ba("Updating...");m(Rt,ea)},xt=Rt=>{var ea=ba("Update Activity Type");m(Rt,ea)};E(We,Rt=>{e(Ge)?Rt(Zt):Rt(xt,!1)})}i(Da),i(Ct),i(_a),i(Ea),i(kt),O((Rt,ea,na,ja)=>{pa=we(Na,1,"adminsubject-custom-dropdown",null,pa,Rt),Ia=we(xa,1,"adminsubject-dropdown-trigger",null,Ia,ea),Mt(Lt,"href",`#adminactivity-activity-card-${e(Q),x(()=>e(Q).id)??""}`),Bt=we(Da,1,"adminsubject-submit-button",null,Bt,na),Da.disabled=ja},[()=>({open:e(ce)}),()=>({selected:e(he)}),()=>({loading:e(Ge)}),()=>(e(Ge),e(V),e(ie),x(()=>e(Ge)||!e(V).trim()||!e(ie).trim()))]),ia(Ut,()=>e(V),Rt=>v(V,Rt)),ia(ka,()=>e(ie),Rt=>v(ie,Rt)),Se("click",xa,Ie),Se("click",ra,()=>qe(e(Q))),Se("submit",_a,tr(Ae)),m(Tt,kt)};E(wt,Tt=>{e(ae),e(Q),x(()=>e(ae)===e(Q).id)&&Tt(qt)})}i(Ye),O(Tt=>{Mt(Ye,"id",`adminactivity-activity-card-${e(Q),x(()=>e(Q).id)??""}`),w(zt,(e(Q),x(()=>e(Q).name))),Mt(bt,"href",`#adminactivity-activity-card-${e(Q),x(()=>e(Q).id)??""}`),Mt(Oe,"title",(e(ae),e(Q),x(()=>e(ae)===e(Q).id?"Cancel Edit":"Edit Activity Type"))),w($t,(e(ae),e(Q),x(()=>e(ae)===e(Q).id?"close":"edit"))),w(Ta,(e(Q),x(()=>e(Q).code))),Wa(ya,`color: var(--${e(Q),x(()=>e(Q).color)??""}-500)`),w(ma,(e(Q),x(()=>e(Q).icon))),w(Fa,`Icon: ${e(Q),x(()=>e(Q).icon)??""}`),w(fa,`Color: ${e(Q),x(()=>e(Q).color)??""}`),w(Ze,`Created: ${Tt??""}`)},[()=>x(()=>new Date().toLocaleDateString())]),Se("click",Oe,()=>qe(e(Q))),Se("click",jt,()=>J(e(Q))),m(ee,Ye)}),m(gt,_t)},Ca=gt=>{var _t=Zk(),de=u(o(_t),2);{var ee=Ye=>{var Qe=Jk();m(Ye,Qe)},Q=Ye=>{var Qe=Xk();m(Ye,Qe)};E(de,Ye=>{e(P),x(()=>e(P).length===0)?Ye(ee):Ye(Q,!1)})}i(_t),m(gt,_t)};E(at,gt=>{e(n),x(()=>e(n).length>0)?gt(va):gt(Ca,!1)})}i(Vt),i(ca),i(I),O((gt,_t,de,ee)=>{nt=we(st,1,"adminsubject-custom-dropdown",null,nt,gt),St=we(vt,1,"adminsubject-dropdown-trigger",null,St,_t),sa=we(Ot,1,"admin-create-button",null,sa,de),Ot.disabled=ee},[()=>({open:e(X)}),()=>({selected:e(L)}),()=>({loading:e(Y)}),()=>(e(Y),e(W),e(N),x(()=>e(Y)||!e(W).trim()||!e(N).trim()))]),ia(Be,()=>e(W),gt=>v(W,gt)),ia(Pe,()=>e(N),gt=>v(N,gt)),Se("click",vt,_e),Se("submit",ve,tr(me)),ia(je,()=>e(y),gt=>v(y,gt)),m($,I)};E(q,$=>{e(j)==="activities"&&$(U)})}i(xe),O(($,I)=>{ue=we(te,1,"admin-tab-button",null,ue,$),z=we(G,1,"admin-tab-button",null,z,I)},[()=>({active:e(j)==="subjects"}),()=>({active:e(j)==="activities"})]),Se("click",te,()=>v(j,"subjects")),Se("click",G,()=>v(j,"activities")),m(s,xe),za()}var sA=_('<span class="material-symbols-outlined">add_ad</span> Create Department',1),rA=_('<button type="button" class="dept-mgmt-clear-search-button"><span class="material-symbols-outlined">close</span></button>'),iA=_('<div class="dept-mgmt-loading"><span class="dept-loader"></span> <p>Loading departments...</p></div>'),nA=_('<h3 class="dept-mgmt-empty-title">No departments created yet</h3> <p class="dept-mgmt-empty-description">Create your first department to get started</p>',1),oA=_('<h3 class="dept-mgmt-empty-title">No departments found</h3> <p class="dept-mgmt-empty-description">No departments match your search or filter criteria</p>',1),lA=_('<div class="dept-mgmt-empty-state"><span class="material-symbols-outlined dept-mgmt-empty-icon">corporate_fare</span> <!></div>'),cA=_('<div class="dept-mgmt-edit-form-section"><div class="dept-mgmt-edit-form-container" id="admin-department-edit-form-container"><div class="dept-mgmt-edit-form-header"><h2 class="dept-mgmt-edit-form-title">Edit Department</h2> <p class="dept-mgmt-edit-form-subtitle">Update department information</p></div> <form class="dept-mgmt-edit-form-content"><div class="dept-mgmt-edit-info-row"><div class="dept-mgmt-form-group"><label class="dept-mgmt-form-label" for="edit-department-name">Department Name *</label> <input type="text" id="edit-department-name" class="dept-mgmt-form-input" placeholder="Enter department name" required/></div> <div class="dept-mgmt-form-group"><label class="dept-mgmt-form-label" for="edit-department-code">Department Code *</label> <input type="text" id="edit-department-code" class="dept-mgmt-form-input" placeholder="Enter department code" required/></div></div> <div class="dept-mgmt-edit-form-actions"><a><button type="button" class="dept-mgmt-cancel-button">Cancel</button></a> <button type="submit" class="dept-mgmt-update-button"><!></button></div></form></div></div>'),dA=_('<button type="button" class="dept-mgmt-select-all-button"><span class="material-symbols-outlined"> </span></button>'),uA=_('<button type="button"><div class="dept-mgmt-option-content"><span class="material-symbols-outlined dept-mgmt-option-icon">subject</span> <span class="dept-mgmt-option-name"> </span> <span class="dept-mgmt-option-description"> </span></div> <div class="dept-mgmt-subject-checkbox"><span class="material-symbols-outlined"> </span></div></button>'),vA=_('<div class="dept-mgmt-no-results"><span class="material-symbols-outlined">subject</span> <span>No subjects found</span></div>'),fA=_('<button type="button" class="dept-mgmt-select-all-button"><span class="material-symbols-outlined"> </span></button>'),pA=_('<button type="button"><div class="dept-mgmt-option-content"><span class="material-symbols-outlined dept-mgmt-option-icon">person</span> <span class="dept-mgmt-option-name"> </span> <span class="dept-mgmt-option-description"> </span></div> <div class="dept-mgmt-teacher-checkbox"><span class="material-symbols-outlined"> </span></div></button>'),mA=_('<div class="dept-mgmt-no-results"><span class="material-symbols-outlined">person_off</span> <span>No teachers found</span></div>'),hA=_('<div class="dept-mgmt-assign-form-section"><div class="dept-mgmt-assign-form-container"><div class="dept-mgmt-assign-form-header"><h2 class="dept-mgmt-assign-form-title">Assign Subjects & Teachers</h2> <p class="dept-mgmt-assign-form-subtitle">Select subjects and teachers for this department</p></div> <form class="dept-mgmt-assign-form-content"><div class="dept-mgmt-assign-info-row"><div class="dept-mgmt-form-group"><label class="dept-mgmt-form-label" for="subjects"> </label> <div class="dept-mgmt-subject-controls"><input type="text" class="dept-mgmt-form-input" placeholder="Search subjects by name or code..." id="subjects"/> <!></div> <div class="dept-mgmt-subject-list"><!> <!></div> <p class="dept-mgmt-form-help">Select subjects that will be managed by this department.</p></div> <div class="dept-mgmt-form-group"><label class="dept-mgmt-form-label" for="teachers"> </label> <div class="dept-mgmt-teacher-controls"><input type="text" class="dept-mgmt-form-input" placeholder="Search teachers by name or account number..." id="teachers"/> <!></div> <div class="dept-mgmt-teacher-list"><!> <!></div> <p class="dept-mgmt-form-help">Select teachers who will be part of this department.</p></div></div> <div class="dept-mgmt-assign-actions"><button type="button" class="dept-mgmt-cancel-button">Cancel</button> <button type="submit" class="dept-mgmt-assign-submit-button"><!></button></div></form></div></div>'),gA=_('<div><div class="dept-mgmt-department-header"><div class="dept-mgmt-department-title"><h3 class="dept-mgmt-department-name"> </h3></div> <div class="dept-mgmt-action-buttons"><a><button type="button" class="dept-mgmt-assign-button"><span class="material-symbols-outlined"> </span></button></a> <a><button type="button" class="dept-mgmt-edit-button"><span class="material-symbols-outlined"> </span></button></a> <button type="button" class="dept-mgmt-remove-button" title="Remove Department"><span class="material-symbols-outlined">delete</span></button></div></div> <div class="dept-mgmt-department-details"><div class="dept-mgmt-department-code"><span class="material-symbols-outlined">tag</span> <span> </span></div> <div class="dept-mgmt-department-subjects"><span class="material-symbols-outlined">subject</span> <span> </span></div> <div class="dept-mgmt-department-teachers"><span class="material-symbols-outlined">person</span> <span> </span></div> <div class="dept-mgmt-department-created"><span class="material-symbols-outlined">calendar_today</span> <span> </span></div></div> <!> <!></div>'),_A=_('<div class="dept-mgmt-container"><div class="dept-mgmt-header"><div class="dept-mgmt-header-content"><h1 class="dept-mgmt-page-title">Department Management</h1> <p class="dept-mgmt-page-subtitle">Create and manage academic departments, assign subjects and teachers</p></div></div> <div class="dept-mgmt-create-section"><h2 class="dept-mgmt-section-title">Create New Department</h2> <p class="dept-mgmt-section-subtitle">Add a new academic department to organize subjects and teachers</p> <div class="dept-mgmt-create-form"><div class="dept-mgmt-form-row"><div class="dept-mgmt-form-group"><label for="departmentName" class="dept-mgmt-form-label">Department Name *</label> <input id="departmentName" type="text" placeholder="e.g., Mathematics Department" class="dept-mgmt-form-input"/></div> <div class="dept-mgmt-form-group"><label for="departmentCode" class="dept-mgmt-form-label">Department Code *</label> <input id="departmentCode" type="text" placeholder="e.g., MATH-DEPT" class="dept-mgmt-form-input"/></div></div> <div class="dept-mgmt-form-actions"><button type="submit" class="dept-mgmt-btn-primary"><!></button></div></div></div> <div class="dept-mgmt-departments-section"><div class="dept-mgmt-section-header"><div class="section-header-content"><div class="section-title-group"><h2 class="dept-mgmt-section-title">All Departments</h2> <p class="dept-mgmt-section-subtitle">Manage existing departments, assign subjects and teachers</p></div> <div class="dept-mgmt-search-container"><div class="dept-mgmt-search-input-wrapper"><span class="material-symbols-outlined dept-mgmt-search-icon">search</span> <input type="text" placeholder="Search by name or code..." class="dept-mgmt-search-input"/> <!></div></div></div></div> <div class="dept-mgmt-departments-grid"><!></div></div></div>');function bA(s,t){qa(t,!1);const a=R(),r=R(),n=R(),l=R();let c=R(!1),d=R([]),f=R([]),p=R(""),h=R(""),g=R([]),b=R([]),y="all",k=R(""),A=R(null),D=R(""),T=R(""),C=R(!1),S=R(null),M=R(!1),F=R([]),j=R([]),P=R(""),Y=R(""),W=R(!1);async function N(){v(W,!0);try{const $=await la.get("/api/departments?action=departments");$.success?v(g,$.data.map(I=>({id:I.id,name:I.name,code:I.code,subjects:I.subjects||[],teachers:I.teachers||[],createdAt:I.created_at?I.created_at.split("T")[0]:new Date().toISOString().split("T")[0]}))):Te.error("Failed to load departments")}catch($){console.error("Error fetching departments:",$),Te.error("Failed to load departments")}finally{v(W,!1)}}async function L(){try{const $=await la.get("/api/departments?action=subjects");$.success?v(F,$.data.map(I=>({id:I.id,name:I.name,code:I.code,gradeLevel:`Grade ${I.grade_level}`}))):Te.error("Failed to load subjects")}catch($){console.error("Error fetching subjects:",$),Te.error("Failed to load subjects")}finally{}}async function X(){try{const $=await la.get("/api/departments?action=teachers");$.success?v(j,$.data.map(I=>({id:I.id,name:I.full_name||`${I.first_name} ${I.last_name}`,accountNumber:I.account_number}))):Te.error("Failed to load teachers")}catch($){console.error("Error fetching teachers:",$),Te.error("Failed to load teachers")}finally{}}Ya(async()=>{await Promise.all([N(),L(),X()]),ae()});function ae($=e(g),I=y,H=e(k)){let fe=[...$];I==="with_subjects"?fe=fe.filter(ve=>ve.subjects.length>0):I==="with_teachers"?fe=fe.filter(ve=>ve.teachers.length>0):I==="empty"&&(fe=fe.filter(ve=>ve.subjects.length===0&&ve.teachers.length===0)),H.trim()!==""&&(fe=fe.filter(ve=>ve.name.toLowerCase().includes(H.toLowerCase())||ve.code.toLowerCase().includes(H.toLowerCase()))),v(b,fe)}async function V(){if(!e(p).trim()||!e(h).trim()){Te.error("Please fill in all required fields");return}if(e(g).some($=>$.code.toLowerCase()===e(h).toLowerCase())){Te.error("Department code already exists");return}v(c,!0);try{const $=await la.post("/api/departments",{name:e(p).trim(),code:e(h).trim().toUpperCase()});$.success?(await N(),v(p,""),v(h,""),Te.success("Department created successfully")):Te.error($.error||"Failed to create department")}catch($){console.error("Error creating department:",$);const I=$.message||"Failed to create department. Please try again.";Te.error(I)}finally{v(c,!1)}}async function ie($){if($.preventDefault(),!e(C)){v(C,!0);try{if(!e(D).trim()||!e(T).trim()){Te.error("Department name and code are required");return}if(e(T).trim().length>20){Te.error("Department code cannot exceed 20 characters");return}if(e(g).find(Ce=>Ce.code.toLowerCase()===e(T).trim().toLowerCase()&&Ce.id!==e(A))){Te.error("Department code already exists");return}const H=e(g).find(Ce=>Ce.id===e(A));if(!H)throw new Error("Department not found");const fe=H.teachers?H.teachers.map(Ce=>Ce.id):[],ve=H.subjects?H.subjects.map(Ce=>Ce.id):[],Fe=await la.put("/api/departments",{id:e(A),name:e(D).trim(),code:e(T).trim().toUpperCase(),teachers:fe,subjects:ve});Fe.success?(await N(),v(A,null),v(D,""),v(T,""),Te.success("Department updated successfully")):Te.error(Fe.error||"Failed to update department")}catch(I){console.error("Error updating department:",I);const H=I.message||"Failed to update department. Please try again.";Te.error(H)}finally{v(C,!1)}}}function he($){e(A)===$.id?(v(A,null),v(D,""),v(T,"")):(e(S)===$.id&&(v(S,null),v(d,[]),v(f,[]),v(P,""),v(Y,"")),v(A,$.id),v(D,$.name),v(T,$.code))}function Ge($){cs.confirm("Remove Department",`<p>Are you sure you want to remove the department <strong>"${$.name}"</strong>?</p>
			 <p class="warning-text">This action will also remove all subject and teacher assignments.</p>`,async()=>{try{const I=await la.delete("/api/departments",{id:$.id,name:$.name});I.success?(await N(),Te.success("Department removed successfully")):Te.error(I.error||"Failed to remove department")}catch(I){console.error("Error removing department:",I),Te.error("Failed to remove department. Please try again.")}},()=>{},{size:"small"})}function ce($){e(S)===$.id?(v(S,null),v(d,[]),v(f,[]),v(P,""),v(Y,"")):(e(A)===$.id&&(v(A,null),v(D,""),v(T,"")),v(S,$.id),v(d,$.subjects?$.subjects.map(I=>I.id):[]),v(f,$.teachers?$.teachers.map(I=>I.id):[]),v(P,""),v(Y,""))}function se($){e(d).findIndex(H=>H===$.id)>-1?v(d,e(d).filter(H=>H!==$.id)):v(d,[...e(d),$.id])}function Re($){e(f).findIndex(H=>H===$.id)>-1?v(f,e(f).filter(H=>H!==$.id)):v(f,[...e(f),$.id])}function Je(){if(e(n).every(I=>e(d).some(H=>H===I.id)))v(d,e(d).filter(I=>!e(n).some(H=>H.id===I)));else{const I=e(n).filter(H=>!e(d).some(fe=>fe===H.id)).map(H=>H.id);v(d,[...e(d),...I])}}function it(){if(e(l).every(I=>e(f).some(H=>H===I.id)))v(f,e(f).filter(I=>!e(l).some(H=>H.id===I)));else{const I=e(l).filter(H=>!e(f).some(fe=>fe===H.id)).map(H=>H.id);v(f,[...e(f),...I])}}async function Le(){v(M,!0);try{const $=e(g).find(fe=>fe.id===e(S));if(!$)throw new Error("Department not found");const I={id:e(S),name:$.name,code:$.code,teachers:e(f),subjects:e(d)},H=await la.put("/api/departments",I);if(!H.success)throw new Error(H.error||"Failed to update assignments");v(g,e(g).map(fe=>{if(fe.id===e(S)){const ve=e(F).filter(Ce=>e(d).includes(Ce.id)),Fe=e(j).filter(Ce=>e(f).includes(Ce.id));return{...fe,subjects:ve,teachers:Fe}}return fe})),Te.success("Department assignments updated successfully"),v(S,null),v(d,[]),v(f,[])}catch($){console.error("Error assigning department:",$),Te.error("Failed to update assignments. Please try again.")}finally{v(M,!1)}}function ke($){return $.subjects||[]}function Ke($){return $.teachers||[]}function lt($){}function He($){if(!$)return"";const I=$.split("-");return I.length===3?`${I[1]}-${I[2]}-${I[0]}`:$}function et(){v(k,"")}ht(()=>(e(g),e(k)),()=>{e(g)&&ae(e(g),y,e(k))}),ht(()=>(e(F),e(P)),()=>{v(a,e(F).filter($=>$.name.toLowerCase().includes(e(P).toLowerCase())||$.code.toLowerCase().includes(e(P).toLowerCase())))}),ht(()=>(e(j),e(Y)),()=>{v(r,e(j).filter($=>$.name.toLowerCase().includes(e(Y).toLowerCase())||$.accountNumber.toLowerCase().includes(e(Y).toLowerCase())))}),ht(()=>(e(a),e(d)),()=>{v(n,e(a).sort(($,I)=>{const H=e(d).some(ve=>ve===$.id),fe=e(d).some(ve=>ve===I.id);return H&&!fe?-1:!H&&fe?1:$.name.localeCompare(I.name)}))}),ht(()=>(e(r),e(f)),()=>{v(l,e(r).sort(($,I)=>{const H=e(f).some(ve=>ve===$.id),fe=e(f).some(ve=>ve===I.id);return H&&!fe?-1:!H&&fe?1:$.name.localeCompare(I.name)}))}),Ms(),Fs();var Ne=_A();Se("click",Zs,lt);var ne=u(o(Ne),2),oe=u(o(ne),4),_e=o(oe),Me=o(_e),ze=u(o(Me),2);ta(ze),i(Me);var Ee=u(Me,2),pe=u(o(Ee),2);ta(pe),i(Ee),i(_e);var qe=u(_e,2),Ae=o(qe),Ie=o(Ae);{var ut=$=>{var I=ba("Creating...");m($,I)},me=$=>{var I=sA();Ht(),m($,I)};E(Ie,$=>{e(c)?$(ut):$(me,!1)})}i(Ae),i(qe),i(oe),i(ne);var J=u(ne,2),xe=o(J),$e=o(xe),B=u(o($e),2),te=o(B),ue=u(o(te),2);ta(ue);var G=u(ue,2);{var z=$=>{var I=rA();Se("click",I,et),m($,I)};E(G,$=>{e(k)&&$(z)})}i(te),i(B),i($e),i(xe);var le=u(xe,2),Z=o(le);{var q=$=>{var I=iA();m($,I)},U=$=>{var I=mt(),H=tt(I);{var fe=Fe=>{var Ce=lA(),Be=u(o(Ce),2);{var Ue=Ve=>{var st=nA();Ht(2),m(Ve,st)},Pe=Ve=>{var st=oA();Ht(2),m(Ve,st)};E(Be,Ve=>{e(g),x(()=>e(g).length===0)?Ve(Ue):Ve(Pe,!1)})}i(Ce),m(Fe,Ce)},ve=Fe=>{var Ce=mt(),Be=tt(Ce);Dt(Be,1,()=>e(b),Ue=>Ue.id,(Ue,Pe)=>{var Ve=gA();let st;var nt=o(Ve),vt=o(nt),St=o(vt),At=o(St,!0);i(St),i(vt);var Wt=u(vt,2),Nt=o(Wt),It=o(Nt),Gt=o(It),Ot=o(Gt,!0);i(Gt),i(It),i(Nt);var sa=u(Nt,2),Qt=o(sa),Pt=o(Qt),Yt=o(Pt,!0);i(Pt),i(Qt),i(sa);var ca=u(sa,2);i(Wt),i(nt);var ye=u(nt,2),Xe=o(ye),ot=u(o(Xe),2),be=o(ot,!0);i(ot),i(Xe);var je=u(Xe,2),rt=u(o(je),2),Ft=o(rt);i(rt),i(je);var Vt=u(je,2),at=u(o(Vt),2),va=o(at);i(at),i(Vt);var Ca=u(Vt,2),gt=u(o(Ca),2),_t=o(gt);i(gt),i(Ca),i(ye);var de=u(ye,2);{var ee=Qe=>{var dt=cA(),yt=o(dt),zt=u(o(yt),2),ga=o(zt),bt=o(ga),Oe=u(o(bt),2);ta(Oe),i(bt);var ft=u(bt,2),$t=u(o(ft),2);ta($t),i(ft),i(ga);var jt=u(ga,2),Kt=o(jt),oa=o(Kt);i(Kt);var Jt=u(Kt,2),Ta=o(Jt);{var Aa=ma=>{var ha=ba("Updating...");m(ma,ha)},ya=ma=>{var ha=ba("Update Department");m(ma,ha)};E(Ta,ma=>{e(C)?ma(Aa):ma(ya,!1)})}i(Jt),i(jt),i(zt),i(yt),i(dt),O(()=>{Mt(Kt,"href",`#department-card-${e(Pe),x(()=>e(Pe).id)??""}`),Jt.disabled=e(C)||!e(D)||!e(T)}),ia(Oe,()=>e(D),ma=>v(D,ma)),ia($t,()=>e(T),ma=>v(T,ma)),Se("click",oa,()=>he(e(Pe))),Se("submit",zt,tr(ie)),m(Qe,dt)};E(de,Qe=>{e(A),e(Pe),x(()=>e(A)===e(Pe).id)&&Qe(ee)})}var Q=u(de,2);{var Ye=Qe=>{var dt=hA(),yt=o(dt),zt=u(o(yt),2),ga=o(zt),bt=o(ga),Oe=o(bt),ft=o(Oe);i(Oe);var $t=u(Oe,2),jt=o($t);ta(jt);var Kt=u(jt,2);{var oa=Ut=>{const Xt=fr(()=>(e(n),e(d),x(()=>e(n).every(pa=>e(d).some(xa=>xa===pa.id)))));var ka=dA(),wa=o(ka),Na=o(wa,!0);i(wa),i(ka),O(()=>{Mt(ka,"title",`${e(Xt)?"Deselect All":"Select All"} (${e(n),x(()=>e(n).length)??""})`),w(Na,e(Xt)?"deselect":"select_all")}),Se("click",ka,Je),m(Ut,ka)};E(Kt,Ut=>{e(n),x(()=>e(n).length>0)&&Ut(oa)})}i($t);var Jt=u($t,2),Ta=o(Jt);Dt(Ta,1,()=>e(n),Ut=>Ut.id,(Ut,Xt)=>{var ka=uA();let wa;var Na=o(ka),pa=u(o(Na),2),xa=o(pa,!0);i(pa);var Ia=u(pa,2),re=o(Ia);i(Ia),i(Na);var ge=u(Na,2),ct=o(ge),Et=o(ct,!0);i(ct),i(ge),i(ka),O((Ct,Lt)=>{wa=we(ka,1,"dept-mgmt-subject-item",null,wa,Ct),w(xa,(e(Xt),x(()=>e(Xt).name))),w(re,`${e(Xt),x(()=>e(Xt).code)??""}  ${e(Xt),x(()=>e(Xt).gradeLevel)??""}`),w(Et,Lt)},[()=>({selected:e(d).some(Ct=>Ct===e(Xt).id)}),()=>(e(d),e(Xt),x(()=>e(d).some(Ct=>Ct===e(Xt).id)?"check_box":"check_box_outline_blank"))]),Se("click",ka,()=>se(e(Xt))),m(Ut,ka)});var Aa=u(Ta,2);{var ya=Ut=>{var Xt=vA();m(Ut,Xt)};E(Aa,Ut=>{e(n),x(()=>e(n).length===0)&&Ut(ya)})}i(Jt),Ht(2),i(bt);var ma=u(bt,2),ha=o(ma),Fa=o(ha);i(ha);var La=u(ha,2),da=o(La);ta(da);var fa=u(da,2);{var K=Ut=>{const Xt=fr(()=>(e(l),e(f),x(()=>e(l).every(pa=>e(f).some(xa=>xa===pa.id)))));var ka=fA(),wa=o(ka),Na=o(wa,!0);i(wa),i(ka),O(()=>{Mt(ka,"title",`${e(Xt)?"Deselect All":"Select All"} (${e(l),x(()=>e(l).length)??""})`),w(Na,e(Xt)?"deselect":"select_all")}),Se("click",ka,it),m(Ut,ka)};E(fa,Ut=>{e(l),x(()=>e(l).length>0)&&Ut(K)})}i(La);var De=u(La,2),Ze=o(De);Dt(Ze,1,()=>e(l),Ut=>Ut.id,(Ut,Xt)=>{var ka=pA();let wa;var Na=o(ka),pa=u(o(Na),2),xa=o(pa,!0);i(pa);var Ia=u(pa,2),re=o(Ia,!0);i(Ia),i(Na);var ge=u(Na,2),ct=o(ge),Et=o(ct,!0);i(ct),i(ge),i(ka),O((Ct,Lt)=>{wa=we(ka,1,"dept-mgmt-teacher-item",null,wa,Ct),w(xa,(e(Xt),x(()=>e(Xt).name))),w(re,(e(Xt),x(()=>e(Xt).accountNumber))),w(Et,Lt)},[()=>({selected:e(f).some(Ct=>Ct===e(Xt).id)}),()=>(e(f),e(Xt),x(()=>e(f).some(Ct=>Ct===e(Xt).id)?"check_box":"check_box_outline_blank"))]),Se("click",ka,()=>Re(e(Xt))),m(Ut,ka)});var wt=u(Ze,2);{var qt=Ut=>{var Xt=mA();m(Ut,Xt)};E(wt,Ut=>{e(l),x(()=>e(l).length===0)&&Ut(qt)})}i(De),Ht(2),i(ma),i(ga);var Tt=u(ga,2),kt=o(Tt),Ea=u(kt,2),_a=o(Ea);{var ua=Ut=>{var Xt=ba("Assigning...");m(Ut,Xt)},Sa=Ut=>{var Xt=ba("Update");m(Ut,Xt)};E(_a,Ut=>{e(M)?Ut(ua):Ut(Sa,!1)})}i(Ea),i(Tt),i(zt),i(yt),i(dt),O(()=>{w(ft,`Select Subjects (${e(d),x(()=>e(d).length)??""} selected)`),w(Fa,`Select Teachers (${e(f),x(()=>e(f).length)??""} selected)`),Ea.disabled=e(M)}),ia(jt,()=>e(P),Ut=>v(P,Ut)),ia(da,()=>e(Y),Ut=>v(Y,Ut)),Se("click",kt,()=>ce(e(Pe))),Se("submit",zt,tr(Le)),m(Qe,dt)};E(Q,Qe=>{e(S),e(Pe),x(()=>e(S)===e(Pe).id)&&Qe(Ye)})}i(Ve),O((Qe,dt,yt,zt)=>{st=we(Ve,1,"dept-mgmt-department-card",null,st,Qe),Mt(Ve,"id",`department-card-${e(Pe),x(()=>e(Pe).id)??""}`),w(At,(e(Pe),x(()=>e(Pe).name))),Mt(Nt,"href",`#department-card-${e(Pe),x(()=>e(Pe).id)??""}`),Mt(It,"title",(e(S),e(Pe),x(()=>e(S)===e(Pe).id?"Cancel Assign":"Assign"))),w(Ot,(e(S),e(Pe),x(()=>e(S)===e(Pe).id?"close":"add_circle"))),Mt(sa,"href",`#department-card-${e(Pe),x(()=>e(Pe).id)??""}`),Mt(Qt,"title",(e(A),e(Pe),x(()=>e(A)===e(Pe).id?"Cancel Edit":"Edit Department"))),w(Yt,(e(A),e(Pe),x(()=>e(A)===e(Pe).id?"close":"edit"))),w(be,(e(Pe),x(()=>e(Pe).code))),w(Ft,`${dt??""} Subjects`),w(va,`${yt??""} Teachers`),w(_t,`Created: ${zt??""}`)},[()=>({editing:e(A)===e(Pe).id,assigning:e(S)===e(Pe).id}),()=>(e(Pe),x(()=>ke(e(Pe)).length)),()=>(e(Pe),x(()=>Ke(e(Pe)).length)),()=>(e(Pe),x(()=>He(e(Pe).createdAt)))]),Se("click",It,()=>ce(e(Pe))),Se("click",Qt,()=>he(e(Pe))),Se("click",ca,()=>Ge(e(Pe))),m(Ue,Ve)}),m(Fe,Ce)};E(H,Fe=>{e(b),x(()=>e(b).length===0)?Fe(fe):Fe(ve,!1)},!0)}m($,I)};E(Z,$=>{e(W)?$(q):$(U,!1)})}i(le),i(J),i(Ne),O(()=>{ze.disabled=e(c),pe.disabled=e(c),Ae.disabled=e(c)||!e(p)||!e(h)}),ia(ze,()=>e(p),$=>v(p,$)),ia(pe,()=>e(h),$=>v(h,$)),Se("click",Ae,V),ia(ue,()=>e(k),$=>v(k,$)),m(s,Ne),za()}var yA=_('<div class="chart-loading svelte-8jize4"><div class="chart-loader svelte-8jize4"></div> <p class="svelte-8jize4">Loading chart data...</p></div>'),wA=_('<div class="chart-error svelte-8jize4"><span class="material-symbols-outlined svelte-8jize4">error</span> <p class="svelte-8jize4"> </p> <button class="retry-button svelte-8jize4"><span class="material-symbols-outlined svelte-8jize4">refresh</span> Retry</button></div>'),xA=_('<canvas class="svelte-8jize4"></canvas>'),SA=_('<div class="chart-container svelte-8jize4"><!></div>');function kA(s,t){qa(t,!1),cr.register(Rn,jn,qn,zn,Qi,Ui,Yi);let a=R(),r,n=R(!0),l=R(null),c=null;const d={on_hold:"On Hold",verifying:"Verifying",processing:"Processing",for_pickup:"For Pickup",released:"Released"},f=["rgba(253, 216, 53, 0.6)","rgba(92, 107, 192, 0.6)","rgba(255, 152, 0, 0.6)","rgba(0, 188, 212, 0.6)","rgba(76, 175, 80, 0.6)"],p=["rgb(253, 216, 53)","rgb(92, 107, 192)","rgb(255, 152, 0)","rgb(0, 188, 212)","rgb(76, 175, 80)"];async function h(){try{v(n,!0),v(l,null);const T=await la.get("/api/document-requests?action=stats");if(T.success)c=T.data,v(n,!1),setTimeout(()=>{e(a)&&g(T.data)},0);else throw new Error(T.error||"Failed to fetch document requests data")}catch(T){console.error("Error fetching document requests data:",T),v(l,T.message),v(n,!1)}}function g(T){if(!e(a)){console.warn("Canvas not yet available");return}r&&r.destroy();const C=Object.keys(d).map(M=>T[M]||0),S=e(a).getContext("2d");r=new cr(S,{type:"bar",data:{labels:Object.values(d),datasets:[{label:"Number of Requests",data:C,backgroundColor:f,borderColor:p,borderWidth:2,borderRadius:8,borderSkipped:!1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,suggestedMax:Math.max(...C)+2,ticks:{stepSize:1,callback(M){return Math.floor(M)},color:getComputedStyle(document.documentElement).getPropertyValue("--md-sys-color-on-surface-variant").trim()},grid:{color:getComputedStyle(document.documentElement).getPropertyValue("--md-sys-color-outline-variant").trim()},title:{display:!0,text:"Number of Requests",color:getComputedStyle(document.documentElement).getPropertyValue("--md-sys-color-on-surface").trim(),font:{size:12,weight:"bold"}}},x:{ticks:{color:getComputedStyle(document.documentElement).getPropertyValue("--md-sys-color-on-surface-variant").trim()},grid:{display:!1}}},plugins:{legend:{display:!1},title:{display:!0,text:"Document Requests by Status",font:{size:16,weight:"bold"},color:getComputedStyle(document.documentElement).getPropertyValue("--md-sys-color-on-surface").trim(),padding:{top:10,bottom:20}},tooltip:{callbacks:{label(M){return`Requests: ${M.parsed.y||0}`}}}}}})}function b(){r&&c&&g(c)}Ya(()=>{h();const T=setInterval(()=>{h()},6e4),C=new MutationObserver(S=>{S.forEach(M=>{M.type==="attributes"&&M.attributeName==="data-theme"&&b()})});return C.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>{clearInterval(T),C.disconnect()}}),ti(()=>{r&&r.destroy()}),Fs();var y=SA(),k=o(y);{var A=T=>{var C=yA();m(T,C)},D=T=>{var C=mt(),S=tt(C);{var M=j=>{var P=wA(),Y=u(o(P),2),W=o(Y,!0);i(Y);var N=u(Y,2);i(P),O(()=>w(W,e(l))),Se("click",N,h),m(j,P)},F=j=>{var P=xA();Hs(P,Y=>v(a,Y),()=>e(a)),m(j,P)};E(S,j=>{e(l)?j(M):j(F,!1)},!0)}m(T,C)};E(k,T=>{e(n)?T(A):T(D,!1)})}i(y),m(s,y),za()}function AA(s,t,a,r){v(t,!e(t)),v(a,!1),v(r,!1)}function DA(s,t,a,r){v(t,!e(t)),v(a,!1),v(r,!1)}function CA(s,t,a,r){v(t,!e(t)),v(a,!1),v(r,!1)}var TA=_('<div class="admindocreq-selected-option"><span class="material-symbols-outlined admindocreq-option-icon">filter_list</span> <div class="admindocreq-option-content"><span class="admindocreq-option-name"> </span></div></div>'),EA=_('<span class="admindocreq-placeholder">All Statuses</span>'),FA=(s,t)=>t(null),NA=(s,t,a)=>t(e(a)),$A=_('<button type="button"><span class="material-symbols-outlined admindocreq-option-icon">filter_list</span> <div class="admindocreq-option-content"><span class="admindocreq-option-name"> </span> <span class="admindocreq-option-description"> </span></div></button>'),LA=_('<div class="admindocreq-selected-option"><span class="material-symbols-outlined admindocreq-option-icon">description</span> <div class="admindocreq-option-content"><span class="admindocreq-option-name"> </span></div></div>'),PA=_('<span class="admindocreq-placeholder">All Document Types</span>'),MA=(s,t)=>t(null),IA=(s,t,a)=>t(e(a)),RA=_('<button type="button"><span class="material-symbols-outlined admindocreq-option-icon">description</span> <div class="admindocreq-option-content"><span class="admindocreq-option-name"> </span> <span class="admindocreq-option-description"> </span></div></button>'),OA=_('<div class="admindocreq-selected-option"><span class="material-symbols-outlined admindocreq-option-icon">school</span> <div class="admindocreq-option-content"><span class="admindocreq-option-name"> </span></div></div>'),jA=_('<span class="admindocreq-placeholder">All Grades</span>'),qA=(s,t)=>t(null),zA=(s,t,a)=>t(e(a)),GA=_('<button type="button"><span class="material-symbols-outlined admindocreq-option-icon">school</span> <div class="admindocreq-option-content"><span class="admindocreq-option-name"> </span> <span class="admindocreq-option-description"> </span></div></button>'),VA=_('<div style="padding: 20px; background: #fee; border-radius: 8px; color: #c33; margin: 20px 0;"><strong>Error:</strong> </div>'),BA=_('<div style="padding: 40px; text-align: center; color: #666;"><span class="material-symbols-outlined" style="font-size: 48px; animation: spin 1s linear infinite;">sync</span> <p>Loading document requests...</p></div>'),WA=_('<div style="padding: 40px; text-align: center; color: #999;"><span class="material-symbols-outlined" style="font-size: 48px;">description</span> <p>No document requests found</p></div>'),HA=(s,t,a)=>t(e(a)),UA=(s,t,a)=>{(s.key==="Enter"||s.key===" ")&&t(e(a))},YA=_('<span class="material-symbols-outlined">pause_circle</span> <span>On Hold</span>',1),QA=_('<span class="material-symbols-outlined">fact_check</span> <span>Verifying</span>',1),KA=_('<span class="material-symbols-outlined">sync</span> <span>For Processing</span>',1),JA=_('<span class="material-symbols-outlined">hand_package</span> <span>For Pick up</span>',1),XA=_('<span class="material-symbols-outlined">check_circle</span> <span>Released</span>',1),ZA=_('<span class="material-symbols-outlined">block</span> <span>Cancelled</span>',1),eD=_('<span class="material-symbols-outlined">cancel</span> <span>Rejected</span>',1),tD=_('<span class="chat-badge"> </span>'),aD=_('<div class="docreq-detail-item"><span class="material-symbols-outlined">event_busy</span> <span> </span></div>'),sD=_('<div class="docreq-detail-item"><span class="material-symbols-outlined">payments</span> <span> </span></div>'),rD=_('<div class="docreq-detail-item"><span class="material-symbols-outlined">event</span> <span> </span></div>'),iD=_('<div role="button" tabindex="0"><div class="docreq-request-header"><div class="docreq-request-info"><div class="docreq-student-info"><h3 class="docreq-student-name"> </h3></div></div> <div class="docreq-action-buttons"><div><!></div> <button class="chat-indicator-btn"><span class="material-symbols-outlined">chat_bubble</span> <!></button></div></div> <div class="docreq-request-details"><div class="docreq-detail-item"><span class="material-symbols-outlined">badge</span> <span> </span></div> <div class="docreq-detail-item"><span class="material-symbols-outlined">school</span> <span> </span></div> <div class="docreq-detail-item"><span class="material-symbols-outlined">description</span> <span> </span></div> <div class="docreq-detail-item"><span class="material-symbols-outlined">tag</span> <span> </span></div> <div class="docreq-detail-item"><span class="material-symbols-outlined">calendar_today</span> <span> </span></div> <!> <!> <!></div></div>'),nD=_('<div class="docreq-requests-grid"></div>'),oD=_('<div class="admin-document-requests-container"><div class="admin-docreq-header"><div class="admin-header-content"><h1 class="admin-page-title">Document Requests</h1> <p class="admin-page-subtitle">Manage and process student document requests</p></div></div> <div class="docreq-status-cards-section"><div class="docreq-status-cards-grid"><div class="docreq-status-card docreq-status-onhold"><div class="docreq-status-icon"><span class="material-symbols-outlined">pause_circle</span></div> <div class="docreq-status-content"><h3 class="docreq-status-value"> </h3> <p class="docreq-status-label">On Hold</p></div></div> <div class="docreq-status-card docreq-status-verifying"><div class="docreq-status-icon"><span class="material-symbols-outlined">fact_check</span></div> <div class="docreq-status-content"><h3 class="docreq-status-value"> </h3> <p class="docreq-status-label">Verifying</p></div></div> <div class="docreq-status-card docreq-status-processing"><div class="docreq-status-icon"><span class="material-symbols-outlined">sync</span></div> <div class="docreq-status-content"><h3 class="docreq-status-value"> </h3> <p class="docreq-status-label">Processing</p></div></div> <div class="docreq-status-card docreq-status-pickup"><div class="docreq-status-icon"><span class="material-symbols-outlined">hand_package</span></div> <div class="docreq-status-content"><h3 class="docreq-status-value"> </h3> <p class="docreq-status-label">For Pickup</p></div></div> <div class="docreq-status-card docreq-status-released"><div class="docreq-status-icon"><span class="material-symbols-outlined">check_circle</span></div> <div class="docreq-status-content"><h3 class="docreq-status-value"> </h3> <p class="docreq-status-label">Released</p></div></div> <div class="docreq-status-card docreq-status-cancelled"><div class="docreq-status-icon"><span class="material-symbols-outlined">block</span></div> <div class="docreq-status-content"><h3 class="docreq-status-value"> </h3> <p class="docreq-status-label">Cancelled</p></div></div></div></div> <div class="docreq-chart-section"><!></div> <div class="admin-docreq-filters-section"><div class="admin-section-header"><h2 class="admin-section-title">Filter Requests</h2> <p class="admin-section-subtitle">Search and filter document requests</p></div> <div class="admindocreq-filters-container"><div class="admindocreq-search-container"><input type="text" placeholder="Search by student name, ID, or document type..." class="admindocreq-search-input"/> <span class="material-symbols-outlined admindocreq-search-icon">search</span></div> <div><button type="button"><!> <span class="material-symbols-outlined admindocreq-dropdown-arrow">expand_more</span></button> <div class="admindocreq-dropdown-menu"><button type="button"><span class="material-symbols-outlined admindocreq-option-icon">clear_all</span> <div class="admindocreq-option-content"><span class="admindocreq-option-name">All Statuses</span></div></button> <!></div></div> <div><button type="button"><!> <span class="material-symbols-outlined admindocreq-dropdown-arrow">expand_more</span></button> <div class="admindocreq-dropdown-menu"><button type="button"><span class="material-symbols-outlined admindocreq-option-icon">clear_all</span> <div class="admindocreq-option-content"><span class="admindocreq-option-name">All Document Types</span></div></button> <!></div></div> <div><button type="button"><!> <span class="material-symbols-outlined admindocreq-dropdown-arrow">expand_more</span></button> <div class="admindocreq-dropdown-menu"><button type="button"><span class="material-symbols-outlined admindocreq-option-icon">clear_all</span> <div class="admindocreq-option-content"><span class="admindocreq-option-name">All Grades</span></div></button> <!></div></div></div></div> <div class="admin-docreq-requests-section"><div class="docreq-section-header"><div class="docreq-section-header-content"><div class="docreq-section-title-group"><h2 class="docreq-section-title">Document Requests</h2> <p class="docreq-section-subtitle">Manage and review all student document requests</p></div></div></div> <!> <!></div></div>');function lD(s,t){qa(t,!1);const a=R(),r=R(),n=R();let l=R([]),c=R(!0),d=!1,f=R(null),p=R(""),h=R(""),g=R(""),b=R(""),y=R(!1),k=R(!1),A=R(!1);const D=[{value:7,label:"Grade 7",description:"Junior High School - First Year"},{value:8,label:"Grade 8",description:"Junior High School - Second Year"},{value:9,label:"Grade 9",description:"Junior High School - Third Year"},{value:10,label:"Grade 10",description:"Junior High School - Fourth Year"}],T=[{id:"tor",name:"Transcript of Records (TOR)",description:"Official academic record"},{id:"enrollment",name:"Enrollment Certificate",description:"Proof of enrollment"},{id:"grade-report",name:"Grade Report",description:"Semester grade report"},{id:"diploma",name:"Diploma",description:"Official graduation certificate"},{id:"certificate",name:"Certificate",description:"Academic achievement certificate"},{id:"good-moral",name:"Good Moral",description:"Certificate of good moral character"},{id:"grade-slip",name:"Grade Slip",description:"Grade slip for specific period"}],C=[{id:"on_hold",name:"On Hold",description:"Awaiting review"},{id:"verifying",name:"Verifying",description:"Under verification"},{id:"processing",name:"For Processing",description:"Currently being processed"},{id:"for_pickup",name:"For Pick Up",description:"Ready for pickup"},{id:"released",name:"Released",description:"Successfully released"},{id:"rejected",name:"Rejected",description:"Request denied"},{id:"cancelled",name:"Cancelled",description:"Cancelled by student"}],S=[{id:"on_hold",name:"On Hold"},{id:"verifying",name:"Verifying"},{id:"processing",name:"For Processing"},{id:"for_pickup",name:"For Pick Up"},{id:"released",name:"Released"}];function M(ee){ee?v(h,ee.id):v(h,""),v(y,!1)}function F(ee){ee?v(g,ee.id):v(g,""),v(k,!1)}function j(ee){ee?v(b,ee.value):v(b,""),v(A,!1)}function P(ee){ee.target.closest(".admindocreq-status-filter")||v(y,!1),ee.target.closest(".admindocreq-doctype-filter")||v(k,!1),ee.target.closest(".admindocreq-grade-filter")||v(A,!1)}async function Y(ee){try{tl.open(ee,C,S,L,X);const Ye=await(await ns(`/api/document-requests?action=single&requestId=${ee.requestId}`)).json();Ye.success?(tl.open(Ye.data,C,S,L,X),await W(ee.requestId)):console.error("Failed to fetch request details:",Ye.error)}catch(Q){console.error("Error fetching request details:",Q)}}async function W(ee){try{const Ye=await(await ns("/api/document-requests",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"markAsRead",requestId:ee})})).json();Ye.success?v(l,e(l).map(Qe=>Qe.requestId===ee?{...Qe,lastReadAt:new Date().toISOString()}:Qe)):console.error("Failed to mark messages as read:",Ye.error)}catch(Q){console.error("Error marking messages as read:",Q)}}async function N(ee=!1){try{ee?d=!0:v(c,!0),v(f,null);const Q=new URLSearchParams({action:"all"});if(e(p)&&Q.append("search",e(p)),e(h)&&Q.append("status",e(h)),e(g)){const dt=T.find(yt=>yt.id===e(g));dt&&Q.append("documentType",dt.name)}e(b)&&Q.append("gradeLevel",e(b));const Qe=await(await ns(`/api/document-requests?${Q.toString()}`)).json();Qe.success?v(l,Qe.data):v(f,Qe.error||"Failed to fetch document requests")}catch(Q){console.error("Error fetching document requests:",Q),v(f,"Failed to load document requests")}finally{v(c,!1),d=!1}}async function L(ee,Q){try{const Qe=await(await ns("/api/document-requests",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"update",requestId:ee,...Q})})).json();return Qe.success?(await N(),Te.success("Document request updated successfully!"),!0):(v(f,Qe.error||"Failed to update request"),Te.error(Qe.error||"Failed to update document request"),!1)}catch(Ye){return console.error("Error updating request:",Ye),v(f,"Failed to update request"),Te.error("An error occurred while updating the request"),!1}}async function X(ee){try{const Ye=await(await ns("/api/document-requests",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"reject",requestId:ee})})).json();return Ye.success?(await N(),Te.success("Document request rejected successfully"),!0):(v(f,Ye.error||"Failed to reject request"),Te.error(Ye.error||"Failed to reject document request"),!1)}catch(Q){return console.error("Error rejecting request:",Q),v(f,"Failed to reject request"),Te.error("An error occurred while rejecting the request"),!1}}function ae(ee){if(!ee)return"N/A";const[Q,Ye,Qe]=ee.split("-");return!Q||!Ye||!Qe?ee:`${Ye}/${Qe}/${Q}`}function V(ee){if(!ee.messages||ee.messages.length===0)return 0;const Q=ee.messages.filter(Qe=>Qe.authorRole!=="admin");if(Q.length===0)return 0;if(!ee.lastReadAt)return Q.length;const Ye=new Date(ee.lastReadAt).getTime();return Q.filter(Qe=>new Date(Qe.created_at).getTime()>Ye).length}let ie=R(!1),he;Ya(()=>(N(),v(ie,!0),he=setInterval(()=>{N(!0)},30*1e3),()=>{he&&clearInterval(he)}));let Ge=R(),ce=R(""),se=R(""),Re=R(""),Je=R("");ht(()=>e(h),()=>{v(a,C.find(ee=>ee.id===e(h)))}),ht(()=>e(g),()=>{v(r,T.find(ee=>ee.id===e(g)))}),ht(()=>e(b),()=>{v(n,D.find(ee=>ee.value===e(b)))}),ht(()=>(e(ie),e(p),e(ce),e(Ge)),()=>{e(ie)&&e(p)!==e(ce)&&(v(ce,e(p)),clearTimeout(e(Ge)),v(Ge,setTimeout(()=>{N()},300)))}),ht(()=>(e(ie),e(h),e(se),e(g),e(Re),e(b),e(Je)),()=>{e(ie)&&(e(h)!==e(se)||e(g)!==e(Re)||e(b)!==e(Je))&&(v(se,e(h)),v(Re,e(g)),v(Je,e(b)),N())}),Ms(),Fs();var it=oD();Se("click",Zs,P);var Le=u(o(it),2),ke=o(Le),Ke=o(ke),lt=u(o(Ke),2),He=o(lt),et=o(He,!0);i(He),Ht(2),i(lt),i(Ke);var Ne=u(Ke,2),ne=u(o(Ne),2),oe=o(ne),_e=o(oe,!0);i(oe),Ht(2),i(ne),i(Ne);var Me=u(Ne,2),ze=u(o(Me),2),Ee=o(ze),pe=o(Ee,!0);i(Ee),Ht(2),i(ze),i(Me);var qe=u(Me,2),Ae=u(o(qe),2),Ie=o(Ae),ut=o(Ie,!0);i(Ie),Ht(2),i(Ae),i(qe);var me=u(qe,2),J=u(o(me),2),xe=o(J),$e=o(xe,!0);i(xe),Ht(2),i(J),i(me);var B=u(me,2),te=u(o(B),2),ue=o(te),G=o(ue,!0);i(ue),Ht(2),i(te),i(B),i(ke),i(Le);var z=u(Le,2),le=o(z);kA(le,{}),i(z);var Z=u(z,2),q=u(o(Z),2),U=o(q),$=o(U);ta($),Ht(2),i(U);var I=u(U,2);let H;var fe=o(I);let ve;fe.__click=[AA,y,k,A];var Fe=o(fe);{var Ce=ee=>{var Q=TA(),Ye=u(o(Q),2),Qe=o(Ye),dt=o(Qe,!0);i(Qe),i(Ye),i(Q),O(()=>w(dt,(e(a),x(()=>e(a).name)))),m(ee,Q)},Be=ee=>{var Q=EA();m(ee,Q)};E(Fe,ee=>{e(a)?ee(Ce):ee(Be,!1)})}Ht(2),i(fe);var Ue=u(fe,2),Pe=o(Ue);let Ve;Pe.__click=[FA,M];var st=u(Pe,2);Dt(st,1,()=>C,ee=>ee.id,(ee,Q)=>{var Ye=$A();let Qe;Ye.__click=[NA,M,Q];var dt=u(o(Ye),2),yt=o(dt),zt=o(yt,!0);i(yt);var ga=u(yt,2),bt=o(ga,!0);i(ga),i(dt),i(Ye),O(Oe=>{Qe=we(Ye,1,"admindocreq-dropdown-option",null,Qe,Oe),w(zt,(e(Q),x(()=>e(Q).name))),w(bt,(e(Q),x(()=>e(Q).description)))},[()=>({selected:e(h)===e(Q).id})]),m(ee,Ye)}),i(Ue),i(I);var nt=u(I,2);let vt;var St=o(nt);let At;St.__click=[DA,k,y,A];var Wt=o(St);{var Nt=ee=>{var Q=LA(),Ye=u(o(Q),2),Qe=o(Ye),dt=o(Qe,!0);i(Qe),i(Ye),i(Q),O(()=>w(dt,(e(r),x(()=>e(r).name)))),m(ee,Q)},It=ee=>{var Q=PA();m(ee,Q)};E(Wt,ee=>{e(r)?ee(Nt):ee(It,!1)})}Ht(2),i(St);var Gt=u(St,2),Ot=o(Gt);let sa;Ot.__click=[MA,F];var Qt=u(Ot,2);Dt(Qt,1,()=>T,ee=>ee.id,(ee,Q)=>{var Ye=RA();let Qe;Ye.__click=[IA,F,Q];var dt=u(o(Ye),2),yt=o(dt),zt=o(yt,!0);i(yt);var ga=u(yt,2),bt=o(ga,!0);i(ga),i(dt),i(Ye),O(Oe=>{Qe=we(Ye,1,"admindocreq-dropdown-option",null,Qe,Oe),w(zt,(e(Q),x(()=>e(Q).name))),w(bt,(e(Q),x(()=>e(Q).description)))},[()=>({selected:e(g)===e(Q).id})]),m(ee,Ye)}),i(Gt),i(nt);var Pt=u(nt,2);let Yt;var ca=o(Pt);let ye;ca.__click=[CA,A,y,k];var Xe=o(ca);{var ot=ee=>{var Q=OA(),Ye=u(o(Q),2),Qe=o(Ye),dt=o(Qe,!0);i(Qe),i(Ye),i(Q),O(()=>w(dt,(e(n),x(()=>e(n).label)))),m(ee,Q)},be=ee=>{var Q=jA();m(ee,Q)};E(Xe,ee=>{e(n)?ee(ot):ee(be,!1)})}Ht(2),i(ca);var je=u(ca,2),rt=o(je);let Ft;rt.__click=[qA,j];var Vt=u(rt,2);Dt(Vt,1,()=>D,ee=>ee.value,(ee,Q)=>{var Ye=GA();let Qe;Ye.__click=[zA,j,Q];var dt=u(o(Ye),2),yt=o(dt),zt=o(yt,!0);i(yt);var ga=u(yt,2),bt=o(ga,!0);i(ga),i(dt),i(Ye),O(Oe=>{Qe=we(Ye,1,"admindocreq-dropdown-option",null,Qe,Oe),w(zt,(e(Q),x(()=>e(Q).label))),w(bt,(e(Q),x(()=>e(Q).description)))},[()=>({selected:e(b)===e(Q).value})]),m(ee,Ye)}),i(je),i(Pt),i(q),i(Z);var at=u(Z,2),va=u(o(at),2);{var Ca=ee=>{var Q=VA(),Ye=u(o(Q));i(Q),O(()=>w(Ye,` ${e(f)??""}`)),m(ee,Q)};E(va,ee=>{e(f)&&ee(Ca)})}var gt=u(va,2);{var _t=ee=>{var Q=BA();m(ee,Q)},de=ee=>{var Q=mt(),Ye=tt(Q);{var Qe=yt=>{var zt=WA();m(yt,zt)},dt=yt=>{var zt=nD();Dt(zt,5,()=>e(l),ga=>ga.id,(ga,bt)=>{var Oe=iD();Oe.__click=[HA,Y,bt],Oe.__keydown=[UA,Y,bt];var ft=o(Oe),$t=o(ft),jt=o($t),Kt=o(jt),oa=o(Kt,!0);i(Kt),i(jt),i($t);var Jt=u($t,2),Ta=o(Jt),Aa=o(Ta);{var ya=ge=>{var ct=YA();Ht(2),m(ge,ct)},ma=ge=>{var ct=mt(),Et=tt(ct);{var Ct=ra=>{var Da=QA();Ht(2),m(ra,Da)},Lt=ra=>{var Da=mt(),Bt=tt(Da);{var We=xt=>{var Rt=KA();Ht(2),m(xt,Rt)},Zt=xt=>{var Rt=mt(),ea=tt(Rt);{var na=$a=>{var Ra=JA();Ht(2),m($a,Ra)},ja=$a=>{var Ra=mt(),Ba=tt(Ra);{var ts=Ga=>{var ss=XA();Ht(2),m(Ga,ss)},_s=Ga=>{var ss=mt(),Pa=tt(ss);{var Ha=es=>{var Za=ZA();Ht(2),m(es,Za)},vs=es=>{var Za=mt(),rs=tt(Za);{var is=bs=>{var ys=eD();Ht(2),m(bs,ys)};E(rs,bs=>{e(bt),x(()=>e(bt).status==="rejected")&&bs(is)},!0)}m(es,Za)};E(Pa,es=>{e(bt),x(()=>e(bt).status==="cancelled")?es(Ha):es(vs,!1)},!0)}m(Ga,ss)};E(Ba,Ga=>{e(bt),x(()=>e(bt).status==="released")?Ga(ts):Ga(_s,!1)},!0)}m($a,Ra)};E(ea,$a=>{e(bt),x(()=>e(bt).status==="for_pickup")?$a(na):$a(ja,!1)},!0)}m(xt,Rt)};E(Bt,xt=>{e(bt),x(()=>e(bt).status==="processing")?xt(We):xt(Zt,!1)},!0)}m(ra,Da)};E(Et,ra=>{e(bt),x(()=>e(bt).status==="verifying")?ra(Ct):ra(Lt,!1)},!0)}m(ge,ct)};E(Aa,ge=>{e(bt),x(()=>e(bt).status==="on_hold")?ge(ya):ge(ma,!1)})}i(Ta);var ha=u(Ta,2),Fa=u(o(ha),2);{var La=ge=>{var ct=tD(),Et=o(ct,!0);i(ct),O(Ct=>w(Et,Ct),[()=>(e(bt),x(()=>V(e(bt))))]),m(ge,ct)};E(Fa,ge=>{e(bt),x(()=>V(e(bt))>0)&&ge(La)})}i(ha),i(Jt),i(ft);var da=u(ft,2),fa=o(da),K=u(o(fa),2),De=o(K,!0);i(K),i(fa);var Ze=u(fa,2),wt=u(o(Ze),2),qt=o(wt,!0);i(wt),i(Ze);var Tt=u(Ze,2),kt=u(o(Tt),2),Ea=o(kt,!0);i(kt),i(Tt);var _a=u(Tt,2),ua=u(o(_a),2),Sa=o(ua);i(ua),i(_a);var Ut=u(_a,2),Xt=u(o(Ut),2),ka=o(Xt);i(Xt),i(Ut);var wa=u(Ut,2);{var Na=ge=>{var ct=aD(),Et=u(o(ct),2),Ct=o(Et);i(Et),i(ct),O(()=>w(Ct,`Cancelled: ${e(bt),x(()=>e(bt).cancelledDate)??""}`)),m(ge,ct)};E(wa,ge=>{e(bt),x(()=>e(bt).status==="cancelled"&&e(bt).cancelledDate)&&ge(Na)})}var pa=u(wa,2);{var xa=ge=>{var ct=sD(),Et=u(o(ct),2),Ct=o(Et,!0);i(Et),i(ct),O(()=>w(Ct,(e(bt),x(()=>e(bt).payment)))),m(ge,ct)};E(pa,ge=>{e(bt),x(()=>e(bt).payment&&e(bt).payment!=="Free"&&!e(bt).payment.toLowerCase().includes("tentative"))&&ge(xa)})}var Ia=u(pa,2);{var re=ge=>{var ct=rD(),Et=u(o(ct),2),Ct=o(Et);i(Et),i(ct),O(Lt=>w(Ct,`Tentative: ${Lt??""}`),[()=>(e(bt),x(()=>ae(e(bt).tentativeDate)))]),m(ge,ct)};E(Ia,ge=>{e(bt),x(()=>e(bt).tentativeDate)&&ge(re)})}i(da),i(Oe),O(ge=>{we(Oe,1,`docreq-request-card status-${e(bt),x(()=>e(bt).status)??""}-border`),w(oa,(e(bt),x(()=>e(bt).studentName))),we(Ta,1,`docreq-status-badge docreq-status-${e(bt),x(()=>e(bt).status)??""}`),Mt(ha,"title",ge),w(De,(e(bt),x(()=>e(bt).studentId))),w(qt,(e(bt),x(()=>e(bt).gradeLevel))),w(Ea,(e(bt),x(()=>e(bt).documentType))),w(Sa,`ID: ${e(bt),x(()=>e(bt).requestId)??""}`),w(ka,`Requested: ${e(bt),x(()=>e(bt).submittedDate)??""}`)},[()=>(e(bt),x(()=>V(e(bt))>0?`${V(e(bt))} unread message${V(e(bt))!==1?"s":""}`:"View messages"))]),m(ga,Oe)}),i(zt),m(yt,zt)};E(Ye,yt=>{e(l),x(()=>e(l).length===0)?yt(Qe):yt(dt,!1)},!0)}m(ee,Q)};E(gt,ee=>{e(c)?ee(_t):ee(de,!1)})}i(at),i(it),O((ee,Q,Ye,Qe,dt,yt,zt,ga,bt,Oe,ft,$t,jt,Kt,oa)=>{w(et,ee),w(_e,Q),w(pe,Ye),w(ut,Qe),w($e,dt),w(G,yt),H=we(I,1,"admindocreq-status-filter admindocreq-custom-dropdown",null,H,zt),ve=we(fe,1,"admindocreq-dropdown-trigger",null,ve,ga),Ve=we(Pe,1,"admindocreq-dropdown-option",null,Ve,bt),vt=we(nt,1,"admindocreq-doctype-filter admindocreq-custom-dropdown",null,vt,Oe),At=we(St,1,"admindocreq-dropdown-trigger",null,At,ft),sa=we(Ot,1,"admindocreq-dropdown-option",null,sa,$t),Yt=we(Pt,1,"admindocreq-grade-filter admindocreq-custom-dropdown",null,Yt,jt),ye=we(ca,1,"admindocreq-dropdown-trigger",null,ye,Kt),Ft=we(rt,1,"admindocreq-dropdown-option",null,Ft,oa)},[()=>(e(l),x(()=>e(l).filter(ee=>ee.status==="on_hold").length)),()=>(e(l),x(()=>e(l).filter(ee=>ee.status==="verifying").length)),()=>(e(l),x(()=>e(l).filter(ee=>ee.status==="processing").length)),()=>(e(l),x(()=>e(l).filter(ee=>ee.status==="for_pickup").length)),()=>(e(l),x(()=>e(l).filter(ee=>ee.status==="released").length)),()=>(e(l),x(()=>e(l).filter(ee=>ee.status==="cancelled").length)),()=>({open:e(y)}),()=>({selected:e(h)}),()=>({selected:e(h)===""}),()=>({open:e(k)}),()=>({selected:e(g)}),()=>({selected:e(g)===""}),()=>({open:e(A)}),()=>({selected:e(b)}),()=>({selected:e(b)===""})]),ia($,()=>e(p),ee=>v(p,ee)),m(s,it),za()}Ps(["click","keydown"]);function cD(s,t,a,r,n){cs.confirm("Change Password",`
			<div class="admin-settings-password-form">
				<div class="admin-settings-form-group">
					<label for="current-password">Current Password</label>
					<div class="admin-settings-password-input-wrapper">
						<input 
							id="current-password"
							type="password" 
							placeholder="Enter current password"
							class="admin-settings-form-input"
						/>
						<button type="button" class="admin-settings-password-toggle" onclick="togglePasswordVisibility('current-password')">
							<svg class="password-eye-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
								<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
								<line x1="1" y1="1" x2="23" y2="23"/>
							</svg>
						</button>
					</div>
				</div>
				
				<div class="admin-settings-form-group">
					<label for="new-password">New Password</label>
					<div class="admin-settings-password-input-wrapper">
						<input 
							id="new-password"
							type="password" 
							placeholder="Enter new password"
							class="admin-settings-form-input"
						/>
						<button type="button" class="admin-settings-password-toggle" onclick="togglePasswordVisibility('new-password')">
							<svg class="password-eye-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
								<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
								<line x1="1" y1="1" x2="23" y2="23"/>
							</svg>
						</button>
					</div>
				</div>
				
				<div class="admin-settings-form-group">
					<label for="confirm-password">Confirm New Password</label>
					<div class="admin-settings-password-input-wrapper">
						<input 
							id="confirm-password"
							type="password" 
							placeholder="Confirm new password"
							class="admin-settings-form-input"
						/>
						<button type="button" class="admin-settings-password-toggle" onclick="togglePasswordVisibility('confirm-password')">
							<svg class="password-eye-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
								<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
								<line x1="1" y1="1" x2="23" y2="23"/>
							</svg>
						</button>
					</div>
				</div>
			</div>
		`,t,()=>{v(a,""),v(r,""),v(n,"")},{size:"medium"})}var dD=_('<div class="admin-settings-date-error"><span class="material-symbols-outlined">error</span> </div>'),uD=_('<div class="admin-settings-date-error"><span class="material-symbols-outlined">error</span> </div>'),vD=_('<div class="admin-settings-date-error"><span class="material-symbols-outlined">error</span> </div>'),fD=_('<div class="admin-settings-date-error"><span class="material-symbols-outlined">error</span> </div>'),pD=_('<div class="admin-settings-date-error"><span class="material-symbols-outlined">error</span> </div>'),mD=_('<span class="material-symbols-outlined">check</span> Apply Date Changes',1),hD=_('<div class="admin-settings-container"><div class="admin-settings-header"><div class="admin-settings-header-content"><h1 class="admin-settings-page-title">Admin Settings</h1> <p class="admin-settings-page-subtitle">Manage system settings and configurations</p></div></div> <div class="admin-settings-section"><div class="admin-settings-card"><div class="admin-settings-card-content"><div class="admin-settings-item"><div class="admin-settings-item-info"><h3 class="admin-settings-item-label">Current School Year</h3> <p class="admin-settings-item-description">The active academic year for the system</p></div> <div class="admin-settings-item-value"><span class="admin-settings-current-year"> </span></div></div></div></div> <div class="admin-settings-card"><div class="admin-settings-card-content"><div class="admin-settings-item"><div class="admin-settings-item-info"><h3 class="admin-settings-item-label">School Year Dates</h3> <p class="admin-settings-item-description">Set the start and end dates for classes</p></div></div> <div class="admin-settings-dates-section"><div class="admin-settings-date-group"><div class="admin-settings-date-item"><label for="start-date" class="admin-settings-date-label">Start of Classes</label> <input id="start-date" type="date"/></div> <div class="admin-settings-date-item"><label for="end-date" class="admin-settings-date-label">End of Classes</label> <input id="end-date" type="date"/></div></div> <div class="admin-settings-quarters-section svelte-jysw9o"><h4 class="admin-settings-quarters-title svelte-jysw9o">Quarter Schedules</h4> <div class="admin-settings-quarters-row svelte-jysw9o"><div class="admin-settings-quarter-group quarter-1 svelte-jysw9o"><div class="admin-settings-quarter-header svelte-jysw9o"><span class="admin-settings-quarter-label svelte-jysw9o">1st Quarter</span></div> <div class="admin-settings-date-group"><div class="admin-settings-date-item"><label for="q1-start" class="admin-settings-date-label">Start</label> <input id="q1-start" type="date"/></div> <div class="admin-settings-date-item"><label for="q1-end" class="admin-settings-date-label">End</label> <input id="q1-end" type="date"/></div></div> <!></div> <div class="admin-settings-quarter-group quarter-2 svelte-jysw9o"><div class="admin-settings-quarter-header svelte-jysw9o"><span class="admin-settings-quarter-label svelte-jysw9o">2nd Quarter</span></div> <div class="admin-settings-date-group"><div class="admin-settings-date-item"><label for="q2-start" class="admin-settings-date-label">Start</label> <input id="q2-start" type="date"/></div> <div class="admin-settings-date-item"><label for="q2-end" class="admin-settings-date-label">End</label> <input id="q2-end" type="date"/></div></div> <!></div> <div class="admin-settings-quarter-group quarter-3 svelte-jysw9o"><div class="admin-settings-quarter-header svelte-jysw9o"><span class="admin-settings-quarter-label svelte-jysw9o">3rd Quarter</span></div> <div class="admin-settings-date-group"><div class="admin-settings-date-item"><label for="q3-start" class="admin-settings-date-label">Start</label> <input id="q3-start" type="date"/></div> <div class="admin-settings-date-item"><label for="q3-end" class="admin-settings-date-label">End</label> <input id="q3-end" type="date"/></div></div> <!></div> <div class="admin-settings-quarter-group quarter-4 svelte-jysw9o"><div class="admin-settings-quarter-header svelte-jysw9o"><span class="admin-settings-quarter-label svelte-jysw9o">4th Quarter</span></div> <div class="admin-settings-date-group"><div class="admin-settings-date-item"><label for="q4-start" class="admin-settings-date-label">Start</label> <input id="q4-start" type="date"/></div> <div class="admin-settings-date-item"><label for="q4-end" class="admin-settings-date-label">End</label> <input id="q4-end" type="date"/></div></div> <!></div></div></div> <!></div> <div class="admin-settings-actions"><button class="admin-settings-action-button admin-settings-primary"><!></button></div></div></div></div> <div class="admin-settings-section"><div class="admin-settings-section-header"><h2 class="admin-settings-section-title">Account Security</h2> <p class="admin-settings-section-subtitle">Manage your account password and security settings</p></div> <div class="admin-settings-security-row"><div class="admin-settings-security-card"><div class="admin-settings-security-content-container"><div class="admin-settings-security-icon"><span class="material-symbols-outlined">lock</span></div> <div class="admin-settings-security-content"><div class="admin-settings-security-label">Password</div> <div class="admin-settings-security-value">Change your account password for security</div></div></div> <div class="admin-settings-security-actions"><button class="admin-settings-security-action-button"><span class="material-symbols-outlined">lock</span> Change Password</button></div></div></div></div></div>');function gD(s,t){qa(t,!0);let a=pt(!1),r=pt(!1),n=pt("2024-2025"),l=pt(""),c=pt("");function d(be,je){if(!be||!je)return"2024-2025";const rt=new Date(be),Ft=new Date(je),Vt=rt.getFullYear(),at=Ft.getFullYear();return at>Vt?`${Vt}-${at}`:`${Vt}-${Vt}`}let f=pt(""),p=pt(""),h=pt(""),g=pt(""),b=pt(""),y=pt(""),k=pt(""),A=pt("");async function D(){try{v(a,!0);const be=await la.get("/api/admin-settings");if(be.success){let rt=function(Ft){if(!Ft)return Ft;const[Vt,at,va]=Ft.split("-");return`${va}-${Vt}-${at}`};const je=be.data;v(l,rt(je.school_year_start_date)||"",!0),v(c,rt(je.school_year_end_date)||"",!0),v(n,d(e(l),e(c)),!0),v(f,rt(je.quarter_1_start_date)||"",!0),v(p,rt(je.quarter_1_end_date)||"",!0),v(h,rt(je.quarter_2_start_date)||"",!0),v(g,rt(je.quarter_2_end_date)||"",!0),v(b,rt(je.quarter_3_start_date)||"",!0),v(y,rt(je.quarter_3_end_date)||"",!0),v(k,rt(je.quarter_4_start_date)||"",!0),v(A,rt(je.quarter_4_end_date)||"",!0)}}catch(be){console.error("Error loading admin settings:",be),us("Failed to load admin settings")}finally{v(a,!1)}}async function T(){try{let be=function(Ft){if(!Ft)return Ft;const[Vt,at,va]=Ft.split("-");return`${at}-${va}-${Vt}`};v(r,!0);const je={current_school_year:e(n),school_year_start_date:be(e(l)),school_year_end_date:be(e(c)),quarter_1_start_date:be(e(f)),quarter_1_end_date:be(e(p)),quarter_2_start_date:be(e(h)),quarter_2_end_date:be(e(g)),quarter_3_start_date:be(e(b)),quarter_3_end_date:be(e(y)),quarter_4_start_date:be(e(k)),quarter_4_end_date:be(e(A))},rt=await la.put("/api/admin-settings",{settings:je});if(rt.success)qr("Admin settings saved successfully");else throw new Error(rt.error||"Failed to save settings")}catch(be){console.error("Error saving admin settings:",be),us("Failed to save admin settings")}finally{v(r,!1)}}let C=pt("");Es(()=>{if(e(l)&&e(c)){const be=new Date(e(l)),je=new Date(e(c));be>=je?v(C,"Start date must be before end date"):(v(C,""),v(n,d(e(l),e(c)),!0))}else v(C,"")});let S={quarter1:"",quarter2:"",quarter3:"",quarter4:""};Es(()=>{if(e(f)&&e(p)){const be=new Date(e(f)),je=new Date(e(p));be>=je?S.quarter1="1st Quarter start date must be before end date":S.quarter1=""}else S.quarter1="";if(e(h)&&e(g)){const be=new Date(e(h)),je=new Date(e(g));be>=je?S.quarter2="2nd Quarter start date must be before end date":S.quarter2=""}else S.quarter2="";if(e(b)&&e(y)){const be=new Date(e(b)),je=new Date(e(y));be>=je?S.quarter3="3rd Quarter start date must be before end date":S.quarter3=""}else S.quarter3="";if(e(k)&&e(A)){const be=new Date(e(k)),je=new Date(e(A));be>=je?S.quarter4="4th Quarter start date must be before end date":S.quarter4=""}else S.quarter4=""});async function M(){if(e(C)){console.error("Cannot apply changes: Date validation error");return}if(Object.values(S).some(je=>je!=="")){console.error("Cannot apply changes: Quarter validation errors");return}await T()}let F=pt(""),j=pt(""),P=pt(""),Y=pt(!1);function W(be){const je=document.getElementById(be),Ft=je.nextElementSibling.querySelector(".password-eye-icon");je.type==="password"?(je.type="text",Ft.innerHTML='<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/>'):(je.type="password",Ft.innerHTML='<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/>')}typeof window<"u"&&(window.togglePasswordVisibility=W);async function N(){const be=document.getElementById("current-password"),je=document.getElementById("new-password"),rt=document.getElementById("confirm-password");if(!be||!je||!rt){us("Password form inputs not found");return}const Ft=be.value,Vt=je.value,at=rt.value;if(!Ft){us("Current password is required");return}if(!Vt){us("New password is required");return}if(Vt!==at){us("New passwords do not match");return}if(Vt.length<8){us("Password must be at least 8 characters long");return}if(Ft===Vt){us("New password must be different from current password");return}try{v(Y,!0);const va=await la.post("/api/change-password",{currentPassword:Ft,newPassword:Vt});va.success?(be.value="",je.value="",rt.value="",qr("Password changed successfully!"),cs.close()):us(va.error||"Failed to change password")}catch(va){console.error("Password change error:",va),us(va.message||"Failed to change password")}finally{v(Y,!1)}}Ya(()=>{D()});var L=hD(),X=u(o(L),2),ae=o(X),V=o(ae),ie=o(V),he=u(o(ie),2),Ge=o(he),ce=o(Ge,!0);i(Ge),i(he),i(ie),i(V),i(ae);var se=u(ae,2),Re=o(se),Je=u(o(Re),2),it=o(Je),Le=o(it),ke=u(o(Le),2);ta(ke);let Ke;i(Le);var lt=u(Le,2),He=u(o(lt),2);ta(He);let et;i(lt),i(it);var Ne=u(it,2),ne=u(o(Ne),2),oe=o(ne),_e=u(o(oe),2),Me=o(_e),ze=u(o(Me),2);ta(ze);let Ee;i(Me);var pe=u(Me,2),qe=u(o(pe),2);ta(qe);let Ae;i(pe),i(_e);var Ie=u(_e,2);{var ut=be=>{var je=dD(),rt=u(o(je));i(je),O(()=>w(rt,` ${S.quarter1??""}`)),m(be,je)};E(Ie,be=>{S.quarter1&&be(ut)})}i(oe);var me=u(oe,2),J=u(o(me),2),xe=o(J),$e=u(o(xe),2);ta($e);let B;i(xe);var te=u(xe,2),ue=u(o(te),2);ta(ue);let G;i(te),i(J);var z=u(J,2);{var le=be=>{var je=uD(),rt=u(o(je));i(je),O(()=>w(rt,` ${S.quarter2??""}`)),m(be,je)};E(z,be=>{S.quarter2&&be(le)})}i(me);var Z=u(me,2),q=u(o(Z),2),U=o(q),$=u(o(U),2);ta($);let I;i(U);var H=u(U,2),fe=u(o(H),2);ta(fe);let ve;i(H),i(q);var Fe=u(q,2);{var Ce=be=>{var je=vD(),rt=u(o(je));i(je),O(()=>w(rt,` ${S.quarter3??""}`)),m(be,je)};E(Fe,be=>{S.quarter3&&be(Ce)})}i(Z);var Be=u(Z,2),Ue=u(o(Be),2),Pe=o(Ue),Ve=u(o(Pe),2);ta(Ve);let st;i(Pe);var nt=u(Pe,2),vt=u(o(nt),2);ta(vt);let St;i(nt),i(Ue);var At=u(Ue,2);{var Wt=be=>{var je=fD(),rt=u(o(je));i(je),O(()=>w(rt,` ${S.quarter4??""}`)),m(be,je)};E(At,be=>{S.quarter4&&be(Wt)})}i(Be),i(ne),i(Ne);var Nt=u(Ne,2);{var It=be=>{var je=pD(),rt=u(o(je));i(je),O(()=>w(rt,` ${e(C)??""}`)),m(be,je)};E(Nt,be=>{e(C)&&be(It)})}i(Je);var Gt=u(Je,2),Ot=o(Gt);Ot.__click=M;var sa=o(Ot);{var Qt=be=>{var je=ba("Saving...");m(be,je)},Pt=be=>{var je=mD();Ht(),m(be,je)};E(sa,be=>{e(r)?be(Qt):be(Pt,!1)})}i(Ot),i(Gt),i(Re),i(se),i(X);var Yt=u(X,2),ca=u(o(Yt),2),ye=o(ca),Xe=u(o(ye),2),ot=o(Xe);ot.__click=[cD,N,F,j,P],i(Xe),i(ye),i(ca),i(Yt),i(L),O((be,je,rt,Ft,Vt,at,va,Ca,gt,_t)=>{w(ce,e(n)),Ke=we(ke,1,"admin-settings-date-input",null,Ke,be),et=we(He,1,"admin-settings-date-input",null,et,je),Ee=we(ze,1,"admin-settings-date-input quarter-1-input",null,Ee,rt),Ae=we(qe,1,"admin-settings-date-input quarter-1-input",null,Ae,Ft),B=we($e,1,"admin-settings-date-input quarter-2-input",null,B,Vt),G=we(ue,1,"admin-settings-date-input quarter-2-input",null,G,at),I=we($,1,"admin-settings-date-input quarter-3-input",null,I,va),ve=we(fe,1,"admin-settings-date-input quarter-3-input",null,ve,Ca),st=we(Ve,1,"admin-settings-date-input quarter-4-input",null,st,gt),St=we(vt,1,"admin-settings-date-input quarter-4-input",null,St,_t),Ot.disabled=e(r)||e(a)||!!e(C)||S.quarter1||S.quarter2||S.quarter3||S.quarter4||!e(l)||!e(c)},[()=>({error:e(C)}),()=>({error:e(C)}),()=>({error:S.quarter1}),()=>({error:S.quarter1}),()=>({error:S.quarter2}),()=>({error:S.quarter2}),()=>({error:S.quarter3}),()=>({error:S.quarter3}),()=>({error:S.quarter4}),()=>({error:S.quarter4})]),ia(ke,()=>e(l),be=>v(l,be)),ia(He,()=>e(c),be=>v(c,be)),ia(ze,()=>e(f),be=>v(f,be)),ia(qe,()=>e(p),be=>v(p,be)),ia($e,()=>e(h),be=>v(h,be)),ia(ue,()=>e(g),be=>v(g,be)),ia($,()=>e(b),be=>v(b,be)),ia(fe,()=>e(y),be=>v(y,be)),ia(Ve,()=>e(k),be=>v(k,be)),ia(vt,()=>e(A),be=>v(A,be)),m(s,L),za()}Ps(["click"]);var _D=_('<meta name="description" content="High School Student Information System"/>'),bD=_('<div><!> <main class="content-area"><!></main> <!></div>'),yD=_('<div><!> <main class="content-area"><!></main> <!></div>'),wD=_('<div><!> <main class="content-area"><!></main> <!></div>'),xD=_('<div class="app-container"><!></div>');function ED(s,t){qa(t,!0);let a=pt(void 0);Es(()=>gs.subscribe(L=>{v(a,L,!0)}));let r=pt("grades"),n=pt(null),l=pt("students"),c=pt("dashboard"),d=pt(!1),f=pt(!1),p=pt(!1);function h(N){typeof N=="string"?(v(r,N,!0),v(n,null)):(v(r,N.detail.section,!0),N.detail.requestId?v(n,N.detail.requestId,!0):v(n,null))}function g(N){typeof N=="string"?v(l,N,!0):v(l,N.detail.section,!0),(typeof N=="string"?N:N.detail.section)!=="class-list"&&v(k,null)}function b(N){const{yearLevel:L,sectionName:X,sectionId:ae}=N.detail;v(k,{yearLevel:L,sectionName:X,sectionId:ae},!0),v(l,"class-list")}function y(){v(k,null),v(l,"students")}let k=pt(null);function A(N){v(c,N.detail.section,!0)}function D(){v(c,"settings")}function T(){v(d,!e(d))}function C(){v(f,!e(f))}function S(){v(p,!e(p))}async function M(){await gs.logout(),v(r,"grades"),v(l,"students"),v(c,"dashboard")}let F=aa(()=>e(a)?.isAuthenticated?e(a).userType==="student"?"Student Portal - High School":e(a).userType==="teacher"?"Teacher Portal - High School":e(a).userType==="admin"?"Admin Portal - High School":"High School Student Information System":"Login - High School Student Information System");var j=xD();Zd(N=>{var L=_D();O(()=>eu.title=e(F)),m(N,L)});var P=o(j);{var Y=N=>{Ku(N,{})},W=N=>{var L=mt(),X=tt(L);{var ae=ie=>{var he=bD();let Ge;var ce=o(he);{let ke=aa(()=>e(a).userData?.name||"Student"),Ke=aa(()=>e(a).userData?.firstName||"Student"),lt=aa(()=>e(a).userData?.gender||"male"),He=aa(()=>e(a).userData?.accountNumber||"N/A"),et=aa(()=>e(a).userData?.profileImage);cv(ce,{get studentName(){return e(ke)},get firstName(){return e(Ke)},get gender(){return e(lt)},get accountNumber(){return e(He)},get profileImage(){return e(et)},onlogout:M,onToggleNavRail:T,onnavigate:h})}var se=u(ce,2),Re=o(se);{var Je=ke=>{Mv(ke,{})},it=ke=>{var Ke=mt(),lt=tt(Ke);{var He=Ne=>{qg(Ne,{})},et=Ne=>{var ne=mt(),oe=tt(ne);{var _e=ze=>{o_(ze,{})},Me=ze=>{var Ee=mt(),pe=tt(Ee);{var qe=Ie=>{w_(Ie,{})},Ae=Ie=>{var ut=mt(),me=tt(ut);{var J=$e=>{B_($e,{get openRequestId(){return e(n)}})},xe=$e=>{var B=mt(),te=tt(B);{var ue=z=>{mb(z,{onnavigate:h})},G=z=>{var le=mt(),Z=tt(le);{var q=U=>{qb(U,{})};E(Z,U=>{e(r)==="todo"&&U(q)},!0)}m(z,le)};E(te,z=>{e(r)==="notifications"?z(ue):z(G,!1)},!0)}m($e,B)};E(me,$e=>{e(r)==="documents"?$e(J):$e(xe,!1)},!0)}m(Ie,ut)};E(pe,Ie=>{e(r)==="schedule"?Ie(qe):Ie(Ae,!1)},!0)}m(ze,Ee)};E(oe,ze=>{e(r)==="ranking"?ze(_e):ze(Me,!1)},!0)}m(Ne,ne)};E(lt,Ne=>{e(r)==="grades"?Ne(He):Ne(et,!1)},!0)}m(ke,Ke)};E(Re,ke=>{e(r)==="profile"?ke(Je):ke(it,!1)})}i(se);var Le=u(se,2);mv(Le,{get activeSection(){return e(r)},get isNavRailVisible(){return e(d)},onnavigate:h}),i(he),O(ke=>Ge=we(he,1,"student-portal",null,Ge,ke),[()=>({"nav-rail-collapsed":!e(d)})]),m(ie,he)},V=ie=>{var he=mt(),Ge=tt(he);{var ce=Re=>{var Je=yD();let it;var Le=o(Je);{let Ne=aa(()=>e(a).userData?.name||"Teacher"),ne=aa(()=>e(a).userData?.firstName||"Teacher"),oe=aa(()=>e(a).userData?.gender||"male"),_e=aa(()=>e(a).userData?.accountNumber||"N/A"),Me=aa(()=>e(a).userData?.profileImage);Qb(Le,{get teacherName(){return e(Ne)},get firstName(){return e(ne)},get gender(){return e(oe)},get accountNumber(){return e(_e)},get profileImage(){return e(Me)},onlogout:M,onToggleNavRail:C,onnavigate:g})}var ke=u(Le,2),Ke=o(ke);{var lt=Ne=>{Sy(Ne,{})},He=Ne=>{var ne=mt(),oe=tt(ne);{var _e=ze=>{Gy(ze,{})},Me=ze=>{var Ee=mt(),pe=tt(Ee);{var qe=Ie=>{Cc(Ie,{onNavigateToClassList:b})},Ae=Ie=>{var ut=mt(),me=tt(ut);{var J=$e=>{L1($e,{get selectedClass(){return e(k)},onBackToClassManagement:y})},xe=$e=>{var B=mt(),te=tt(B);{var ue=z=>{r2(z,{})},G=z=>{Cc(z,{onNavigateToClassList:b})};E(te,z=>{e(l)==="advisory"?z(ue):z(G,!1)},!0)}m($e,B)};E(me,$e=>{e(l)==="class-list"&&e(k)?$e(J):$e(xe,!1)},!0)}m(Ie,ut)};E(pe,Ie=>{e(l)==="students"?Ie(qe):Ie(Ae,!1)},!0)}m(ze,Ee)};E(oe,ze=>{e(l)==="schedule"?ze(_e):ze(Me,!1)},!0)}m(Ne,ne)};E(Ke,Ne=>{e(l)==="profile"?Ne(lt):Ne(He,!1)})}i(ke);var et=u(ke,2);{let Ne=aa(()=>e(a).userData?.id);ty(et,{get teacherActiveSection(){return e(l)},get teacherNavRailVisible(){return e(f)},onnavigate:g,get teacherId(){return e(Ne)}})}i(Je),O(Ne=>it=we(Je,1,"teacher-portal",null,it,Ne),[()=>({"nav-rail-collapsed":!e(f)})]),m(Re,Je)},se=Re=>{var Je=mt(),it=tt(Je);{var Le=ke=>{var Ke=wD();let lt;var He=o(Ke);{let Me=aa(()=>e(a).userData?.name||"Admin"),ze=aa(()=>e(a).userData?.firstName||"Admin"),Ee=aa(()=>e(a).userData?.gender||"male"),pe=aa(()=>e(a).userData?.accountNumber||"N/A"),qe=aa(()=>e(a).userData?.profileImage);f2(He,{get adminName(){return e(Me)},get firstName(){return e(ze)},get gender(){return e(Ee)},get accountNumber(){return e(pe)},get profileImage(){return e(qe)},onlogout:M,onToggleNavRail:S,onNavigateToSettings:D})}var et=u(He,2),Ne=o(et);{var ne=Me=>{r0(Me,{})},oe=Me=>{var ze=mt(),Ee=tt(ze);{var pe=Ae=>{U0(Ae,{})},qe=Ae=>{var Ie=mt(),ut=tt(Ie);{var me=xe=>{hw(xe,{})},J=xe=>{var $e=mt(),B=tt($e);{var te=G=>{Mw(G,{})},ue=G=>{var z=mt(),le=tt(z);{var Z=U=>{ix(U,{})},q=U=>{var $=mt(),I=tt($);{var H=ve=>{xx(ve,{})},fe=ve=>{var Fe=mt(),Ce=tt(Fe);{var Be=Pe=>{Ck(Pe)},Ue=Pe=>{var Ve=mt(),st=tt(Ve);{var nt=St=>{bA(St,{})},vt=St=>{var At=mt(),Wt=tt(At);{var Nt=Gt=>{aA(Gt,{})},It=Gt=>{var Ot=mt(),sa=tt(Ot);{var Qt=Yt=>{lD(Yt,{})},Pt=Yt=>{var ca=mt(),ye=tt(ca);{var Xe=ot=>{gD(ot,{})};E(ye,ot=>{e(c)==="settings"&&ot(Xe)},!0)}m(Yt,ca)};E(sa,Yt=>{e(c)==="document-requests"?Yt(Qt):Yt(Pt,!1)},!0)}m(Gt,Ot)};E(Wt,Gt=>{e(c)==="subjects-and-activities"?Gt(Nt):Gt(It,!1)},!0)}m(St,At)};E(st,St=>{e(c)==="department-management"?St(nt):St(vt,!1)},!0)}m(Pe,Ve)};E(Ce,Pe=>{e(c)==="schedule-management"?Pe(Be):Pe(Ue,!1)},!0)}m(ve,Fe)};E(I,ve=>{e(c)==="student-grades-list"?ve(H):ve(fe,!1)},!0)}m(U,$)};E(le,U=>{e(c)==="archived-accounts"?U(Z):U(q,!1)},!0)}m(G,z)};E(B,G=>{e(c)==="teacher-masterlist"?G(te):G(ue,!1)},!0)}m(xe,$e)};E(ut,xe=>{e(c)==="student-masterlist"?xe(me):xe(J,!1)},!0)}m(Ae,Ie)};E(Ee,Ae=>{e(c)==="account-creation"?Ae(pe):Ae(qe,!1)},!0)}m(Me,ze)};E(Ne,Me=>{e(c)==="dashboard"?Me(ne):Me(oe,!1)})}i(et);var _e=u(et,2);P2(_e,{get adminActiveSection(){return e(c)},get adminNavRailVisible(){return e(p)},onnavigate:A}),i(Ke),O(Me=>lt=we(Ke,1,"admin-portal",null,lt,Me),[()=>({"nav-rail-collapsed":!e(p)})]),m(ke,Ke)};E(it,ke=>{e(a).userType==="admin"&&ke(Le)},!0)}m(Re,Je)};E(Ge,Re=>{e(a).userType==="teacher"?Re(ce):Re(se,!1)},!0)}m(ie,he)};E(X,ie=>{e(a).userType==="student"?ie(ae):ie(V,!1)},!0)}m(N,L)};E(P,N=>{e(a)?.isAuthenticated?N(W,!1):N(Y)})}i(j),m(s,j),za()}export{ED as component};
