import"../chunks/DsnmJJEf.js";import{w as R,h as Qa,a as Ka,a0 as vs,aM as ds,f as Za,al as cs,ax as us,aN as fs,aO as ps,aP as Ya,G as ms,aQ as _s,ak as ja,q as kt,ae as E,_ as _t,T as d,t as h,x as r,y as xt,l as e,A as t,aL as Zt,aR as ss,ad as $a,ag as ae,aS as ma,aT as _a,v as Q,z as a,B as s,aU as ls,C as _,i as mt,ah as Be,aV as At,ai as at,aW as hs,P as qs}from"../chunks/BrR45Eif.js";import{p as Ee,i as k,b as rt,s as Ua,a as Ga,c as Ja}from"../chunks/CsvhCkDi.js";import{t as Re,e as ot,T as bs,s as te,a as re,b as ua,r as Et,c as Kt,i as Ea,d as fa,f as gs,m as Wa,g as Pa,h as Xa,j as Aa}from"../chunks/IeYxAUqq.js";import{c as ys}from"../chunks/vM_StVem.js";function es(c,l,p=!1,q=!1,$=!1){var b=c,M="";R(()=>{var n=vs;if(M===(M=l()??"")){Qa&&Ka();return}if(n.nodes_start!==null&&(ds(n.nodes_start,n.nodes_end),n.nodes_start=n.nodes_end=null),M!==""){if(Qa){Za.data;for(var u=Ka(),Y=u;u!==null&&(u.nodeType!==cs||u.data!=="");)Y=u,u=us(u);if(u===null)throw fs(),ps;Ya(Za,Y),b=ms(u);return}var V=M+"";p?V=`<svg>${V}</svg>`:q&&(V=`<math>${V}</math>`);var i=_s(V);if((p||q)&&(i=ja(i)),Ya(ja(i),i.lastChild),p||q)for(;ja(i);)b.before(ja(i));else b.before(i)}})}const ts="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48px'%20viewBox='0%20-960%20960%20960'%20width='48px'%20fill='%23789DE5'%3e%3cpath%20d='M222-255q63-40%20124.5-60.5T480-336q72%200%20134%2020.5T739-255q44-54%2062.5-109T820-480q0-145-97.5-242.5T480-820q-145%200-242.5%2097.5T140-480q0%2061%2019%20116t63%20109Zm257.81-195q-57.81%200-97.31-39.69-39.5-39.68-39.5-97.5%200-57.81%2039.69-97.31%2039.68-39.5%2097.5-39.5%2057.81%200%2097.31%2039.69%2039.5%2039.68%2039.5%2097.5%200%2057.81-39.69%2097.31-39.68%2039.5-97.5%2039.5Zm-.21%20370q-83.15%200-156.28-31.5t-127.22-86Q142-252%20111-324.84%2080-397.68%2080-480.5t31.5-155.66Q143-709%20197.5-763t127.34-85.5Q397.68-880%20480.5-880t155.66%2031.5Q709-817%20763-763t85.5%20127Q880-563%20880-480.27q0%2082.74-31.5%20155.5Q817-252%20763-197.5t-127.13%2086Q562.74-80%20479.6-80Z'/%3e%3c/svg%3e",ws="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48px'%20viewBox='0%20-960%20960%20960'%20width='48px'%20fill='%23789DE5'%3e%3cpath%20d='M480.17-450Q537-450%20577-490.17t40-97Q617-644%20576.83-684t-97-40Q423-724%20383-683.83t-40%2097Q343-530%20383.17-490t97%2040ZM480-81q-148-38-234-162.54Q160-368.08%20160-523v-238l320-120%20320%20120v238q0%20154.92-86%20279.46Q628-119%20480-81Zm0-62q60-20%20108-59.5t83-90.5q-44.67-21.02-92.97-32.01Q529.72-336%20479.86-336t-98.07%2010.99Q333.58-314.02%20289-293q35%2051%2083%2090.5T480-143Z'/%3e%3c/svg%3e",zs="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48px'%20viewBox='0%20-960%20960%20960'%20width='48px'%20fill='%23789DE5'%3e%3cpath%20d='M860-283v-282L479-360%2040-600l439-240%20441%20240v317h-60ZM479-120%20189-279v-210l290%20159%20290-159v210L479-120Z'/%3e%3c/svg%3e",ks="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48px'%20viewBox='0%20-960%20960%20960'%20width='48px'%20fill='%23789DE5'%3e%3cpath%20d='M480-302q-74%200-139.5%2024.5T220-211v71h520v-71q-55-42-120.5-66.5T480-302ZM220-80q-24%200-42-18t-18-42v-680q0-24%2018-42t42-18h520q24%200%2042%2018t18%2042v680q0%2024-18%2042t-42%2018H220Zm262-301q58%200%2098-40t40-98q0-58-40-98t-98-40q-58%200-98%2040t-40%2098q0%2058%2040%2098t98%2040Z'/%3e%3c/svg%3e";var xs=h('<div class="toast-container svelte-n5a2bz"></div>');function Ss(c,l){kt(l,!0);let p=E(_t([]));Re.subscribe(b=>{d(p,b,!0)});function q(b){setTimeout(()=>{Re.remove(b)},300)}var $=xs();ot($,21,()=>e(p),b=>b.id,(b,M)=>{bs(b,{get message(){return e(M).message},get type(){return e(M).type},get duration(){return e(M).duration},onClose:()=>q(e(M).id)})}),t($),r(c,$),xt()}function as(c,l,p){l()&&c.target===c.currentTarget&&p()}var Ds=h('<h2 id="modal-title" class="modal-title svelte-1a3w2n2"> </h2>'),Ts=h('<button class="modal-close-btn svelte-1a3w2n2" aria-label="Close modal"><span class="material-symbols-outlined svelte-1a3w2n2">close</span></button>'),Cs=h('<div class="modal-header svelte-1a3w2n2"><!> <!></div>'),Ms=h('<div role="presentation"><div role="dialog" aria-modal="true" tabindex="-1"><!> <div class="modal-body svelte-1a3w2n2"><!></div></div></div>');function pa(c,l){kt(l,!0);let p=Ee(l,"title",3,""),q=Ee(l,"size",3,"medium"),$=Ee(l,"closable",3,!0),b=Ee(l,"backdrop",3,!0),M=E(!1),n=E(!1),u=E(void 0);const Y=ss();$a(()=>(setTimeout(()=>{d(M,!0)},10),e(u)&&e(u).focus(),document.body.style.overflow="hidden",()=>{document.body.style.overflow=""}));function V(){$()&&(d(n,!0),setTimeout(()=>{d(M,!1),document.body.style.overflow="",l.onClose&&l.onClose(),Y("close")},300))}function i(j){j.key==="Escape"&&$()&&V()}function F(j){switch(j){case"small":return"modal-small";case"large":return"modal-large";case"xlarge":return"modal-xlarge";case"full":return"modal-full";default:return"modal-medium"}}var K=ae();ma("keydown",_a,i);var Z=Q(K);{var C=j=>{var J=Ms();let qe;J.__click=[as,b,V],J.__keydown=[as,b,V];var O=a(J),ee=a(O);{var oe=U=>{var H=Cs(),le=a(H);{var X=L=>{var ie=Ds(),Ze=a(ie,!0);t(ie),R(()=>_(Ze,p())),r(L,ie)};k(le,L=>{p()&&L(X)})}var A=s(le,2);{var N=L=>{var ie=Ts();ie.__click=V,r(L,ie)};k(A,L=>{$()&&L(N)})}t(H),r(U,H)};k(ee,U=>{(p()||$())&&U(oe)})}var me=s(ee,2),Se=a(me);ls(Se,()=>l.children),t(me),t(O),rt(O,U=>d(u,U),()=>e(u)),t(J),R((U,H)=>{qe=te(J,1,"modal-overlay svelte-1a3w2n2",null,qe,U),te(O,1,`modal-content ${H??""}`,"svelte-1a3w2n2"),re(O,"aria-labelledby",p()?"modal-title":void 0)},[()=>({"modal-visible":e(M)&&!e(n),"modal-closing":e(n)}),()=>F(q())]),r(j,J)};k(Z,j=>{(e(M)||e(n))&&j(C)})}r(c,K),xt()}Zt(["click","keydown"]);function Is(c,l,p){const q=Array.from(c.target.files||[]);if(q.length===0)return;const $=10*1024*1024,b=q.filter(M=>M.size>$?(Re.error(`File "${M.name}" is too large. Maximum size is 10MB.`),!1):!0);d(l,[...e(l),...b],!0),e(p)&&(e(p).value="")}function Rs(c,l){e(l)&&e(l).click()}function js(c,l){d(l,!e(l))}function Ps(c,l){const p=c.target.value;e(l)&&(e(l).tentativeDate=p||null)}function As(c,l){d(l,!0)}async function Es(c,l,p,q,$,b){const M={status:e(l).status,tentativeDate:e(l).tentativeDate,paymentAmount:e(l).paymentAmount,paymentStatus:e(p)},n=await q()(e(l).requestId,M);d($,!1),n&&await b()}function $s(c,l){d(l,!0)}async function Fs(c,l,p,q,$){await l()(e(p).requestId),d(q,!1),$()()}async function Ns(c,l,p,q,$,b,M){if(!(!e(l)||!e(l).requestId)){d(p,!1),d(q,!0);try{const n=await ua(`/api/document-requests?action=generateReceipt&requestId=${e(l).requestId}`,{method:"GET"});if(!n.ok){const Z=await n.json();Re.error(Z.error||"Failed to generate receipt"),d(q,!1);return}const u=await n.blob(),Y=await $(u),V=[{name:`receipt-${e(l).requestId}.pdf`,type:"application/pdf",size:u.size,data:Y}],i=`temp-${Date.now()}`,F=`Receipt generated for ${e(l).requestId}`,K={id:i,text:F,author:b().userData?.name||"Admin",authorRole:"admin",created_at:new Date().toISOString(),attachments:V,isPending:!0};e(l).messages=[...e(l).messages||[],K],M();try{const C=await(await ua("/api/document-requests",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"sendMessage",requestId:e(l).requestId,message:F,attachments:V})})).json();C.success?(e(l).messages=e(l).messages.map(j=>j.id===i?{...C.data,id:i,isPending:!1}:j),Re.success("Receipt generated and sent to chat successfully")):(e(l).messages=e(l).messages.filter(j=>j.id!==i),Re.error(C.error||"Failed to send receipt to chat"))}catch(Z){console.error("Error sending receipt to chat:",Z),e(l).messages=e(l).messages.filter(C=>C.id!==i),Re.error("Receipt generated but failed to send to chat")}}catch(n){console.error("Error generating receipt:",n),Re.error("An error occurred while generating the receipt")}finally{d(q,!1)}}}function Os(c,l){d(l,!e(l))}function Ls(c,l){d(l,e(l)==="paid"?"pending":"paid",!0)}var Bs=(c,l,p)=>l(e(p).id),Vs=h('<button type="button" class="docreq-status-item svelte-zl658f" role="option"><span></span> <span class="status-text svelte-zl658f"> </span></button>'),Hs=h('<input type="date" class="date-input editable svelte-zl658f"/>'),Us=h('<div class="date-box readonly svelte-zl658f"> </div>'),Gs=h('<div class="docreq-card svelte-zl658f"><div class="card-label svelte-zl658f"><span class="material-symbols-outlined">event</span> Tentative Date</div> <div class="admin-card-value svelte-zl658f"><!></div></div>'),Qs=h('<div class="payment-input-wrapper svelte-zl658f"><span class="currency-symbol svelte-zl658f">₱</span> <input type="number" class="payment-input svelte-zl658f" min="0" step="0.01" placeholder="Set fee amount..."/></div>'),Ks=h('<span class="not-set svelte-zl658f">Not set</span>'),Zs=h("<div><!></div>"),Ys=h('<div class="docreq-card svelte-zl658f"><div class="card-label svelte-zl658f"><span class="material-symbols-outlined">event_busy</span> Cancelled Date</div> <div class="admin-card-value svelte-zl658f"> </div></div>'),Js=h('<div class="message-avatar svelte-zl658f"><span class="material-symbols-outlined svelte-zl658f">account_circle</span></div>'),Ws=h('<div class="admin-document-request-message-text"> </div>'),Xs=(c,l,p)=>l(e(p)),el=h('<button class="attachment-item svelte-zl658f"><span class="material-symbols-outlined svelte-zl658f">attach_file</span> <div class="attachment-info svelte-zl658f"><span class="attachment-name svelte-zl658f"> </span> <span class="attachment-size svelte-zl658f"> </span></div> <span class="material-symbols-outlined svelte-zl658f">download</span></button>'),tl=h('<div class="message-attachments svelte-zl658f"></div>'),al=h('<div><!> <div class="message-bubble svelte-zl658f"><div class="message-header svelte-zl658f"><span class="message-author svelte-zl658f"> </span> <span class="message-time svelte-zl658f"> </span></div> <!> <!></div></div>'),sl=h('<div class="no-chat svelte-zl658f"><span class="material-symbols-outlined svelte-zl658f">chat_bubble_outline</span> <p class="svelte-zl658f">No messages yet</p> <p class="subtitle svelte-zl658f">Start a conversation with the student</p></div>'),ll=h('<div class="file-preview-item svelte-zl658f"><span class="material-symbols-outlined svelte-zl658f">description</span> <span class="file-preview-name svelte-zl658f"> </span> <span class="file-preview-size svelte-zl658f"> </span> <button class="remove-file-btn svelte-zl658f" title="Remove file"><span class="material-symbols-outlined svelte-zl658f">close</span></button></div>'),il=h('<div class="selected-files-preview svelte-zl658f"></div>'),nl=h('<div class="chat-disabled-notice svelte-zl658f"><span class="material-symbols-outlined svelte-zl658f">block</span> <span> </span></div>'),rl=(c,l,p)=>c.key==="Enter"&&!c.shiftKey&&!e(l)&&p(),ol=h('<input type="file" multiple accept="image/*,.pdf,.doc,.docx,.xls,.xlsx,.txt" style="display: none;" class="svelte-zl658f"/> <button class="attach-btn svelte-zl658f" title="Attach file" aria-label="Attach file"><span class="material-symbols-outlined svelte-zl658f">attach_file</span></button> <input placeholder="Type your message..." aria-label="Message input" class="svelte-zl658f"/> <button class="send-btn svelte-zl658f" title="Send message" aria-label="Send message"><span class="material-symbols-outlined svelte-zl658f">send</span></button>',1),vl=h('<div class="confirm-detail-row svelte-zl658f"><span class="detail-label svelte-zl658f">Tentative Date:</span> <span class="detail-value svelte-zl658f"> </span></div>'),dl=h('<div class="modal-confirm-content svelte-zl658f"><div class="modal-message svelte-zl658f"><p class="svelte-zl658f">Are you sure you want to update this document request?</p> <div class="confirm-details svelte-zl658f"><div class="confirm-detail-row svelte-zl658f"><span class="detail-label svelte-zl658f">Request ID:</span> <span class="detail-value svelte-zl658f"> </span></div> <div class="confirm-detail-row svelte-zl658f"><span class="detail-label svelte-zl658f">New Status:</span> <span class="detail-value svelte-zl658f"> </span></div> <!> <div class="confirm-detail-row svelte-zl658f"><span class="detail-label svelte-zl658f">Payment Amount:</span> <span class="detail-value svelte-zl658f"><!></span></div> <div class="confirm-detail-row svelte-zl658f"><span class="detail-label svelte-zl658f">Payment Status:</span> <span> </span></div></div></div> <div class="modal-actions svelte-zl658f"><button class="modal-btn modal-btn-secondary svelte-zl658f">Cancel</button> <button class="modal-btn modal-btn-primary svelte-zl658f">Confirm</button></div></div>'),cl=h('<div class="modal-confirm-content svelte-zl658f"><div class="modal-message svelte-zl658f"><p class="svelte-zl658f">Are you sure you want to reject this document request?</p> <div class="confirm-details reject-warning svelte-zl658f"><div class="confirm-detail-row svelte-zl658f"><span class="detail-label svelte-zl658f">Request ID:</span> <span class="detail-value svelte-zl658f"> </span></div> <div class="confirm-detail-row svelte-zl658f"><span class="detail-label svelte-zl658f">Student:</span> <span class="detail-value svelte-zl658f"> </span></div> <div class="confirm-detail-row svelte-zl658f"><span class="detail-label svelte-zl658f">Document Type:</span> <span class="detail-value svelte-zl658f"> </span></div> <div class="reject-notice svelte-zl658f"><span class="material-symbols-outlined svelte-zl658f">warning</span> <span>This action will mark the request as rejected and notify the student.</span></div></div></div> <div class="modal-actions svelte-zl658f"><button class="modal-btn modal-btn-secondary svelte-zl658f">Cancel</button> <button class="modal-btn modal-btn-danger svelte-zl658f">Reject Request</button></div></div>'),ul=h('<div class="modal-confirm-content svelte-zl658f"><div class="modal-message svelte-zl658f"><p class="svelte-zl658f">Generate receipt for this document request?</p> <div class="confirm-details svelte-zl658f"><div class="confirm-detail-row svelte-zl658f"><span class="detail-label svelte-zl658f">Request ID:</span> <span class="detail-value svelte-zl658f"> </span></div> <div class="confirm-detail-row svelte-zl658f"><span class="detail-label svelte-zl658f">Student:</span> <span class="detail-value svelte-zl658f"> </span></div> <div class="confirm-detail-row svelte-zl658f"><span class="detail-label svelte-zl658f">Document Type:</span> <span class="detail-value svelte-zl658f"> </span></div> <div class="reject-notice svelte-zl658f" style="background: rgba(33, 150, 243, 0.1); border-color: #2196F3;"><span class="material-symbols-outlined svelte-zl658f" style="color: #2196F3;">info</span> <span>The receipt will be generated and automatically sent to the chat.</span></div></div></div> <div class="modal-actions svelte-zl658f"><button class="modal-btn modal-btn-secondary svelte-zl658f">Cancel</button> <button class="modal-btn modal-btn-primary svelte-zl658f"> </button></div></div>'),fl=h('<div class="docreq-modal-content svelte-zl658f"><div class="docreq-modal-grid svelte-zl658f"><div class="docreq-modal-left-container svelte-zl658f"><header class="docreq-modal-title svelte-zl658f"><div class="docreq-modal-title-row svelte-zl658f"><div><h2 class="svelte-zl658f">Request Details</h2> <div class="docreq-modal-sub svelte-zl658f">ID: <span> </span></div></div></div></header> <div class="docreq-cards svelte-zl658f"><div class="docreq-card svelte-zl658f"><div class="card-label svelte-zl658f"><span class="material-symbols-outlined">description</span> Document Type</div> <div class="admin-card-value svelte-zl658f"> </div></div> <div class="docreq-card svelte-zl658f"><div class="card-label svelte-zl658f"><span class="material-symbols-outlined">account_circle</span> Processed By</div> <div class="admin-card-value svelte-zl658f"> </div></div> <div class="docreq-card svelte-zl658f"><div class="card-label svelte-zl658f"><span class="material-symbols-outlined">info</span> Status</div> <div class="admin-card-value svelte-zl658f"><div aria-haspopup="listbox"><button class="docreq-status-dropdown-trigger svelte-zl658f" aria-label="Change status"><span class="docreq-status-dropdown-label svelte-zl658f"> </span> <span class="material-symbols-outlined docreq-status-dropdown-caret svelte-zl658f"> </span></button> <div class="docreq-status-dropdown-menu svelte-zl658f" role="listbox" aria-label="Select status"></div></div></div></div> <!> <div class="docreq-card svelte-zl658f"><div class="card-label svelte-zl658f"><span class="material-symbols-outlined">payments</span> Payment Amount</div> <div class="admin-card-value svelte-zl658f"><div class="payment-display-container svelte-zl658f"><!> <div class="payment-actions svelte-zl658f"><button><span class="material-symbols-outlined svelte-zl658f"> </span></button> <button class="payment-edit-btn svelte-zl658f"><span class="material-symbols-outlined svelte-zl658f"> </span></button></div></div></div></div> <!></div> <div class="docreq-purpose svelte-zl658f"><div class="purpose-label svelte-zl658f"><span class="material-symbols-outlined">description</span> Purpose & Details</div> <div class="purpose-content svelte-zl658f"> </div></div> <div class="action-buttons svelte-zl658f"><button class="docreq-approve-button svelte-zl658f"><span class="material-symbols-outlined svelte-zl658f">check_circle</span> Update Request</button> <button class="docreq-reject-button svelte-zl658f"><span class="material-symbols-outlined svelte-zl658f">cancel</span> Reject Request</button> <button class="docreq-complete-button svelte-zl658f"><span class="material-symbols-outlined svelte-zl658f">arrow_back</span> Back</button></div></div> <div class="docreq-modal-right-container svelte-zl658f"><div class="student-info-section svelte-zl658f"><h3 class="svelte-zl658f"><span class="material-symbols-outlined">school</span> Student Information</h3> <div class="student-info-grid svelte-zl658f"><div class="student-field svelte-zl658f"><div class="field-label svelte-zl658f">Student ID</div> <div class="field-value svelte-zl658f"> </div></div> <div class="student-field svelte-zl658f"><div class="field-label svelte-zl658f">Full Name</div> <div class="field-value svelte-zl658f"> </div></div> <div class="student-field svelte-zl658f"><div class="field-label svelte-zl658f">Grade & Section</div> <div class="field-value svelte-zl658f"> </div></div> <div class="student-field svelte-zl658f"><div class="field-label svelte-zl658f">Date of birth</div> <div class="field-value svelte-zl658f"> </div></div></div></div> <div class="chat-container svelte-zl658f"><div class="chat-header svelte-zl658f"><h3 class="svelte-zl658f"><span class="material-symbols-outlined svelte-zl658f">forum</span> Communication</h3> <span class="chat-count-badge svelte-zl658f"> </span></div> <div class="admin-chat-messages svelte-zl658f"><!></div> <div class="admin-chat-input-wrapper svelte-zl658f"><!> <div><!></div></div></div></div></div></div> <!> <!> <!>',1);function is(c,l){kt(l,!0);const[p,q]=Ua(),$=()=>Ga(fa,"$authStore",p);let b=Ee(l,"request",19,()=>({})),M=Ee(l,"requestStatuses",19,()=>[]),n=Ee(l,"modalStatuses",19,()=>[]),u=Ee(l,"onUpdate",3,async()=>{}),Y=Ee(l,"onReject",3,async()=>{}),V=Ee(l,"onClose",3,()=>{});ss();let i=E(_t({...b()}));mt(()=>{b()&&b().requestId&&d(i,{...b()},!0)});let F=E(!1),K=E(void 0),Z=E(""),C=E(!1),j=E(void 0),J=E(void 0),qe=E(void 0),O=E(_t([])),ee,oe=E(!1),me=E(!1),Se=E(!1),U=E(!1),H=E("pending"),le=Be(()=>e(i).messages||[]),X=E(_t(b().status||"")),A=E(_t(b().paymentStatus||"pending"));mt(()=>{b()&&b().status&&d(X,b().status,!0),b()&&b().paymentStatus?d(A,b().paymentStatus,!0):b()&&d(A,"pending")});let N=Be(()=>e(X)==="released"||e(X)==="cancelled");mt(()=>{e(i)&&e(i).paymentStatus?d(H,e(i).paymentStatus,!0):e(i)&&d(H,"pending")});function L(){e(j)&&setTimeout(()=>{e(j).scrollTop=e(j).scrollHeight},100)}function ie(o){d(O,e(O).filter((f,T)=>T!==o),!0)}async function Ze(o){return new Promise((f,T)=>{const g=new FileReader;g.onload=()=>f(g.result),g.onerror=T,g.readAsDataURL(o)})}function Ye(o){const f=document.createElement("a");f.href=o.data,f.download=o.name,f.click()}async function je(){if(!e(Z).trim()&&e(O).length===0||e(C)||e(N))return;d(C,!0);const o=e(Z).trim(),f=[...e(O)];let T=[];try{for(const S of f){const y=await Ze(S);T.push({name:S.name,type:S.type,size:S.size,data:y})}}catch(S){console.error("Error converting files:",S),Re.error("Failed to process files. Please try again."),d(C,!1);return}const g=`temp-${Date.now()}`,x={id:g,text:o,author:$().userData?.name||"Admin",authorRole:"admin",created_at:new Date().toISOString(),attachments:T,isPending:!0};e(i).messages=[...e(i).messages||[],x],d(Z,""),d(O,[],!0),L(),e(J)&&setTimeout(()=>e(J).focus(),50);try{const y=await(await ua("/api/document-requests",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"sendMessage",requestId:e(i).requestId,message:o,attachments:T})})).json();y.success?e(i).messages=e(i).messages.map(G=>G.id===g?{...y.data,id:g,isPending:!1}:G):(console.error("Failed to send message:",y.error),e(i).messages=e(i).messages.filter(G=>G.id!==g),Re.error("Failed to send message. Please try again."),d(Z,o,!0),d(O,f,!0))}catch(S){console.error("Error sending message:",S),e(i).messages=e(i).messages.filter(y=>y.id!==g),Re.error("An error occurred while sending the message."),d(Z,o,!0),d(O,f,!0)}finally{d(C,!1)}}function Je(o){e(i)&&(e(i).status=o,e(i).tentativeDate=null,d(F,!1))}function We(o){if(!o)return"--/--/----";const[f,T,g]=o.split("-");return!f||!T||!g?"--/--/----":`${T}/${g}/${f}`}async function vt(){if(!(!e(i)||!e(i).requestId))try{const f=await(await ua(`/api/document-requests?action=single&requestId=${e(i).requestId}`)).json();f.success&&f.data&&(d(i,{...f.data},!0),f.data.status&&d(X,f.data.status,!0),f.data.paymentStatus?(d(H,f.data.paymentStatus,!0),d(A,f.data.paymentStatus,!0)):d(A,"pending"))}catch(o){console.error("Error refreshing request data:",o)}}function Ve(){d(oe,!1)}function De(){d(me,!1)}async function Te(o){return new Promise((f,T)=>{const g=new FileReader;g.onload=()=>f(g.result),g.onerror=T,g.readAsDataURL(o)})}function Pe(){d(Se,!1)}let $e=Be(()=>e(i)&&(M().find(o=>o.id===e(i).status)||{}).name||"Select");function st(o){o.target.closest(".docreq-status-dropdown")||d(F,!1)}function we(o){o.key==="Escape"&&e(F)&&d(F,!1)}async function Fe(){if(!(!e(i)||e(C)))try{const f=await(await ua(`/api/document-requests?action=single&requestId=${e(i).requestId}`,{method:"GET"})).json();if(f.success&&f.data.messages){const T=e(le).filter(y=>y.isPending),g=f.data.messages,x=new Set(e(le).filter(y=>!y.isPending).map(y=>y.id));g.filter(y=>!x.has(y.id)).length>0&&(e(i).messages=[...g,...T],L())}}catch(o){console.error("Error fetching latest messages:",o)}}function dt(){document.hidden?ee&&(clearInterval(ee),ee=null):ee||(Fe(),ee=setInterval(Fe,8e3))}mt(()=>{e(le).length>0&&L()}),mt(()=>(ee=setInterval(Fe,8e3),document.addEventListener("visibilitychange",dt),L(),()=>{ee&&clearInterval(ee),document.removeEventListener("visibilitychange",dt)}));var ze=fl();ma("click",_a,st),ma("keydown",_a,we);var He=Q(ze),be=a(He),ve=a(be),Ce=a(ve),ke=a(Ce),St=a(ke),ct=s(a(St),2),ht=s(a(ct)),qt=a(ht,!0);t(ht),t(ct),t(St),t(ke),t(Ce);var ut=s(Ce,2),Ue=a(ut),$t=s(a(Ue),2),ha=a($t,!0);t($t),t(Ue);var Yt=s(Ue,2),Ft=s(a(Yt),2),qa=a(Ft,!0);t(Ft),t(Yt);var Jt=s(Yt,2),Wt=s(a(Jt),2),Nt=a(Wt);let ba;var Dt=a(Nt);Dt.__click=[js,F];var Xt=a(Dt),ea=a(Xt,!0);t(Xt);var ta=s(Xt,2),Fa=a(ta,!0);t(ta),t(Dt);var aa=s(Dt,2);ot(aa,21,n,o=>o.id,(o,f)=>{var T=Vs();T.__click=[Bs,Je,f];var g=a(T),x=s(g,2),S=a(x,!0);t(x),t(T),R(()=>{re(T,"aria-selected",e(i).status===e(f).id),te(g,1,`status-dot ${e(f).id??""}`,"svelte-zl658f"),_(S,e(f).name)}),r(o,T)}),t(aa),t(Nt),t(Wt),t(Jt);var ga=s(Jt,2);{var ya=o=>{var f=Gs(),T=s(a(f),2),g=a(T);{var x=y=>{var G=Hs();Et(G),G.__change=[Ps,i],rt(G,he=>d(K,he),()=>e(K)),R(()=>gs(G,e(i).tentativeDate||"")),r(y,G)},S=y=>{var G=Us(),he=a(G,!0);t(G),R(W=>_(he,W),[()=>We(e(i).tentativeDate)]),r(y,G)};k(g,y=>{["verifying","processing"].includes(e(i).status)?y(x):y(S,!1)})}t(T),t(f),r(o,f)};k(ga,o=>{(["verifying","processing"].includes(e(i).status)||e(i).tentativeDate)&&o(ya)})}var bt=s(ga,2),wa=s(a(bt),2),Ot=a(wa),sa=a(Ot);{var za=o=>{var f=Qs(),T=s(a(f),2);Et(T),t(f),Kt(T,()=>e(i).paymentAmount,g=>e(i).paymentAmount=g),r(o,f)},la=o=>{var f=Zs(),T=a(f);{var g=S=>{var y=at();R(()=>_(y,`₱${e(i).paymentAmount??""}`)),r(S,y)},x=S=>{var y=Ks();r(S,y)};k(T,S=>{e(i).paymentAmount!==null&&e(i).paymentAmount!==void 0?S(g):S(x,!1)})}t(f),R(()=>te(f,1,`payment-readonly ${(b()?.status!=="cancelled"&&b()?.status!=="rejected"&&e(i).paymentAmount!==null&&e(i).paymentAmount!==void 0?e(H):"")??""}`,"svelte-zl658f")),r(o,f)};k(sa,o=>{e(U)?o(za):o(la,!1)})}var ia=s(sa,2),lt=a(ia);lt.__click=[Ls,H];var Tt=a(lt),Na=a(Tt,!0);t(Tt),t(lt);var gt=s(lt,2);gt.__click=[Os,U];var ka=a(gt),xa=a(ka,!0);t(ka),t(gt),t(ia),t(Ot),t(wa),t(bt);var Sa=s(bt,2);{var Oa=o=>{var f=Ys(),T=s(a(f),2),g=a(T,!0);t(T),t(f),R(()=>_(g,e(i).cancelledDate)),r(o,f)};k(Sa,o=>{e(i).status==="cancelled"&&e(i).cancelledDate&&o(Oa)})}t(ut);var Ct=s(ut,2),na=s(a(Ct),2),La=a(na,!0);t(na),t(Ct);var Da=s(Ct,2),ra=a(Da);ra.__click=[As,oe];var Lt=s(ra,2);Lt.__click=[$s,me];var Ta=s(Lt,2);Ta.__click=function(...o){V()?.apply(this,o)},t(Da),t(ve);var Bt=s(ve,2),Vt=a(Bt),oa=s(a(Vt),2),Ht=a(oa),va=s(a(Ht),2),Ba=a(va,!0);t(va),t(Ht);var Ut=s(Ht,2),Ca=s(a(Ut),2),Ma=a(Ca,!0);t(Ca),t(Ut);var da=s(Ut,2),Ia=s(a(da),2),Va=a(Ia);t(Ia),t(da);var v=s(da,2),m=s(a(v),2),w=a(m,!0);t(m),t(v),t(oa),t(Vt);var z=s(Vt,2),I=a(z),D=s(a(I),2),P=a(D,!0);t(D),t(I);var ne=s(I,2),xe=a(ne);{var se=o=>{var f=ae(),T=Q(f);ot(T,17,()=>e(le),g=>g.id,(g,x)=>{var S=al(),y=a(S);{var G=fe=>{var pe=Js();r(fe,pe)};k(y,fe=>{e(x).authorRole!=="admin"&&fe(G)})}var he=s(y,2),W=a(he),ue=a(W),Xe=a(ue,!0);t(ue);var Oe=s(ue,2),et=a(Oe,!0);t(Oe),t(W);var ge=s(W,2);{var Ie=fe=>{var pe=Ws(),Qe=a(pe,!0);t(pe),R(()=>_(Qe,e(x).text)),r(fe,pe)};k(ge,fe=>{e(x).text&&fe(Ie)})}var tt=s(ge,2);{var Ge=fe=>{var pe=tl();ot(pe,21,()=>e(x).attachments,Ea,(Qe,jt)=>{var pt=el();pt.__click=[Xs,Ye,jt];var Pt=s(a(pt),2),Ke=a(Pt),ye=a(Ke,!0);t(Ke);var Le=s(Ke,2),Gt=a(Le);t(Le),t(Pt),At(2),t(pt),R(ca=>{_(ye,e(jt).name),_(Gt,`${ca??""} KB`)},[()=>(e(jt).size/1024).toFixed(1)]),r(Qe,pt)}),t(pe),r(fe,pe)};k(tt,fe=>{e(x).attachments&&e(x).attachments.length>0&&fe(Ge)})}t(he),t(S),R(fe=>{te(S,1,`message-wrapper ${e(x).authorRole==="admin"?"sent":"received"}`,"svelte-zl658f"),_(Xe,e(x).author),_(et,fe)},[()=>new Date(e(x).created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]),r(g,S)}),r(o,f)},_e=o=>{var f=sl();r(o,f)};k(xe,o=>{e(le).length>0?o(se):o(_e,!1)})}t(ne),rt(ne,o=>d(j,o),()=>e(j));var de=s(ne,2),B=a(de);{var Ae=o=>{var f=il();ot(f,21,()=>e(O),Ea,(T,g,x)=>{var S=ll(),y=s(a(S),2),G=a(y,!0);t(y);var he=s(y,2),W=a(he);t(he);var ue=s(he,2);ue.__click=()=>ie(x),t(S),R(Xe=>{_(G,e(g).name),_(W,`(${Xe??""} KB)`)},[()=>(e(g).size/1024).toFixed(1)]),r(T,S)}),t(f),r(o,f)};k(B,o=>{e(O).length>0&&o(Ae)})}var Ne=s(B,2);let it;var yt=a(Ne);{var Mt=o=>{var f=nl(),T=s(a(f),2),g=a(T);t(T),t(f),R(()=>_(g,`Chat is disabled for ${e(X)==="released"?"released":"cancelled"} requests`)),r(o,f)},ce=o=>{var f=ol(),T=Q(f);T.__change=[Is,O,qe],rt(T,y=>d(qe,y),()=>e(qe));var g=s(T,2);g.__click=[Rs,qe];var x=s(g,2);Et(x),x.__keydown=[rl,C,je],rt(x,y=>d(J,y),()=>e(J));var S=s(x,2);S.__click=je,R(y=>{x.disabled=e(C),S.disabled=y},[()=>e(C)||!e(Z).trim()&&e(O).length===0]),Kt(x,()=>e(Z),y=>d(Z,y)),r(o,f)};k(yt,o=>{e(N)?o(Mt):o(ce,!1)})}t(Ne),t(de),t(z),t(Bt),t(be),t(He);var Me=s(He,2);{var ft=o=>{pa(o,{title:"Confirm Update",size:"small",closable:!0,onClose:Ve,children:(f,T)=>{var g=dl(),x=a(g),S=s(a(x),2),y=a(S),G=s(a(y),2),he=a(G,!0);t(G),t(y);var W=s(y,2),ue=s(a(W),2),Xe=a(ue,!0);t(ue),t(W);var Oe=s(W,2);{var et=ye=>{var Le=vl(),Gt=s(a(Le),2),ca=a(Gt,!0);t(Gt),t(Le),R(zt=>_(ca,zt),[()=>We(e(i).tentativeDate)]),r(ye,Le)};k(Oe,ye=>{e(i).tentativeDate&&ye(et)})}var ge=s(Oe,2),Ie=s(a(ge),2),tt=a(Ie);{var Ge=ye=>{var Le=at();R(()=>_(Le,`₱${e(i).paymentAmount??""}`)),r(ye,Le)},fe=ye=>{var Le=at("Tentative (not set)");r(ye,Le)};k(tt,ye=>{e(i).paymentAmount!==null&&e(i).paymentAmount!==void 0?ye(Ge):ye(fe,!1)})}t(Ie),t(ge);var pe=s(ge,2),Qe=s(a(pe),2),jt=a(Qe,!0);t(Qe),t(pe),t(S),t(x);var pt=s(x,2),Pt=a(pt);Pt.__click=Ve;var Ke=s(Pt,2);Ke.__click=[Es,i,H,u,oe,vt],t(pt),t(g),R(()=>{_(he,e(i).requestId),_(Xe,e($e)),te(Qe,1,`detail-value payment-status-${e(H)??""}`,"svelte-zl658f"),_(jt,e(H)==="paid"?"Paid":"Pending")}),r(f,g)},$$slots:{default:!0}})};k(Me,o=>{e(oe)&&o(ft)})}var nt=s(Me,2);{var wt=o=>{pa(o,{title:"Reject Request",size:"small",closable:!0,onClose:De,children:(f,T)=>{var g=cl(),x=a(g),S=s(a(x),2),y=a(S),G=s(a(y),2),he=a(G,!0);t(G),t(y);var W=s(y,2),ue=s(a(W),2),Xe=a(ue,!0);t(ue),t(W);var Oe=s(W,2),et=s(a(Oe),2),ge=a(et,!0);t(et),t(Oe),At(2),t(S),t(x);var Ie=s(x,2),tt=a(Ie);tt.__click=De;var Ge=s(tt,2);Ge.__click=[Fs,Y,i,me,V],t(Ie),t(g),R(()=>{_(he,e(i).requestId),_(Xe,e(i).studentName),_(ge,e(i).documentType)}),r(f,g)},$$slots:{default:!0}})};k(nt,o=>{e(me)&&o(wt)})}var It=s(nt,2);{var Rt=o=>{pa(o,{title:"Generate Receipt",size:"small",closable:!0,onClose:Pe,children:(f,T)=>{var g=ul(),x=a(g),S=s(a(x),2),y=a(S),G=s(a(y),2),he=a(G,!0);t(G),t(y);var W=s(y,2),ue=s(a(W),2),Xe=a(ue,!0);t(ue),t(W);var Oe=s(W,2),et=s(a(Oe),2),ge=a(et,!0);t(et),t(Oe),At(2),t(S),t(x);var Ie=s(x,2),tt=a(Ie);tt.__click=Pe;var Ge=s(tt,2);Ge.__click=[Ns,i,Se,C,Te,$,L];var fe=a(Ge,!0);t(Ge),t(Ie),t(g),R(()=>{_(he,e(i).requestId),_(Xe,e(i).studentName),_(ge,e(i).documentType),Ge.disabled=e(C),_(fe,e(C)?"Generating...":"Generate Receipt")}),r(f,g)},$$slots:{default:!0}})};k(It,o=>{e(Se)&&o(Rt)})}R((o,f)=>{_(qt,e(i).requestId),_(ha,e(i).documentType),_(qa,e(i).processedBy??"—"),ba=te(Nt,1,"docreq-status-dropdown svelte-zl658f",null,ba,o),re(Nt,"aria-expanded",e(F)),Dt.disabled=b()?.status==="cancelled"||b()?.status==="rejected",_(ea,e($e)),_(Fa,e(F)?"expand_less":"expand_more"),te(lt,1,`payment-status-toggle ${e(H)==="paid"?"pending":"paid"}`,"svelte-zl658f"),re(lt,"title",e(i).paymentAmount===null||e(i).paymentAmount===void 0?"Set payment amount first":e(H)==="paid"?"Mark as pending":"Mark as paid"),re(lt,"aria-label",e(H)==="paid"?"Mark as pending":"Mark as paid"),lt.disabled=e(X)==="cancelled"||e(X)==="rejected"||e(X)==="released"||e(i).paymentAmount===null||e(i).paymentAmount===void 0,_(Na,e(H)==="paid"?"cancel":"check_circle"),re(gt,"title",e(U)?"Save":"Edit payment amount"),re(gt,"aria-label",e(U)?"Save":"Edit payment amount"),gt.disabled=e(X)==="cancelled"||e(X)==="rejected"||e(X)==="released"||e(A)==="paid",_(xa,e(U)?"check":"edit"),_(La,e(i).purpose??"No purpose provided"),ra.disabled=b()?.status==="cancelled"||b()?.status==="rejected",Lt.disabled=e(X)==="cancelled"||e(X)==="rejected"||e(X)==="released",_(Ba,e(i).studentId),_(Ma,e(i).studentName),_(Va,`${e(i).gradeLevel??""} - ${e(i).section||"N/A"}`),_(w,e(i).dateOfBirth??"—"),_(P,e(le).length),it=te(Ne,1,"admin-chat-input svelte-zl658f",null,it,f)},[()=>({open:e(F)}),()=>({disabled:e(N)})]),r(c,ze),xt(),q()}Zt(["click","change","keydown"]);var pl=(c,l,p)=>{e(l).props.onCancel&&e(l).props.onCancel(),p(e(l).id)},ml=(c,l,p)=>{e(l).props.onConfirm&&e(l).props.onConfirm(),p(e(l).id)},_l=h('<div class="modal-confirm-content svelte-lx5glj"><div><!></div> <div class="modal-actions svelte-lx5glj"><button class="modal-btn modal-btn-secondary svelte-lx5glj">Cancel</button> <button>Confirm</button></div></div>'),hl=(c,l,p)=>{e(l).props.onClose&&e(l).props.onClose(),p(e(l).id)},ql=h('<div class="modal-alert-content svelte-lx5glj"><p class="modal-message svelte-lx5glj"> </p> <div class="modal-actions svelte-lx5glj"><button class="modal-btn modal-btn-primary svelte-lx5glj">OK</button></div></div>'),bl=(c,l,p)=>{e(l).props.onCancel&&e(l).props.onCancel(),p(e(l).id)},gl=(c,l,p)=>{e(l).props.onSubmit&&e(l).props.onSubmit(e(l).props.inputValue||e(l).props.defaultValue||""),p(e(l).id)},yl=h('<div class="modal-prompt-content svelte-lx5glj"><p class="modal-message svelte-lx5glj"> </p> <input type="text" class="modal-input svelte-lx5glj"/> <div class="modal-actions svelte-lx5glj"><button class="modal-btn modal-btn-secondary svelte-lx5glj">Cancel</button> <button class="modal-btn modal-btn-primary svelte-lx5glj">Submit</button></div></div>'),wl=(c,l,p)=>{e(l).props.onCancel&&e(l).props.onCancel(),p(e(l).id)},zl=(c,l,p)=>{e(l).props.onDelete&&!e(l).props.deleteDisabled&&e(l).props.onDelete(),p(e(l).id)},kl=(c,l,p)=>{e(l).props.onSubmit&&e(l).props.onSubmit(e(l).props.field1Value,e(l).props.field2Value),p(e(l).id)},xl=h('<div class="modal-form-content svelte-lx5glj"><p class="modal-message svelte-lx5glj"> </p> <div class="modal-form-fields svelte-lx5glj"><div class="modal-form-group svelte-lx5glj"><label for="formField1" class="modal-form-label svelte-lx5glj"> </label> <input id="formField1"/></div> <div class="modal-form-group svelte-lx5glj"><label for="formField2" class="modal-form-label svelte-lx5glj"> </label> <input id="formField2"/></div></div> <div class="modal-actions svelte-lx5glj"><button class="modal-btn modal-btn-secondary svelte-lx5glj">Cancel</button> <button class="modal-btn modal-btn-danger svelte-lx5glj">Delete</button> <button class="modal-btn modal-btn-primary svelte-lx5glj">Update</button></div></div>'),Sl=h('<div class="modal-custom-content svelte-lx5glj"><!></div>'),Dl=h('<div class="modal-generic-content svelte-lx5glj"><p> </p></div>');function Tl(c,l){kt(l,!0);let p=E(_t([]));Wa.subscribe(M=>{d(p,M,!0)});function q(M){Wa.close(M)}var $=ae(),b=Q($);ot(b,17,()=>e(p),M=>M.id,(M,n,u)=>{{let Y=Be(()=>e(n).props.title||""),V=Be(()=>e(n).options.size||"medium"),i=Be(()=>e(n).options.closable!==!1),F=Be(()=>e(n).options.backdrop!==!1);pa(M,{get title(){return e(Y)},get size(){return e(V)},get closable(){return e(i)},get backdrop(){return e(F)},onClose:()=>q(e(n).id),children:(K,Z)=>{var C=ae(),j=Q(C);{var J=O=>{var ee=ae(),oe=Q(ee);{var me=U=>{var H=_l(),le=a(H);let X;var A=a(le);es(A,()=>e(n).props.message),t(le);var N=s(le,2),L=a(N);L.__click=[pl,n,q];var ie=s(L,2);ie.__click=[ml,n,q],t(N),t(H),R(Ze=>{X=te(le,1,"modal-message svelte-lx5glj",null,X,Ze),te(ie,1,`modal-btn ${e(n).props.variant==="danger"?"modal-btn-danger":"modal-btn-primary"}`,"svelte-lx5glj")},[()=>({"danger-message":e(n).props.variant==="danger"})]),r(U,H)},Se=U=>{var H=ae(),le=Q(H);{var X=N=>{var L=ql(),ie=a(L),Ze=a(ie,!0);t(ie);var Ye=s(ie,2),je=a(Ye);je.__click=[hl,n,q],t(Ye),t(L),R(()=>_(Ze,e(n).props.message)),r(N,L)},A=N=>{var L=ae(),ie=Q(L);{var Ze=je=>{var Je=yl(),We=a(Je),vt=a(We,!0);t(We);var Ve=s(We,2);Et(Ve);var De=s(Ve,2),Te=a(De);Te.__click=[bl,n,q];var Pe=s(Te,2);Pe.__click=[gl,n,q],t(De),t(Je),R(()=>{_(vt,e(n).props.message),re(Ve,"placeholder",e(n).props.placeholder||"Enter value...")}),Kt(Ve,()=>e(n).props.inputValue,$e=>e(n).props.inputValue=$e),r(je,Je)},Ye=je=>{var Je=ae(),We=Q(Je);{var vt=De=>{var Te=xl(),Pe=a(Te),$e=a(Pe,!0);t(Pe);var st=s(Pe,2),we=a(st),Fe=a(we),dt=a(Fe,!0);t(Fe);var ze=s(Fe,2);Et(ze);let He;t(we);var be=s(we,2),ve=a(be),Ce=a(ve,!0);t(ve);var ke=s(ve,2);Et(ke);let St;t(be),t(st);var ct=s(st,2),ht=a(ct);ht.__click=[wl,n,q];var qt=s(ht,2);qt.__click=[zl,n,q];var ut=s(qt,2);ut.__click=[kl,n,q],t(ct),t(Te),R((Ue,$t)=>{_($e,e(n).props.message),_(dt,e(n).props.field1Label||"Field 1"),re(ze,"type",e(n).props.field1Type||"text"),He=te(ze,1,"modal-input svelte-lx5glj",null,He,Ue),re(ze,"placeholder",e(n).props.field1Placeholder||"Enter value..."),re(ze,"min",e(n).props.field1Min),re(ze,"max",e(n).props.field1Max),ze.disabled=e(n).props.field1Disabled,re(ze,"title",e(n).props.field1Disabled?e(n).props.field1DisabledReason:""),_(Ce,e(n).props.field2Label||"Field 2"),re(ke,"type",e(n).props.field2Type||"text"),St=te(ke,1,"modal-input svelte-lx5glj",null,St,$t),re(ke,"placeholder",e(n).props.field2Placeholder||"Enter value..."),re(ke,"min",e(n).props.field2Min),re(ke,"max",e(n).props.field2Max),ke.disabled=e(n).props.field2Disabled,re(ke,"title",e(n).props.field2Disabled?e(n).props.field2DisabledReason:""),qt.disabled=e(n).props.deleteDisabled,re(qt,"title",e(n).props.deleteDisabled?e(n).props.deleteDisabledReason:"Delete this column")},[()=>({"modal-input-disabled":e(n).props.field1Disabled}),()=>({"modal-input-disabled":e(n).props.field2Disabled})]),Kt(ze,()=>e(n).props.field1Value,Ue=>e(n).props.field1Value=Ue),Kt(ke,()=>e(n).props.field2Value,Ue=>e(n).props.field2Value=Ue),r(De,Te)},Ve=De=>{var Te=ae(),Pe=Q(Te);{var $e=we=>{is(we,Ja(()=>e(n).props,{onClose:()=>q(e(n).id)}))},st=we=>{var Fe=ae(),dt=Q(Fe);{var ze=be=>{var ve=Sl(),Ce=a(ve);es(Ce,()=>e(n).props.content),t(ve),r(be,ve)},He=be=>{var ve=Dl(),Ce=a(ve),ke=a(Ce);t(Ce),t(ve),R(()=>_(ke,`Component '${e(n).component??""}' not found`)),r(be,ve)};k(dt,be=>{e(n).component==="CustomModal"?be(ze):be(He,!1)},!0)}r(we,Fe)};k(Pe,we=>{e(n).component==="DocumentRequestModal"?we($e):we(st,!1)},!0)}r(De,Te)};k(We,De=>{e(n).component==="FormModal"?De(vt):De(Ve,!1)},!0)}r(je,Je)};k(ie,je=>{e(n).component==="PromptModal"?je(Ze):je(Ye,!1)},!0)}r(N,L)};k(le,N=>{e(n).component==="AlertModal"?N(X):N(A,!1)},!0)}r(U,H)};k(oe,U=>{e(n).component==="ConfirmModal"?U(me):U(Se,!1)})}r(O,ee)},qe=O=>{const ee=Be(()=>e(n).component);var oe=ae(),me=Q(oe);ys(me,()=>e(ee),(Se,U)=>{U(Se,Ja(()=>e(n).props,{onClose:()=>q(e(n).id)}))}),r(O,oe)};k(j,O=>{typeof e(n).component=="string"?O(J):O(qe,!1)})}r(K,C)},$$slots:{default:!0}})}}),r(c,$),xt()}Zt(["click"]);var Cl=(c,l)=>c.key==="Enter"&&l(c),Ml=h('<div role="dialog" aria-modal="true" tabindex="-1"><!></div>');function Il(c,l){kt(l,!0);const[p,q]=Ua();let b=Be(()=>Ga(Pa,"$docReqModalStore",p)),M=E(!1),n=E(!1),u=E(null);mt(()=>{e(b).isOpen&&!e(M)&&!e(n)?(setTimeout(()=>{d(M,!0)},10),document.body.style.overflow="hidden"):!e(b).isOpen&&(e(M)||e(n))&&Y()});function Y(){d(n,!0),setTimeout(()=>{d(M,!1),d(n,!1),document.body.style.overflow=""},300)}function V(C){C.target===C.currentTarget&&Pa.close()}function i(C){C.key==="Escape"&&e(b).isOpen&&Pa.close()}$a(()=>()=>{document.body.style.overflow=""});var F=ae();ma("keydown",_a,i);var K=Q(F);{var Z=C=>{var j=Ml();let J;j.__click=V,j.__keydown=[Cl,V];var qe=a(j);is(qe,{get request(){return e(b).request},get requestStatuses(){return e(b).requestStatuses},get modalStatuses(){return e(b).modalStatuses},get onUpdate(){return e(b).onUpdate},get onReject(){return e(b).onReject},onClose:()=>Pa.close()}),t(j),rt(j,O=>d(u,O),()=>e(u)),R(O=>J=te(j,1,"docreq-modal-overlay svelte-1yi457b",null,J,O),[()=>({"docreq-modal-visible":e(M)&&!e(n),"docreq-modal-closing":e(n)})]),r(C,j)};k(K,C=>{(e(b).isOpen||e(M)||e(n))&&C(Z)})}r(c,F),xt(),q()}Zt(["click","keydown"]);function Rl(c,l,p){const q=Array.from(c.target.files||[]);if(q.length===0)return;const $=10*1024*1024,b=q.filter(M=>M.size>$?(Re.error(`File "${M.name}" is too large. Maximum size is 10MB.`),!1):!0);d(l,[...e(l),...b],!0),e(p)&&(e(p).value="")}function jl(c,l){e(l)&&e(l).click()}function Pl(c,l){d(l,!0)}function Al(c,l){d(l,!0)}function El(c,l){d(l,!0)}async function $l(c,l,p,q,$){l()&&await l()(p),d(q,!1),$()()}var Fl=h('<span class="payment-amount free svelte-10q3qfh">Free</span>'),Nl=(c,l)=>{c.preventDefault(),l()},Ol=h('<a href="javascript:void(0)" class="payment-amount pending clickable svelte-10q3qfh" title="Click to view payment instructions" aria-label="View payment instructions" role="button"> </a>'),Ll=h('<span class="payment-amount paid svelte-10q3qfh"> </span>'),Bl=h('<div class="student-docreq-card third-row svelte-10q3qfh"><div class="card-label svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">payments</span> Payment</div> <div class="card-value payment-value svelte-10q3qfh"><!></div></div>'),Vl=h('<div class="student-docreq-card third-row svelte-10q3qfh"><div class="card-label svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">event_busy</span> Cancelled Date</div> <div class="card-value svelte-10q3qfh"> </div></div>'),Hl=h('<div class="student-docreq-card third-row svelte-10q3qfh"><div class="card-label svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">event</span> Tentative Date</div> <div class="card-value svelte-10q3qfh"><div class="date-display svelte-10q3qfh"> </div></div></div>'),Ul=h('<div class="student-docreq-card svelte-10q3qfh"><div class="card-label svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">check_circle</span> Released Date</div> <div class="card-value svelte-10q3qfh"> </div></div>'),Gl=h('<div class="admin-note-section svelte-10q3qfh"><div class="note-label svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">note</span> Admin Note</div> <p class="note-text svelte-10q3qfh"> </p></div>'),Ql=h('<div class="message-avatar svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">admin_panel_settings</span></div>'),Kl=h('<div class="student-document-request-message-text"> </div>'),Zl=(c,l,p)=>l(e(p)),Yl=h('<button class="attachment-item svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">attach_file</span> <div class="attachment-info svelte-10q3qfh"><span class="attachment-name svelte-10q3qfh"> </span> <span class="attachment-size svelte-10q3qfh"> </span></div> <span class="material-symbols-outlined svelte-10q3qfh">download</span></button>'),Jl=h('<div class="message-attachments svelte-10q3qfh"></div>'),Wl=h('<div><!> <div class="message-bubble svelte-10q3qfh"><div class="message-header svelte-10q3qfh"><span class="message-author svelte-10q3qfh"> </span> <span class="message-time svelte-10q3qfh"> </span></div> <!> <!></div></div>'),Xl=h('<div class="no-chat svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">chat_bubble_outline</span> <p class="svelte-10q3qfh">No messages yet</p> <p class="subtitle svelte-10q3qfh">Start a conversation with the admin</p></div>'),ei=h('<div class="file-preview-item svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">description</span> <span class="file-preview-name svelte-10q3qfh"> </span> <span class="file-preview-size svelte-10q3qfh"> </span> <button class="remove-file-btn svelte-10q3qfh" title="Remove file"><span class="material-symbols-outlined svelte-10q3qfh">close</span></button></div>'),ti=h('<div class="selected-files-preview svelte-10q3qfh"></div>'),ai=h('<div class="chat-disabled-notice svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">block</span> <span> </span></div>'),si=(c,l,p)=>c.key==="Enter"&&!c.shiftKey&&!e(l)&&p(),li=h('<input type="file" multiple accept="image/*,.pdf,.doc,.docx,.xls,.xlsx,.txt" style="display: none;" class="svelte-10q3qfh"/> <button class="attach-btn svelte-10q3qfh" title="Attach file" aria-label="Attach file"><span class="material-symbols-outlined svelte-10q3qfh">attach_file</span></button> <input placeholder="Type your message..." aria-label="Message input" class="svelte-10q3qfh"/> <button class="send-btn svelte-10q3qfh" title="Send message" aria-label="Send message"><span class="material-symbols-outlined svelte-10q3qfh">send</span></button>',1),ii=(c,l)=>l(1),ni=(c,l)=>l(2),ri=(c,l)=>c.key==="Escape"&&l(),oi=c=>c.stopPropagation(),vi=c=>c.stopPropagation(),di=h('<p class="timeline-user svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">person</span> </p>'),ci=h('<div class="timeline-item svelte-10q3qfh"><div><span class="material-symbols-outlined svelte-10q3qfh"><!></span></div> <div class="timeline-content svelte-10q3qfh"><div class="timeline-header svelte-10q3qfh"><h4 class="svelte-10q3qfh"> </h4> <span class="timeline-date svelte-10q3qfh"> </span></div> <!> <p class="timeline-note svelte-10q3qfh"> </p></div></div>'),ui=h('<div class="status-timeline svelte-10q3qfh"></div>'),fi=h('<div class="no-history svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">history_toggle_off</span> <p class="svelte-10q3qfh">No status history available</p> <p class="subtitle svelte-10q3qfh">Status changes will appear here</p></div>'),pi=h('<div class="status-history-backdrop svelte-10q3qfh" role="dialog" aria-modal="true" tabindex="-1"><div class="status-history-sidebar svelte-10q3qfh"><div class="status-history-header svelte-10q3qfh"><div class="status-history-title svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">history</span> <h3 class="svelte-10q3qfh">Status History</h3></div> <button class="status-history-close-btn svelte-10q3qfh" aria-label="Close"><span class="material-symbols-outlined svelte-10q3qfh">close</span></button></div> <div class="status-history-body svelte-10q3qfh"><!></div></div></div>'),mi=(c,l)=>c.key==="Enter"&&l(),_i=c=>c.stopPropagation(),hi=c=>c.stopPropagation(),qi=h('<div class="flow-backdrop svelte-10q3qfh" role="dialog" aria-modal="true" tabindex="-1"><div class="flow-container svelte-10q3qfh" role="document"><div class="flow-header svelte-10q3qfh"><h2 class="svelte-10q3qfh">Process Status Flow</h2> <button class="flow-close-btn svelte-10q3qfh" aria-label="Close"><span class="material-symbols-outlined svelte-10q3qfh">close</span></button></div> <div class="flow-body svelte-10q3qfh"><div class="flow-list svelte-10q3qfh"><div class="flow-item svelte-10q3qfh"><div class="flow-icon-wrapper on_hold svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">pause_circle</span></div> <div class="flow-content svelte-10q3qfh"><h3 class="svelte-10q3qfh">On Hold</h3> <p class="svelte-10q3qfh">Your request is awaiting review by the admin.</p></div></div> <div class="flow-item svelte-10q3qfh"><div class="flow-icon-wrapper verifying svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">fact_check</span></div> <div class="flow-content svelte-10q3qfh"><h3 class="svelte-10q3qfh">Verifying</h3> <p class="svelte-10q3qfh">The document request is currently being verified.</p></div></div> <div class="flow-item svelte-10q3qfh"><div class="flow-icon-wrapper processing svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">sync</span></div> <div class="flow-content svelte-10q3qfh"><h3 class="svelte-10q3qfh">For Processing</h3> <p class="svelte-10q3qfh">The document is in the processing stage.</p></div></div> <div class="flow-item svelte-10q3qfh"><div class="flow-icon-wrapper for_pickup svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">inventory</span></div> <div class="flow-content svelte-10q3qfh"><h3 class="svelte-10q3qfh">For Pick Up</h3> <p class="svelte-10q3qfh">The document is ready and available for pick up.</p></div></div> <div class="flow-item svelte-10q3qfh"><div class="flow-icon-wrapper released svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">check_circle</span></div> <div class="flow-content svelte-10q3qfh"><h3 class="svelte-10q3qfh">Released</h3> <p class="svelte-10q3qfh">The document has been released to you.</p></div></div> <div class="flow-item svelte-10q3qfh"><div class="flow-icon-wrapper rejected svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">cancel</span></div> <div class="flow-content svelte-10q3qfh"><h3 class="svelte-10q3qfh">Rejected</h3> <p class="svelte-10q3qfh">The request was rejected. Check the rejection reason or contact admin.</p></div></div></div></div></div></div>'),bi=h('<div class="modal-confirm-content svelte-10q3qfh"><div class="modal-message svelte-10q3qfh"><p class="svelte-10q3qfh">Are you sure you want to cancel this document request?</p> <div class="confirm-details cancel-warning svelte-10q3qfh"><div class="confirm-detail-row svelte-10q3qfh"><span class="detail-label svelte-10q3qfh">Request ID:</span> <span class="detail-value svelte-10q3qfh"> </span></div> <div class="confirm-detail-row svelte-10q3qfh"><span class="detail-label svelte-10q3qfh">Document Type:</span> <span class="detail-value svelte-10q3qfh"> </span></div> <div class="confirm-detail-row svelte-10q3qfh"><span class="detail-label svelte-10q3qfh">Status:</span> <span class="detail-value svelte-10q3qfh"> </span></div> <div class="cancel-notice svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">warning</span> <span>This action will mark your request as cancelled. You may need to submit a new request if needed.</span></div></div></div> <div class="modal-actions svelte-10q3qfh"><button class="modal-btn modal-btn-secondary svelte-10q3qfh">Go Back</button> <button class="modal-btn modal-btn-danger svelte-10q3qfh">Cancel Request</button></div></div>'),gi=(c,l)=>c.key==="Escape"&&l(),yi=c=>c.stopPropagation(),wi=h(`<div class="payment-instructions-backdrop svelte-10q3qfh" role="dialog" aria-modal="true" tabindex="-1"><div class="payment-instructions-container svelte-10q3qfh"><div class="payment-instructions-header svelte-10q3qfh"><h2 class="svelte-10q3qfh">Payment Instructions</h2> <button class="payment-instructions-close-btn svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">close</span></button></div> <div class="payment-instructions-body svelte-10q3qfh"><p class="svelte-10q3qfh">You can pay once your document is ready for pick-up.</p> <p class="svelte-10q3qfh">Please follow these steps to complete your payment and claim your document:</p> <ol class="payment-instructions-steps svelte-10q3qfh"><li class="svelte-10q3qfh">Wait until your request status shows "Ready for Pick-Up."</li> <li class="svelte-10q3qfh">Go to the Cashier's Office.</li> <li class="svelte-10q3qfh">Inform the cashier that you are paying for your approved document request.</li> <li class="svelte-10q3qfh">Provide your Request Reference Number or Student ID.</li> <li class="svelte-10q3qfh">Pay the required amount for your document.</li> <li class="svelte-10q3qfh">Get your Official Receipt.</li> <li class="svelte-10q3qfh">Proceed to the Registrar's Office (or releasing area) and present your receipt to claim your document.</li></ol></div> <div class="payment-instructions-footer svelte-10q3qfh"><button class="payment-instructions-got-it-btn svelte-10q3qfh">Got it</button></div></div></div>`),zi=h('<div class="student-docreq-modal-content svelte-10q3qfh"><div class="student-docreq-modal-grid svelte-10q3qfh"><div><header class="student-docreq-modal-title svelte-10q3qfh"><h2 class="svelte-10q3qfh">Request Details</h2> <div class="student-docreq-modal-sub svelte-10q3qfh">ID: <span> </span></div></header> <div class="student-docreq-cards svelte-10q3qfh"><div><div class="status-group svelte-10q3qfh"><div class="card-label svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">info</span> Status:</div> <button title="Click to view status history" aria-label="View status history timeline"> </button></div> <button class="status-info-button svelte-10q3qfh" title="Click to view status flow information" aria-label="View status flow information"><span class="material-symbols-outlined svelte-10q3qfh">help</span></button></div> <div class="student-docreq-card half-width svelte-10q3qfh"><div class="card-label svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">description</span> Document Type</div> <div class="card-value svelte-10q3qfh"> </div></div> <div class="student-docreq-card half-width svelte-10q3qfh"><div class="card-label svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">account_circle</span> Processed By</div> <div class="card-value svelte-10q3qfh"> </div></div> <!> <div class="student-docreq-card third-row svelte-10q3qfh"><div class="card-label svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">calendar_today</span> Requested Date</div> <div class="card-value svelte-10q3qfh"> </div></div> <!> <!></div> <div class="student-docreq-purpose svelte-10q3qfh"><div class="purpose-label svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">description</span> Purpose & Details</div> <div class="purpose-content svelte-10q3qfh"> </div></div> <!> <div class="student-modal-action-buttons svelte-10q3qfh"><button class="student-cancel-button svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">cancel</span> Cancel Request</button> <button class="student-back-button svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">arrow_back</span> Back</button></div></div> <div><div class="chat-container svelte-10q3qfh"><div class="chat-header svelte-10q3qfh"><h3 class="svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">forum</span> Communication</h3> <span class="chat-count-badge svelte-10q3qfh"> </span></div> <div class="student-chat-messages svelte-10q3qfh"><!></div> <div class="student-chat-input-wrapper svelte-10q3qfh"><!> <div><!></div></div></div></div></div> <div class="mobile-pagination-controls svelte-10q3qfh"><div class="pagination-dots svelte-10q3qfh"><button aria-label="Go to request details"><span class="material-symbols-outlined svelte-10q3qfh">description</span></button> <button aria-label="Go to chat"><span class="material-symbols-outlined svelte-10q3qfh">forum</span></button></div></div></div> <!> <!> <!> <!>',1);function ki(c,l){kt(l,!0);const[p,q]=Ua(),$=()=>Ga(fa,"$authStore",p);let b=Ee(l,"request",19,()=>({})),M=Ee(l,"onCancel",3,()=>{});Ee(l,"onRefresh",3,()=>{});let n=Ee(l,"onClose",3,()=>{}),u=_t({...b()}),Y=E(""),V=E(!1),i=E(!1),F=E(void 0),K=E(void 0),Z=E(void 0),C=E(_t([])),j,J=E(!1),qe=E(!1),O=E(!1),ee=E(1),oe=Be(()=>u.messages||[]),me=Be(()=>u.statusHistory||[]),Se=Be(()=>u.status==="released"||u.status==="cancelled");function U(){e(F)&&setTimeout(()=>{e(F).scrollTop=e(F).scrollHeight},100)}function H(v){d(C,e(C).filter((m,w)=>w!==v),!0)}async function le(v){return new Promise((m,w)=>{const z=new FileReader;z.onload=()=>m(z.result),z.onerror=w,z.readAsDataURL(v)})}function X(v){const m=document.createElement("a");m.href=v.data,m.download=v.name,m.click()}function A(v){return{on_hold:"On Hold",verifying:"Verifying",processing:"For Processing",for_pickup:"For Pick Up",released:"Released",rejected:"Rejected",cancelled:"Cancelled"}[v]||v}function N(v){if(!v)return"N/A";const m=new Date(v),w=String(m.getMonth()+1).padStart(2,"0"),z=String(m.getDate()).padStart(2,"0"),I=m.getFullYear();return`${w}/${z}/${I}`}function L(){d(V,!1)}function ie(){d(qe,!1)}function Ze(){d(O,!0)}function Ye(){d(O,!1)}async function je(){if(!e(Y).trim()&&e(C).length===0||e(i)||!u||e(Se))return;d(i,!0);const v=e(Y).trim(),m=[...e(C)];let w=[];try{for(const D of m){const P=await le(D);w.push({name:D.name,type:D.type,size:D.size,data:P})}}catch(D){console.error("Error converting files:",D),Re.error("Failed to process files. Please try again."),d(i,!1);return}const z=`temp-${Date.now()}`,I={id:z,text:v,author:$().userData?.name||"Student",authorRole:"student",created_at:new Date().toISOString(),attachments:w,isPending:!0};u.messages=[...u.messages||[],I],d(Y,""),d(C,[],!0),U(),e(K)&&setTimeout(()=>e(K).focus(),50);try{const D=await Xa.post("/api/document-requests",{action:"sendMessage",requestId:u.requestId,message:v,attachments:w});D.success?u.messages=u.messages.map(P=>P.id===z?{...D.data,id:z,isPending:!1}:P):(console.error("Failed to send message:",D.error),u.messages=u.messages.filter(P=>P.id!==z),Re.error("Failed to send message. Please try again."),d(Y,v,!0),d(C,m,!0))}catch(D){console.error("Error sending message:",D),u.messages=u.messages.filter(P=>P.id!==z),Re.error("An error occurred while sending the message."),d(Y,v,!0),d(C,m,!0)}finally{d(i,!1)}}function Je(){d(J,!1)}function We(v){d(ee,v,!0)}async function vt(){if(!(!u||e(i)))try{const v=await Xa.get(`/api/document-requests?action=single&requestId=${u.requestId}`);if(v.success&&v.data.messages){const m=e(oe).filter(D=>D.isPending),w=v.data.messages,z=new Set(e(oe).filter(D=>!D.isPending).map(D=>D.id));w.filter(D=>!z.has(D.id)).length>0&&(u.messages=[...w,...m],U()),v.data.statusHistory&&(u.statusHistory=v.data.statusHistory)}}catch(v){console.error("Error fetching latest messages:",v)}}function Ve(){document.hidden?j&&(clearInterval(j),j=null):j||(vt(),j=setInterval(vt,8e3))}mt(()=>(j=setInterval(vt,8e3),document.addEventListener("visibilitychange",Ve),U(),()=>{j&&clearInterval(j),document.removeEventListener("visibilitychange",Ve)}));var De=zi(),Te=Q(De),Pe=a(Te),$e=a(Pe);let st;var we=a($e),Fe=s(a(we),2),dt=s(a(Fe)),ze=a(dt,!0);t(dt),t(Fe),t(we);var He=s(we,2),be=a(He),ve=a(be),Ce=s(a(ve),2);Ce.__click=[Al,qe];var ke=a(Ce,!0);t(Ce),t(ve);var St=s(ve,2);St.__click=[Pl,V],t(be);var ct=s(be,2),ht=s(a(ct),2),qt=a(ht,!0);t(ht),t(ct);var ut=s(ct,2),Ue=s(a(ut),2),$t=a(Ue,!0);t(Ue),t(ut);var ha=s(ut,2);{var Yt=v=>{var m=Bl(),w=s(a(m),2),z=a(w);{var I=P=>{var ne=Fl();r(P,ne)},D=P=>{var ne=ae(),xe=Q(ne);{var se=de=>{var B=Ol();B.__click=[Nl,Ze];var Ae=a(B);t(B),R(()=>_(Ae,`₱${u.paymentAmount??""} (Pending)`)),r(de,B)},_e=de=>{var B=Ll(),Ae=a(B);t(B),R(()=>_(Ae,`₱${u.paymentAmount??""} (Paid)`)),r(de,B)};k(xe,de=>{u.paymentStatus==="pending"?de(se):de(_e,!1)},!0)}r(P,ne)};k(z,P=>{u.paymentAmount===0?P(I):P(D,!1)})}t(w),t(m),r(v,m)};k(ha,v=>{u.paymentAmount!==null&&u.paymentAmount!==void 0&&v(Yt)})}var Ft=s(ha,2),qa=s(a(Ft),2),Jt=a(qa,!0);t(qa),t(Ft);var Wt=s(Ft,2);{var Nt=v=>{var m=Vl(),w=s(a(m),2),z=a(w,!0);t(w),t(m),R(()=>_(z,u.cancelledDate)),r(v,m)},ba=v=>{var m=ae(),w=Q(m);{var z=I=>{var D=Hl(),P=s(a(D),2),ne=a(P),xe=a(ne,!0);t(ne),t(P),t(D),R(se=>_(xe,se),[()=>N(u.tentativeDate)]),r(I,D)};k(w,I=>{u.tentativeDate&&I(z)},!0)}r(v,m)};k(Wt,v=>{u.status==="cancelled"&&u.cancelledDate?v(Nt):v(ba,!1)})}var Dt=s(Wt,2);{var Xt=v=>{var m=Ul(),w=s(a(m),2),z=a(w,!0);t(w),t(m),R(()=>_(z,u.completedDate)),r(v,m)};k(Dt,v=>{u.status==="released"&&u.completedDate&&v(Xt)})}t(He);var ea=s(He,2),ta=s(a(ea),2),Fa=a(ta,!0);t(ta),t(ea);var aa=s(ea,2);{var ga=v=>{var m=Gl(),w=s(a(m),2),z=a(w,!0);t(w),t(m),R(()=>_(z,u.adminNote)),r(v,m)};k(aa,v=>{u.adminNote&&v(ga)})}var ya=s(aa,2),bt=a(ya);bt.__click=[El,J];var wa=s(bt,2);wa.__click=function(...v){n()?.apply(this,v)},t(ya),t($e);var Ot=s($e,2);let sa;var za=a(Ot),la=a(za),ia=s(a(la),2),lt=a(ia,!0);t(ia),t(la);var Tt=s(la,2),Na=a(Tt);{var gt=v=>{var m=ae(),w=Q(m);ot(w,17,()=>e(oe),z=>z.id,(z,I)=>{var D=Wl(),P=a(D);{var ne=ce=>{var Me=Ql();r(ce,Me)};k(P,ce=>{e(I).authorRole==="admin"&&ce(ne)})}var xe=s(P,2),se=a(xe),_e=a(se),de=a(_e,!0);t(_e);var B=s(_e,2),Ae=a(B,!0);t(B),t(se);var Ne=s(se,2);{var it=ce=>{var Me=Kl(),ft=a(Me,!0);t(Me),R(()=>_(ft,e(I).text)),r(ce,Me)};k(Ne,ce=>{e(I).text&&ce(it)})}var yt=s(Ne,2);{var Mt=ce=>{var Me=Jl();ot(Me,21,()=>e(I).attachments,Ea,(ft,nt)=>{var wt=Yl();wt.__click=[Zl,X,nt];var It=s(a(wt),2),Rt=a(It),o=a(Rt,!0);t(Rt);var f=s(Rt,2),T=a(f);t(f),t(It),At(2),t(wt),R(g=>{_(o,e(nt).name),_(T,`${g??""} KB`)},[()=>(e(nt).size/1024).toFixed(1)]),r(ft,wt)}),t(Me),r(ce,Me)};k(yt,ce=>{e(I).attachments&&e(I).attachments.length>0&&ce(Mt)})}t(xe),t(D),R(ce=>{te(D,1,`message-wrapper ${e(I).authorRole==="admin"?"received":"sent"}`,"svelte-10q3qfh"),_(de,e(I).author),_(Ae,ce)},[()=>new Date(e(I).created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]),r(z,D)}),r(v,m)},ka=v=>{var m=Xl();r(v,m)};k(Na,v=>{e(oe).length>0?v(gt):v(ka,!1)})}t(Tt),rt(Tt,v=>d(F,v),()=>e(F));var xa=s(Tt,2),Sa=a(xa);{var Oa=v=>{var m=ti();ot(m,21,()=>e(C),Ea,(w,z,I)=>{var D=ei(),P=s(a(D),2),ne=a(P,!0);t(P);var xe=s(P,2),se=a(xe);t(xe);var _e=s(xe,2);_e.__click=()=>H(I),t(D),R(de=>{_(ne,e(z).name),_(se,`(${de??""} KB)`)},[()=>(e(z).size/1024).toFixed(1)]),r(w,D)}),t(m),r(v,m)};k(Sa,v=>{e(C).length>0&&v(Oa)})}var Ct=s(Sa,2);let na;var La=a(Ct);{var Da=v=>{var m=ai(),w=s(a(m),2),z=a(w);t(w),t(m),R(()=>_(z,`Chat is disabled for ${u.status==="released"?"released":"cancelled"} requests`)),r(v,m)},ra=v=>{var m=li(),w=Q(m);w.__change=[Rl,C,Z],rt(w,P=>d(Z,P),()=>e(Z));var z=s(w,2);z.__click=[jl,Z];var I=s(z,2);Et(I),I.__keydown=[si,i,je],rt(I,P=>d(K,P),()=>e(K));var D=s(I,2);D.__click=je,R(P=>{I.disabled=e(i),D.disabled=P},[()=>e(i)||!e(Y).trim()&&e(C).length===0]),Kt(I,()=>e(Y),P=>d(Y,P)),r(v,m)};k(La,v=>{e(Se)?v(Da):v(ra,!1)})}t(Ct),t(xa),t(za),t(Ot),t(Pe);var Lt=s(Pe,2),Ta=a(Lt),Bt=a(Ta);let Vt;Bt.__click=[ii,We];var oa=s(Bt,2);let Ht;oa.__click=[ni,We],t(Ta),t(Lt),t(Te);var va=s(Te,2);{var Ba=v=>{var m=pi();m.__click=ie,m.__keydown=[ri,ie];var w=a(m);w.__click=[oi],w.__keydown=[vi];var z=a(w),I=s(a(z),2);I.__click=ie,t(z);var D=s(z,2),P=a(D);{var ne=se=>{var _e=ui();ot(_e,23,()=>e(me),(de,B)=>de.timestamp||B,(de,B)=>{var Ae=ci(),Ne=a(Ae),it=a(Ne),yt=a(it);{var Mt=x=>{var S=at("pause_circle");r(x,S)},ce=x=>{var S=ae(),y=Q(S);{var G=W=>{var ue=at("fact_check");r(W,ue)},he=W=>{var ue=ae(),Xe=Q(ue);{var Oe=ge=>{var Ie=at("sync");r(ge,Ie)},et=ge=>{var Ie=ae(),tt=Q(Ie);{var Ge=pe=>{var Qe=at("inventory");r(pe,Qe)},fe=pe=>{var Qe=ae(),jt=Q(Qe);{var pt=Ke=>{var ye=at("check_circle");r(Ke,ye)},Pt=Ke=>{var ye=ae(),Le=Q(ye);{var Gt=zt=>{var Ra=at("cancel");r(zt,Ra)},ca=zt=>{var Ra=ae(),ns=Q(Ra);{var rs=Qt=>{var Ha=at("block");r(Qt,Ha)},os=Qt=>{var Ha=at("circle");r(Qt,Ha)};k(ns,Qt=>{e(B).status==="cancelled"?Qt(rs):Qt(os,!1)},!0)}r(zt,Ra)};k(Le,zt=>{e(B).status==="rejected"?zt(Gt):zt(ca,!1)},!0)}r(Ke,ye)};k(jt,Ke=>{e(B).status==="released"?Ke(pt):Ke(Pt,!1)},!0)}r(pe,Qe)};k(tt,pe=>{e(B).status==="for_pickup"?pe(Ge):pe(fe,!1)},!0)}r(ge,Ie)};k(Xe,ge=>{e(B).status==="processing"?ge(Oe):ge(et,!1)},!0)}r(W,ue)};k(y,W=>{e(B).status==="verifying"?W(G):W(he,!1)},!0)}r(x,S)};k(yt,x=>{e(B).status==="on_hold"?x(Mt):x(ce,!1)})}t(it),t(Ne);var Me=s(Ne,2),ft=a(Me),nt=a(ft),wt=a(nt,!0);t(nt);var It=s(nt,2),Rt=a(It,!0);t(It),t(ft);var o=s(ft,2);{var f=x=>{var S=di(),y=s(a(S));t(S),R(()=>_(y,` ${e(B).changedBy??""}`)),r(x,S)};k(o,x=>{e(B).changedBy&&x(f)})}var T=s(o,2),g=a(T,!0);t(T),t(Me),t(Ae),R((x,S)=>{te(Ne,1,`timeline-marker status-${e(B).status??""}`,"svelte-10q3qfh"),_(wt,x),_(Rt,S),_(g,e(B).note||"No additional details")},[()=>A(e(B).status),()=>new Date(e(B).timestamp).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})]),r(de,Ae)}),t(_e),r(se,_e)},xe=se=>{var _e=fi();r(se,_e)};k(P,se=>{e(me)&&e(me).length>0?se(ne):se(xe,!1)})}t(D),t(w),t(m),r(v,m)};k(va,v=>{e(qe)&&v(Ba)})}var Ut=s(va,2);{var Ca=v=>{var m=qi();m.__click=L,m.__keydown=[mi,L];var w=a(m);w.__click=[_i],w.__keydown=[hi];var z=a(w),I=s(a(z),2);I.__click=L,t(z),At(2),t(w),t(m),r(v,m)};k(Ut,v=>{e(V)&&v(Ca)})}var Ma=s(Ut,2);{var da=v=>{pa(v,{title:"Cancel Request",size:"small",closable:!0,onClose:Je,children:(m,w)=>{var z=bi(),I=a(z),D=s(a(I),2),P=a(D),ne=s(a(P),2),xe=a(ne,!0);t(ne),t(P);var se=s(P,2),_e=s(a(se),2),de=a(_e,!0);t(_e),t(se);var B=s(se,2),Ae=s(a(B),2),Ne=a(Ae,!0);t(Ae),t(B),At(2),t(D),t(I);var it=s(I,2),yt=a(it);yt.__click=Je;var Mt=s(yt,2);Mt.__click=[$l,M,u,J,n],t(it),t(z),R(ce=>{_(xe,u.requestId),_(de,u.type),_(Ne,ce)},[()=>A(u.status)]),r(m,z)},$$slots:{default:!0}})};k(Ma,v=>{e(J)&&v(da)})}var Ia=s(Ma,2);{var Va=v=>{var m=wi();m.__click=Ye,m.__keydown=[gi,Ye];var w=a(m);w.__click=[yi];var z=a(w),I=s(a(z),2);I.__click=Ye,t(z);var D=s(z,4),P=a(D);P.__click=Ye,t(D),t(w),t(m),r(v,m)};k(Ia,v=>{e(O)&&v(Va)})}R((v,m,w,z,I,D)=>{st=te($e,1,"student-docreq-modal-left-container svelte-10q3qfh",null,st,v),_(ze,u.requestId),te(be,1,`student-docreq-card full-width status-card-horizontal status-card-${u.status??""}`,"svelte-10q3qfh"),te(Ce,1,`status-badge status-${u.status??""}`,"svelte-10q3qfh"),_(ke,m),_(qt,u.type),_($t,u.processedBy??"—"),_(Jt,u.requestedDate??"—"),_(Fa,u.purpose||"No purpose provided"),bt.disabled=u.status!=="on_hold",re(bt,"title",u.status!=="on_hold"?"Can only cancel requests that are on hold":"Cancel this request"),sa=te(Ot,1,"student-docreq-modal-right-container svelte-10q3qfh",null,sa,w),_(lt,e(oe).length),na=te(Ct,1,"student-chat-input svelte-10q3qfh",null,na,z),Vt=te(Bt,1,"pagination-dot svelte-10q3qfh",null,Vt,I),Ht=te(oa,1,"pagination-dot svelte-10q3qfh",null,Ht,D)},[()=>({"mobile-hidden":e(ee)!==1}),()=>A(u.status),()=>({"mobile-hidden":e(ee)!==2}),()=>({disabled:e(Se)}),()=>({active:e(ee)===1}),()=>({active:e(ee)===2})]),r(c,De),xt(),q()}Zt(["click","change","keydown"]);var xi=(c,l)=>c.key==="Enter"&&l(c),Si=h('<div role="dialog" aria-modal="true" tabindex="-1"><!></div>');function Di(c,l){kt(l,!0);let p=E(_t({isOpen:!1,request:null,onCancel:null,onRefresh:null}));Aa.subscribe(F=>{d(p,F,!0)});let q=E(!1),$=E(!1),b=E(null);mt(()=>{e(p).isOpen&&!e(q)&&!e($)?(setTimeout(()=>{d(q,!0)},10),document.body.style.overflow="hidden"):!e(p).isOpen&&(e(q)||e($))&&M()});function M(){d($,!0),setTimeout(()=>{d(q,!1),d($,!1),document.body.style.overflow=""},300)}function n(F){F.target===F.currentTarget&&Aa.close()}function u(F){F.key==="Escape"&&e(p).isOpen&&Aa.close()}$a(()=>()=>{document.body.style.overflow=""});var Y=ae();ma("keydown",_a,u);var V=Q(Y);{var i=F=>{var K=Si();let Z;K.__click=n,K.__keydown=[xi,n];var C=a(K);ki(C,{get request(){return e(p).request},get onCancel(){return e(p).onCancel},get onRefresh(){return e(p).onRefresh},onClose:()=>Aa.close()}),t(K),rt(K,j=>d(b,j),()=>e(b)),R(j=>Z=te(K,1,"student-docreq-modal-overlay svelte-1ingzcd",null,Z,j),[()=>({"student-docreq-modal-visible":e(q)&&!e($),"student-docreq-modal-closing":e($)})]),r(F,K)};k(V,F=>{(e(p).isOpen||e(q)||e($))&&F(i)})}r(c,Y),xt()}Zt(["click","keydown"]);var Ti=h('<link rel="icon"/> <link rel="preconnect" href="https://fonts.googleapis.com"/> <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin=""/> <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&amp;display=swap" rel="stylesheet"/> <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/> <meta name="theme-color" content="#1565c0"/>',1),Ci=h("<!> <!> <!> <!> <!>",1);function Ai(c,l){kt(l,!0);let p=E(!1),q=E(void 0);mt(()=>fa.subscribe(N=>{d(q,N,!0)}));let $=Be(()=>e(q)?.isAuthenticated?e(q).userType==="admin"?ws:e(q).userType==="student"?zs:e(q).userType==="teacher"?ks:ts:ts);$a(()=>{setTimeout(()=>{fa.initialize(),d(p,!0),window.appLoadingManager&&window.appLoadingManager.setReady(),ee()},2800)});const b=14400*1e3,M=300*1e3,n="lastActivityTimestamp";let u=null,Y=0;function V(){try{const A=localStorage.getItem(n);return A?Number(A):null}catch{return null}}function i(A){try{localStorage.setItem(n,String(A))}catch{}}function F(){try{localStorage.removeItem(n)}catch{}}function K(){u&&(clearTimeout(u),u=null);const A=V()||Date.now(),N=Date.now()-A,L=b-N;if(L<=0){j();return}u=setTimeout(j,L)}async function Z(){try{if(!e(q)?.isAuthenticated||!e(q).userData)return;const A=Date.now();if(A-Y<M)return;const N={id:e(q).userData.id,name:e(q).userData.name,account_number:e(q).userData.accountNumber,account_type:e(q).userData.account_type||e(q).userData.accountType};await fetch("/api/auth/heartbeat",{method:"POST",headers:{"Content-Type":"application/json","x-user-info":JSON.stringify(N)},body:JSON.stringify({timestamp:new Date().toISOString()})}),Y=A}catch(A){console.warn("Heartbeat failed",A)}}function C(){if(!window?.localStorage)return;const A=Date.now();i(A),K(),Z()}function j(){e(q)?.isAuthenticated&&(fa.logout(),F())}let J=!1;function qe(){if(J)return;J=!0,["mousemove","mousedown","keydown","scroll","touchstart","click"].forEach(N=>window.addEventListener(N,C,{passive:!0})),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&C()}),window.addEventListener("storage",N=>{N.key===n&&K()})}function O(){if(!J)return;J=!1,["mousemove","mousedown","keydown","scroll","touchstart","click"].forEach(N=>window.removeEventListener(N,C)),document.removeEventListener("visibilitychange",()=>{}),window.removeEventListener("storage",()=>{})}function ee(){if(typeof window>"u")return;V()||i(Date.now()),qe(),K(),window.addEventListener("beforeunload",()=>{O(),u&&clearTimeout(u)})}var oe=Ci();hs(A=>{var N=Ti(),L=Q(N);At(12),R(()=>re(L,"href",e($))),r(A,N)});var me=Q(oe);{var Se=A=>{var N=ae(),L=Q(N);ls(L,()=>l.children??qs),r(A,N)};k(me,A=>{e(p)&&A(Se)})}var U=s(me,2);Ss(U,{});var H=s(U,2);Tl(H,{});var le=s(H,2);Il(le,{});var X=s(le,2);Di(X,{}),r(c,oe),xt()}export{Ai as component};
