import"../chunks/DsnmJJEf.js";import{w as P,h as Ka,a as Za,a0 as ds,aM as vs,f as Ya,al as cs,ax as us,aN as fs,aO as ps,aP as Ja,G as ms,aQ as _s,ak as Ia,q as Dt,ae as $,_ as bt,T as v,t as q,x as n,y as Tt,l as e,A as t,aL as Wt,aR as ls,ad as Aa,ag as te,aS as ha,aT as qa,v as Q,z as a,B as s,aU as is,C as _,i as qt,ah as Be,aV as jt,ai as et,aW as hs,P as qs}from"../chunks/BrR45Eif.js";import{p as je,i as k,b as rt,s as Ga,a as Qa,c as Wa}from"../chunks/CsvhCkDi.js";import{t as Ie,e as ot,T as bs,s as se,a as ne,b as pa,r as Nt,c as Jt,i as Pa,d as ma,f as ys,m as Xa,g as Ma,h as es,j as Ra}from"../chunks/x4FCHtqB.js";import{c as gs}from"../chunks/vM_StVem.js";function ts(c,l,p=!1,b=!1,F=!1){var y=c,T="";P(()=>{var r=ds;if(T===(T=l()??"")){Ka&&Za();return}if(r.nodes_start!==null&&(vs(r.nodes_start,r.nodes_end),r.nodes_start=r.nodes_end=null),T!==""){if(Ka){Ya.data;for(var u=Za(),Y=u;u!==null&&(u.nodeType!==cs||u.data!=="");)Y=u,u=us(u);if(u===null)throw fs(),ps;Ja(Ya,Y),y=ms(u);return}var H=T+"";p?H=`<svg>${H}</svg>`:b&&(H=`<math>${H}</math>`);var i=_s(H);if((p||b)&&(i=Ia(i)),Ja(Ia(i),i.lastChild),p||b)for(;Ia(i);)y.before(Ia(i));else y.before(i)}})}const as="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48px'%20viewBox='0%20-960%20960%20960'%20width='48px'%20fill='%23789DE5'%3e%3cpath%20d='M222-255q63-40%20124.5-60.5T480-336q72%200%20134%2020.5T739-255q44-54%2062.5-109T820-480q0-145-97.5-242.5T480-820q-145%200-242.5%2097.5T140-480q0%2061%2019%20116t63%20109Zm257.81-195q-57.81%200-97.31-39.69-39.5-39.68-39.5-97.5%200-57.81%2039.69-97.31%2039.68-39.5%2097.5-39.5%2057.81%200%2097.31%2039.69%2039.5%2039.68%2039.5%2097.5%200%2057.81-39.69%2097.31-39.68%2039.5-97.5%2039.5Zm-.21%20370q-83.15%200-156.28-31.5t-127.22-86Q142-252%20111-324.84%2080-397.68%2080-480.5t31.5-155.66Q143-709%20197.5-763t127.34-85.5Q397.68-880%20480.5-880t155.66%2031.5Q709-817%20763-763t85.5%20127Q880-563%20880-480.27q0%2082.74-31.5%20155.5Q817-252%20763-197.5t-127.13%2086Q562.74-80%20479.6-80Z'/%3e%3c/svg%3e",ws="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48px'%20viewBox='0%20-960%20960%20960'%20width='48px'%20fill='%23789DE5'%3e%3cpath%20d='M480.17-450Q537-450%20577-490.17t40-97Q617-644%20576.83-684t-97-40Q423-724%20383-683.83t-40%2097Q343-530%20383.17-490t97%2040ZM480-81q-148-38-234-162.54Q160-368.08%20160-523v-238l320-120%20320%20120v238q0%20154.92-86%20279.46Q628-119%20480-81Zm0-62q60-20%20108-59.5t83-90.5q-44.67-21.02-92.97-32.01Q529.72-336%20479.86-336t-98.07%2010.99Q333.58-314.02%20289-293q35%2051%2083%2090.5T480-143Z'/%3e%3c/svg%3e",ks="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48px'%20viewBox='0%20-960%20960%20960'%20width='48px'%20fill='%23789DE5'%3e%3cpath%20d='M860-283v-282L479-360%2040-600l439-240%20441%20240v317h-60ZM479-120%20189-279v-210l290%20159%20290-159v210L479-120Z'/%3e%3c/svg%3e",zs="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48px'%20viewBox='0%20-960%20960%20960'%20width='48px'%20fill='%23789DE5'%3e%3cpath%20d='M480-302q-74%200-139.5%2024.5T220-211v71h520v-71q-55-42-120.5-66.5T480-302ZM220-80q-24%200-42-18t-18-42v-680q0-24%2018-42t42-18h520q24%200%2042%2018t18%2042v680q0%2024-18%2042t-42%2018H220Zm262-301q58%200%2098-40t40-98q0-58-40-98t-98-40q-58%200-98%2040t-40%2098q0%2058%2040%2098t98%2040Z'/%3e%3c/svg%3e";var xs=q('<div class="toast-container svelte-n5a2bz"></div>');function Ss(c,l){Dt(l,!0);let p=$(bt([]));Ie.subscribe(y=>{v(p,y,!0)});function b(y){setTimeout(()=>{Ie.remove(y)},300)}var F=xs();ot(F,21,()=>e(p),y=>y.id,(y,T)=>{bs(y,{get message(){return e(T).message},get type(){return e(T).type},get duration(){return e(T).duration},onClose:()=>b(e(T).id)})}),t(F),n(c,F),Tt()}function ss(c,l,p){l()&&c.target===c.currentTarget&&p()}var Ds=q('<h2 id="modal-title" class="modal-title svelte-1a3w2n2"> </h2>'),Ts=q('<button class="modal-close-btn svelte-1a3w2n2" aria-label="Close modal"><span class="material-symbols-outlined svelte-1a3w2n2">close</span></button>'),Cs=q('<div class="modal-header svelte-1a3w2n2"><!> <!></div>'),Is=q('<div role="presentation"><div role="dialog" aria-modal="true" tabindex="-1"><!> <div class="modal-body svelte-1a3w2n2"><!></div></div></div>');function _a(c,l){Dt(l,!0);let p=je(l,"title",3,""),b=je(l,"size",3,"medium"),F=je(l,"closable",3,!0),y=je(l,"backdrop",3,!0),T=$(!1),r=$(!1),u=$(void 0);const Y=ls();Aa(()=>(setTimeout(()=>{v(T,!0)},10),e(u)&&e(u).focus(),document.body.style.overflow="hidden",()=>{document.body.style.overflow=""}));function H(){F()&&(v(r,!0),setTimeout(()=>{v(T,!1),document.body.style.overflow="",l.onClose&&l.onClose(),Y("close")},300))}function i(M){M.key==="Escape"&&F()&&H()}function j(M){switch(M){case"small":return"modal-small";case"large":return"modal-large";case"xlarge":return"modal-xlarge";case"full":return"modal-full";default:return"modal-medium"}}var K=te();ha("keydown",qa,i);var Z=Q(K);{var D=M=>{var J=Is();let he;J.__click=[ss,y,H],J.__keydown=[ss,y,H];var O=a(J),X=a(O);{var re=G=>{var U=Cs(),oe=a(U);{var ee=B=>{var fe=Ds(),dt=a(fe,!0);t(fe),P(()=>_(dt,p())),n(B,fe)};k(oe,B=>{p()&&B(ee)})}var E=s(oe,2);{var N=B=>{var fe=Ts();fe.__click=H,n(B,fe)};k(E,B=>{F()&&B(N)})}t(U),n(G,U)};k(X,G=>{(p()||F())&&G(re)})}var ue=s(X,2),ye=a(ue);is(ye,()=>l.children),t(ue),t(O),rt(O,G=>v(u,G),()=>e(u)),t(J),P((G,U)=>{he=se(J,1,"modal-overlay svelte-1a3w2n2",null,he,G),se(O,1,`modal-content ${U??""}`,"svelte-1a3w2n2"),ne(O,"aria-labelledby",p()?"modal-title":void 0)},[()=>({"modal-visible":e(T)&&!e(r),"modal-closing":e(r)}),()=>j(b())]),n(M,J)};k(Z,M=>{(e(T)||e(r))&&M(D)})}n(c,K),Tt()}Wt(["click","keydown"]);function Ms(c,l,p){const b=Array.from(c.target.files||[]);if(b.length===0)return;const F=10*1024*1024,y=b.filter(T=>T.size>F?(Ie.error(`File "${T.name}" is too large. Maximum size is 10MB.`),!1):!0);v(l,[...e(l),...y],!0),e(p)&&(e(p).value="")}function Rs(c,l){e(l)&&e(l).click()}function Ps(c,l){v(l,!e(l))}function As(c,l){const p=c.target.value;e(l)&&(e(l).tentativeDate=p||null)}function Es(c,l){v(l,!0)}async function $s(c,l,p,b,F,y){const T={status:e(l).status,tentativeDate:e(l).tentativeDate,paymentAmount:e(l).paymentAmount,paymentStatus:e(p)},r=await b()(e(l).requestId,T);v(F,!1),r&&await y()}function Fs(c,l){v(l,!0)}async function js(c,l,p,b,F){await l()(e(p).requestId),v(b,!1),F()()}function Ns(c,l,p){!e(l)||!e(l).requestId||v(p,!0)}async function Os(c,l,p,b,F,y,T){if(!(!e(l)||!e(l).requestId)){v(p,!1),v(b,!0);try{const r=await pa(`/api/document-requests?action=generateReceipt&requestId=${e(l).requestId}`,{method:"GET"});if(!r.ok){const Z=await r.json();Ie.error(Z.error||"Failed to generate receipt"),v(b,!1);return}const u=await r.blob(),Y=await F(u),H=[{name:`receipt-${e(l).requestId}.pdf`,type:"application/pdf",size:u.size,data:Y}],i=`temp-${Date.now()}`,j=`Receipt generated for ${e(l).requestId}`,K={id:i,text:j,author:y().userData?.name||"Admin",authorRole:"admin",created_at:new Date().toISOString(),attachments:H,isPending:!0};e(l).messages=[...e(l).messages||[],K],T();try{const D=await(await pa("/api/document-requests",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"sendMessage",requestId:e(l).requestId,message:j,attachments:H})})).json();D.success?(e(l).messages=e(l).messages.map(M=>M.id===i?{...D.data,id:i,isPending:!1}:M),Ie.success("Receipt generated and sent to chat successfully")):(e(l).messages=e(l).messages.filter(M=>M.id!==i),Ie.error(D.error||"Failed to send receipt to chat"))}catch(Z){console.error("Error sending receipt to chat:",Z),e(l).messages=e(l).messages.filter(D=>D.id!==i),Ie.error("Receipt generated but failed to send to chat")}}catch(r){console.error("Error generating receipt:",r),Ie.error("An error occurred while generating the receipt")}finally{v(b,!1)}}}function Ls(c,l){v(l,!e(l))}function Bs(c,l){v(l,e(l)==="paid"?"pending":"paid",!0)}var Vs=q('<button class="generate-receipt-btn svelte-zl658f" title="Generate Receipt"><span class="material-symbols-outlined svelte-zl658f">receipt</span> <span>Generate Receipt</span></button>'),Hs=(c,l,p)=>l(e(p).id),Us=q('<button type="button" class="docreq-status-item svelte-zl658f" role="option"><span></span> <span class="status-text svelte-zl658f"> </span></button>'),Gs=q('<input type="date" class="date-input editable svelte-zl658f"/>'),Qs=q('<div class="date-box readonly svelte-zl658f"> </div>'),Ks=q('<div class="docreq-card svelte-zl658f"><div class="card-label svelte-zl658f"><span class="material-symbols-outlined">event</span> Tentative Date</div> <div class="admin-card-value svelte-zl658f"><!></div></div>'),Zs=q('<div class="payment-input-wrapper svelte-zl658f"><span class="currency-symbol svelte-zl658f">₱</span> <input type="number" class="payment-input svelte-zl658f" min="0" step="0.01" placeholder="Set fee amount..."/></div>'),Ys=q('<span class="not-set svelte-zl658f">Not set</span>'),Js=q("<div><!></div>"),Ws=q('<div class="docreq-card svelte-zl658f"><div class="card-label svelte-zl658f"><span class="material-symbols-outlined">event_busy</span> Cancelled Date</div> <div class="admin-card-value svelte-zl658f"> </div></div>'),Xs=q('<div class="message-avatar svelte-zl658f"><span class="material-symbols-outlined svelte-zl658f">account_circle</span></div>'),el=q('<div class="admin-document-request-message-text"> </div>'),tl=(c,l,p)=>l(e(p)),al=q('<button class="attachment-item svelte-zl658f"><span class="material-symbols-outlined svelte-zl658f">attach_file</span> <div class="attachment-info svelte-zl658f"><span class="attachment-name svelte-zl658f"> </span> <span class="attachment-size svelte-zl658f"> </span></div> <span class="material-symbols-outlined svelte-zl658f">download</span></button>'),sl=q('<div class="message-attachments svelte-zl658f"></div>'),ll=q('<div><!> <div class="message-bubble svelte-zl658f"><div class="message-header svelte-zl658f"><span class="message-author svelte-zl658f"> </span> <span class="message-time svelte-zl658f"> </span></div> <!> <!></div></div>'),il=q('<div class="no-chat svelte-zl658f"><span class="material-symbols-outlined svelte-zl658f">chat_bubble_outline</span> <p class="svelte-zl658f">No messages yet</p> <p class="subtitle svelte-zl658f">Start a conversation with the student</p></div>'),nl=q('<div class="file-preview-item svelte-zl658f"><span class="material-symbols-outlined svelte-zl658f">description</span> <span class="file-preview-name svelte-zl658f"> </span> <span class="file-preview-size svelte-zl658f"> </span> <button class="remove-file-btn svelte-zl658f" title="Remove file"><span class="material-symbols-outlined svelte-zl658f">close</span></button></div>'),rl=q('<div class="selected-files-preview svelte-zl658f"></div>'),ol=q('<div class="chat-disabled-notice svelte-zl658f"><span class="material-symbols-outlined svelte-zl658f">block</span> <span> </span></div>'),dl=(c,l,p)=>c.key==="Enter"&&!c.shiftKey&&!e(l)&&p(),vl=q('<input type="file" multiple accept="image/*,.pdf,.doc,.docx,.xls,.xlsx,.txt" style="display: none;" class="svelte-zl658f"/> <button class="attach-btn svelte-zl658f" title="Attach file" aria-label="Attach file"><span class="material-symbols-outlined svelte-zl658f">attach_file</span></button> <input placeholder="Type your message..." aria-label="Message input" class="svelte-zl658f"/> <button class="send-btn svelte-zl658f" title="Send message" aria-label="Send message"><span class="material-symbols-outlined svelte-zl658f">send</span></button>',1),cl=q('<div class="confirm-detail-row svelte-zl658f"><span class="detail-label svelte-zl658f">Tentative Date:</span> <span class="detail-value svelte-zl658f"> </span></div>'),ul=q('<div class="modal-confirm-content svelte-zl658f"><div class="modal-message svelte-zl658f"><p class="svelte-zl658f">Are you sure you want to update this document request?</p> <div class="confirm-details svelte-zl658f"><div class="confirm-detail-row svelte-zl658f"><span class="detail-label svelte-zl658f">Request ID:</span> <span class="detail-value svelte-zl658f"> </span></div> <div class="confirm-detail-row svelte-zl658f"><span class="detail-label svelte-zl658f">New Status:</span> <span class="detail-value svelte-zl658f"> </span></div> <!> <div class="confirm-detail-row svelte-zl658f"><span class="detail-label svelte-zl658f">Payment Amount:</span> <span class="detail-value svelte-zl658f"><!></span></div> <div class="confirm-detail-row svelte-zl658f"><span class="detail-label svelte-zl658f">Payment Status:</span> <span> </span></div></div></div> <div class="modal-actions svelte-zl658f"><button class="modal-btn modal-btn-secondary svelte-zl658f">Cancel</button> <button class="modal-btn modal-btn-primary svelte-zl658f">Confirm</button></div></div>'),fl=q('<div class="modal-confirm-content svelte-zl658f"><div class="modal-message svelte-zl658f"><p class="svelte-zl658f">Are you sure you want to reject this document request?</p> <div class="confirm-details reject-warning svelte-zl658f"><div class="confirm-detail-row svelte-zl658f"><span class="detail-label svelte-zl658f">Request ID:</span> <span class="detail-value svelte-zl658f"> </span></div> <div class="confirm-detail-row svelte-zl658f"><span class="detail-label svelte-zl658f">Student:</span> <span class="detail-value svelte-zl658f"> </span></div> <div class="confirm-detail-row svelte-zl658f"><span class="detail-label svelte-zl658f">Document Type:</span> <span class="detail-value svelte-zl658f"> </span></div> <div class="reject-notice svelte-zl658f"><span class="material-symbols-outlined svelte-zl658f">warning</span> <span>This action will mark the request as rejected and notify the student.</span></div></div></div> <div class="modal-actions svelte-zl658f"><button class="modal-btn modal-btn-secondary svelte-zl658f">Cancel</button> <button class="modal-btn modal-btn-danger svelte-zl658f">Reject Request</button></div></div>'),pl=q('<div class="modal-confirm-content svelte-zl658f"><div class="modal-message svelte-zl658f"><p class="svelte-zl658f">Generate receipt for this document request?</p> <div class="confirm-details svelte-zl658f"><div class="confirm-detail-row svelte-zl658f"><span class="detail-label svelte-zl658f">Request ID:</span> <span class="detail-value svelte-zl658f"> </span></div> <div class="confirm-detail-row svelte-zl658f"><span class="detail-label svelte-zl658f">Student:</span> <span class="detail-value svelte-zl658f"> </span></div> <div class="confirm-detail-row svelte-zl658f"><span class="detail-label svelte-zl658f">Document Type:</span> <span class="detail-value svelte-zl658f"> </span></div> <div class="reject-notice svelte-zl658f" style="background: rgba(33, 150, 243, 0.1); border-color: #2196F3;"><span class="material-symbols-outlined svelte-zl658f" style="color: #2196F3;">info</span> <span>The receipt will be generated and automatically sent to the chat.</span></div></div></div> <div class="modal-actions svelte-zl658f"><button class="modal-btn modal-btn-secondary svelte-zl658f">Cancel</button> <button class="modal-btn modal-btn-primary svelte-zl658f"> </button></div></div>'),ml=q('<div class="docreq-modal-content svelte-zl658f"><div class="docreq-modal-grid svelte-zl658f"><div class="docreq-modal-left-container svelte-zl658f"><header class="docreq-modal-title svelte-zl658f"><div class="docreq-modal-title-row svelte-zl658f"><div><h2 class="svelte-zl658f">Request Details</h2> <div class="docreq-modal-sub svelte-zl658f">ID: <span> </span></div></div> <!></div></header> <div class="docreq-cards svelte-zl658f"><div class="docreq-card svelte-zl658f"><div class="card-label svelte-zl658f"><span class="material-symbols-outlined">description</span> Document Type</div> <div class="admin-card-value svelte-zl658f"> </div></div> <div class="docreq-card svelte-zl658f"><div class="card-label svelte-zl658f"><span class="material-symbols-outlined">account_circle</span> Processed By</div> <div class="admin-card-value svelte-zl658f"> </div></div> <div class="docreq-card svelte-zl658f"><div class="card-label svelte-zl658f"><span class="material-symbols-outlined">info</span> Status</div> <div class="admin-card-value svelte-zl658f"><div aria-haspopup="listbox"><button class="docreq-status-dropdown-trigger svelte-zl658f" aria-label="Change status"><span class="docreq-status-dropdown-label svelte-zl658f"> </span> <span class="material-symbols-outlined docreq-status-dropdown-caret svelte-zl658f"> </span></button> <div class="docreq-status-dropdown-menu svelte-zl658f" role="listbox" aria-label="Select status"></div></div></div></div> <!> <div class="docreq-card svelte-zl658f"><div class="card-label svelte-zl658f"><span class="material-symbols-outlined">payments</span> Payment Amount</div> <div class="admin-card-value svelte-zl658f"><div class="payment-display-container svelte-zl658f"><!> <div class="payment-actions svelte-zl658f"><button><span class="material-symbols-outlined svelte-zl658f"> </span></button> <button class="payment-edit-btn svelte-zl658f"><span class="material-symbols-outlined svelte-zl658f"> </span></button></div></div></div></div> <!></div> <div class="docreq-purpose svelte-zl658f"><div class="purpose-label svelte-zl658f"><span class="material-symbols-outlined">description</span> Purpose & Details</div> <div class="purpose-content svelte-zl658f"> </div></div> <div class="action-buttons svelte-zl658f"><button class="docreq-approve-button svelte-zl658f"><span class="material-symbols-outlined svelte-zl658f">check_circle</span> Update Request</button> <button class="docreq-reject-button svelte-zl658f"><span class="material-symbols-outlined svelte-zl658f">cancel</span> Reject Request</button> <button class="docreq-complete-button svelte-zl658f"><span class="material-symbols-outlined svelte-zl658f">arrow_back</span> Back</button></div></div> <div class="docreq-modal-right-container svelte-zl658f"><div class="student-info-section svelte-zl658f"><h3 class="svelte-zl658f"><span class="material-symbols-outlined">school</span> Student Information</h3> <div class="student-info-grid svelte-zl658f"><div class="student-field svelte-zl658f"><div class="field-label svelte-zl658f">Student ID</div> <div class="field-value svelte-zl658f"> </div></div> <div class="student-field svelte-zl658f"><div class="field-label svelte-zl658f">Full Name</div> <div class="field-value svelte-zl658f"> </div></div> <div class="student-field svelte-zl658f"><div class="field-label svelte-zl658f">Grade & Section</div> <div class="field-value svelte-zl658f"> </div></div> <div class="student-field svelte-zl658f"><div class="field-label svelte-zl658f">Date of birth</div> <div class="field-value svelte-zl658f"> </div></div></div></div> <div class="chat-container svelte-zl658f"><div class="chat-header svelte-zl658f"><h3 class="svelte-zl658f"><span class="material-symbols-outlined svelte-zl658f">forum</span> Communication</h3> <span class="chat-count-badge svelte-zl658f"> </span></div> <div class="admin-chat-messages svelte-zl658f"><!></div> <div class="admin-chat-input-wrapper svelte-zl658f"><!> <div><!></div></div></div></div></div></div> <!> <!> <!>',1);function ns(c,l){Dt(l,!0);const[p,b]=Ga(),F=()=>Qa(ma,"$authStore",p);let y=je(l,"request",19,()=>({})),T=je(l,"requestStatuses",19,()=>[]),r=je(l,"modalStatuses",19,()=>[]),u=je(l,"onUpdate",3,async()=>{}),Y=je(l,"onReject",3,async()=>{}),H=je(l,"onClose",3,()=>{});ls();let i=$(bt({...y()}));qt(()=>{y()&&y().requestId&&v(i,{...y()},!0)});let j=$(!1),K=$(void 0),Z=$(""),D=$(!1),M=$(void 0),J=$(void 0),he=$(void 0),O=$(bt([])),X,re=$(!1),ue=$(!1),ye=$(!1),G=$(!1),U=$("pending"),oe=Be(()=>e(i).messages||[]),ee=$(bt(y().status||"")),E=$(bt(y().paymentStatus||"pending"));qt(()=>{y()&&y().status&&v(ee,y().status,!0),y()&&y().paymentStatus?v(E,y().paymentStatus,!0):y()&&v(E,"pending")});let N=Be(()=>e(ee)==="released"||e(ee)==="cancelled");qt(()=>{e(i)&&e(i).paymentStatus?v(U,e(i).paymentStatus,!0):e(i)&&v(U,"pending")});function B(){e(M)&&setTimeout(()=>{e(M).scrollTop=e(M).scrollHeight},100)}function fe(o){v(O,e(O).filter((f,g)=>g!==o),!0)}async function dt(o){return new Promise((f,g)=>{const h=new FileReader;h.onload=()=>f(h.result),h.onerror=g,h.readAsDataURL(o)})}function Ke(o){const f=document.createElement("a");f.href=o.data,f.download=o.name,f.click()}async function Me(){if(!e(Z).trim()&&e(O).length===0||e(D)||e(N))return;v(D,!0);const o=e(Z).trim(),f=[...e(O)];let g=[];try{for(const R of f){const x=await dt(R);g.push({name:R.name,type:R.type,size:R.size,data:x})}}catch(R){console.error("Error converting files:",R),Ie.error("Failed to process files. Please try again."),v(D,!1);return}const h=`temp-${Date.now()}`,I={id:h,text:o,author:F().userData?.name||"Admin",authorRole:"admin",created_at:new Date().toISOString(),attachments:g,isPending:!0};e(i).messages=[...e(i).messages||[],I],v(Z,""),v(O,[],!0),B(),e(J)&&setTimeout(()=>e(J).focus(),50);try{const x=await(await pa("/api/document-requests",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"sendMessage",requestId:e(i).requestId,message:o,attachments:g})})).json();x.success?e(i).messages=e(i).messages.map(L=>L.id===h?{...x.data,id:h,isPending:!1}:L):(console.error("Failed to send message:",x.error),e(i).messages=e(i).messages.filter(L=>L.id!==h),Ie.error("Failed to send message. Please try again."),v(Z,o,!0),v(O,f,!0))}catch(R){console.error("Error sending message:",R),e(i).messages=e(i).messages.filter(x=>x.id!==h),Ie.error("An error occurred while sending the message."),v(Z,o,!0),v(O,f,!0)}finally{v(D,!1)}}function Ze(o){e(i)&&(e(i).status=o,e(i).tentativeDate=null,v(j,!1))}function Ye(o){if(!o)return"--/--/----";const[f,g,h]=o.split("-");return!f||!g||!h?"--/--/----":`${g}/${h}/${f}`}async function vt(){if(!(!e(i)||!e(i).requestId))try{const f=await(await pa(`/api/document-requests?action=single&requestId=${e(i).requestId}`)).json();f.success&&f.data&&(v(i,{...f.data},!0),f.data.status&&v(ee,f.data.status,!0),f.data.paymentStatus?(v(U,f.data.paymentStatus,!0),v(E,f.data.paymentStatus,!0)):v(E,"pending"))}catch(o){console.error("Error refreshing request data:",o)}}function Ve(){v(re,!1)}function Se(){v(ue,!1)}async function De(o){return new Promise((f,g)=>{const h=new FileReader;h.onload=()=>f(h.result),h.onerror=g,h.readAsDataURL(o)})}function Re(){v(ye,!1)}let Ne=Be(()=>e(i)&&(T().find(o=>o.id===e(i).status)||{}).name||"Select");function tt(o){o.target.closest(".docreq-status-dropdown")||v(j,!1)}function ge(o){o.key==="Escape"&&e(j)&&v(j,!1)}async function Oe(){if(!(!e(i)||e(D)))try{const f=await(await pa(`/api/document-requests?action=single&requestId=${e(i).requestId}`,{method:"GET"})).json();if(f.success&&f.data.messages){const g=e(oe).filter(x=>x.isPending),h=f.data.messages,I=new Set(e(oe).filter(x=>!x.isPending).map(x=>x.id));h.filter(x=>!I.has(x.id)).length>0&&(e(i).messages=[...h,...g],B())}}catch(o){console.error("Error fetching latest messages:",o)}}function ct(){document.hidden?X&&(clearInterval(X),X=null):X||(Oe(),X=setInterval(Oe,8e3))}qt(()=>{e(oe).length>0&&B()}),qt(()=>(X=setInterval(Oe,8e3),document.addEventListener("visibilitychange",ct),B(),()=>{X&&clearInterval(X),document.removeEventListener("visibilitychange",ct)}));var we=ml();ha("click",qa,tt),ha("keydown",qa,ge);var He=Q(we),qe=a(He),de=a(qe),Te=a(de),ke=a(Te),yt=a(ke),ut=s(a(yt),2),gt=s(a(ut)),wt=a(gt,!0);t(gt),t(ut),t(yt);var Ct=s(yt,2);{var at=o=>{var f=Vs();f.__click=[Ns,i,ye],n(o,f)};k(Ct,o=>{e(i).status==="for_pickup"&&o(at)})}t(ke),t(Te);var It=s(Te,2),Ot=a(It),ba=s(a(Ot),2),Xt=a(ba,!0);t(ba),t(Ot);var Lt=s(Ot,2),ya=s(a(Lt),2),ga=a(ya,!0);t(ya),t(Lt);var ea=s(Lt,2),wa=s(a(ea),2),Bt=a(wa);let ka;var ft=a(Bt);ft.__click=[Ps,j];var Vt=a(ft),Ea=a(Vt,!0);t(Vt);var ta=s(Vt,2),$a=a(ta,!0);t(ta),t(ft);var aa=s(ft,2);ot(aa,21,r,o=>o.id,(o,f)=>{var g=Us();g.__click=[Hs,Ze,f];var h=a(g),I=s(h,2),R=a(I,!0);t(I),t(g),P(()=>{ne(g,"aria-selected",e(i).status===e(f).id),se(h,1,`status-dot ${e(f).id??""}`,"svelte-zl658f"),_(R,e(f).name)}),n(o,g)}),t(aa),t(Bt),t(wa),t(ea);var Mt=s(ea,2);{var Fa=o=>{var f=Ks(),g=s(a(f),2),h=a(g);{var I=x=>{var L=Gs();Nt(L),L.__change=[As,i],rt(L,le=>v(K,le),()=>e(K)),P(()=>ys(L,e(i).tentativeDate||"")),n(x,L)},R=x=>{var L=Qs(),le=a(L,!0);t(L),P(ie=>_(le,ie),[()=>Ye(e(i).tentativeDate)]),n(x,L)};k(h,x=>{["verifying","processing"].includes(e(i).status)?x(I):x(R,!1)})}t(g),t(f),n(o,f)};k(Mt,o=>{(["verifying","processing"].includes(e(i).status)||e(i).tentativeDate)&&o(Fa)})}var Rt=s(Mt,2),sa=s(a(Rt),2),la=a(sa),Ht=a(la);{var za=o=>{var f=Zs(),g=s(a(f),2);Nt(g),t(f),Jt(g,()=>e(i).paymentAmount,h=>e(i).paymentAmount=h),n(o,f)},ja=o=>{var f=Js(),g=a(f);{var h=R=>{var x=et();P(()=>_(x,`₱${e(i).paymentAmount??""}`)),n(R,x)},I=R=>{var x=Ys();n(R,x)};k(g,R=>{e(i).paymentAmount!==null&&e(i).paymentAmount!==void 0?R(h):R(I,!1)})}t(f),P(()=>se(f,1,`payment-readonly ${(y()?.status!=="cancelled"&&y()?.status!=="rejected"&&e(i).paymentAmount!==null&&e(i).paymentAmount!==void 0?e(U):"")??""}`,"svelte-zl658f")),n(o,f)};k(Ht,o=>{e(G)?o(za):o(ja,!1)})}var Pt=s(Ht,2),st=a(Pt);st.__click=[Bs,U];var xa=a(st),Na=a(xa,!0);t(xa),t(st);var pt=s(st,2);pt.__click=[Ls,G];var ia=a(pt),Oa=a(ia,!0);t(ia),t(pt),t(Pt),t(la),t(sa),t(Rt);var na=s(Rt,2);{var Sa=o=>{var f=Ws(),g=s(a(f),2),h=a(g,!0);t(g),t(f),P(()=>_(h,e(i).cancelledDate)),n(o,f)};k(na,o=>{e(i).status==="cancelled"&&e(i).cancelledDate&&o(Sa)})}t(It);var ra=s(It,2),Da=s(a(ra),2),La=a(Da,!0);t(Da),t(ra);var oa=s(ra,2),Ut=a(oa);Ut.__click=[Es,re];var At=s(Ut,2);At.__click=[Fs,ue];var Ta=s(At,2);Ta.__click=function(...o){H()?.apply(this,o)},t(oa),t(de);var da=s(de,2),Gt=a(da),va=s(a(Gt),2),ca=a(va),ua=s(a(ca),2),Ba=a(ua,!0);t(ua),t(ca);var Qt=s(ca,2),Ca=s(a(Qt),2),Va=a(Ca,!0);t(Ca),t(Qt);var fa=s(Qt,2),d=s(a(fa),2),m=a(d);t(d),t(fa);var w=s(fa,2),z=s(a(w),2),A=a(z,!0);t(z),t(w),t(va),t(Gt);var S=s(Gt,2),C=a(S),ve=s(a(C),2),ze=a(ve,!0);t(ve),t(C);var W=s(C,2),pe=a(W);{var me=o=>{var f=te(),g=Q(f);ot(g,17,()=>e(oe),h=>h.id,(h,I)=>{var R=ll(),x=a(R);{var L=ae=>{var Ee=Xs();n(ae,Ee)};k(x,ae=>{e(I).authorRole!=="admin"&&ae(L)})}var le=s(x,2),ie=a(le),xe=a(ie),Je=a(xe,!0);t(xe);var _e=s(xe,2),Ae=a(_e,!0);t(_e),t(ie);var Ge=s(ie,2);{var Qe=ae=>{var Ee=el(),ht=a(Ee,!0);t(Ee),P(()=>_(ht,e(I).text)),n(ae,Ee)};k(Ge,ae=>{e(I).text&&ae(Qe)})}var We=s(Ge,2);{var be=ae=>{var Ee=sl();ot(Ee,21,()=>e(I).attachments,Pa,(ht,$t)=>{var $e=al();$e.__click=[tl,Ke,$t];var nt=s(a($e),2),Ft=a(nt),Fe=a(Ft,!0);t(Ft);var Le=s(Ft,2),Xe=a(Le);t(Le),t(nt),jt(2),t($e),P(St=>{_(Fe,e($t).name),_(Xe,`${St??""} KB`)},[()=>(e($t).size/1024).toFixed(1)]),n(ht,$e)}),t(Ee),n(ae,Ee)};k(We,ae=>{e(I).attachments&&e(I).attachments.length>0&&ae(be)})}t(le),t(R),P(ae=>{se(R,1,`message-wrapper ${e(I).authorRole==="admin"?"sent":"received"}`,"svelte-zl658f"),_(Je,e(I).author),_(Ae,ae)},[()=>new Date(e(I).created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]),n(h,R)}),n(o,f)},V=o=>{var f=il();n(o,f)};k(pe,o=>{e(oe).length>0?o(me):o(V,!1)})}t(W),rt(W,o=>v(M,o),()=>e(M));var Ce=s(W,2),Ue=a(Ce);{var mt=o=>{var f=rl();ot(f,21,()=>e(O),Pa,(g,h,I)=>{var R=nl(),x=s(a(R),2),L=a(x,!0);t(x);var le=s(x,2),ie=a(le);t(le);var xe=s(le,2);xe.__click=()=>fe(I),t(R),P(Je=>{_(L,e(h).name),_(ie,`(${Je??""} KB)`)},[()=>(e(h).size/1024).toFixed(1)]),n(g,R)}),t(f),n(o,f)};k(Ue,o=>{e(O).length>0&&o(mt)})}var lt=s(Ue,2);let kt;var ce=a(lt);{var Pe=o=>{var f=ol(),g=s(a(f),2),h=a(g);t(g),t(f),P(()=>_(h,`Chat is disabled for ${e(ee)==="released"?"released":"cancelled"} requests`)),n(o,f)},_t=o=>{var f=vl(),g=Q(f);g.__change=[Ms,O,he],rt(g,x=>v(he,x),()=>e(he));var h=s(g,2);h.__click=[Rs,he];var I=s(h,2);Nt(I),I.__keydown=[dl,D,Me],rt(I,x=>v(J,x),()=>e(J));var R=s(I,2);R.__click=Me,P(x=>{I.disabled=e(D),R.disabled=x},[()=>e(D)||!e(Z).trim()&&e(O).length===0]),Jt(I,()=>e(Z),x=>v(Z,x)),n(o,f)};k(ce,o=>{e(N)?o(Pe):o(_t,!1)})}t(lt),t(Ce),t(S),t(da),t(qe),t(He);var it=s(He,2);{var zt=o=>{_a(o,{title:"Confirm Update",size:"small",closable:!0,onClose:Ve,children:(f,g)=>{var h=ul(),I=a(h),R=s(a(I),2),x=a(R),L=s(a(x),2),le=a(L,!0);t(L),t(x);var ie=s(x,2),xe=s(a(ie),2),Je=a(xe,!0);t(xe),t(ie);var _e=s(ie,2);{var Ae=Fe=>{var Le=cl(),Xe=s(a(Le),2),St=a(Xe,!0);t(Xe),t(Le),P(Ha=>_(St,Ha),[()=>Ye(e(i).tentativeDate)]),n(Fe,Le)};k(_e,Fe=>{e(i).tentativeDate&&Fe(Ae)})}var Ge=s(_e,2),Qe=s(a(Ge),2),We=a(Qe);{var be=Fe=>{var Le=et();P(()=>_(Le,`₱${e(i).paymentAmount??""}`)),n(Fe,Le)},ae=Fe=>{var Le=et("Tentative (not set)");n(Fe,Le)};k(We,Fe=>{e(i).paymentAmount!==null&&e(i).paymentAmount!==void 0?Fe(be):Fe(ae,!1)})}t(Qe),t(Ge);var Ee=s(Ge,2),ht=s(a(Ee),2),$t=a(ht,!0);t(ht),t(Ee),t(R),t(I);var $e=s(I,2),nt=a($e);nt.__click=Ve;var Ft=s(nt,2);Ft.__click=[$s,i,U,u,re,vt],t($e),t(h),P(()=>{_(le,e(i).requestId),_(Je,e(Ne)),se(ht,1,`detail-value payment-status-${e(U)??""}`,"svelte-zl658f"),_($t,e(U)==="paid"?"Paid":"Pending")}),n(f,h)},$$slots:{default:!0}})};k(it,o=>{e(re)&&o(zt)})}var xt=s(it,2);{var Et=o=>{_a(o,{title:"Reject Request",size:"small",closable:!0,onClose:Se,children:(f,g)=>{var h=fl(),I=a(h),R=s(a(I),2),x=a(R),L=s(a(x),2),le=a(L,!0);t(L),t(x);var ie=s(x,2),xe=s(a(ie),2),Je=a(xe,!0);t(xe),t(ie);var _e=s(ie,2),Ae=s(a(_e),2),Ge=a(Ae,!0);t(Ae),t(_e),jt(2),t(R),t(I);var Qe=s(I,2),We=a(Qe);We.__click=Se;var be=s(We,2);be.__click=[js,Y,i,ue,H],t(Qe),t(h),P(()=>{_(le,e(i).requestId),_(Je,e(i).studentName),_(Ge,e(i).documentType)}),n(f,h)},$$slots:{default:!0}})};k(xt,o=>{e(ue)&&o(Et)})}var Kt=s(xt,2);{var Zt=o=>{_a(o,{title:"Generate Receipt",size:"small",closable:!0,onClose:Re,children:(f,g)=>{var h=pl(),I=a(h),R=s(a(I),2),x=a(R),L=s(a(x),2),le=a(L,!0);t(L),t(x);var ie=s(x,2),xe=s(a(ie),2),Je=a(xe,!0);t(xe),t(ie);var _e=s(ie,2),Ae=s(a(_e),2),Ge=a(Ae,!0);t(Ae),t(_e),jt(2),t(R),t(I);var Qe=s(I,2),We=a(Qe);We.__click=Re;var be=s(We,2);be.__click=[Os,i,ye,D,De,F,B];var ae=a(be,!0);t(be),t(Qe),t(h),P(()=>{_(le,e(i).requestId),_(Je,e(i).studentName),_(Ge,e(i).documentType),be.disabled=e(D),_(ae,e(D)?"Generating...":"Generate Receipt")}),n(f,h)},$$slots:{default:!0}})};k(Kt,o=>{e(ye)&&o(Zt)})}P((o,f)=>{_(wt,e(i).requestId),_(Xt,e(i).documentType),_(ga,e(i).processedBy??"—"),ka=se(Bt,1,"docreq-status-dropdown svelte-zl658f",null,ka,o),ne(Bt,"aria-expanded",e(j)),ft.disabled=y()?.status==="cancelled"||y()?.status==="rejected",_(Ea,e(Ne)),_($a,e(j)?"expand_less":"expand_more"),se(st,1,`payment-status-toggle ${e(U)==="paid"?"pending":"paid"}`,"svelte-zl658f"),ne(st,"title",e(i).paymentAmount===null||e(i).paymentAmount===void 0?"Set payment amount first":e(U)==="paid"?"Mark as pending":"Mark as paid"),ne(st,"aria-label",e(U)==="paid"?"Mark as pending":"Mark as paid"),st.disabled=e(ee)==="cancelled"||e(ee)==="rejected"||e(ee)==="released"||e(i).paymentAmount===null||e(i).paymentAmount===void 0,_(Na,e(U)==="paid"?"cancel":"check_circle"),ne(pt,"title",e(G)?"Save":"Edit payment amount"),ne(pt,"aria-label",e(G)?"Save":"Edit payment amount"),pt.disabled=e(ee)==="cancelled"||e(ee)==="rejected"||e(ee)==="released"||e(E)==="paid",_(Oa,e(G)?"check":"edit"),_(La,e(i).purpose??"No purpose provided"),Ut.disabled=y()?.status==="cancelled"||y()?.status==="rejected",At.disabled=e(ee)==="cancelled"||e(ee)==="rejected"||e(ee)==="released",_(Ba,e(i).studentId),_(Va,e(i).studentName),_(m,`${e(i).gradeLevel??""} - ${e(i).section||"N/A"}`),_(A,e(i).dateOfBirth??"—"),_(ze,e(oe).length),kt=se(lt,1,"admin-chat-input svelte-zl658f",null,kt,f)},[()=>({open:e(j)}),()=>({disabled:e(N)})]),n(c,we),Tt(),b()}Wt(["click","change","keydown"]);var _l=(c,l,p)=>{e(l).props.onCancel&&e(l).props.onCancel(),p(e(l).id)},hl=(c,l,p)=>{e(l).props.onConfirm&&e(l).props.onConfirm(),p(e(l).id)},ql=q('<div class="modal-confirm-content svelte-1bd5k9d"><div class="modal-message svelte-1bd5k9d"><!></div> <div class="modal-actions svelte-1bd5k9d"><button class="modal-btn modal-btn-secondary svelte-1bd5k9d">Cancel</button> <button class="modal-btn modal-btn-primary svelte-1bd5k9d">Confirm</button></div></div>'),bl=(c,l,p)=>{e(l).props.onClose&&e(l).props.onClose(),p(e(l).id)},yl=q('<div class="modal-alert-content svelte-1bd5k9d"><p class="modal-message svelte-1bd5k9d"> </p> <div class="modal-actions svelte-1bd5k9d"><button class="modal-btn modal-btn-primary svelte-1bd5k9d">OK</button></div></div>'),gl=(c,l,p)=>{e(l).props.onCancel&&e(l).props.onCancel(),p(e(l).id)},wl=(c,l,p)=>{e(l).props.onSubmit&&e(l).props.onSubmit(e(l).props.inputValue||e(l).props.defaultValue||""),p(e(l).id)},kl=q('<div class="modal-prompt-content svelte-1bd5k9d"><p class="modal-message svelte-1bd5k9d"> </p> <input type="text" class="modal-input svelte-1bd5k9d"/> <div class="modal-actions svelte-1bd5k9d"><button class="modal-btn modal-btn-secondary svelte-1bd5k9d">Cancel</button> <button class="modal-btn modal-btn-primary svelte-1bd5k9d">Submit</button></div></div>'),zl=(c,l,p)=>{e(l).props.onCancel&&e(l).props.onCancel(),p(e(l).id)},xl=(c,l,p)=>{e(l).props.onDelete&&!e(l).props.deleteDisabled&&e(l).props.onDelete(),p(e(l).id)},Sl=(c,l,p)=>{e(l).props.onSubmit&&e(l).props.onSubmit(e(l).props.field1Value,e(l).props.field2Value),p(e(l).id)},Dl=q('<div class="modal-form-content svelte-1bd5k9d"><p class="modal-message svelte-1bd5k9d"> </p> <div class="modal-form-fields svelte-1bd5k9d"><div class="modal-form-group svelte-1bd5k9d"><label for="formField1" class="modal-form-label svelte-1bd5k9d"> </label> <input id="formField1"/></div> <div class="modal-form-group svelte-1bd5k9d"><label for="formField2" class="modal-form-label svelte-1bd5k9d"> </label> <input id="formField2"/></div></div> <div class="modal-actions svelte-1bd5k9d"><button class="modal-btn modal-btn-secondary svelte-1bd5k9d">Cancel</button> <button class="modal-btn modal-btn-danger svelte-1bd5k9d">Delete</button> <button class="modal-btn modal-btn-primary svelte-1bd5k9d">Update</button></div></div>'),Tl=q('<div class="modal-custom-content svelte-1bd5k9d"><!></div>'),Cl=q('<div class="modal-generic-content svelte-1bd5k9d"><p> </p></div>');function Il(c,l){Dt(l,!0);let p=$(bt([]));Xa.subscribe(T=>{v(p,T,!0)});function b(T){Xa.close(T)}var F=te(),y=Q(F);ot(y,17,()=>e(p),T=>T.id,(T,r,u)=>{{let Y=Be(()=>e(r).props.title||""),H=Be(()=>e(r).options.size||"medium"),i=Be(()=>e(r).options.closable!==!1),j=Be(()=>e(r).options.backdrop!==!1);_a(T,{get title(){return e(Y)},get size(){return e(H)},get closable(){return e(i)},get backdrop(){return e(j)},onClose:()=>b(e(r).id),children:(K,Z)=>{var D=te(),M=Q(D);{var J=O=>{var X=te(),re=Q(X);{var ue=G=>{var U=ql(),oe=a(U),ee=a(oe);ts(ee,()=>e(r).props.message),t(oe);var E=s(oe,2),N=a(E);N.__click=[_l,r,b];var B=s(N,2);B.__click=[hl,r,b],t(E),t(U),n(G,U)},ye=G=>{var U=te(),oe=Q(U);{var ee=N=>{var B=yl(),fe=a(B),dt=a(fe,!0);t(fe);var Ke=s(fe,2),Me=a(Ke);Me.__click=[bl,r,b],t(Ke),t(B),P(()=>_(dt,e(r).props.message)),n(N,B)},E=N=>{var B=te(),fe=Q(B);{var dt=Me=>{var Ze=kl(),Ye=a(Ze),vt=a(Ye,!0);t(Ye);var Ve=s(Ye,2);Nt(Ve);var Se=s(Ve,2),De=a(Se);De.__click=[gl,r,b];var Re=s(De,2);Re.__click=[wl,r,b],t(Se),t(Ze),P(()=>{_(vt,e(r).props.message),ne(Ve,"placeholder",e(r).props.placeholder||"Enter value...")}),Jt(Ve,()=>e(r).props.inputValue,Ne=>e(r).props.inputValue=Ne),n(Me,Ze)},Ke=Me=>{var Ze=te(),Ye=Q(Ze);{var vt=Se=>{var De=Dl(),Re=a(De),Ne=a(Re,!0);t(Re);var tt=s(Re,2),ge=a(tt),Oe=a(ge),ct=a(Oe,!0);t(Oe);var we=s(Oe,2);Nt(we);let He;t(ge);var qe=s(ge,2),de=a(qe),Te=a(de,!0);t(de);var ke=s(de,2);Nt(ke);let yt;t(qe),t(tt);var ut=s(tt,2),gt=a(ut);gt.__click=[zl,r,b];var wt=s(gt,2);wt.__click=[xl,r,b];var Ct=s(wt,2);Ct.__click=[Sl,r,b],t(ut),t(De),P((at,It)=>{_(Ne,e(r).props.message),_(ct,e(r).props.field1Label||"Field 1"),ne(we,"type",e(r).props.field1Type||"text"),He=se(we,1,"modal-input svelte-1bd5k9d",null,He,at),ne(we,"placeholder",e(r).props.field1Placeholder||"Enter value..."),ne(we,"min",e(r).props.field1Min),ne(we,"max",e(r).props.field1Max),we.disabled=e(r).props.field1Disabled,ne(we,"title",e(r).props.field1Disabled?e(r).props.field1DisabledReason:""),_(Te,e(r).props.field2Label||"Field 2"),ne(ke,"type",e(r).props.field2Type||"text"),yt=se(ke,1,"modal-input svelte-1bd5k9d",null,yt,It),ne(ke,"placeholder",e(r).props.field2Placeholder||"Enter value..."),ne(ke,"min",e(r).props.field2Min),ne(ke,"max",e(r).props.field2Max),ke.disabled=e(r).props.field2Disabled,ne(ke,"title",e(r).props.field2Disabled?e(r).props.field2DisabledReason:""),wt.disabled=e(r).props.deleteDisabled,ne(wt,"title",e(r).props.deleteDisabled?e(r).props.deleteDisabledReason:"Delete this column")},[()=>({"modal-input-disabled":e(r).props.field1Disabled}),()=>({"modal-input-disabled":e(r).props.field2Disabled})]),Jt(we,()=>e(r).props.field1Value,at=>e(r).props.field1Value=at),Jt(ke,()=>e(r).props.field2Value,at=>e(r).props.field2Value=at),n(Se,De)},Ve=Se=>{var De=te(),Re=Q(De);{var Ne=ge=>{ns(ge,Wa(()=>e(r).props,{onClose:()=>b(e(r).id)}))},tt=ge=>{var Oe=te(),ct=Q(Oe);{var we=qe=>{var de=Tl(),Te=a(de);ts(Te,()=>e(r).props.content),t(de),n(qe,de)},He=qe=>{var de=Cl(),Te=a(de),ke=a(Te);t(Te),t(de),P(()=>_(ke,`Component '${e(r).component??""}' not found`)),n(qe,de)};k(ct,qe=>{e(r).component==="CustomModal"?qe(we):qe(He,!1)},!0)}n(ge,Oe)};k(Re,ge=>{e(r).component==="DocumentRequestModal"?ge(Ne):ge(tt,!1)},!0)}n(Se,De)};k(Ye,Se=>{e(r).component==="FormModal"?Se(vt):Se(Ve,!1)},!0)}n(Me,Ze)};k(fe,Me=>{e(r).component==="PromptModal"?Me(dt):Me(Ke,!1)},!0)}n(N,B)};k(oe,N=>{e(r).component==="AlertModal"?N(ee):N(E,!1)},!0)}n(G,U)};k(re,G=>{e(r).component==="ConfirmModal"?G(ue):G(ye,!1)})}n(O,X)},he=O=>{const X=Be(()=>e(r).component);var re=te(),ue=Q(re);gs(ue,()=>e(X),(ye,G)=>{G(ye,Wa(()=>e(r).props,{onClose:()=>b(e(r).id)}))}),n(O,re)};k(M,O=>{typeof e(r).component=="string"?O(J):O(he,!1)})}n(K,D)},$$slots:{default:!0}})}}),n(c,F),Tt()}Wt(["click"]);var Ml=(c,l)=>c.key==="Enter"&&l(c),Rl=q('<div role="dialog" aria-modal="true" tabindex="-1"><!></div>');function Pl(c,l){Dt(l,!0);const[p,b]=Ga();let y=Be(()=>Qa(Ma,"$docReqModalStore",p)),T=$(!1),r=$(!1),u=$(null);qt(()=>{e(y).isOpen&&!e(T)&&!e(r)?(setTimeout(()=>{v(T,!0)},10),document.body.style.overflow="hidden"):!e(y).isOpen&&(e(T)||e(r))&&Y()});function Y(){v(r,!0),setTimeout(()=>{v(T,!1),v(r,!1),document.body.style.overflow=""},300)}function H(D){D.target===D.currentTarget&&Ma.close()}function i(D){D.key==="Escape"&&e(y).isOpen&&Ma.close()}Aa(()=>()=>{document.body.style.overflow=""});var j=te();ha("keydown",qa,i);var K=Q(j);{var Z=D=>{var M=Rl();let J;M.__click=H,M.__keydown=[Ml,H];var he=a(M);ns(he,{get request(){return e(y).request},get requestStatuses(){return e(y).requestStatuses},get modalStatuses(){return e(y).modalStatuses},get onUpdate(){return e(y).onUpdate},get onReject(){return e(y).onReject},onClose:()=>Ma.close()}),t(M),rt(M,O=>v(u,O),()=>e(u)),P(O=>J=se(M,1,"docreq-modal-overlay svelte-1yi457b",null,J,O),[()=>({"docreq-modal-visible":e(T)&&!e(r),"docreq-modal-closing":e(r)})]),n(D,M)};k(K,D=>{(e(y).isOpen||e(T)||e(r))&&D(Z)})}n(c,j),Tt(),b()}Wt(["click","keydown"]);function Al(c,l,p){const b=Array.from(c.target.files||[]);if(b.length===0)return;const F=10*1024*1024,y=b.filter(T=>T.size>F?(Ie.error(`File "${T.name}" is too large. Maximum size is 10MB.`),!1):!0);v(l,[...e(l),...y],!0),e(p)&&(e(p).value="")}function El(c,l){e(l)&&e(l).click()}function $l(c,l){v(l,!0)}function Fl(c,l){v(l,!0)}function jl(c,l){v(l,!0)}async function Nl(c,l,p,b,F){l()&&await l()(p),v(b,!1),F()()}var Ol=q('<span class="payment-amount free svelte-10q3qfh">Free</span>'),Ll=(c,l)=>{c.preventDefault(),l()},Bl=q('<a href="javascript:void(0)" class="payment-amount pending clickable svelte-10q3qfh" title="Click to view payment instructions" aria-label="View payment instructions" role="button"> </a>'),Vl=q('<span class="payment-amount paid svelte-10q3qfh"> </span>'),Hl=q('<div class="student-docreq-card third-row svelte-10q3qfh"><div class="card-label svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">payments</span> Payment</div> <div class="card-value payment-value svelte-10q3qfh"><!></div></div>'),Ul=q('<div class="student-docreq-card third-row svelte-10q3qfh"><div class="card-label svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">event_busy</span> Cancelled Date</div> <div class="card-value svelte-10q3qfh"> </div></div>'),Gl=q('<div class="student-docreq-card third-row svelte-10q3qfh"><div class="card-label svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">event</span> Tentative Date</div> <div class="card-value svelte-10q3qfh"><div class="date-display svelte-10q3qfh"> </div></div></div>'),Ql=q('<div class="student-docreq-card svelte-10q3qfh"><div class="card-label svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">check_circle</span> Released Date</div> <div class="card-value svelte-10q3qfh"> </div></div>'),Kl=q('<div class="admin-note-section svelte-10q3qfh"><div class="note-label svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">note</span> Admin Note</div> <p class="note-text svelte-10q3qfh"> </p></div>'),Zl=q('<div class="message-avatar svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">admin_panel_settings</span></div>'),Yl=q('<div class="student-document-request-message-text"> </div>'),Jl=(c,l,p)=>l(e(p)),Wl=q('<button class="attachment-item svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">attach_file</span> <div class="attachment-info svelte-10q3qfh"><span class="attachment-name svelte-10q3qfh"> </span> <span class="attachment-size svelte-10q3qfh"> </span></div> <span class="material-symbols-outlined svelte-10q3qfh">download</span></button>'),Xl=q('<div class="message-attachments svelte-10q3qfh"></div>'),ei=q('<div><!> <div class="message-bubble svelte-10q3qfh"><div class="message-header svelte-10q3qfh"><span class="message-author svelte-10q3qfh"> </span> <span class="message-time svelte-10q3qfh"> </span></div> <!> <!></div></div>'),ti=q('<div class="no-chat svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">chat_bubble_outline</span> <p class="svelte-10q3qfh">No messages yet</p> <p class="subtitle svelte-10q3qfh">Start a conversation with the admin</p></div>'),ai=q('<div class="file-preview-item svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">description</span> <span class="file-preview-name svelte-10q3qfh"> </span> <span class="file-preview-size svelte-10q3qfh"> </span> <button class="remove-file-btn svelte-10q3qfh" title="Remove file"><span class="material-symbols-outlined svelte-10q3qfh">close</span></button></div>'),si=q('<div class="selected-files-preview svelte-10q3qfh"></div>'),li=q('<div class="chat-disabled-notice svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">block</span> <span> </span></div>'),ii=(c,l,p)=>c.key==="Enter"&&!c.shiftKey&&!e(l)&&p(),ni=q('<input type="file" multiple accept="image/*,.pdf,.doc,.docx,.xls,.xlsx,.txt" style="display: none;" class="svelte-10q3qfh"/> <button class="attach-btn svelte-10q3qfh" title="Attach file" aria-label="Attach file"><span class="material-symbols-outlined svelte-10q3qfh">attach_file</span></button> <input placeholder="Type your message..." aria-label="Message input" class="svelte-10q3qfh"/> <button class="send-btn svelte-10q3qfh" title="Send message" aria-label="Send message"><span class="material-symbols-outlined svelte-10q3qfh">send</span></button>',1),ri=(c,l)=>l(1),oi=(c,l)=>l(2),di=(c,l)=>c.key==="Escape"&&l(),vi=c=>c.stopPropagation(),ci=c=>c.stopPropagation(),ui=q('<p class="timeline-user svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">person</span> </p>'),fi=q('<div class="timeline-item svelte-10q3qfh"><div><span class="material-symbols-outlined svelte-10q3qfh"><!></span></div> <div class="timeline-content svelte-10q3qfh"><div class="timeline-header svelte-10q3qfh"><h4 class="svelte-10q3qfh"> </h4> <span class="timeline-date svelte-10q3qfh"> </span></div> <!> <p class="timeline-note svelte-10q3qfh"> </p></div></div>'),pi=q('<div class="status-timeline svelte-10q3qfh"></div>'),mi=q('<div class="no-history svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">history_toggle_off</span> <p class="svelte-10q3qfh">No status history available</p> <p class="subtitle svelte-10q3qfh">Status changes will appear here</p></div>'),_i=q('<div class="status-history-backdrop svelte-10q3qfh" role="dialog" aria-modal="true" tabindex="-1"><div class="status-history-sidebar svelte-10q3qfh"><div class="status-history-header svelte-10q3qfh"><div class="status-history-title svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">history</span> <h3 class="svelte-10q3qfh">Status History</h3></div> <button class="status-history-close-btn svelte-10q3qfh" aria-label="Close"><span class="material-symbols-outlined svelte-10q3qfh">close</span></button></div> <div class="status-history-body svelte-10q3qfh"><!></div></div></div>'),hi=(c,l)=>c.key==="Enter"&&l(),qi=c=>c.stopPropagation(),bi=c=>c.stopPropagation(),yi=q('<div class="flow-backdrop svelte-10q3qfh" role="dialog" aria-modal="true" tabindex="-1"><div class="flow-container svelte-10q3qfh" role="document"><div class="flow-header svelte-10q3qfh"><h2 class="svelte-10q3qfh">Process Status Flow</h2> <button class="flow-close-btn svelte-10q3qfh" aria-label="Close"><span class="material-symbols-outlined svelte-10q3qfh">close</span></button></div> <div class="flow-body svelte-10q3qfh"><div class="flow-list svelte-10q3qfh"><div class="flow-item svelte-10q3qfh"><div class="flow-icon-wrapper on_hold svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">pause_circle</span></div> <div class="flow-content svelte-10q3qfh"><h3 class="svelte-10q3qfh">On Hold</h3> <p class="svelte-10q3qfh">Your request is awaiting review by the admin.</p></div></div> <div class="flow-item svelte-10q3qfh"><div class="flow-icon-wrapper verifying svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">fact_check</span></div> <div class="flow-content svelte-10q3qfh"><h3 class="svelte-10q3qfh">Verifying</h3> <p class="svelte-10q3qfh">The document request is currently being verified.</p></div></div> <div class="flow-item svelte-10q3qfh"><div class="flow-icon-wrapper processing svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">sync</span></div> <div class="flow-content svelte-10q3qfh"><h3 class="svelte-10q3qfh">For Processing</h3> <p class="svelte-10q3qfh">The document is in the processing stage.</p></div></div> <div class="flow-item svelte-10q3qfh"><div class="flow-icon-wrapper for_pickup svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">inventory</span></div> <div class="flow-content svelte-10q3qfh"><h3 class="svelte-10q3qfh">For Pick Up</h3> <p class="svelte-10q3qfh">The document is ready and available for pick up.</p></div></div> <div class="flow-item svelte-10q3qfh"><div class="flow-icon-wrapper released svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">check_circle</span></div> <div class="flow-content svelte-10q3qfh"><h3 class="svelte-10q3qfh">Released</h3> <p class="svelte-10q3qfh">The document has been released to you.</p></div></div> <div class="flow-item svelte-10q3qfh"><div class="flow-icon-wrapper rejected svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">cancel</span></div> <div class="flow-content svelte-10q3qfh"><h3 class="svelte-10q3qfh">Rejected</h3> <p class="svelte-10q3qfh">The request was rejected. Check the rejection reason or contact admin.</p></div></div></div></div></div></div>'),gi=q('<div class="modal-confirm-content svelte-10q3qfh"><div class="modal-message svelte-10q3qfh"><p class="svelte-10q3qfh">Are you sure you want to cancel this document request?</p> <div class="confirm-details cancel-warning svelte-10q3qfh"><div class="confirm-detail-row svelte-10q3qfh"><span class="detail-label svelte-10q3qfh">Request ID:</span> <span class="detail-value svelte-10q3qfh"> </span></div> <div class="confirm-detail-row svelte-10q3qfh"><span class="detail-label svelte-10q3qfh">Document Type:</span> <span class="detail-value svelte-10q3qfh"> </span></div> <div class="confirm-detail-row svelte-10q3qfh"><span class="detail-label svelte-10q3qfh">Status:</span> <span class="detail-value svelte-10q3qfh"> </span></div> <div class="cancel-notice svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">warning</span> <span>This action will mark your request as cancelled. You may need to submit a new request if needed.</span></div></div></div> <div class="modal-actions svelte-10q3qfh"><button class="modal-btn modal-btn-secondary svelte-10q3qfh">Go Back</button> <button class="modal-btn modal-btn-danger svelte-10q3qfh">Cancel Request</button></div></div>'),wi=(c,l)=>c.key==="Escape"&&l(),ki=c=>c.stopPropagation(),zi=q(`<div class="payment-instructions-backdrop svelte-10q3qfh" role="dialog" aria-modal="true" tabindex="-1"><div class="payment-instructions-container svelte-10q3qfh"><div class="payment-instructions-header svelte-10q3qfh"><h2 class="svelte-10q3qfh">Payment Instructions</h2> <button class="payment-instructions-close-btn svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">close</span></button></div> <div class="payment-instructions-body svelte-10q3qfh"><p class="svelte-10q3qfh">You can pay once your document is ready for pick-up.</p> <p class="svelte-10q3qfh">Please follow these steps to complete your payment and claim your document:</p> <ol class="payment-instructions-steps svelte-10q3qfh"><li class="svelte-10q3qfh">Wait until your request status shows "Ready for Pick-Up."</li> <li class="svelte-10q3qfh">Go to the Cashier's Office.</li> <li class="svelte-10q3qfh">Inform the cashier that you are paying for your approved document request.</li> <li class="svelte-10q3qfh">Provide your Request Reference Number or Student ID.</li> <li class="svelte-10q3qfh">Pay the required amount for your document.</li> <li class="svelte-10q3qfh">Get your Official Receipt.</li> <li class="svelte-10q3qfh">Proceed to the Registrar's Office (or releasing area) and present your receipt to claim your document.</li></ol></div> <div class="payment-instructions-footer svelte-10q3qfh"><button class="payment-instructions-got-it-btn svelte-10q3qfh">Got it</button></div></div></div>`),xi=q('<div class="student-docreq-modal-content svelte-10q3qfh"><div class="student-docreq-modal-grid svelte-10q3qfh"><div><header class="student-docreq-modal-title svelte-10q3qfh"><h2 class="svelte-10q3qfh">Request Details</h2> <div class="student-docreq-modal-sub svelte-10q3qfh">ID: <span> </span></div></header> <div class="student-docreq-cards svelte-10q3qfh"><div><div class="status-group svelte-10q3qfh"><div class="card-label svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">info</span> Status:</div> <button title="Click to view status history" aria-label="View status history timeline"> </button></div> <button class="status-info-button svelte-10q3qfh" title="Click to view status flow information" aria-label="View status flow information"><span class="material-symbols-outlined svelte-10q3qfh">help</span></button></div> <div class="student-docreq-card half-width svelte-10q3qfh"><div class="card-label svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">description</span> Document Type</div> <div class="card-value svelte-10q3qfh"> </div></div> <div class="student-docreq-card half-width svelte-10q3qfh"><div class="card-label svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">account_circle</span> Processed By</div> <div class="card-value svelte-10q3qfh"> </div></div> <!> <div class="student-docreq-card third-row svelte-10q3qfh"><div class="card-label svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">calendar_today</span> Requested Date</div> <div class="card-value svelte-10q3qfh"> </div></div> <!> <!></div> <div class="student-docreq-purpose svelte-10q3qfh"><div class="purpose-label svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">description</span> Purpose & Details</div> <div class="purpose-content svelte-10q3qfh"> </div></div> <!> <div class="student-modal-action-buttons svelte-10q3qfh"><button class="student-cancel-button svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">cancel</span> Cancel Request</button> <button class="student-back-button svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">arrow_back</span> Back</button></div></div> <div><div class="chat-container svelte-10q3qfh"><div class="chat-header svelte-10q3qfh"><h3 class="svelte-10q3qfh"><span class="material-symbols-outlined svelte-10q3qfh">forum</span> Communication</h3> <span class="chat-count-badge svelte-10q3qfh"> </span></div> <div class="student-chat-messages svelte-10q3qfh"><!></div> <div class="student-chat-input-wrapper svelte-10q3qfh"><!> <div><!></div></div></div></div></div> <div class="mobile-pagination-controls svelte-10q3qfh"><div class="pagination-dots svelte-10q3qfh"><button aria-label="Go to request details"><span class="material-symbols-outlined svelte-10q3qfh">description</span></button> <button aria-label="Go to chat"><span class="material-symbols-outlined svelte-10q3qfh">forum</span></button></div></div></div> <!> <!> <!> <!>',1);function Si(c,l){Dt(l,!0);const[p,b]=Ga(),F=()=>Qa(ma,"$authStore",p);let y=je(l,"request",19,()=>({})),T=je(l,"onCancel",3,()=>{});je(l,"onRefresh",3,()=>{});let r=je(l,"onClose",3,()=>{}),u=bt({...y()}),Y=$(""),H=$(!1),i=$(!1),j=$(void 0),K=$(void 0),Z=$(void 0),D=$(bt([])),M,J=$(!1),he=$(!1),O=$(!1),X=$(1),re=Be(()=>u.messages||[]),ue=Be(()=>u.statusHistory||[]),ye=Be(()=>u.status==="released"||u.status==="cancelled");function G(){e(j)&&setTimeout(()=>{e(j).scrollTop=e(j).scrollHeight},100)}function U(d){v(D,e(D).filter((m,w)=>w!==d),!0)}async function oe(d){return new Promise((m,w)=>{const z=new FileReader;z.onload=()=>m(z.result),z.onerror=w,z.readAsDataURL(d)})}function ee(d){const m=document.createElement("a");m.href=d.data,m.download=d.name,m.click()}function E(d){return{on_hold:"On Hold",verifying:"Verifying",processing:"For Processing",for_pickup:"For Pick Up",released:"Released",rejected:"Rejected",cancelled:"Cancelled"}[d]||d}function N(d){if(!d)return"N/A";const m=new Date(d),w=String(m.getMonth()+1).padStart(2,"0"),z=String(m.getDate()).padStart(2,"0"),A=m.getFullYear();return`${w}/${z}/${A}`}function B(){v(H,!1)}function fe(){v(he,!1)}function dt(){v(O,!0)}function Ke(){v(O,!1)}async function Me(){if(!e(Y).trim()&&e(D).length===0||e(i)||!u||e(ye))return;v(i,!0);const d=e(Y).trim(),m=[...e(D)];let w=[];try{for(const S of m){const C=await oe(S);w.push({name:S.name,type:S.type,size:S.size,data:C})}}catch(S){console.error("Error converting files:",S),Ie.error("Failed to process files. Please try again."),v(i,!1);return}const z=`temp-${Date.now()}`,A={id:z,text:d,author:F().userData?.name||"Student",authorRole:"student",created_at:new Date().toISOString(),attachments:w,isPending:!0};u.messages=[...u.messages||[],A],v(Y,""),v(D,[],!0),G(),e(K)&&setTimeout(()=>e(K).focus(),50);try{const S=await es.post("/api/document-requests",{action:"sendMessage",requestId:u.requestId,message:d,attachments:w});S.success?u.messages=u.messages.map(C=>C.id===z?{...S.data,id:z,isPending:!1}:C):(console.error("Failed to send message:",S.error),u.messages=u.messages.filter(C=>C.id!==z),Ie.error("Failed to send message. Please try again."),v(Y,d,!0),v(D,m,!0))}catch(S){console.error("Error sending message:",S),u.messages=u.messages.filter(C=>C.id!==z),Ie.error("An error occurred while sending the message."),v(Y,d,!0),v(D,m,!0)}finally{v(i,!1)}}function Ze(){v(J,!1)}function Ye(d){v(X,d,!0)}async function vt(){if(!(!u||e(i)))try{const d=await es.get(`/api/document-requests?action=single&requestId=${u.requestId}`);if(d.success&&d.data.messages){const m=e(re).filter(S=>S.isPending),w=d.data.messages,z=new Set(e(re).filter(S=>!S.isPending).map(S=>S.id));w.filter(S=>!z.has(S.id)).length>0&&(u.messages=[...w,...m],G()),d.data.statusHistory&&(u.statusHistory=d.data.statusHistory)}}catch(d){console.error("Error fetching latest messages:",d)}}function Ve(){document.hidden?M&&(clearInterval(M),M=null):M||(vt(),M=setInterval(vt,8e3))}qt(()=>(M=setInterval(vt,8e3),document.addEventListener("visibilitychange",Ve),G(),()=>{M&&clearInterval(M),document.removeEventListener("visibilitychange",Ve)}));var Se=xi(),De=Q(Se),Re=a(De),Ne=a(Re);let tt;var ge=a(Ne),Oe=s(a(ge),2),ct=s(a(Oe)),we=a(ct,!0);t(ct),t(Oe),t(ge);var He=s(ge,2),qe=a(He),de=a(qe),Te=s(a(de),2);Te.__click=[Fl,he];var ke=a(Te,!0);t(Te),t(de);var yt=s(de,2);yt.__click=[$l,H],t(qe);var ut=s(qe,2),gt=s(a(ut),2),wt=a(gt,!0);t(gt),t(ut);var Ct=s(ut,2),at=s(a(Ct),2),It=a(at,!0);t(at),t(Ct);var Ot=s(Ct,2);{var ba=d=>{var m=Hl(),w=s(a(m),2),z=a(w);{var A=C=>{var ve=Ol();n(C,ve)},S=C=>{var ve=te(),ze=Q(ve);{var W=me=>{var V=Bl();V.__click=[Ll,dt];var Ce=a(V);t(V),P(()=>_(Ce,`₱${u.paymentAmount??""} (Pending)`)),n(me,V)},pe=me=>{var V=Vl(),Ce=a(V);t(V),P(()=>_(Ce,`₱${u.paymentAmount??""} (Paid)`)),n(me,V)};k(ze,me=>{u.paymentStatus==="pending"?me(W):me(pe,!1)},!0)}n(C,ve)};k(z,C=>{u.paymentAmount===0?C(A):C(S,!1)})}t(w),t(m),n(d,m)};k(Ot,d=>{u.paymentAmount!==null&&u.paymentAmount!==void 0&&d(ba)})}var Xt=s(Ot,2),Lt=s(a(Xt),2),ya=a(Lt,!0);t(Lt),t(Xt);var ga=s(Xt,2);{var ea=d=>{var m=Ul(),w=s(a(m),2),z=a(w,!0);t(w),t(m),P(()=>_(z,u.cancelledDate)),n(d,m)},wa=d=>{var m=te(),w=Q(m);{var z=A=>{var S=Gl(),C=s(a(S),2),ve=a(C),ze=a(ve,!0);t(ve),t(C),t(S),P(W=>_(ze,W),[()=>N(u.tentativeDate)]),n(A,S)};k(w,A=>{u.tentativeDate&&A(z)},!0)}n(d,m)};k(ga,d=>{u.status==="cancelled"&&u.cancelledDate?d(ea):d(wa,!1)})}var Bt=s(ga,2);{var ka=d=>{var m=Ql(),w=s(a(m),2),z=a(w,!0);t(w),t(m),P(()=>_(z,u.completedDate)),n(d,m)};k(Bt,d=>{u.status==="released"&&u.completedDate&&d(ka)})}t(He);var ft=s(He,2),Vt=s(a(ft),2),Ea=a(Vt,!0);t(Vt),t(ft);var ta=s(ft,2);{var $a=d=>{var m=Kl(),w=s(a(m),2),z=a(w,!0);t(w),t(m),P(()=>_(z,u.adminNote)),n(d,m)};k(ta,d=>{u.adminNote&&d($a)})}var aa=s(ta,2),Mt=a(aa);Mt.__click=[jl,J];var Fa=s(Mt,2);Fa.__click=function(...d){r()?.apply(this,d)},t(aa),t(Ne);var Rt=s(Ne,2);let sa;var la=a(Rt),Ht=a(la),za=s(a(Ht),2),ja=a(za,!0);t(za),t(Ht);var Pt=s(Ht,2),st=a(Pt);{var xa=d=>{var m=te(),w=Q(m);ot(w,17,()=>e(re),z=>z.id,(z,A)=>{var S=ei(),C=a(S);{var ve=ce=>{var Pe=Zl();n(ce,Pe)};k(C,ce=>{e(A).authorRole==="admin"&&ce(ve)})}var ze=s(C,2),W=a(ze),pe=a(W),me=a(pe,!0);t(pe);var V=s(pe,2),Ce=a(V,!0);t(V),t(W);var Ue=s(W,2);{var mt=ce=>{var Pe=Yl(),_t=a(Pe,!0);t(Pe),P(()=>_(_t,e(A).text)),n(ce,Pe)};k(Ue,ce=>{e(A).text&&ce(mt)})}var lt=s(Ue,2);{var kt=ce=>{var Pe=Xl();ot(Pe,21,()=>e(A).attachments,Pa,(_t,it)=>{var zt=Wl();zt.__click=[Jl,ee,it];var xt=s(a(zt),2),Et=a(xt),Kt=a(Et,!0);t(Et);var Zt=s(Et,2),o=a(Zt);t(Zt),t(xt),jt(2),t(zt),P(f=>{_(Kt,e(it).name),_(o,`${f??""} KB`)},[()=>(e(it).size/1024).toFixed(1)]),n(_t,zt)}),t(Pe),n(ce,Pe)};k(lt,ce=>{e(A).attachments&&e(A).attachments.length>0&&ce(kt)})}t(ze),t(S),P(ce=>{se(S,1,`message-wrapper ${e(A).authorRole==="admin"?"received":"sent"}`,"svelte-10q3qfh"),_(me,e(A).author),_(Ce,ce)},[()=>new Date(e(A).created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]),n(z,S)}),n(d,m)},Na=d=>{var m=ti();n(d,m)};k(st,d=>{e(re).length>0?d(xa):d(Na,!1)})}t(Pt),rt(Pt,d=>v(j,d),()=>e(j));var pt=s(Pt,2),ia=a(pt);{var Oa=d=>{var m=si();ot(m,21,()=>e(D),Pa,(w,z,A)=>{var S=ai(),C=s(a(S),2),ve=a(C,!0);t(C);var ze=s(C,2),W=a(ze);t(ze);var pe=s(ze,2);pe.__click=()=>U(A),t(S),P(me=>{_(ve,e(z).name),_(W,`(${me??""} KB)`)},[()=>(e(z).size/1024).toFixed(1)]),n(w,S)}),t(m),n(d,m)};k(ia,d=>{e(D).length>0&&d(Oa)})}var na=s(ia,2);let Sa;var ra=a(na);{var Da=d=>{var m=li(),w=s(a(m),2),z=a(w);t(w),t(m),P(()=>_(z,`Chat is disabled for ${u.status==="released"?"released":"cancelled"} requests`)),n(d,m)},La=d=>{var m=ni(),w=Q(m);w.__change=[Al,D,Z],rt(w,C=>v(Z,C),()=>e(Z));var z=s(w,2);z.__click=[El,Z];var A=s(z,2);Nt(A),A.__keydown=[ii,i,Me],rt(A,C=>v(K,C),()=>e(K));var S=s(A,2);S.__click=Me,P(C=>{A.disabled=e(i),S.disabled=C},[()=>e(i)||!e(Y).trim()&&e(D).length===0]),Jt(A,()=>e(Y),C=>v(Y,C)),n(d,m)};k(ra,d=>{e(ye)?d(Da):d(La,!1)})}t(na),t(pt),t(la),t(Rt),t(Re);var oa=s(Re,2),Ut=a(oa),At=a(Ut);let Ta;At.__click=[ri,Ye];var da=s(At,2);let Gt;da.__click=[oi,Ye],t(Ut),t(oa),t(De);var va=s(De,2);{var ca=d=>{var m=_i();m.__click=fe,m.__keydown=[di,fe];var w=a(m);w.__click=[vi],w.__keydown=[ci];var z=a(w),A=s(a(z),2);A.__click=fe,t(z);var S=s(z,2),C=a(S);{var ve=W=>{var pe=pi();ot(pe,23,()=>e(ue),(me,V)=>me.timestamp||V,(me,V)=>{var Ce=fi(),Ue=a(Ce),mt=a(Ue),lt=a(mt);{var kt=g=>{var h=et("pause_circle");n(g,h)},ce=g=>{var h=te(),I=Q(h);{var R=L=>{var le=et("fact_check");n(L,le)},x=L=>{var le=te(),ie=Q(le);{var xe=_e=>{var Ae=et("sync");n(_e,Ae)},Je=_e=>{var Ae=te(),Ge=Q(Ae);{var Qe=be=>{var ae=et("inventory");n(be,ae)},We=be=>{var ae=te(),Ee=Q(ae);{var ht=$e=>{var nt=et("check_circle");n($e,nt)},$t=$e=>{var nt=te(),Ft=Q(nt);{var Fe=Xe=>{var St=et("cancel");n(Xe,St)},Le=Xe=>{var St=te(),Ha=Q(St);{var rs=Yt=>{var Ua=et("block");n(Yt,Ua)},os=Yt=>{var Ua=et("circle");n(Yt,Ua)};k(Ha,Yt=>{e(V).status==="cancelled"?Yt(rs):Yt(os,!1)},!0)}n(Xe,St)};k(Ft,Xe=>{e(V).status==="rejected"?Xe(Fe):Xe(Le,!1)},!0)}n($e,nt)};k(Ee,$e=>{e(V).status==="released"?$e(ht):$e($t,!1)},!0)}n(be,ae)};k(Ge,be=>{e(V).status==="for_pickup"?be(Qe):be(We,!1)},!0)}n(_e,Ae)};k(ie,_e=>{e(V).status==="processing"?_e(xe):_e(Je,!1)},!0)}n(L,le)};k(I,L=>{e(V).status==="verifying"?L(R):L(x,!1)},!0)}n(g,h)};k(lt,g=>{e(V).status==="on_hold"?g(kt):g(ce,!1)})}t(mt),t(Ue);var Pe=s(Ue,2),_t=a(Pe),it=a(_t),zt=a(it,!0);t(it);var xt=s(it,2),Et=a(xt,!0);t(xt),t(_t);var Kt=s(_t,2);{var Zt=g=>{var h=ui(),I=s(a(h));t(h),P(()=>_(I,` ${e(V).changedBy??""}`)),n(g,h)};k(Kt,g=>{e(V).changedBy&&g(Zt)})}var o=s(Kt,2),f=a(o,!0);t(o),t(Pe),t(Ce),P((g,h)=>{se(Ue,1,`timeline-marker status-${e(V).status??""}`,"svelte-10q3qfh"),_(zt,g),_(Et,h),_(f,e(V).note||"No additional details")},[()=>E(e(V).status),()=>new Date(e(V).timestamp).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})]),n(me,Ce)}),t(pe),n(W,pe)},ze=W=>{var pe=mi();n(W,pe)};k(C,W=>{e(ue)&&e(ue).length>0?W(ve):W(ze,!1)})}t(S),t(w),t(m),n(d,m)};k(va,d=>{e(he)&&d(ca)})}var ua=s(va,2);{var Ba=d=>{var m=yi();m.__click=B,m.__keydown=[hi,B];var w=a(m);w.__click=[qi],w.__keydown=[bi];var z=a(w),A=s(a(z),2);A.__click=B,t(z),jt(2),t(w),t(m),n(d,m)};k(ua,d=>{e(H)&&d(Ba)})}var Qt=s(ua,2);{var Ca=d=>{_a(d,{title:"Cancel Request",size:"small",closable:!0,onClose:Ze,children:(m,w)=>{var z=gi(),A=a(z),S=s(a(A),2),C=a(S),ve=s(a(C),2),ze=a(ve,!0);t(ve),t(C);var W=s(C,2),pe=s(a(W),2),me=a(pe,!0);t(pe),t(W);var V=s(W,2),Ce=s(a(V),2),Ue=a(Ce,!0);t(Ce),t(V),jt(2),t(S),t(A);var mt=s(A,2),lt=a(mt);lt.__click=Ze;var kt=s(lt,2);kt.__click=[Nl,T,u,J,r],t(mt),t(z),P(ce=>{_(ze,u.requestId),_(me,u.type),_(Ue,ce)},[()=>E(u.status)]),n(m,z)},$$slots:{default:!0}})};k(Qt,d=>{e(J)&&d(Ca)})}var Va=s(Qt,2);{var fa=d=>{var m=zi();m.__click=Ke,m.__keydown=[wi,Ke];var w=a(m);w.__click=[ki];var z=a(w),A=s(a(z),2);A.__click=Ke,t(z);var S=s(z,4),C=a(S);C.__click=Ke,t(S),t(w),t(m),n(d,m)};k(Va,d=>{e(O)&&d(fa)})}P((d,m,w,z,A,S)=>{tt=se(Ne,1,"student-docreq-modal-left-container svelte-10q3qfh",null,tt,d),_(we,u.requestId),se(qe,1,`student-docreq-card full-width status-card-horizontal status-card-${u.status??""}`,"svelte-10q3qfh"),se(Te,1,`status-badge status-${u.status??""}`,"svelte-10q3qfh"),_(ke,m),_(wt,u.type),_(It,u.processedBy??"—"),_(ya,u.requestedDate??"—"),_(Ea,u.purpose||"No purpose provided"),Mt.disabled=u.status!=="on_hold",ne(Mt,"title",u.status!=="on_hold"?"Can only cancel requests that are on hold":"Cancel this request"),sa=se(Rt,1,"student-docreq-modal-right-container svelte-10q3qfh",null,sa,w),_(ja,e(re).length),Sa=se(na,1,"student-chat-input svelte-10q3qfh",null,Sa,z),Ta=se(At,1,"pagination-dot svelte-10q3qfh",null,Ta,A),Gt=se(da,1,"pagination-dot svelte-10q3qfh",null,Gt,S)},[()=>({"mobile-hidden":e(X)!==1}),()=>E(u.status),()=>({"mobile-hidden":e(X)!==2}),()=>({disabled:e(ye)}),()=>({active:e(X)===1}),()=>({active:e(X)===2})]),n(c,Se),Tt(),b()}Wt(["click","change","keydown"]);var Di=(c,l)=>c.key==="Enter"&&l(c),Ti=q('<div role="dialog" aria-modal="true" tabindex="-1"><!></div>');function Ci(c,l){Dt(l,!0);let p=$(bt({isOpen:!1,request:null,onCancel:null,onRefresh:null}));Ra.subscribe(j=>{v(p,j,!0)});let b=$(!1),F=$(!1),y=$(null);qt(()=>{e(p).isOpen&&!e(b)&&!e(F)?(setTimeout(()=>{v(b,!0)},10),document.body.style.overflow="hidden"):!e(p).isOpen&&(e(b)||e(F))&&T()});function T(){v(F,!0),setTimeout(()=>{v(b,!1),v(F,!1),document.body.style.overflow=""},300)}function r(j){j.target===j.currentTarget&&Ra.close()}function u(j){j.key==="Escape"&&e(p).isOpen&&Ra.close()}Aa(()=>()=>{document.body.style.overflow=""});var Y=te();ha("keydown",qa,u);var H=Q(Y);{var i=j=>{var K=Ti();let Z;K.__click=r,K.__keydown=[Di,r];var D=a(K);Si(D,{get request(){return e(p).request},get onCancel(){return e(p).onCancel},get onRefresh(){return e(p).onRefresh},onClose:()=>Ra.close()}),t(K),rt(K,M=>v(y,M),()=>e(y)),P(M=>Z=se(K,1,"student-docreq-modal-overlay svelte-1ingzcd",null,Z,M),[()=>({"student-docreq-modal-visible":e(b)&&!e(F),"student-docreq-modal-closing":e(F)})]),n(j,K)};k(H,j=>{(e(p).isOpen||e(b)||e(F))&&j(i)})}n(c,Y),Tt()}Wt(["click","keydown"]);var Ii=q('<link rel="icon"/> <link rel="preconnect" href="https://fonts.googleapis.com"/> <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin=""/> <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&amp;display=swap" rel="stylesheet"/> <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/> <meta name="viewport" content="width=device-width, initial-scale=1.0"/> <meta name="theme-color" content="#1565c0"/>',1),Mi=q("<!> <!> <!> <!> <!>",1);function Fi(c,l){Dt(l,!0);let p=$(!1),b=$(void 0);qt(()=>ma.subscribe(N=>{v(b,N,!0)}));let F=Be(()=>e(b)?.isAuthenticated?e(b).userType==="admin"?ws:e(b).userType==="student"?ks:e(b).userType==="teacher"?zs:as:as);Aa(()=>{setTimeout(()=>{ma.initialize(),v(p,!0),window.appLoadingManager&&window.appLoadingManager.setReady(),X()},2800)});const y=14400*1e3,T=300*1e3,r="lastActivityTimestamp";let u=null,Y=0;function H(){try{const E=localStorage.getItem(r);return E?Number(E):null}catch{return null}}function i(E){try{localStorage.setItem(r,String(E))}catch{}}function j(){try{localStorage.removeItem(r)}catch{}}function K(){u&&(clearTimeout(u),u=null);const E=H()||Date.now(),N=Date.now()-E,B=y-N;if(B<=0){M();return}u=setTimeout(M,B)}async function Z(){try{if(!e(b)?.isAuthenticated||!e(b).userData)return;const E=Date.now();if(E-Y<T)return;const N={id:e(b).userData.id,name:e(b).userData.name,account_number:e(b).userData.accountNumber,account_type:e(b).userData.account_type||e(b).userData.accountType};await fetch("/api/auth/heartbeat",{method:"POST",headers:{"Content-Type":"application/json","x-user-info":JSON.stringify(N)},body:JSON.stringify({timestamp:new Date().toISOString()})}),Y=E}catch(E){console.warn("Heartbeat failed",E)}}function D(){if(!window?.localStorage)return;const E=Date.now();i(E),K(),Z()}function M(){e(b)?.isAuthenticated&&(ma.logout(),j())}let J=!1;function he(){if(J)return;J=!0,["mousemove","mousedown","keydown","scroll","touchstart","click"].forEach(N=>window.addEventListener(N,D,{passive:!0})),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&D()}),window.addEventListener("storage",N=>{N.key===r&&K()})}function O(){if(!J)return;J=!1,["mousemove","mousedown","keydown","scroll","touchstart","click"].forEach(N=>window.removeEventListener(N,D)),document.removeEventListener("visibilitychange",()=>{}),window.removeEventListener("storage",()=>{})}function X(){if(typeof window>"u")return;H()||i(Date.now()),he(),K(),window.addEventListener("beforeunload",()=>{O(),u&&clearTimeout(u)})}var re=Mi();hs(E=>{var N=Ii(),B=Q(N);jt(12),P(()=>ne(B,"href",e(F))),n(E,N)});var ue=Q(re);{var ye=E=>{var N=te(),B=Q(N);is(B,()=>l.children??qs),n(E,N)};k(ue,E=>{e(p)&&E(ye)})}var G=s(ue,2);Ss(G,{});var U=s(G,2);Il(U,{});var oe=s(U,2);Pl(oe,{});var ee=s(oe,2);Ci(ee,{}),n(c,re),Tt()}export{Fi as component};
