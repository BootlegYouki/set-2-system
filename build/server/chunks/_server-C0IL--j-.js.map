{"version":3,"file":"_server-C0IL--j-.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/accounts/next-number/_server.js"],"sourcesContent":["import { json } from \"@sveltejs/kit\";\nimport { c as client } from \"../../../../../chunks/db.js\";\nasync function generateAccountNumber(accountType) {\n  const currentYear = (/* @__PURE__ */ new Date()).getFullYear();\n  const prefix = accountType === \"student\" ? \"STU\" : accountType === \"teacher\" ? \"TCH\" : accountType === \"admin\" ? \"ADM\" : \"ACC\";\n  try {\n    const db = client.db(process.env.MONGODB_DB_NAME);\n    const usersCollection = db.collection(\"users\");\n    const existingAccounts = await usersCollection.find({\n      account_number: { $regex: `^${prefix}-${currentYear}-` },\n      status: { $ne: \"archived\" }\n    }).toArray();\n    if (existingAccounts.length === 0) {\n      return `${prefix}-${currentYear}-0001`;\n    }\n    const existingNumbers = new Set(\n      existingAccounts.map((account) => {\n        const parts = account.account_number.split(\"-\");\n        return parseInt(parts[2]);\n      }).filter((num) => !isNaN(num))\n    );\n    let nextNumber = 1;\n    while (existingNumbers.has(nextNumber)) {\n      nextNumber++;\n    }\n    return `${prefix}-${currentYear}-${nextNumber.toString().padStart(4, \"0\")}`;\n  } catch (error) {\n    console.error(\"Error generating account number:\", error);\n    throw error;\n  }\n}\nasync function GET({ url }) {\n  try {\n    const accountType = url.searchParams.get(\"type\");\n    if (!accountType) {\n      return json({ error: \"Account type is required\" }, { status: 400 });\n    }\n    if (![\"student\", \"teacher\", \"admin\"].includes(accountType)) {\n      return json({ error: \"Invalid account type\" }, { status: 400 });\n    }\n    const nextNumber = await generateAccountNumber(accountType);\n    return json({\n      accountNumber: nextNumber,\n      accountType\n    });\n  } catch (error) {\n    console.error(\"Error getting next account number:\", error);\n    return json({ error: \"Failed to get next account number\" }, { status: 500 });\n  }\n}\nexport {\n  GET\n};\n"],"names":[],"mappings":"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"}