{"version":3,"file":"_server-lg0WpkjZ.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/dashboard/students-per-grade/_server.js"],"sourcesContent":["import { json } from \"@sveltejs/kit\";\nimport { a as connectToDatabase } from \"../../../../../chunks/db.js\";\nimport { v as verifyAuth } from \"../../../../../chunks/auth-helper.js\";\nasync function GET({ request }) {\n  try {\n    const authResult = await verifyAuth(request, [\"admin\", \"teacher\", \"adviser\"]);\n    if (!authResult.success) {\n      return json({ error: authResult.error || \"Authentication required\" }, { status: 401 });\n    }\n    const db = await connectToDatabase();\n    const studentsPerGrade = await db.collection(\"users\").aggregate([\n      {\n        $match: {\n          account_type: \"student\",\n          $or: [\n            { status: { $exists: false } },\n            { status: \"active\" }\n          ]\n        }\n      },\n      {\n        $group: {\n          _id: \"$grade_level\",\n          count: { $sum: 1 }\n        }\n      },\n      {\n        $project: {\n          _id: 0,\n          grade_level: \"$_id\",\n          count: 1\n        }\n      },\n      {\n        $sort: { grade_level: 1 }\n      }\n    ]).toArray();\n    return json({\n      success: true,\n      data: studentsPerGrade\n    });\n  } catch (error) {\n    console.error(\"Error fetching students per grade level:\", error);\n    return json({\n      success: false,\n      error: \"Failed to fetch students per grade level\"\n    }, { status: 500 });\n  }\n}\nexport {\n  GET\n};\n"],"names":[],"mappings":";;;;;;AAGA,eAAe,GAAG,CAAC,EAAE,OAAO,EAAE,EAAE;AAChC,EAAE,IAAI;AACN,IAAI,MAAM,UAAU,GAAG,MAAM,UAAU,CAAC,OAAO,EAAE,CAAC,OAAO,EAAE,SAAS,EAAE,SAAS,CAAC,CAAC;AACjF,IAAI,IAAI,CAAC,UAAU,CAAC,OAAO,EAAE;AAC7B,MAAM,OAAO,IAAI,CAAC,EAAE,KAAK,EAAE,UAAU,CAAC,KAAK,IAAI,yBAAyB,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;AAC5F,IAAI;AACJ,IAAI,MAAM,EAAE,GAAG,MAAM,iBAAiB,EAAE;AACxC,IAAI,MAAM,gBAAgB,GAAG,MAAM,EAAE,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC,SAAS,CAAC;AACpE,MAAM;AACN,QAAQ,MAAM,EAAE;AAChB,UAAU,YAAY,EAAE,SAAS;AACjC,UAAU,GAAG,EAAE;AACf,YAAY,EAAE,MAAM,EAAE,EAAE,OAAO,EAAE,KAAK,EAAE,EAAE;AAC1C,YAAY,EAAE,MAAM,EAAE,QAAQ;AAC9B;AACA;AACA,OAAO;AACP,MAAM;AACN,QAAQ,MAAM,EAAE;AAChB,UAAU,GAAG,EAAE,cAAc;AAC7B,UAAU,KAAK,EAAE,EAAE,IAAI,EAAE,CAAC;AAC1B;AACA,OAAO;AACP,MAAM;AACN,QAAQ,QAAQ,EAAE;AAClB,UAAU,GAAG,EAAE,CAAC;AAChB,UAAU,WAAW,EAAE,MAAM;AAC7B,UAAU,KAAK,EAAE;AACjB;AACA,OAAO;AACP,MAAM;AACN,QAAQ,KAAK,EAAE,EAAE,WAAW,EAAE,CAAC;AAC/B;AACA,KAAK,CAAC,CAAC,OAAO,EAAE;AAChB,IAAI,OAAO,IAAI,CAAC;AAChB,MAAM,OAAO,EAAE,IAAI;AACnB,MAAM,IAAI,EAAE;AACZ,KAAK,CAAC;AACN,EAAE,CAAC,CAAC,OAAO,KAAK,EAAE;AAClB,IAAI,OAAO,CAAC,KAAK,CAAC,0CAA0C,EAAE,KAAK,CAAC;AACpE,IAAI,OAAO,IAAI,CAAC;AAChB,MAAM,OAAO,EAAE,KAAK;AACpB,MAAM,KAAK,EAAE;AACb,KAAK,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;AACvB,EAAE;AACF;;;;"}