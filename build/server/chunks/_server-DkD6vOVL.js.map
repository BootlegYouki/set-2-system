{"version":3,"file":"_server-DkD6vOVL.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/ai-analysis/_server.js"],"sourcesContent":["import { json } from \"@sveltejs/kit\";\nimport { O as OPENROUTER_AI_KEY } from \"../../../../chunks/private.js\";\nasync function POST({ request }) {\n  try {\n    const { data, type } = await request.json();\n    if (!data || !type) {\n      return json({ success: false, error: \"Missing required parameters\" }, { status: 400 });\n    }\n    let prompt = \"\";\n    if (type === \"sectionsPerGrade\") {\n      prompt = `Analyze this junior high school section distribution data for grades 7-10: ${JSON.stringify(data)}. Identify significant imbalances (differences >2 sections between grades) and provide a brief 2-3 sentence analysis with one specific actionable recommendation. Focus on resource allocation and student experience for grades 7-10. Be concise. Limit to 60-70 words.`;\n    } else if (type === \"studentsPerGrade\") {\n      prompt = `Analyze this junior high school student distribution data for grades 7-10: ${JSON.stringify(data)}. Identify significant imbalances in student numbers across grades 7-10 and provide a brief 2-3 sentence analysis with one specific actionable recommendation. Focus on capacity planning and enrollment strategies for grades 7-10. Be concise. Limit to 60-70 words.`;\n    } else if (type === \"teachersPerDepartment\") {\n      prompt = `Analyze this teacher department distribution data: ${JSON.stringify(data)}. Identify staffing imbalances and provide a brief 2-3 sentence analysis with one specific actionable recommendation. Focus on workload distribution and hiring priorities. Be concise. Limit to 60-70 words.`;\n    } else {\n      return json({ success: false, error: \"Invalid analysis type\" }, { status: 400 });\n    }\n    const response = await fetch(\"https://openrouter.ai/api/v1/chat/completions\", {\n      method: \"POST\",\n      headers: {\n        \"Authorization\": `Bearer ${OPENROUTER_AI_KEY}`,\n        \"HTTP-Referer\": \"http://localhost:3000\",\n        \"X-Title\": \"SET-2 System\",\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        model: \"kwaipilot/kat-coder-pro:free\",\n        messages: [\n          {\n            role: \"user\",\n            content: prompt\n          }\n        ]\n      })\n    });\n    if (!response.ok) {\n      throw new Error(\"OpenRouter API request failed\");\n    }\n    const result = await response.json();\n    const analysis = result.choices[0].message.content;\n    return json({ success: true, analysis });\n  } catch (error) {\n    console.error(\"AI Analysis Error:\", error);\n    return json({ success: false, error: error.message }, { status: 500 });\n  }\n}\nexport {\n  POST\n};\n"],"names":[],"mappings":";;;AAEA,eAAe,IAAI,CAAC,EAAE,OAAO,EAAE,EAAE;AACjC,EAAE,IAAI;AACN,IAAI,MAAM,EAAE,IAAI,EAAE,IAAI,EAAE,GAAG,MAAM,OAAO,CAAC,IAAI,EAAE;AAC/C,IAAI,IAAI,CAAC,IAAI,IAAI,CAAC,IAAI,EAAE;AACxB,MAAM,OAAO,IAAI,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,6BAA6B,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;AAC5F,IAAI;AACJ,IAAI,IAAI,MAAM,GAAG,EAAE;AACnB,IAAI,IAAI,IAAI,KAAK,kBAAkB,EAAE;AACrC,MAAM,MAAM,GAAG,CAAC,2EAA2E,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,wQAAwQ,CAAC;AAC3X,IAAI,CAAC,MAAM,IAAI,IAAI,KAAK,kBAAkB,EAAE;AAC5C,MAAM,MAAM,GAAG,CAAC,2EAA2E,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,sQAAsQ,CAAC;AACzX,IAAI,CAAC,MAAM,IAAI,IAAI,KAAK,uBAAuB,EAAE;AACjD,MAAM,MAAM,GAAG,CAAC,mDAAmD,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,6MAA6M,CAAC;AACxS,IAAI,CAAC,MAAM;AACX,MAAM,OAAO,IAAI,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,uBAAuB,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;AACtF,IAAI;AACJ,IAAI,MAAM,QAAQ,GAAG,MAAM,KAAK,CAAC,+CAA+C,EAAE;AAClF,MAAM,MAAM,EAAE,MAAM;AACpB,MAAM,OAAO,EAAE;AACf,QAAQ,eAAe,EAAE,CAAC,OAAO,EAAE,iBAAiB,CAAC,CAAC;AACtD,QAAQ,cAAc,EAAE,uBAAuB;AAC/C,QAAQ,SAAS,EAAE,cAAc;AACjC,QAAQ,cAAc,EAAE;AACxB,OAAO;AACP,MAAM,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC;AAC3B,QAAQ,KAAK,EAAE,8BAA8B;AAC7C,QAAQ,QAAQ,EAAE;AAClB,UAAU;AACV,YAAY,IAAI,EAAE,MAAM;AACxB,YAAY,OAAO,EAAE;AACrB;AACA;AACA,OAAO;AACP,KAAK,CAAC;AACN,IAAI,IAAI,CAAC,QAAQ,CAAC,EAAE,EAAE;AACtB,MAAM,MAAM,IAAI,KAAK,CAAC,+BAA+B,CAAC;AACtD,IAAI;AACJ,IAAI,MAAM,MAAM,GAAG,MAAM,QAAQ,CAAC,IAAI,EAAE;AACxC,IAAI,MAAM,QAAQ,GAAG,MAAM,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,OAAO;AACtD,IAAI,OAAO,IAAI,CAAC,EAAE,OAAO,EAAE,IAAI,EAAE,QAAQ,EAAE,CAAC;AAC5C,EAAE,CAAC,CAAC,OAAO,KAAK,EAAE;AAClB,IAAI,OAAO,CAAC,KAAK,CAAC,oBAAoB,EAAE,KAAK,CAAC;AAC9C,IAAI,OAAO,IAAI,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,CAAC,OAAO,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;AAC1E,EAAE;AACF;;;;"}