{"version":3,"file":"db-B_8POatj.js","sources":["../../../.svelte-kit/adapter-node/chunks/db.js"],"sourcesContent":["import { MongoClient, ServerApiVersion } from \"mongodb\";\nimport dotenv from \"dotenv\";\ndotenv.config();\nconst uri = process.env.MONGODB_URI;\nconst dbName = process.env.MONGODB_DB_NAME || \"set-2-system\";\nconst client = new MongoClient(uri, {\n  serverApi: {\n    version: ServerApiVersion.v1,\n    strict: true,\n    deprecationErrors: true\n  },\n  tls: true,\n  tlsAllowInvalidCertificates: false,\n  connectTimeoutMS: 3e4,\n  socketTimeoutMS: 3e4\n});\nlet isConnected = false;\nasync function connectToDatabase() {\n  try {\n    console.log(\"Attempting to connect to MongoDB...\");\n    console.log(\"MongoDB URI:\", uri ? \"URI is set\" : \"URI is missing\");\n    console.log(\"Database name:\", dbName);\n    if (!uri) {\n      throw new Error(\"MONGODB_URI environment variable is not set\");\n    }\n    if (!uri.startsWith(\"mongodb://\") && !uri.startsWith(\"mongodb+srv://\")) {\n      throw new Error(\"Invalid MongoDB URI format. Must start with mongodb:// or mongodb+srv://\");\n    }\n    if (!isConnected) {\n      await client.connect();\n      await client.db(dbName).admin().ping();\n      isConnected = true;\n      console.log(\"Connected to MongoDB successfully and verified with ping\");\n    }\n    const db = client.db(dbName);\n    console.log(\"Database object created:\", db ? \"Success\" : \"Failed\");\n    return db;\n  } catch (error) {\n    console.error(\"Failed to connect to MongoDB:\", error);\n    isConnected = false;\n    if (error.code === \"ERR_SSL_TLSV1_ALERT_INTERNAL_ERROR\") {\n      console.error(\"SSL/TLS error detected. This might be due to network restrictions or SSL configuration issues.\");\n      throw new Error(\"Database connection failed due to SSL/TLS error. Please check network connectivity and SSL settings.\");\n    }\n    throw error;\n  }\n}\nexport {\n  connectToDatabase as a,\n  client as c\n};\n"],"names":[],"mappings":";;;AAEA,MAAM,CAAC,MAAM,EAAE;AACf,MAAM,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC,WAAW;AACnC,MAAM,MAAM,GAAG,OAAO,CAAC,GAAG,CAAC,eAAe,IAAI,cAAc;AACvD,MAAC,MAAM,GAAG,IAAI,WAAW,CAAC,GAAG,EAAE;AACpC,EAAE,SAAS,EAAE;AACb,IAAI,OAAO,EAAE,gBAAgB,CAAC,EAAE;AAChC,IAAI,MAAM,EAAE,IAAI;AAChB,IAAI,iBAAiB,EAAE;AACvB,GAAG;AACH,EAAE,GAAG,EAAE,IAAI;AACX,EAAE,2BAA2B,EAAE,KAAK;AACpC,EAAE,gBAAgB,EAAE,GAAG;AACvB,EAAE,eAAe,EAAE;AACnB,CAAC;AACD,IAAI,WAAW,GAAG,KAAK;AACvB,eAAe,iBAAiB,GAAG;AACnC,EAAE,IAAI;AACN,IAAI,OAAO,CAAC,GAAG,CAAC,qCAAqC,CAAC;AACtD,IAAI,OAAO,CAAC,GAAG,CAAC,cAAc,EAAE,GAAG,GAAG,YAAY,GAAG,gBAAgB,CAAC;AACtE,IAAI,OAAO,CAAC,GAAG,CAAC,gBAAgB,EAAE,MAAM,CAAC;AACzC,IAAI,IAAI,CAAC,GAAG,EAAE;AACd,MAAM,MAAM,IAAI,KAAK,CAAC,6CAA6C,CAAC;AACpE,IAAI;AACJ,IAAI,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,YAAY,CAAC,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,gBAAgB,CAAC,EAAE;AAC5E,MAAM,MAAM,IAAI,KAAK,CAAC,0EAA0E,CAAC;AACjG,IAAI;AACJ,IAAI,IAAI,CAAC,WAAW,EAAE;AACtB,MAAM,MAAM,MAAM,CAAC,OAAO,EAAE;AAC5B,MAAM,MAAM,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC,KAAK,EAAE,CAAC,IAAI,EAAE;AAC5C,MAAM,WAAW,GAAG,IAAI;AACxB,MAAM,OAAO,CAAC,GAAG,CAAC,0DAA0D,CAAC;AAC7E,IAAI;AACJ,IAAI,MAAM,EAAE,GAAG,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC;AAChC,IAAI,OAAO,CAAC,GAAG,CAAC,0BAA0B,EAAE,EAAE,GAAG,SAAS,GAAG,QAAQ,CAAC;AACtE,IAAI,OAAO,EAAE;AACb,EAAE,CAAC,CAAC,OAAO,KAAK,EAAE;AAClB,IAAI,OAAO,CAAC,KAAK,CAAC,+BAA+B,EAAE,KAAK,CAAC;AACzD,IAAI,WAAW,GAAG,KAAK;AACvB,IAAI,IAAI,KAAK,CAAC,IAAI,KAAK,oCAAoC,EAAE;AAC7D,MAAM,OAAO,CAAC,KAAK,CAAC,gGAAgG,CAAC;AACrH,MAAM,MAAM,IAAI,KAAK,CAAC,sGAAsG,CAAC;AAC7H,IAAI;AACJ,IAAI,MAAM,KAAK;AACf,EAAE;AACF;;;;"}