{"version":3,"file":"_server-Ch7s5C0j.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/current-quarter/_server.js"],"sourcesContent":["import { json } from \"@sveltejs/kit\";\nimport { a as connectToDatabase } from \"../../../../chunks/db.js\";\nfunction parseMMDDYYYY(dateStr) {\n  if (!dateStr || dateStr.trim() === \"\") return null;\n  const parts = dateStr.split(\"-\");\n  if (parts.length !== 3) return null;\n  const [month, day, year] = parts.map((p) => parseInt(p, 10));\n  if (isNaN(month) || isNaN(day) || isNaN(year)) return null;\n  if (month < 1 || month > 12) return null;\n  if (day < 1 || day > 31) return null;\n  return new Date(year, month - 1, day);\n}\nasync function GET({ request }) {\n  try {\n    const db = await connectToDatabase();\n    const adminSettingsCollection = db.collection(\"admin_settings\");\n    const quarterSettings = await adminSettingsCollection.find({\n      setting_key: {\n        $in: [\n          \"quarter_1_start_date\",\n          \"quarter_1_end_date\",\n          \"quarter_2_start_date\",\n          \"quarter_2_end_date\",\n          \"quarter_3_start_date\",\n          \"quarter_3_end_date\",\n          \"quarter_4_start_date\",\n          \"quarter_4_end_date\",\n          \"current_school_year\"\n          // Also fetch school year\n        ]\n      }\n    }).toArray();\n    const settings = {};\n    quarterSettings.forEach((row) => {\n      settings[row.setting_key] = row.setting_value;\n    });\n    const currentSchoolYear = settings.current_school_year || \"2025-2026\";\n    const today = /* @__PURE__ */ new Date();\n    today.setHours(0, 0, 0, 0);\n    const quarters = [\n      {\n        quarter: 1,\n        name: \"1st Quarter\",\n        startDate: parseMMDDYYYY(settings.quarter_1_start_date),\n        endDate: parseMMDDYYYY(settings.quarter_1_end_date)\n      },\n      {\n        quarter: 2,\n        name: \"2nd Quarter\",\n        startDate: parseMMDDYYYY(settings.quarter_2_start_date),\n        endDate: parseMMDDYYYY(settings.quarter_2_end_date)\n      },\n      {\n        quarter: 3,\n        name: \"3rd Quarter\",\n        startDate: parseMMDDYYYY(settings.quarter_3_start_date),\n        endDate: parseMMDDYYYY(settings.quarter_3_end_date)\n      },\n      {\n        quarter: 4,\n        name: \"4th Quarter\",\n        startDate: parseMMDDYYYY(settings.quarter_4_start_date),\n        endDate: parseMMDDYYYY(settings.quarter_4_end_date)\n      }\n    ];\n    let currentQuarter = null;\n    for (const quarter of quarters) {\n      if (!quarter.startDate || !quarter.endDate) {\n        continue;\n      }\n      if (today >= quarter.startDate && today <= quarter.endDate) {\n        currentQuarter = quarter;\n        break;\n      }\n    }\n    if (!currentQuarter) {\n      currentQuarter = quarters[0];\n    }\n    return json({\n      success: true,\n      data: {\n        currentQuarter: currentQuarter.quarter,\n        quarterName: currentQuarter.name,\n        currentSchoolYear,\n        startDate: currentQuarter.startDate ? currentQuarter.startDate.toISOString() : null,\n        endDate: currentQuarter.endDate ? currentQuarter.endDate.toISOString() : null,\n        systemDate: today.toISOString(),\n        allQuarters: quarters.map((q) => ({\n          quarter: q.quarter,\n          name: q.name,\n          startDate: q.startDate ? q.startDate.toISOString() : null,\n          endDate: q.endDate ? q.endDate.toISOString() : null,\n          isActive: q.quarter === currentQuarter?.quarter\n        }))\n      }\n    });\n  } catch (error) {\n    console.error(\"Error determining current quarter:\", error);\n    return json(\n      {\n        error: \"Failed to determine current quarter\",\n        details: error.message\n      },\n      { status: 500 }\n    );\n  }\n}\nexport {\n  GET\n};\n"],"names":[],"mappings":"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"}