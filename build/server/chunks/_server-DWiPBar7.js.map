{"version":3,"file":"_server-DWiPBar7.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/users/_server.js"],"sourcesContent":["import { json } from \"@sveltejs/kit\";\nimport { a as connectToDatabase } from \"../../../../chunks/db.js\";\nimport { ObjectId } from \"mongodb\";\nimport { v as verifyAuth } from \"../../../../chunks/auth-helper.js\";\nasync function GET({ url, request }) {\n  try {\n    const action = url.searchParams.get(\"action\");\n    const userId = url.searchParams.get(\"id\");\n    if (userId) {\n      const authResult = await verifyAuth(request, [\"student\", \"teacher\", \"adviser\", \"admin\"]);\n      if (!authResult.success) {\n        return json({ error: authResult.error }, { status: 401 });\n      }\n      const currentUser = authResult.user;\n      if (currentUser.account_type !== \"admin\" && currentUser.id !== userId) {\n        return json({\n          error: \"Unauthorized: You can only view your own data\"\n        }, { status: 403 });\n      }\n      const db = await connectToDatabase();\n      const user = await db.collection(\"users\").findOne({\n        _id: new ObjectId(userId)\n      });\n      if (!user) {\n        return json({ error: \"User not found\" }, { status: 404 });\n      }\n      const userData = {\n        id: user._id.toString(),\n        account_number: user.account_number,\n        full_name: user.full_name,\n        first_name: user.first_name,\n        last_name: user.last_name,\n        middle_initial: user.middle_initial,\n        email: user.email,\n        contact_number: user.contact_number,\n        address: user.address,\n        birth_date: user.birth_date,\n        age: user.age,\n        guardian: user.guardian,\n        gender: user.gender,\n        grade_level: user.grade_level,\n        account_type: user.account_type,\n        status: user.status,\n        created_at: user.created_at,\n        updated_at: user.updated_at\n      };\n      return json({ success: true, user: userData });\n    }\n    switch (action) {\n      case \"teachers\":\n        const db = await connectToDatabase();\n        const teachers = await db.collection(\"users\").find({\n          account_type: \"teacher\",\n          $or: [\n            { status: { $exists: false } },\n            { status: \"active\" }\n          ]\n        }).sort({ first_name: 1, last_name: 1 }).toArray();\n        const formattedTeachers = teachers.map((teacher) => ({\n          id: teacher._id,\n          accountNumber: teacher.account_number,\n          fullName: teacher.full_name,\n          first_name: teacher.first_name,\n          last_name: teacher.last_name,\n          middleInitial: teacher.middle_initial,\n          email: teacher.email,\n          accountType: teacher.account_type,\n          createdAt: teacher.created_at,\n          updatedAt: teacher.updated_at\n        }));\n        return json({ success: true, data: formattedTeachers });\n      default:\n        return json({ error: \"Invalid action parameter or missing id\" }, { status: 400 });\n    }\n  } catch (error) {\n    console.error(\"Error in /api/users:\", error);\n    if (error.code === \"ECONNREFUSED\" || error.code === \"ENOTFOUND\") {\n      return json({ error: \"Database connection failed\" }, { status: 503 });\n    }\n    return json({ error: \"Failed to fetch user data\" }, { status: 500 });\n  }\n}\nexport {\n  GET\n};\n"],"names":[],"mappings":"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"}